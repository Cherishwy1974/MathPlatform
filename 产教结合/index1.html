<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>高职院校数学技能图谱</title>
<style>
:root {
    --primary-color: #3498db;
    --secondary-color: #2ecc71;
    --tertiary-color: #f39c12;
    --quaternary-color: #e74c3c;
    --quinary-color: #9b59b6;
    --text-color: #333;
    --bg-color: #f9f9f9;
    --card-bg: #fff;
    --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    --manufacturing-color: #e74c3c;
    --electronic-color: #3498db;
    --civil-color: #f39c12;
    --chemical-color: #2ecc71;
    --finance-color: #9b59b6;
    --medical-color: #1abc9c;
    --energy-color: #d35400;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Helvetica Neue', Arial, sans-serif;
}

body {
    background-color: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
}

header {
    background: linear-gradient(135deg, var(--primary-color), var(--quinary-color));
    color: white;
    padding: 10px 0;
    text-align: center;
    box-shadow: var(--shadow);
    position: relative;
    z-index: 100;
}

header h1 {
    font-size: 1.8rem;
}

header .container {
    padding: 5px;
}

header p {
    font-size: 0.9rem;
    margin-top: 5px;
}

.container {
    width: 98%;
    max-width: 1800px;
    margin: 0 auto;
    padding: 10px;
}

.filter-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
}

.filter-group {
    background-color: var(--card-bg);
    padding: 15px;
    border-radius: 8px;
    box-shadow: var(--shadow);
    min-width: 250px;
}

.filter-group h3 {
    text-align: center;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 2px solid var(--primary-color);
    color: var(--primary-color);
}

.filter-btn {
    background-color: #f1f1f1;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
    margin: 3px;
    display: inline-block;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.filter-btn:hover {
    background-color: #e0e0e0;
    transform: translateY(-2px);
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
}

.filter-btn.active {
    background-color: var(--primary-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
}

.skill-map-container {
    background-color: var(--card-bg);
    border-radius: 8px;
    box-shadow: var(--shadow);
    overflow: hidden;
    margin-top: 10px;
    position: relative;
    height: 85vh;
    min-height: 700px;
}

#skill-map {
    width: 100%;
    height: 100%;
}

.node {
    cursor: pointer;
    transition: all 0.3s;
}

.node:hover {
    filter: brightness(1.2);
}

.node text {
    pointer-events: none;
    text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
}

.link {
    fill: none;
    stroke: #999;
    stroke-opacity: 0.6;
    stroke-width: 1.5px;
}

.info-panel {
    position: absolute;
    width: 40%;
    max-width: 500px;
    top: 20px;
    right: 20px;
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 8px;
    box-shadow: var(--shadow);
    padding: 20px;
    display: none;
    max-height: 610px;
    overflow-y: auto;
    z-index: 10;
}

.info-panel h2 {
    color: var(--primary-color);
    margin-bottom: 15px;
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 10px;
}

.info-panel h3 {
    margin: 15px 0 10px;
    color: var(--secondary-color);
}

.related-categories {
    margin-top: 20px;
    border-top: 1px solid #eee;
    padding-top: 15px;
}

.tag-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 15px;
}

.major-tag, .industry-tag {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    color: white;
    margin-right: 5px;
    margin-bottom: 5px;
}

.major-tag.manufacturing { background-color: var(--manufacturing-color); }
.major-tag.electronic { background-color: var(--electronic-color); }
.major-tag.civil { background-color: var(--civil-color); }
.major-tag.chemical { background-color: var(--chemical-color); }
.major-tag.finance { background-color: var(--finance-color); }
.major-tag.medical { background-color: var(--medical-color); }
.major-tag.energy { background-color: var(--energy-color); }

.industry-tag.advmanufacturing { background-color: var(--manufacturing-color); }
.industry-tag.it { background-color: var(--electronic-color); }
.industry-tag.finance { background-color: var(--finance-color); }
.industry-tag.construction { background-color: var(--civil-color); }
.industry-tag.energy { background-color: var(--energy-color); }
.industry-tag.medical { background-color: var(--medical-color); }

.close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: var(--text-color);
}

.category {
    margin-bottom: 20px;
}

.category-title {
    background-color: var(--primary-color);
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    margin-bottom: 10px;
    font-size: 18px;
}

.application-card {
    background-color: #f5f5f5;
    padding: 15px;
    border-radius: 5px;
    margin-bottom: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.app-title {
    font-weight: bold;
    color: var(--tertiary-color);
    margin-bottom: 5px;
}

.tag {
    display: inline-block;
    background-color: var(--quinary-color);
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 12px;
    margin-right: 5px;
    margin-bottom: 5px;
}

.legend {
    background-color: rgba(255, 255, 255, 0.95);
    padding: 15px;
    border-radius: 8px;
    box-shadow: var(--shadow);
    border: 1px solid #eee;
    transition: all 0.3s ease;
    position: relative; /* 移除绝对定位 */
    max-width: 250px;
}

.legend h4 {
    font-size: 14px;
    margin-bottom: 10px;
    text-align: center;
    color: var(--primary-color);
    border-bottom: 1px solid #eee;
    padding-bottom: 5px;
}

.legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    cursor: pointer;
    padding: 3px;
    border-radius: 4px;
    transition: background-color 0.3s;
}

.legend-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.legend-color {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    margin-right: 10px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.tooltip {
    position: absolute;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 14px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 20;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    max-width: 200px;
    text-align: center;
}

footer {
    text-align: center;
    padding: 20px;
    margin-top: 30px;
    background-color: #333;
    color: white;
}

@media (max-width: 768px) {
    .info-panel {
        width: 90%;
        max-width: none;
        left: 5%;
        right: 5%;
        top: 50%;
        transform: translateY(-50%);
        max-height: 80vh;
    }
    
    .container {
        width: 100%;
        padding: 5px;
    }
    
    .skill-map-container {
        height: 75vh;
    }
    
    /* 优化图例和控制按钮的位置 */
    .legends-container {
        position: fixed;
        bottom: 20px;
        right: 10px;
        top: auto;
        max-width: 200px;
        z-index: 100;
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        padding: 10px;
    }
    
    .legend {
        max-height: 250px;
        overflow-y: auto;
        border: none;
        box-shadow: none;
        padding: 5px;
    }
    
    .zoom-controls {
        left: 10px;
        top: 80px; /* 避免与返回按钮重叠 */
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        padding: 5px;
    }
    
    /* 优化返回按钮 */
    .back-button {
        top: 10px;
        left: 10px;
        padding: 8px 12px;
        font-size: 12px;
        z-index: 1001;
    }
    
    .back-button svg {
        width: 16px;
        height: 16px;
    }
    
    /* 优化标题区域 */
    header h1 {
        font-size: 1.5rem;
    }
    
    header p {
        font-size: 0.8rem;
    }
    
    /* 修复节点文本重叠问题 */
    .node text {
        font-size: 10px;
    }
    
    /* 修复信息面板滚动问题 */
    .info-panel {
        -webkit-overflow-scrolling: touch;
    }
}

@media (max-width: 480px) {
    /* 超小屏幕优化 */
    .legends-container {
        max-width: 150px;
        bottom: 10px;
        right: 5px;
    }
    
    .legend-tabs {
        flex-direction: column;
    }
    
    .tab-btn {
        padding: 5px 2px;
        font-size: 11px;
    }
    
    .legend-item {
        padding: 3px;
        font-size: 12px;
    }
    
    .legend-color {
        width: 12px;
        height: 12px;
        margin-right: 5px;
    }
    
    .zoom-controls {
        top: 70px;
    }
    
    .zoom-btn {
        width: 30px;
        height: 30px;
        font-size: 16px;
    }
    
    /* 优化信息面板 */
    .info-panel {
        padding: 10px;
        max-height: 70vh;
        width: 95%;
        left: 2.5%;
        right: 2.5%;
    }
    
    .info-panel h2 {
        font-size: 16px;
        margin-bottom: 10px;
    }
    
    .info-panel h3 {
        font-size: 14px;
    }
    
    .application-card {
        padding: 10px;
    }
    
    /* 优化标题区域 */
    header {
        padding: 5px 0;
    }
    
    header h1 {
        font-size: 1.2rem;
    }
    
    header p {
        font-size: 0.7rem;
        margin-top: 2px;
    }
    
    /* 修复节点文本重叠问题 */
    .node text {
        font-size: 8px;
    }
    
    /* 修复标签溢出问题 */
    .tag-container {
        flex-wrap: wrap;
    }
    
    .major-tag, .industry-tag {
        font-size: 11px;
        padding: 4px 8px;
        margin-bottom: 4px;
    }
}

/* 全局修复 */
* {
    -webkit-text-size-adjust: 100%; /* 防止iOS自动调整字体大小 */
    box-sizing: border-box;
}

/* 修复滚动问题 */
body {
    -webkit-overflow-scrolling: touch;
    overflow-x: hidden;
}

/* 修复图像溢出 */
img, svg {
    max-width: 100%;
    height: auto;
}

/* 修复D3图表在移动端的显示 */
#skill-map svg {
    width: 100%;
    height: 100%;
    touch-action: manipulation;
}

/* 修复节点点击区域 */
.node circle {
    touch-action: manipulation;
}

/* 添加嵌入模式的样式 */
body.embedded-mode {
    margin: 0;
    padding: 0;
    overflow: hidden;
}

body.embedded-mode header,
body.embedded-mode footer {
    display: none;
}

body.embedded-mode .container {
    width: 100%;
    max-width: none;
    padding: 0;
    margin: 0;
}

body.embedded-mode .skill-map-container {
    height: 100vh;
    border-radius: 0;
    margin-top: 0;
}

body.embedded-mode .legends-container {
    right: 10px;
    top: 10px;
}

body.embedded-mode .zoom-controls {
    left: 10px;
    top: 10px;
}

body.embedded-mode .back-button {
    display: none;
}

/* 图例容器样式 */
.legends-container {
    position: absolute;
    right: 20px;
    top: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 10;
    max-width: 250px;
}

.legend:hover {
    transform: translateX(-5px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.legend h4 {
    font-size: 14px;
    margin-bottom: 10px;
    text-align: center;
    color: var(--primary-color);
    border-bottom: 1px solid #eee;
    padding-bottom: 5px;
}

.legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
    transition: all 0.3s;
}

.legend-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
    transform: translateX(3px);
}

.legend-item.active {
    background-color: rgba(0, 0, 0, 0.08);
    font-weight: bold;
}

.legend-color {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    margin-right: 10px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.zoom-controls {
    position: absolute;
    left: 20px;
    top: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 10;
}

.zoom-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: white;
    border: 1px solid #ddd;
    color: #555;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: all 0.3s;
}

.zoom-btn:hover {
    background-color: var(--primary-color);
    color: white;
    transform: scale(1.1);
}

/* 添加新的样式 */
.legend-tabs {
    display: flex;
    border-bottom: 1px solid #eee;
    margin-bottom: 10px;
}

.tab-btn {
    flex: 1;
    padding: 8px 5px;
    background: none;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    color: #777;
    transition: all 0.3s;
}

.tab-btn:hover {
    color: var(--primary-color);
}

.tab-btn.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
    font-weight: bold;
}

.tab-content {
    display: none;
    max-height: 300px;
    overflow-y: auto;
}

.tab-content.active {
    display: block;
}

/* 返回按钮样式 */
.back-button {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: linear-gradient(135deg, #3b82f6, #4f46e5);
    color: white;
    padding: 10px 16px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(4px);
}

.back-button:hover {
    background: linear-gradient(135deg, #2563eb, #4338ca);
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
}

.back-button:active {
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
}

.back-button svg {
    width: 18px;
    height: 18px;
    stroke-width: 2.5;
}

/* 移动端适配 */
@media (max-width: 768px) {
    .info-panel {
        width: 90%;
        max-width: none;
        left: 5%;
        right: 5%;
        top: 50%;
        transform: translateY(-50%);
        max-height: 80vh;
    }
    
    .container {
        width: 100%;
        padding: 5px;
    }
    
    .skill-map-container {
        height: 75vh;
    }
    
    /* 优化图例和控制按钮的位置 */
    .legends-container {
        position: fixed;
        bottom: 20px;
        right: 10px;
        top: auto;
        max-width: 200px;
        z-index: 100;
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        padding: 10px;
    }
    
    .legend {
        max-height: 250px;
        overflow-y: auto;
        border: none;
        box-shadow: none;
        padding: 5px;
    }
    
    .zoom-controls {
        left: 10px;
        top: 80px; /* 避免与返回按钮重叠 */
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        padding: 5px;
    }
    
    /* 优化返回按钮 */
    .back-button {
        top: 10px;
        left: 10px;
        padding: 8px 12px;
        font-size: 12px;
        z-index: 1001;
    }
    
    .back-button svg {
        width: 16px;
        height: 16px;
    }
    
    /* 优化标题区域 */
    header h1 {
        font-size: 1.5rem;
    }
    
    header p {
        font-size: 0.8rem;
    }
    
    /* 修复节点文本重叠问题 */
    .node text {
        font-size: 10px;
    }
    
    /* 修复信息面板滚动问题 */
    .info-panel {
        -webkit-overflow-scrolling: touch;
    }
}

@media (max-width: 480px) {
    /* 超小屏幕优化 */
    .legends-container {
        max-width: 150px;
        bottom: 10px;
        right: 5px;
    }
    
    .legend-tabs {
        flex-direction: column;
    }
    
    .tab-btn {
        padding: 5px 2px;
        font-size: 11px;
    }
    
    .legend-item {
        padding: 3px;
        font-size: 12px;
    }
    
    .legend-color {
        width: 12px;
        height: 12px;
        margin-right: 5px;
    }
    
    .zoom-controls {
        top: 70px;
    }
    
    .zoom-btn {
        width: 30px;
        height: 30px;
        font-size: 16px;
    }
    
    /* 优化信息面板 */
    .info-panel {
        padding: 10px;
        max-height: 70vh;
        width: 95%;
        left: 2.5%;
        right: 2.5%;
    }
    
    .info-panel h2 {
        font-size: 16px;
        margin-bottom: 10px;
    }
    
    .info-panel h3 {
        font-size: 14px;
    }
    
    .application-card {
        padding: 10px;
    }
    
    /* 优化标题区域 */
    header {
        padding: 5px 0;
    }
    
    header h1 {
        font-size: 1.2rem;
    }
    
    header p {
        font-size: 0.7rem;
        margin-top: 2px;
    }
    
    /* 修复节点文本重叠问题 */
    .node text {
        font-size: 8px;
    }
    
    /* 修复标签溢出问题 */
    .tag-container {
        flex-wrap: wrap;
    }
    
    .major-tag, .industry-tag {
        font-size: 11px;
        padding: 4px 8px;
        margin-bottom: 4px;
    }
}

/* 添加嵌入模式的样式 */
body.embedded-mode {
    margin: 0;
    padding: 0;
    overflow: hidden;
}

body.embedded-mode header,
body.embedded-mode footer {
    display: none;
}

body.embedded-mode .container {
    width: 100%;
    max-width: none;
    padding: 0;
    margin: 0;
}

body.embedded-mode .skill-map-container {
    height: 100vh;
    border-radius: 0;
    margin-top: 0;
}

body.embedded-mode .legends-container {
    right: 10px;
    top: 10px;
}

body.embedded-mode .zoom-controls {
    left: 10px;
    top: 10px;
}

body.embedded-mode .back-button {
    display: none;
}

/* 整体布局缩小 */
.container {
    width: 98%;
    max-width: 1800px;
    margin: 0 auto;
    padding: 10px;
}

/* 标题区域缩小 */
header {
    padding: 10px 0;
}

header h1 {
    font-size: 1.8rem;
}

header p {
    font-size: 0.9rem;
    margin-top: 5px;
}

/* 技能图谱容器缩小 */
.skill-map-container {
    height: 85vh;
    min-height: 700px;
    margin-top: 10px;
}

/* 图例和控制按钮缩小 */
.legends-container {
    max-width: 250px;
    right: 20px;
    top: 20px;
}

.legend {
    padding: 15px;
}

.legend h4 {
    font-size: 14px;
    margin-bottom: 10px;
    padding-bottom: 5px;
}

.legend-item {
    margin-bottom: 8px;
    padding: 5px;
}

.legend-color {
    width: 15px;
    height: 15px;
    margin-right: 10px;
}

.zoom-controls {
    left: 20px;
    top: 20px;
    gap: 10px;
}

.zoom-btn {
    width: 36px;
    height: 36px;
    font-size: 18px;
}

/* 返回按钮缩小 */
.back-button {
    padding: 10px 16px;
    font-size: 14px;
    top: 20px;
    left: 20px;
}

.back-button svg {
    width: 18px;
    height: 18px;
}

/* 信息面板缩小 */
.info-panel {
    width: 40%;
    max-width: 500px;
    padding: 20px;
    max-height: 610px;
}

.info-panel h2 {
    font-size: inherit;
    margin-bottom: 15px;
    padding-bottom: 10px;
}

.info-panel h3 {
    font-size: inherit;
    margin: 15px 0 10px;
}

.application-card {
    padding: 15px;
    margin-bottom: 10px;
}

.tag {
    padding: 2px 8px;
    font-size: 12px;
    margin-right: 5px;
    margin-bottom: 5px;
}

/* 页脚缩小 */
footer {
    padding: 20px;
    margin-top: 30px;
}

/* 移动端特别优化 - 保留这部分 */
@media (max-width: 768px) {
    .info-panel {
        width: 90%;
        max-width: none;
        left: 5%;
        right: 5%;
        padding: 10px;
        max-height: 70vh;
    }
    
    .container {
        padding: 3px;
    }
    
    .skill-map-container {
        height: 70vh;
        min-height: 400px;
    }
    
    /* 优化图例和控制按钮的位置 */
    .legends-container {
        position: fixed;
        bottom: 10px;
        right: 5px;
        top: auto;
        max-width: 150px;
        z-index: 100;
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        padding: 8px;
    }
    
    .legend {
        max-height: 200px;
        overflow-y: auto;
        border: none;
        box-shadow: none;
        padding: 3px;
    }
    
    .zoom-controls {
        left: 5px;
        top: 60px; /* 避免与返回按钮重叠 */
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        padding: 3px;
    }
    
    /* 优化返回按钮 */
    .back-button {
        top: 5px;
        left: 5px;
        padding: 5px 10px;
        font-size: 11px;
        z-index: 1001;
    }
    
    .back-button svg {
        width: 12px;
        height: 12px;
    }
    
    /* 优化标题区域 */
    header h1 {
        font-size: 1.2rem;
    }
    
    header p {
        font-size: 0.7rem;
    }
    
    /* 修复节点文本重叠问题 */
    .node text {
        font-size: 8px;
    }
    
    /* 修复信息面板滚动问题 */
    .info-panel {
        -webkit-overflow-scrolling: touch;
    }
}

@media (max-width: 480px) {
    /* 超小屏幕优化 */
    .legends-container {
        max-width: 120px;
        bottom: 5px;
        right: 3px;
        padding: 5px;
    }
    
    .legend-tabs {
        flex-direction: column;
    }
    
    .tab-btn {
        padding: 3px 2px;
        font-size: 10px;
    }
    
    .legend-item {
        padding: 2px;
        font-size: 10px;
    }
    
    .legend-color {
        width: 10px;
        height: 10px;
        margin-right: 4px;
    }
    
    .zoom-controls {
        top: 50px;
        left: 3px;
    }
    
    .zoom-btn {
        width: 25px;
        height: 25px;
        font-size: 14px;
    }
    
    /* 优化信息面板 */
    .info-panel {
        padding: 8px;
        max-height: 60vh;
        width: 95%;
        left: 2.5%;
        right: 2.5%;
    }
    
    .info-panel h2 {
        font-size: 14px;
        margin-bottom: 8px;
    }
    
    .info-panel h3 {
        font-size: 12px;
    }
    
    .application-card {
        padding: 8px;
    }
    
    /* 优化标题区域 */
    header {
        padding: 3px 0;
    }
    
    header h1 {
        font-size: 1rem;
    }
    
    header p {
        font-size: 0.6rem;
        margin-top: 1px;
    }
    
    /* 修复节点文本重叠问题 */
    .node text {
        font-size: 6px;
    }
    
    /* 修复标签溢出问题 */
    .tag-container {
        flex-wrap: wrap;
    }
    
    .major-tag, .industry-tag {
        font-size: 9px;
        padding: 3px 6px;
        margin-bottom: 3px;
    }
}
</style>
</head>
<body>
    <!-- 添加返回按钮 -->
    <a href="index.html" class="back-button">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        返回案例库
    </a>
    
<header>
<div class="container">
    <h1 class="text-base">高职院校数学技能图谱</h1>
    <p class="text-xs">面向产业 · 结合行业标准 · 服务专业 · 靠近实际岗位案例</p>
</div>
</header>

<div class="container">
<div class="skill-map-container">
    <div id="skill-map"></div>
    
    <div class="zoom-controls">
        <button id="zoom-in" class="zoom-btn">+</button>
        <button id="reset-view" class="zoom-btn">⟲</button>
        <button id="zoom-out" class="zoom-btn">-</button>
    </div>
    
    <div class="legends-container">
        <div class="legend combined-legend">
            <div class="legend-tabs">
                <button class="tab-btn active" data-tab="math">数学知识</button>
                <button class="tab-btn" data-tab="major">专业大类</button>
                <button class="tab-btn" data-tab="industry">支柱产业</button>
            </div>
            
            <div class="legend-content">
                <div class="tab-content math-content active">
                    <div class="legend-item" data-category="all" data-type="category">
                        <div class="legend-color" style="background-color: #555;"></div>
                        <span>全部</span>
                    </div>
                    <div class="legend-item" data-category="algebra" data-type="category">
                        <div class="legend-color" style="background-color: #3498db;"></div>
                        <span>代数与函数</span>
                    </div>
                    <div class="legend-item" data-category="calculus" data-type="category">
                        <div class="legend-color" style="background-color: #2ecc71;"></div>
                        <span>微积分</span>
                    </div>
                    <div class="legend-item" data-category="differential" data-type="category">
                        <div class="legend-color" style="background-color: #e74c3c;"></div>
                        <span>微分方程</span>
                    </div>
                    <div class="legend-item" data-category="multivariate" data-type="category">
                        <div class="legend-color" style="background-color: #f39c12;"></div>
                        <span>多元函数</span>
                    </div>
                    <div class="legend-item" data-category="matrix" data-type="category">
                        <div class="legend-color" style="background-color: #9b59b6;"></div>
                        <span>线性代数</span>
                    </div>
                    <div class="legend-item" data-category="series" data-type="category">
                        <div class="legend-color" style="background-color: #1abc9c;"></div>
                        <span>级数</span>
                    </div>
                    <div class="legend-item" data-category="vector" data-type="category">
                        <div class="legend-color" style="background-color: #d35400;"></div>
                        <span>机械</span>
                    </div>
                    <div class="legend-item" data-category="probability" data-type="category">
                        <div class="legend-color" style="background-color: #8e44ad;"></div>
                        <span>概率统计</span>
                    </div>
                </div>
                
                <div class="tab-content major-content">
                    <div class="legend-item" data-category="all" data-type="major">
                        <div class="legend-color" style="background-color: #555;"></div>
                        <span>全部专业</span>
                    </div>
                    <div class="legend-item" data-category="manufacturing" data-type="major">
                        <div class="legend-color" style="background-color: var(--manufacturing-color);"></div>
                        <span>装备制造大类</span>
                    </div>
                    <div class="legend-item" data-category="electronic" data-type="major">
                        <div class="legend-color" style="background-color: var(--electronic-color);"></div>
                        <span>电子信息大类</span>
                    </div>
                    <div class="legend-item" data-category="civil" data-type="major">
                        <div class="legend-color" style="background-color: var(--civil-color);"></div>
                        <span>土木建筑大类</span>
                    </div>
                    <div class="legend-item" data-category="chemical" data-type="major">
                        <div class="legend-color" style="background-color: var(--chemical-color);"></div>
                        <span>化工与生物大类</span>
                    </div>
                    <div class="legend-item" data-category="finance" data-type="major">
                        <div class="legend-color" style="background-color: var(--finance-color);"></div>
                        <span>财经商贸大类</span>
                    </div>
                    <div class="legend-item" data-category="medical" data-type="major">
                        <div class="legend-color" style="background-color: var(--medical-color);"></div>
                        <span>医药卫生大类</span>
                    </div>
                    <div class="legend-item" data-category="energy" data-type="major">
                        <div class="legend-color" style="background-color: var(--energy-color);"></div>
                        <span>能源动力与材料大类</span>
                    </div>
                </div>
                
                <div class="tab-content industry-content">
                    <div class="legend-item" data-category="all" data-type="industry">
                        <div class="legend-color" style="background-color: #555;"></div>
                        <span>全部产业</span>
                    </div>
                    <div class="legend-item" data-category="advmanufacturing" data-type="industry">
                        <div class="legend-color" style="background-color: var(--manufacturing-color);"></div>
                        <span>先进制造业</span>
                    </div>
                    <div class="legend-item" data-category="it" data-type="industry">
                        <div class="legend-color" style="background-color: var(--electronic-color);"></div>
                        <span>信息技术产业</span>
                    </div>
                    <div class="legend-item" data-category="finance" data-type="industry">
                        <div class="legend-color" style="background-color: var(--finance-color);"></div>
                        <span>金融服务业</span>
                    </div>
                    <div class="legend-item" data-category="construction" data-type="industry">
                        <div class="legend-color" style="background-color: var(--civil-color);"></div>
                        <span>建筑工程业</span>
                    </div>
                    <div class="legend-item" data-category="energy" data-type="industry">
                        <div class="legend-color" style="background-color: var(--energy-color);"></div>
                        <span>能源产业</span>
                    </div>
                    <div class="legend-item" data-category="medical" data-type="industry">
                        <div class="legend-color" style="background-color: var(--medical-color);"></div>
                        <span>医疗健康产业</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="info-panel">
        <button class="close-btn">&times;</button>
        <h2 id="info-title">知识点详情</h2>
        <div id="info-content">
            <!-- 内容将通过JS动态添加 -->
        </div>
        <div class="related-categories">
            <h3>相关专业大类</h3>
            <div id="related-majors" class="tag-container">
                <!-- 相关专业大类将通过JS动态添加 -->
            </div>
            
            <h3>相关支柱产业</h3>
            <div id="related-industries" class="tag-container">
                <!-- 相关支柱产业将通过JS动态添加 -->
            </div>
        </div>
    </div>
    
    <div class="tooltip"></div>
</div>
</div>

<footer>
<p>&copy; 2025 高职院校数学技能图谱 - 面向产业应用与岗位需求</p>
</footer>

<!-- 引入D3.js库 -->
<script src="d3.min.js"></script>
<script>
// 数学知识点数据
const mathKnowledgeData = {
    "name": "数学技能图谱",
    "children": [
        {
            "name": "代数与函数",
            "category": "algebra",
            "color": "#3498db",
            "children": [
                {
                    "name": "代数基础知识",
                    "details": {
                        "description": "包括基本运算法则、因式分解、方程与不等式等",
                        "applications": [
                            {
                                "title": "智能制造中的参数计算",
                                "industry": "制造业",
                                "position": "工艺参数设计师",
                                "description": "在智能制造生产线上，运用代数方程设计加工参数，确保产品质量和生产效率",
                                "standards": ["中国制造2025", "智能制造工程技术人员国家职业标准"],
                                "majorCategories": ["manufacturing", "electronic"],
                                "industries": ["advmanufacturing", "it"]
                            },
                            {
                                "title": "建筑工程造价估算",
                                "industry": "建筑业",
                                "position": "工程造价员",
                                "description": "利用代数公式进行工程量计算和造价估算，优化建筑成本",
                                "standards": ["建筑工程造价员职业标准", "建筑工程预算定额"],
                                "majorCategories": ["civil", "finance"],
                                "industries": ["construction", "finance"]
                            }
                        ],
                        "majorCategories": ["manufacturing", "electronic", "civil", "finance"],
                        "industries": ["advmanufacturing", "it", "construction", "finance"]
                    }
                },
                {
                    "name": "函数",
                    "details": {
                        "description": "函数概念、性质、图像、特殊函数等",
                        "applications": [
                            {
                                "title": "电子电路中的函数关系分析",
                                "industry": "电子信息",
                                "position": "电路设计工程师",
                                "description": "分析电子元件之间的函数关系，进行电路参数优化和性能预测",
                                "standards": ["电子工程师职业资格标准", "电子产品制造标准"],
                                "majorCategories": ["electronic", "manufacturing"],
                                "industries": ["it", "advmanufacturing"]
                            },
                            {
                                "title": "市场营销数据分析",
                                "industry": "商业服务",
                                "position": "数据分析师",
                                "description": "利用函数建模分析销售数据趋势，预测市场需求变化，辅助制定营销策略",
                                "standards": ["大数据分析师职业标准", "商业数据分析规范"],
                                "majorCategories": ["finance"],
                                "industries": ["finance", "it"]
                            }
                        ],
                        "majorCategories": ["electronic", "manufacturing", "finance"],
                        "industries": ["it", "advmanufacturing", "finance"]
                    }
                }
            ]
        },
        {
            "name": "多元函数",
            "category": "multivariate",
            "color": "#f39c12",
            "children": [
                {
                    "name": "多元函数的基本概念",
                    "details": {
                        "description": "多元函数的定义域、值域、图形等",
                        "applications": [
                            {
                                "title": "热力学多参数系统分析",
                                "industry": "能源工程",
                                "position": "热能工程师",
                                "description": "应用多元函数分析温度、压力、体积等多个参数之间的关系，优化热力系统效率",
                                "standards": ["热能工程师职业资格标准", "工业锅炉能效标准"],
                                "majorCategories": ["energy", "manufacturing"],
                                "industries": ["energy", "advmanufacturing"]
                            },
                            {
                                "title": "环境监测数据分析",
                                "industry": "环境保护",
                                "position": "环境数据分析师",
                                "description": "利用多元函数分析空气、水、土壤等多种环境因素之间的相互关系，评估污染源影响",
                                "standards": ["环境监测技术规范", "环境数据分析标准"],
                                "majorCategories": ["chemical", "energy"],
                                "industries": ["energy", "advmanufacturing"]
                            }
                        ],
                        "majorCategories": ["energy", "manufacturing", "chemical"],
                        "industries": ["energy", "advmanufacturing"]
                    }
                },
                {
                    "name": "偏导数",
                    "details": {
                        "description": "偏导数的概念与计算、几何意义等",
                        "applications": [
                            {
                                "title": "经济学边际效益分析",
                                "industry": "经济管理",
                                "position": "经济分析师",
                                "description": "利用偏导数计算不同投入要素对产出的边际贡献，优化资源配置",
                                "standards": ["经济师职业资格标准", "企业经济管理规范"],
                                "majorCategories": ["finance"],
                                "industries": ["finance"]
                            },
                            {
                                "title": "化学反应速率分析",
                                "industry": "化工制造",
                                "position": "工艺工程师",
                                "description": "应用偏导数分析温度、浓度等因素对化学反应速率的影响，调整生产参数",
                                "standards": ["化工工程师职业标准", "化工生产安全规范"],
                                "majorCategories": ["chemical", "manufacturing"],
                                "industries": ["advmanufacturing"]
                            },
                            {
                                "title": "机器学习算法优化",
                                "industry": "人工智能",
                                "position": "算法工程师",
                                "description": "利用偏导数计算损失函数的梯度，实现神经网络参数优化和模型训练",
                                "standards": ["人工智能工程师职业标准", "机器学习模型评估规范"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            }
                        ],
                        "majorCategories": ["finance", "chemical", "manufacturing", "electronic"],
                        "industries": ["finance", "advmanufacturing", "it"]
                    }
                },
                {
                    "name": "二元函数的极值",
                    "details": {
                        "description": "二元函数极值的判定条件与求解方法",
                        "applications": [
                            {
                                "title": "生产成本优化",
                                "industry": "制造业",
                                "position": "生产管理工程师",
                                "description": "利用二元函数极值理论优化生产批量和库存量，实现最低成本运营",
                                "standards": ["工业工程师职业标准", "成本管理规范"],
                                "majorCategories": ["manufacturing", "finance"],
                                "industries": ["advmanufacturing", "finance"]
                            },
                            {
                                "title": "物流配送路径优化",
                                "industry": "物流业",
                                "position": "物流规划师",
                                "description": "应用多元函数极值理论优化配送中心选址和配送路线，降低物流成本",
                                "standards": ["物流师职业资格标准", "物流服务质量标准"],
                                "majorCategories": ["finance"],
                                "industries": ["finance", "advmanufacturing"]
                            },
                            {
                                "title": "结构设计参数优化",
                                "industry": "工程设计",
                                "position": "优化设计工程师",
                                "description": "应用多元函数极值理论寻找结构设计参数的最优组合，实现轻量化设计和性能最优",
                                "standards": ["工程设计优化技术规范", "结构优化设计标准"],
                                "majorCategories": ["manufacturing", "civil"],
                                "industries": ["advmanufacturing", "construction"]
                            }
                        ],
                        "majorCategories": ["manufacturing", "finance", "civil"],
                        "industries": ["advmanufacturing", "finance", "construction"]
                    }
                }
            ]
        },
        {
            "name": "微积分",
            "category": "calculus",
            "color": "#2ecc71",
            "children": [
                {
                    "name": "数列极限",
                    "details": {
                        "description": "数列的极限概念与性质，收敛与发散等",
                        "applications": [
                            {
                                "title": "金融投资回报分析",
                                "industry": "金融业",
                                "position": "投资分析师",
                                "description": "应用数列极限计算复利增长和投资回报率，评估长期投资价值",
                                "standards": ["证券投资分析师执业标准", "金融分析行业规范"],
                                "majorCategories": ["finance"],
                                "industries": ["finance"]
                            },
                            {
                                "title": "工业生产持续改进",
                                "industry": "制造业",
                                "position": "工业工程师",
                                "description": "应用数列极限评估生产优化效果，分析生产效率提升空间，实现精益生产",
                                "standards": ["工业工程师职业标准", "精益生产管理规范"],
                                "majorCategories": ["manufacturing"],
                                "industries": ["advmanufacturing"]
                            }
                        ],
                        "majorCategories": ["finance", "manufacturing"],
                        "industries": ["finance", "advmanufacturing"]
                    }
                },
                {
                    "name": "函数极限",
                    "details": {
                        "description": "函数极限的概念与性质，左右极限等",
                        "applications": [
                            {
                                "title": "电气工程中的瞬态分析",
                                "industry": "电力工程",
                                "position": "电气工程师",
                                "description": "利用函数极限分析电气系统在开关瞬间的状态变化，确保系统稳定性",
                                "standards": ["电气工程师职业资格标准", "电气安全技术规范"],
                                "majorCategories": ["energy", "electronic"],
                                "industries": ["energy", "advmanufacturing"]
                            },
                            {
                                "title": "通信系统信号分析",
                                "industry": "通信技术",
                                "position": "通信工程师",
                                "description": "应用函数极限分析信号传输特性，优化通信系统设计",
                                "standards": ["通信工程师职业标准", "通信系统设计规范"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            }
                        ],
                        "majorCategories": ["energy", "electronic"],
                        "industries": ["energy", "advmanufacturing", "it"]
                    }
                },
                {
                    "name": "导数",
                    "details": {
                        "description": "导数的概念、几何意义、求导法则等",
                        "applications": [
                            {
                                "title": "机械设备速度与加速度分析",
                                "industry": "机械制造",
                                "position": "机械设计工程师",
                                "description": "应用导数计算机械运动部件的速度和加速度，优化设备运行效率和安全性",
                                "standards": ["机械设计工程师职业标准", "机械安全标准"],
                                "majorCategories": ["manufacturing"],
                                "industries": ["advmanufacturing"]
                            },
                            {
                                "title": "信号处理中的变化率分析",
                                "industry": "通信工程",
                                "position": "信号处理工程师",
                                "description": "利用导数描述信号变化率，进行信号滤波和特征提取",
                                "standards": ["通信工程技术人员职业标准", "信号处理技术规范"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            },
                            {
                                "title": "经济学边际分析",
                                "industry": "经济管理",
                                "position": "经济分析师",
                                "description": "利用导数进行边际成本和边际收益分析，确定最优生产规模",
                                "standards": ["经济师职业资格标准", "企业经济分析规范"],
                                "majorCategories": ["finance"],
                                "industries": ["finance"]
                            }
                        ],
                        "majorCategories": ["manufacturing", "electronic", "finance"],
                        "industries": ["advmanufacturing", "it", "finance"]
                    }
                },
                {
                    "name": "不定积分",
                    "details": {
                        "description": "不定积分的概念与性质，积分方法等",
                        "applications": [
                            {
                                "title": "工程结构变形分析",
                                "industry": "土木工程",
                                "position": "结构工程师",
                                "description": "通过不定积分计算结构在荷载作用下的变形，评估结构安全性",
                                "standards": ["结构工程师执业资格标准", "建筑结构设计规范"],
                                "majorCategories": ["civil"],
                                "industries": ["construction"]
                            },
                            {
                                "title": "电磁场理论应用",
                                "industry": "电子工程",
                                "position": "电磁场工程师",
                                "description": "运用不定积分计算电磁场分布，分析电磁兼容性问题",
                                "standards": ["电子工程师职业标准", "电磁兼容性技术规范"],
                                "majorCategories": ["electronic", "energy"],
                                "industries": ["it", "energy"]
                            }
                        ],
                        "majorCategories": ["civil", "electronic", "energy"],
                        "industries": ["construction", "it", "energy"]
                    }
                },
                {
                    "name": "定积分",
                    "details": {
                        "description": "定积分的概念与性质，微积分基本定理等",
                        "applications": [
                            {
                                "title": "流体力学中的流量计算",
                                "industry": "水利工程",
                                "position": "水利工程师",
                                "description": "应用定积分计算管道或河流的流量，进行水利工程设计和洪水预测",
                                "standards": ["水利工程师职业资格标准", "水利工程设计规范"],
                                "majorCategories": ["civil"],
                                "industries": ["construction", "energy"]
                            },
                            {
                                "title": "工业产品体积计算",
                                "industry": "制造业",
                                "position": "产品开发工程师",
                                "description": "利用定积分计算不规则形状工业产品的体积，进行材料用量估算",
                                "standards": ["产品设计工程师职业标准", "产品质量管理规范"],
                                "majorCategories": ["manufacturing"],
                                "industries": ["advmanufacturing"]
                            },
                            {
                                "title": "经济学中的消费者剩余计算",
                                "industry": "经济学",
                                "position": "市场经济分析师",
                                "description": "应用定积分计算消费者剩余和生产者剩余，分析市场效率",
                                "standards": ["经济师职业资格标准", "市场经济分析规范"],
                                "majorCategories": ["finance"],
                                "industries": ["finance"]
                            }
                        ],
                        "majorCategories": ["civil", "manufacturing", "finance"],
                        "industries": ["construction", "energy", "advmanufacturing", "finance"]
                    }
                }
            ]
        },
        {
            "name": "微分方程",
            "category": "differential",
            "color": "#e74c3c",
            "children": [
                {
                    "name": "一阶线性微分方程",
                    "details": {
                        "description": "一阶线性微分方程的解法与应用",
                        "applications": [
                            {
                                "title": "电路暂态响应分析",
                                "industry": "电子工程",
                                "position": "电子系统设计师",
                                "description": "应用一阶微分方程分析RC电路的充放电过程，设计电子时序控制系统",
                                "standards": ["电子工程师职业资格标准", "电子产品可靠性设计规范"],
                                "majorCategories": ["electronic", "manufacturing"],
                                "industries": ["it", "advmanufacturing"]
                            },
                            {
                                "title": "药物代谢动力学分析",
                                "industry": "医药制造",
                                "position": "药物研发技术员",
                                "description": "利用一阶微分方程建立药物在体内的代谢模型，预测药效持续时间",
                                "standards": ["药物研发工程师职业标准", "药物临床试验技术规范"],
                                "majorCategories": ["medical", "chemical"],
                                "industries": ["medical"]
                            },
                            {
                                "title": "人口增长模型预测",
                                "industry": "城市规划",
                                "position": "城市规划师",
                                "description": "应用微分方程建立人口增长模型，预测城市发展需求，合理规划城市资源",
                                "standards": ["城市规划师职业标准", "城市人口容量测算规范"],
                                "majorCategories": ["civil", "finance"],
                                "industries": ["construction", "finance"]
                            }
                        ],
                        "majorCategories": ["electronic", "manufacturing", "medical", "chemical", "civil", "finance"],
                        "industries": ["it", "advmanufacturing", "medical", "construction", "finance"]
                    }
                },
                {
                    "name": "二阶线性微分方程",
                    "details": {
                        "description": "二阶线性微分方程的解法与应用",
                        "applications": [
                            {
                                "title": "机械振动分析",
                                "industry": "机械制造",
                                "position": "机械设计工程师",
                                "description": "应用二阶微分方程分析机械系统的振动特性，优化机械设计",
                                "standards": ["机械设计工程师职业标准", "机械振动分析规范"],
                                "majorCategories": ["manufacturing"],
                                "industries": ["advmanufacturing"]
                            },
                            {
                                "title": "电子电路稳定性分析",
                                "industry": "电子信息",
                                "position": "电路设计工程师",
                                "description": "应用二阶微分方程分析电子电路的稳定性，优化电路设计",
                                "standards": ["电子工程师职业标准", "电子电路稳定性设计规范"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            }
                        ],
                        "majorCategories": ["manufacturing", "electronic"],
                        "industries": ["advmanufacturing", "it"]
                    }
                }
            ]
        },
        {
            "name": "线性代数",
            "category": "matrix",
            "color": "#9b59b6",
            "children": [
                {
                    "name": "矩阵运算",
                    "details": {
                        "description": "矩阵的加减乘除、转置、求逆等基本运算",
                        "applications": [
                            {
                                "title": "图像处理变换",
                                "industry": "计算机视觉",
                                "position": "图像算法工程师",
                                "description": "使用矩阵运算进行图像的旋转、缩放、平移等几何变换",
                                "standards": ["计算机视觉工程师规范", "图像处理标准"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            },
                            {
                                "title": "机器人运动学计算",
                                "industry": "智能制造",
                                "position": "机器人工程师",
                                "description": "利用矩阵运算计算机器人各关节的位置和姿态",
                                "standards": ["机器人工程技术规范", "工业机器人标准"],
                                "majorCategories": ["manufacturing", "electronic"],
                                "industries": ["advmanufacturing"]
                            }
                        ]
                    }
                },
                {
                    "name": "特征值与特征向量",
                    "details": {
                        "description": "矩阵特征值和特征向量的概念、计算及应用",
                        "applications": [
                            {
                                "title": "振动分析",
                                "industry": "机械工程",
                                "position": "结构工程师",
                                "description": "利用特征值分析机械系统的固有频率和振型",
                                "standards": ["机械振动分析规范", "结构动力学标准"],
                                "majorCategories": ["manufacturing"],
                                "industries": ["advmanufacturing"]
                            }
                        ]
                    }
                }
            ]
        },
        {
            "name": "级数",
            "category": "series",
            "color": "#1abc9c",
            "children": [
                {
                    "name": "幂级数",
                    "details": {
                        "description": "幂级数的收敛性、和函数、泰勒级数等",
                        "applications": [
                            {
                                "title": "信号处理",
                                "industry": "通信工程",
                                "position": "信号处理工程师",
                                "description": "使用幂级数展开进行信号分析和处理",
                                "standards": ["通信工程技术规范", "信号处理标准"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            }
                        ]
                    }
                },
                {
                    "name": "傅里叶级数",
                    "details": {
                        "description": "周期函数的傅里叶展开、频谱分析等",
                        "applications": [
                            {
                                "title": "声音信号分析",
                                "industry": "音频工程",
                                "position": "音频工程师",
                                "description": "利用傅里叶级数分析声音的频率成分",
                                "standards": ["音频工程标准", "声学分析规范"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            }
                        ]
                    }
                }
            ]
        },
        {
            "name": "机械",
            "category": "vector",
            "color": "#d35400",
            "children": [
                {
                    "name": "向量运算",
                    "details": {
                        "description": "向量的加减法、数量积、向量积等运算",
                        "applications": [
                            {
                                "title": "3D游戏物理引擎",
                                "industry": "游戏开发",
                                "position": "游戏物理工程师",
                                "description": "使用向量计算游戏中物体的运动和碰撞",
                                "standards": ["游戏开发技术规范", "物理引擎标准"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            }
                        ]
                    }
                },
                {
                    "name": "向量空间",
                    "details": {
                        "description": "向量空间的基本概念、线性相关性等",
                        "applications": [
                            {
                                "title": "数据压缩",
                                "industry": "信息技术",
                                "position": "算法工程师",
                                "description": "利用向量空间理论进行数据降维和压缩",
                                "standards": ["数据压缩标准", "信息编码规范"],
                                "majorCategories": ["electronic"],
                                "industries": ["it"]
                            }
                        ]
                    }
                }
            ]
        },
        {
            "name": "概率统计",
            "category": "probability",
            "color": "#8e44ad",
            "children": [
                {
                    "name": "概率论基础",
                    "details": {
                        "description": "随机事件、概率分布、大数定律等",
                        "applications": [
                            {
                                "title": "金融风险评估",
                                "industry": "金融服务",
                                "position": "风险分析师",
                                "description": "使用概率模型评估投资风险和收益",
                                "standards": ["金融风险管理规范", "投资分析标准"],
                                "majorCategories": ["finance"],
                                "industries": ["finance"]
                            },
                            {
                                "title": "质量控制",
                                "industry": "制造业",
                                "position": "质量工程师",
                                "description": "应用概率统计方法进行产品质量控制",
                                "standards": ["质量管理体系标准", "统计过程控制规范"],
                                "majorCategories": ["manufacturing"],
                                "industries": ["advmanufacturing"]
                            }
                        ]
                    }
                },
                {
                    "name": "统计推断",
                    "details": {
                        "description": "参数估计、假设检验、回归分析等",
                        "applications": [
                            {
                                "title": "医学临床试验",
                                "industry": "医疗健康",
                                "position": "医学统计师",
                                "description": "使用统计方法分析临床试验数据",
                                "standards": ["临床试验统计规范", "医学研究标准"],
                                "majorCategories": ["medical"],
                                "industries": ["medical"]
                            },
                            {
                                "title": "市场调研分析",
                                "industry": "市场营销",
                                "position": "数据分析师",
                                "description": "运用统计方法分析市场调研数据",
                                "standards": ["市场调研标准", "数据分析规范"],
                                "majorCategories": ["finance"],
                                "industries": ["finance"]
                            }
                        ]
                    }
                }
            ]
        }
    ]
};

document.addEventListener('DOMContentLoaded', function() {
    // D3.js 力导向图
    const width = document.getElementById('skill-map').offsetWidth;
    const height = document.getElementById('skill-map').offsetHeight;
    
    // 添加缩放功能
    const zoom = d3.zoom()
        .scaleExtent([0.3, 3])
        .on('zoom', function(event) {
            svg.attr('transform', event.transform);
        });
    
    // 创建SVG元素
    const svgContainer = d3.select('#skill-map')
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .call(zoom)
        .on("wheel", function(event) {
            // 阻止默认滚轮行为，防止页面滚动
            event.preventDefault();
        })
        .on("touchstart", function(event) {
            // 防止触摸事件引起页面滚动
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
    // 添加一个背景矩形以便可以点击背景进行拖动
    svgContainer.append('rect')
        .attr('width', width)
        .attr('height', height)
        .attr('fill', 'none')
        .attr('pointer-events', 'all');
        
    const svg = svgContainer
        .append('g')
        .attr('transform', `translate(${width/2}, ${height/2})`); // 将图谱居中显示
    
    // 创建力导向图布局 - 修改配置使节点更稳定
    const simulation = d3.forceSimulation()
        .force('link', d3.forceLink().id(d => d.id).distance(d => {
            // 在移动设备上减小连接距离
            const isMobile = window.innerWidth <= 768;
            return d.source.id === 'root' ? (isMobile ? 100 : 150) : (isMobile ? 70 : 100);
        }))
        .force('charge', d3.forceManyBody().strength(d => {
            // 在移动设备上减小排斥力
            const isMobile = window.innerWidth <= 768;
            return d.level === 0 ? (isMobile ? -600 : -1000) : 
                   d.level === 1 ? (isMobile ? -300 : -500) : 
                   (isMobile ? -200 : -300);
        }))
        .force('center', d3.forceCenter(0, 0)) // 使用中心力将节点拉向中心
        .force('x', d3.forceX(0).strength(0.1))
        .force('y', d3.forceY(0).strength(0.1))
        .force('collision', d3.forceCollide().radius(d => {
            // 在移动设备上减小碰撞半径
            const isMobile = window.innerWidth <= 768;
            return d.level === 0 ? (isMobile ? 40 : 60) : 
                   d.level === 1 ? (isMobile ? 30 : 40) : 
                   (isMobile ? 20 : 30);
        }))
        .alphaDecay(0.1) // 增加衰减速度，让布局更快稳定
        .velocityDecay(0.8) // 增加"阻力"，减缓节点移动
        .alpha(0.3) // 降低初始alpha值，减少初始运动
        .alphaMin(0.001); // 提高最小alpha值，使模拟更快停止
    
    // 处理数据
    const nodes = [];
    const links = [];
    
    // 添加根节点
    nodes.push({
        id: 'root',
        name: mathKnowledgeData.name,
        level: 0,
        category: 'root',
        color: '#555'
    });
    
    // 计算节点位置的辅助函数 - 使用放射状布局
    function calculateNodePosition(catIndex, totalCategories, topicIndex, totalTopics) {
        // 计算一级节点的角度和距离
        if (topicIndex === undefined) {
            const angle = (2 * Math.PI * catIndex) / totalCategories;
            return {
                x: 200 * Math.cos(angle),
                y: 200 * Math.sin(angle)
            };
        } 
        // 计算二级节点的角度和距离
        else {
            const categoryAngle = (2 * Math.PI * catIndex) / totalCategories;
            const segmentAngle = Math.PI / (totalTopics + 1); // 每个主题在其扇区内的角度
            const topicAngle = categoryAngle + segmentAngle * (topicIndex + 1) - Math.PI / totalCategories;
            
            return {
                x: 350 * Math.cos(topicAngle),
                y: 350 * Math.sin(topicAngle)
            };
        }
    }
    
    // 添加一级节点和连接
    const totalCategories = mathKnowledgeData.children.length;
    mathKnowledgeData.children.forEach((category, catIndex) => {
        const categoryId = `category-${catIndex}`;
        const position = calculateNodePosition(catIndex, totalCategories);
        
        nodes.push({
            id: categoryId,
            name: category.name,
            level: 1,
            category: category.category,
            color: category.color,
            x: position.x,
            y: position.y,
            fx: position.x, // 固定x位置
            fy: position.y  // 固定y位置
        });
        
        links.push({
            source: 'root',
            target: categoryId,
            value: 2,
            color: category.color
        });
        
        // 添加二级节点和连接
        const totalTopics = category.children.length;
        category.children.forEach((topic, topicIndex) => {
            const topicId = `topic-${catIndex}-${topicIndex}`;
            const topicPosition = calculateNodePosition(catIndex, totalCategories, topicIndex, totalTopics);
            
            nodes.push({
                id: topicId,
                name: topic.name,
                level: 2,
                category: category.category,
                color: category.color,
                details: topic.details,
                x: topicPosition.x,
                y: topicPosition.y,
                fx: topicPosition.x, // 固定x位置
                fy: topicPosition.y  // 固定y位置
            });
            
            links.push({
                source: categoryId,
                target: topicId,
                value: 1,
                color: category.color
            });
        });
    });
    
    // 创建连接线 - 优化样式
    const link = svg.append('g')
        .attr('class', 'links')
        .selectAll('line')
        .data(links)
        .enter()
        .append('line')
        .attr('class', 'link')
        .attr('stroke', d => d.color || '#999')
        .attr('stroke-width', d => d.value * 1.5)
        .attr('stroke-opacity', 0.6)
        .attr('stroke-dasharray', d => d.source === 'root' ? '0' : '5,5'); // 根节点连线实线，其他虚线
    
    // 创建节点组
    const node = svg.append('g')
        .attr('class', 'nodes')
        .selectAll('g')
        .data(nodes)
        .enter()
        .append('g')
        .attr('class', d => `node node-level-${d.level}`)
        .call(d3.drag()
            .on('start', dragstarted)
            .on('drag', dragged)
            .on('end', dragended));
    
    // 添加节点圆形 - 美化样式
    node.append('circle')
        .attr('r', d => d.level === 0 ? 45 : d.level === 1 ? 30 : 20)
        .attr('fill', d => {
            const color = d.color;
            // 创建径向渐变
            const gradientId = `gradient-${d.id}`;
            const gradient = svgContainer.append('defs')
                .append('radialGradient')
                .attr('id', gradientId)
                .attr('cx', '50%')
                .attr('cy', '50%')
                .attr('r', '50%')
                .attr('fx', '50%')
                .attr('fy', '50%');
            
            gradient.append('stop')
                .attr('offset', '0%')
                .attr('stop-color', d3.rgb(color).brighter(0.5));
            
            gradient.append('stop')
                .attr('offset', '100%')
                .attr('stop-color', color);
            
            return `url(#${gradientId})`;
        })
        .attr('stroke', d => d3.rgb(d.color).darker(0.5))
        .attr('stroke-width', 2)
        .style('filter', 'drop-shadow(0px 3px 3px rgba(0,0,0,0.2))');
    
    // 为二级节点添加脉动动画效果
    node.filter(d => d.level === 2)
        .select('circle')
        .append('animate')
        .attr('attributeName', 'r')
        .attr('values', '18;22;18')
        .attr('dur', '3s')
        .attr('repeatCount', 'indefinite')
        .attr('begin', d => Math.random() * 3 + 's'); // 随机开始时间，避免所有节点同步脉动
    
    // 添加节点文本 - 改进文本显示
    node.append('text')
        .attr('dy', d => d.level === 2 ? '2.5em' : '.3em')
        .attr('text-anchor', 'middle')
        .text(d => d.name)
        .style('font-size', d => d.level === 0 ? '16px' : d.level === 1 ? '14px' : '12px')
        .style('font-weight', d => d.level === 0 ? 'bold' : d.level === 1 ? 'bold' : 'normal')
        .style('fill', d => d.level === 0 ? '#000' : '#333')
        .style('text-shadow', '0 1px 0 rgba(255,255,255,0.8), 1px 0 0 rgba(255,255,255,0.8), 0 -1px 0 rgba(255,255,255,0.8), -1px 0 0 rgba(255,255,255,0.8)')
        .each(function(d) {
            const self = d3.select(this);
            
            // 如果是二级节点，使用背景块提高可读性
            if (d.level === 2) {
                // 先添加背景
                const parent = d3.select(this.parentNode);
                parent.insert('rect', 'text')
                    .attr('x', -40)
                    .attr('y', 15)
                    .attr('width', 80)
                    .attr('height', 22)
                    .attr('rx', 5)
                    .attr('ry', 5)
                    .attr('fill', 'rgba(255,255,255,0.9)')
                    .attr('stroke', d.color)
                    .attr('stroke-width', 1)
                    .style('filter', 'drop-shadow(0px 2px 2px rgba(0,0,0,0.1))');
            }
            
            const words = d.name.split(' ');
            if (words.length > 1 && d.level !== 2) {
                self.text('');
                
                words.forEach((word, i) => {
                    const tspan = self.append('tspan')
                        .text(word)
                        .attr('x', 0)
                        .attr('dy', i === 0 ? '-0.2em' : '1.2em');
                });
            }
        });
    
    // 添加节点点击事件
    node.on('click', function(event, d) {
        if (d.level === 2 && d.details) {
            // 添加点击动画效果
            const circle = d3.select(this).select('circle');
            circle.transition()
                .duration(150)
                .attr('r', d => d.level === 0 ? 50 : d.level === 1 ? 35 : 25)
                .transition()
                .duration(150)
                .attr('r', d => d.level === 0 ? 45 : d.level === 1 ? 30 : 20);
                
            const infoPanel = document.querySelector('.info-panel');
            
            // 检查当前是否已经显示了这个节点的详情
            const currentNodeId = infoPanel.getAttribute('data-node-id');
            
            if (infoPanel.style.display === 'block' && currentNodeId === d.id) {
                // 如果已经显示了这个节点的详情，则隐藏面板
                infoPanel.style.opacity = 0;
                setTimeout(() => {
                    infoPanel.style.display = 'none';
                    infoPanel.removeAttribute('data-node-id');
                }, 300);
            } else {
                // 显示这个节点的详情
                showDetails(d);
                infoPanel.setAttribute('data-node-id', d.id);
            }
        }
    });
    
    // 添加鼠标悬停效果
    node.on('mouseover', function(event, d) {
        // 放大节点
        d3.select(this).select('circle')
            .transition()
            .duration(300)
            .attr('r', d => d.level === 0 ? 50 : d.level === 1 ? 35 : 25);
            
        // 加粗相关连接
        link.filter(l => l.source.id === d.id || l.target.id === d.id)
            .transition()
            .duration(300)
            .attr('stroke-width', d => d.value * 2.5)
            .attr('stroke-opacity', 1);
            
        if (d.level === 2) {
            tooltip.transition()
                .duration(200)
                .style('opacity', 0.9);
            tooltip.html(d.name)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 28) + 'px');
        }
    })
    .on('mouseout', function(event, d) {
        // 恢复节点大小
        d3.select(this).select('circle')
            .transition()
            .duration(300)
            .attr('r', d => d.level === 0 ? 45 : d.level === 1 ? 30 : 20);
            
        // 恢复连接样式
        link.filter(l => l.source.id === d.id || l.target.id === d.id)
            .transition()
            .duration(300)
            .attr('stroke-width', d => d.value * 1.5)
            .attr('stroke-opacity', 0.6);
            
        tooltip.transition()
            .duration(500)
            .style('opacity', 0);
    });
    
    // 力导向图模拟
    simulation
        .nodes(nodes)
        .on('tick', ticked);
    
    simulation.force('link')
        .links(links);
    
    // 动画10次迭代后停止，固定节点位置
    let tickCounter = 0;
    function ticked() {
        link
            .attr('x1', d => d.source.x)
            .attr('y1', d => d.source.y)
            .attr('x2', d => d.target.x)
            .attr('y2', d => d.target.y);
        
        node
            .attr('transform', d => `translate(${d.x}, ${d.y})`);
            
        tickCounter++;
        if (tickCounter >= 10) { // 减少迭代次数，更快固定位置
            simulation.stop();
            // 固定所有节点位置
            nodes.forEach(d => {
                d.fx = d.x;
                d.fy = d.y;
            });
        }
    }
    
    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.1).restart();
        // 不改变固定位置
    }
    
    function dragged(event, d) {
        // 允许拖动但不改变固定位置
        d.x = event.x;
        d.y = event.y;
        d3.select(this).attr('transform', `translate(${d.x}, ${d.y})`);
        
        // 更新与该节点相连的连接线
        link.filter(l => l.source.id === d.id || l.target.id === d.id)
            .attr('x1', l => l.source.id === d.id ? d.x : l.source.x)
            .attr('y1', l => l.source.id === d.id ? d.y : l.source.y)
            .attr('x2', l => l.target.id === d.id ? d.x : l.target.x)
            .attr('y2', l => l.target.id === d.id ? d.y : l.target.y);
    }
    
    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        // 拖动结束后重新固定位置
        d.fx = d.x;
        d.fy = d.y;
    }
    
    // 添加缩放控制
    document.getElementById('zoom-in').addEventListener('click', function() {
        svgContainer.transition()
            .duration(500)
            .call(zoom.scaleBy, 1.3);
    });
    
    document.getElementById('zoom-out').addEventListener('click', function() {
        svgContainer.transition()
            .duration(500)
            .call(zoom.scaleBy, 0.7);
    });
    
    document.getElementById('reset-view').addEventListener('click', function() {
        svgContainer.transition()
            .duration(750)
            .call(zoom.transform, d3.zoomIdentity.translate(width/2, height/2));
    });
    
    // 初始化时居中显示
    svgContainer.call(zoom.transform, d3.zoomIdentity.translate(width/2, height/2));
    
    // 显示知识点详情
    function showDetails(d) {
        const infoPanel = document.querySelector('.info-panel');
        const infoTitle = document.getElementById('info-title');
        const infoContent = document.getElementById('info-content');
        const relatedMajors = document.getElementById('related-majors');
        const relatedIndustries = document.getElementById('related-industries');
        
        infoTitle.textContent = d.name;
        
        // 清空内容区域
        infoContent.innerHTML = '';
        relatedMajors.innerHTML = '';
        relatedIndustries.innerHTML = '';
        
        // 添加描述
        const descDiv = document.createElement('div');
        descDiv.innerHTML = `<p>${d.details.description}</p>`;
        infoContent.appendChild(descDiv);
        
        // 添加应用案例
        if (d.details.applications && d.details.applications.length > 0) {
            const applicationsDiv = document.createElement('div');
            applicationsDiv.className = 'category';
            applicationsDiv.innerHTML = `<h3 class="category-title">产业应用案例</h3>`;
            
            d.details.applications.forEach(app => {
                const appCard = document.createElement('div');
                appCard.className = 'application-card';
                
                appCard.innerHTML = `
                    <div class="app-title">${app.title}</div>
                    <div class="app-industry"><strong>所属行业:</strong> ${app.industry}</div>
                    <div class="app-position"><strong>相关岗位:</strong> ${app.position}</div>
                    <div class="app-desc">${app.description}</div>
                    <div class="app-standards"><strong>行业标准:</strong></div>
                `;
                
                const standardsList = document.createElement('div');
                app.standards.forEach(standard => {
                    const standardTag = document.createElement('span');
                    standardTag.className = 'tag';
                    standardTag.textContent = standard;
                    standardsList.appendChild(standardTag);
                });
                
                appCard.querySelector('.app-standards').appendChild(standardsList);
                applicationsDiv.appendChild(appCard);
            });
            
            infoContent.appendChild(applicationsDiv);
        }
        
        // 添加相关专业大类标签
        if (d.details.majorCategories && d.details.majorCategories.length > 0) {
            d.details.majorCategories.forEach(major => {
                if (majorCategoryInfo[major]) {
                    const majorTag = document.createElement('span');
                    majorTag.className = `major-tag ${major}`;
                    majorTag.textContent = majorCategoryInfo[major].name;
                    majorTag.title = majorCategoryInfo[major].description;
                    relatedMajors.appendChild(majorTag);
                }
            });
        }
        
        // 添加相关支柱产业标签
        if (d.details.industries && d.details.industries.length > 0) {
            d.details.industries.forEach(industry => {
                if (industryInfo[industry]) {
                    const industryTag = document.createElement('span');
                    industryTag.className = `industry-tag ${industry}`;
                    industryTag.textContent = industryInfo[industry].name;
                    industryTag.title = industryInfo[industry].description;
                    relatedIndustries.appendChild(industryTag);
                }
            });
        }
        
        // 显示面板，添加过渡动画
        infoPanel.style.opacity = 0;
        infoPanel.style.display = 'block';
        setTimeout(() => {
            infoPanel.style.transition = 'opacity 0.3s ease-in-out';
            infoPanel.style.opacity = 1;
        }, 10);
    }
    
    // 关闭知识点详情面板
    document.querySelector('.close-btn').addEventListener('click', function() {
        const infoPanel = document.querySelector('.info-panel');
        infoPanel.style.opacity = 0;
        setTimeout(() => {
            infoPanel.style.display = 'none';
        }, 300);
    });
    
    // 悬停提示功能
    const tooltip = d3.select('.tooltip');
    
    // 图例点击筛选功能
    const legendItems = document.querySelectorAll('.legend-item');
    
    // 筛选函数
    function applyFilter(filterValue, filterCategory) {
        // 添加平滑过渡
        node.transition().duration(500).style('opacity', d => {
            let match = false;
            
            if (filterValue === 'all') {
                match = true;
            } else if (filterCategory === 'category') {
                match = d.category === filterValue;
            } else if (filterCategory === 'major' && d.details && d.details.majorCategories) {
                match = d.details.majorCategories.includes(filterValue);
            } else if (filterCategory === 'industry' && d.details && d.details.industries) {
                match = d.details.industries.includes(filterValue);
            }
            
            return match ? 1 : 0.2;
        });
        
        // 连线也应用相同的过滤
        link.transition().duration(500).style('opacity', d => {
            const sourceNode = nodes.find(n => n.id === d.source.id || n.id === d.source);
            const targetNode = nodes.find(n => n.id === d.target.id || n.id === d.target);
            
            let sourceMatch = false;
            let targetMatch = false;
            
            if (filterValue === 'all') {
                return 1;
            }
            
            if (filterCategory === 'category') {
                sourceMatch = sourceNode && sourceNode.category === filterValue;
                targetMatch = targetNode && targetNode.category === filterValue;
            } else if (filterCategory === 'major') {
                sourceMatch = sourceNode && sourceNode.details && sourceNode.details.majorCategories && 
                           sourceNode.details.majorCategories.includes(filterValue);
                targetMatch = targetNode && targetNode.details && targetNode.details.majorCategories && 
                           targetNode.details.majorCategories.includes(filterValue);
            } else if (filterCategory === 'industry') {
                sourceMatch = sourceNode && sourceNode.details && sourceNode.details.industries && 
                           sourceNode.details.industries.includes(filterValue);
                targetMatch = targetNode && targetNode.details && targetNode.details.industries && 
                           targetNode.details.industries.includes(filterValue);
            }
            
            return (sourceMatch || targetMatch) ? 1 : 0.1;
        });
    }
    
    // 为所有图例项添加点击事件
    legendItems.forEach(item => {
        item.addEventListener('click', function() {
            const category = this.getAttribute('data-category');
            const type = this.getAttribute('data-type');
            
            // 根据类型找到对应的标签页内容
            const tabContent = this.closest('.tab-content');
            
            // 移除同组中所有图例项的激活状态
            tabContent.querySelectorAll('.legend-item').forEach(li => {
                li.classList.remove('active');
            });
            
            // 激活当前点击的图例项
            this.classList.add('active');
            
            // 应用筛选
            applyFilter(category, type);
        });
    });
    
    // 初始化默认选择"全部"
    document.querySelector('.math-content .legend-item[data-category="all"]').classList.add('active');
    
    // 自动播放功能 - 展示各数学分类
    setTimeout(() => {
        // 获取所有数学分类
        const categories = mathKnowledgeData.children.map(c => c.category);
        let currentIndex = 0;
        
        function highlightNextCategory() {
            if (currentIndex >= categories.length) {
                // 显示全部，结束序列
                const allCategoryItem = document.querySelector('.legend-item[data-category="all"][data-type="category"]');
                if (allCategoryItem) {
                    allCategoryItem.click();
                }
                return;
            }
            
            const category = categories[currentIndex];
            // 找到并点击对应的图例项
            const categoryItem = document.querySelector(`.legend-item[data-category="${category}"][data-type="category"]`);
            if (categoryItem) {
                categoryItem.click();
            }
            
            currentIndex++;
            setTimeout(highlightNextCategory, 1500); // 每1.5秒切换一次
        }
        
        // 3秒后开始序列
        setTimeout(highlightNextCategory, 3000);
    }, 1000);
    
    // 添加Tab切换功能
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            // 移除所有按钮的active类
            tabButtons.forEach(btn => btn.classList.remove('active'));
            // 为当前点击的按钮添加active类
            this.classList.add('active');
            
            // 隐藏所有内容
            tabContents.forEach(content => content.classList.remove('active'));
            
            // 显示对应的内容
            const tabName = this.getAttribute('data-tab');
            document.querySelector(`.${tabName}-content`).classList.add('active');
            
            // 重置筛选为当前标签页的"全部"选项
            const allItem = document.querySelector(`.${tabName}-content .legend-item[data-category="all"]`);
            if (allItem) {
                allItem.click();
            }
        });
    });
});

// 专业大类信息
const majorCategoryInfo = {
    manufacturing: {
        name: '装备制造大类',
        description: '包括机械设计制造、材料成型与控制工程、机械电子工程等专业'
    },
    electronic: {
        name: '电子信息大类',
        description: '包括电子信息工程、通信工程、计算机科学与技术等专业'
    },
    civil: {
        name: '土木建筑大类',
        description: '包括土木工程、建筑学、给排水科学与工程等专业'
    },
    chemical: {
        name: '化工与生物大类',
        description: '包括化学工程与工艺、生物工程、制药工程等专业'
    },
    finance: {
        name: '财经商贸大类',
        description: '包括金融学、会计学、市场营销、物流管理等专业'
    },
    medical: {
        name: '医药卫生大类',
        description: '包括临床医学、护理学、药学、医学影像技术等专业'
    },
    energy: {
        name: '能源动力与材料大类',
        description: '包括电气工程及其自动化、热能与动力工程、材料科学与工程等专业'
    }
};

// 支柱产业信息
const industryInfo = {
    advmanufacturing: {
        name: '先进制造业',
        description: '涵盖高端装备、智能制造、新材料等领域'
    },
    it: {
        name: '信息技术产业',
        description: '涵盖电子信息、软件开发、通信技术等领域'
    },
    finance: {
        name: '金融服务业',
        description: '涵盖银行、保险、证券、投资等领域'
    },
    construction: {
        name: '建筑工程业',
        description: '涵盖房屋建筑、道路桥梁、市政工程等领域'
    },
    energy: {
        name: '能源产业',
        description: '涵盖发电、输配电、新能源开发等领域'
    },
    medical: {
        name: '医疗健康产业',
        description: '涵盖医药研发、医疗器械、健康服务等领域'
    }
};

// 添加回车键搜索功能
searchBox.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        const searchTerm = this.value.toLowerCase();
        if (searchTerm === '') return;
        
        // 找到第一个匹配的节点并显示详情
        let foundNode = null;
        node.each(function(d) {
            if (foundNode) return;
            
            const nodeText = d.name.toLowerCase();
            const nodeDesc = d.details && d.details.description ? d.details.description.toLowerCase() : '';
            
            if ((nodeText.includes(searchTerm) || nodeDesc.includes(searchTerm)) && d.level === 2) {
                foundNode = d;
            }
        });
        
        if (foundNode) {
            showDetails(foundNode);
        }
    }
});

// 悬停提示功能
const tooltip = d3.select('.tooltip');

// 图例点击筛选功能
const legendItems = document.querySelectorAll('.legend-item');

// 筛选函数
function applyFilter(filterValue, filterCategory) {
    // 添加平滑过渡
    node.transition().duration(500).style('opacity', d => {
        let match = false;
        
        if (filterValue === 'all') {
            match = true;
        } else if (filterCategory === 'category') {
            match = d.category === filterValue;
        } else if (filterCategory === 'major' && d.details && d.details.majorCategories) {
            match = d.details.majorCategories.includes(filterValue);
        } else if (filterCategory === 'industry' && d.details && d.details.industries) {
            match = d.details.industries.includes(filterValue);
        }
        
        return match ? 1 : 0.2;
    });
    
    // 连线也应用相同的过滤
    link.transition().duration(500).style('opacity', d => {
        const sourceNode = nodes.find(n => n.id === d.source.id || n.id === d.source);
        const targetNode = nodes.find(n => n.id === d.target.id || n.id === d.target);
        
        let sourceMatch = false;
        let targetMatch = false;
        
        if (filterValue === 'all') {
            return 1;
        }
        
        if (filterCategory === 'category') {
            sourceMatch = sourceNode && sourceNode.category === filterValue;
            targetMatch = targetNode && targetNode.category === filterValue;
        } else if (filterCategory === 'major') {
            sourceMatch = sourceNode && sourceNode.details && sourceNode.details.majorCategories && 
                       sourceNode.details.majorCategories.includes(filterValue);
            targetMatch = targetNode && targetNode.details && targetNode.details.majorCategories && 
                       targetNode.details.majorCategories.includes(filterValue);
        } else if (filterCategory === 'industry') {
            sourceMatch = sourceNode && sourceNode.details && sourceNode.details.industries && 
                       sourceNode.details.industries.includes(filterValue);
            targetMatch = targetNode && targetNode.details && targetNode.details.industries && 
                       targetNode.details.industries.includes(filterValue);
        }
        
        return (sourceMatch || targetMatch) ? 1 : 0.1;
    });
}

// 为所有图例项添加点击事件
legendItems.forEach(item => {
    item.addEventListener('click', function() {
        const category = this.getAttribute('data-category');
        const type = this.getAttribute('data-type');
        
        // 根据类型找到对应的标签页内容
        const tabContent = this.closest('.tab-content');
        
        // 移除同组中所有图例项的激活状态
        tabContent.querySelectorAll('.legend-item').forEach(li => {
            li.classList.remove('active');
        });
        
        // 激活当前点击的图例项
        this.classList.add('active');
        
        // 应用筛选
        applyFilter(category, type);
    });
});

// 初始化默认选择"全部"
document.querySelector('.math-content .legend-item[data-category="all"]').classList.add('active');

// 自动播放功能 - 展示各数学分类
setTimeout(() => {
    // 获取所有数学分类
    const categories = mathKnowledgeData.children.map(c => c.category);
    let currentIndex = 0;
    
    function highlightNextCategory() {
        if (currentIndex >= categories.length) {
            // 显示全部，结束序列
            const allCategoryItem = document.querySelector('.legend-item[data-category="all"][data-type="category"]');
            if (allCategoryItem) {
                allCategoryItem.click();
            }
            return;
        }
        
        const category = categories[currentIndex];
        // 找到并点击对应的图例项
        const categoryItem = document.querySelector(`.legend-item[data-category="${category}"][data-type="category"]`);
        if (categoryItem) {
            categoryItem.click();
        }
        
        currentIndex++;
        setTimeout(highlightNextCategory, 1500); // 每1.5秒切换一次
    }
    
    // 3秒后开始序列
    setTimeout(highlightNextCategory, 3000);
}, 1000);

// 添加Tab切换功能
const tabButtons = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');

tabButtons.forEach(button => {
    button.addEventListener('click', function() {
        // 移除所有按钮的active类
        tabButtons.forEach(btn => btn.classList.remove('active'));
        // 为当前点击的按钮添加active类
        this.classList.add('active');
        
        // 隐藏所有内容
        tabContents.forEach(content => content.classList.remove('active'));
        
        // 显示对应的内容
        const tabName = this.getAttribute('data-tab');
        document.querySelector(`.${tabName}-content`).classList.add('active');
        
        // 重置筛选为当前标签页的"全部"选项
        const allItem = document.querySelector(`.${tabName}-content .legend-item[data-category="all"]`);
        if (allItem) {
            allItem.click();
        }
    });
});
</script>
</body>
</html>