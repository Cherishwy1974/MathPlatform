<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基本积分公式实验室</title>

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady().then(() => {
                        console.log('MathJax加载完成');
                    });
                }
            }
        };
    </script>
    <script src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js" id="MathJax-script"></script>

    <style>
        :root {
            --h1-size: 22px;
            --h2-size: 20px;
            --h3-size: 18px;
            --btn-size: 16px;
            --formula-size: 20px;
            --text-size: 16px;

            --primary: #4f46e5;
            --primary-light: #6366f1;
            --primary-dark: #3730a3;
            --light: #ffffff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        *::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', Arial, sans-serif;
            font-size: var(--text-size);
            line-height: 1.5;
            background: var(--gray-50);
            color: var(--gray-800);
        }

        .container {
            width: 100%;
            max-width: 1400px;
            height: 100vh;
            max-height: 700px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            background: var(--light);
        }

        .header {
            background: var(--primary);
            color: var(--light);
            padding: 8px 20px;
            height: 40px;
            display: flex;
            align-items: center;
        }

        .header h1 {
            font-size: var(--h2-size);
            margin: 0;
        }

        .main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 120px;
            background: var(--gray-50);
            border-right: 1px solid var(--border);
            padding: 10px 8px;
        }

        .nav-btn {
            width: 100%;
            padding: 8px;
            margin-bottom: 4px;
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: var(--text-size);
            color: var(--gray-600);
            text-align: left;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: var(--gray-100);
        }

        .nav-btn.active {
            background: var(--primary);
            color: var(--light);
        }

        .content {
            flex: 1;
            display: none;
            padding: 16px;
            overflow-y: auto;
        }

        .content.active {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: 16px;
            overflow-y: auto;
        }

        .card {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
        }

        .card h3 {
            font-size: var(--h3-size);
            color: var(--primary);
            margin-bottom: 12px;
        }

        .formula-box {
            background: #f0f7ff;
            padding: 12px;
            border-radius: 4px;
            border-left: 3px solid var(--primary);
            margin: 12px 0;
            text-align: center;
            font-size: var(--formula-size);
            cursor: pointer;
            transition: all 0.2s;
        }

        .formula-box:hover {
            background: #dbeafe;
            transform: translateX(5px);
        }

        .formula-box.active {
            background: #bfdbfe;
            border-left-color: var(--success);
        }

        .canvas-container {
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            background: #fafafa;
            padding: 10px;
            min-height: 200px;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .canvas-container canvas {
            max-width: 100%;
            height: 320px;
            display: block;
            margin: 0 auto;
        }

        .result {
            background: var(--gray-50);
            padding: 12px;
            border-radius: 4px;
            border: 1px solid var(--primary);
            text-align: center;
            font-size: var(--text-size);
            margin: 12px 0;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn {
            padding: 8px 16px;
            background: var(--primary);
            color: var(--light);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: var(--btn-size);
            transition: all 0.2s;
            width: 100%;
        }

        .btn:hover {
            background: var(--primary-dark);
        }

        .formula-grid {
            display: grid;
            gap: 8px;
        }

        .return-home-panel { position: fixed; bottom: 12px; right: 12px; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; z-index: 40; }
        .return-toggle { width: 40px; height: 40px; border-radius: 50%; border: none; background: linear-gradient(135deg, rgba(79,70,229,0.96), rgba(99,102,241,0.9)); color: #fff; font-size: 20px; cursor: pointer; box-shadow: 0 10px 18px rgba(79,70,229,0.28); transition: transform 0.2s, box-shadow 0.2s; }
        .return-toggle:hover { transform: translateY(-1px) scale(1.03); box-shadow: 0 14px 26px rgba(79,70,229,0.35); }
        .return-links { display: none; flex-direction: column; gap: 6px; padding: 10px; border-radius: 10px; background: rgba(255,255,255,0.96); border: 1px solid rgba(79,70,229,0.18); box-shadow: 0 10px 30px rgba(15,23,42,0.14); opacity: 0; transition: opacity 0.16s; }
        .return-link { text-decoration: none; font-size: 15px; color: var(--primary-dark); padding: 6px 12px; border-radius: 8px; background: rgba(99,102,241,0.12); transition: background 0.2s; }
        .return-link:hover { background: rgba(79,70,229,0.18); }

        @media (max-width: 768px) {
            .content.active {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>基本积分公式实验室</h1>
        </header>

        <div class="main">
            <nav class="sidebar">
                <button class="nav-btn active" onclick="switchPanel('formulas')">公式演示</button>
                <button class="nav-btn" onclick="switchPanel('compare')">对比验证</button>
            </nav>

            <!-- 公式演示 -->
            <div class="content active" id="formulas">
                <div class="column">
                    <div class="card">
                        <h3>幂函数积分</h3>
                        <div class="formula-grid">
                            <div class="formula-box" onclick="selectFormula('power', 1)">
                                $\int x \, dx = \frac{x^2}{2} + C$
                            </div>
                            <div class="formula-box" onclick="selectFormula('power', 2)">
                                $\int x^2 \, dx = \frac{x^3}{3} + C$
                            </div>
                            <div class="formula-box" onclick="selectFormula('power', 3)">
                                $\int x^3 \, dx = \frac{x^4}{4} + C$
                            </div>
                            <div class="formula-box" onclick="selectFormula('power', -1)">
                                $\int \frac{1}{x} \, dx = \ln|x| + C$
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>三角函数积分</h3>
                        <div class="formula-grid">
                            <div class="formula-box" onclick="selectFormula('trig', 'sin')">
                                $\int \sin x \, dx = -\cos x + C$
                            </div>
                            <div class="formula-box" onclick="selectFormula('trig', 'cos')">
                                $\int \cos x \, dx = \sin x + C$
                            </div>
                            <div class="formula-box" onclick="selectFormula('trig', 'sec2')">
                                $\int \sec^2 x \, dx = \tan x + C$
                            </div>
                            <div class="formula-box" onclick="selectFormula('trig', 'csc2')">
                                $\int \csc^2 x \, dx = -\cot x + C$
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>指数与对数</h3>
                        <div class="formula-grid">
                            <div class="formula-box" onclick="selectFormula('exp', 'e')">
                                $\int e^x \, dx = e^x + C$
                            </div>
                            <div class="formula-box" onclick="selectFormula('exp', 'a')">
                                $\int a^x \, dx = \frac{a^x}{\ln a} + C$
                            </div>
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="card">
                        <h3>可视化演示</h3>
                        <div class="canvas-container">
                            <canvas id="formulaCanvas" width="600" height="320"></canvas>
                        </div>
                        <div class="result" id="formulaResult">
                            点击左侧公式查看可视化
                        </div>
                    </div>
                </div>
            </div>

            <!-- 对比验证 -->
            <div class="content" id="compare">
                <div class="column">
                    <div class="card">
                        <h3>函数 $f(x)$</h3>
                        <div class="canvas-container">
                            <canvas id="fxCanvas" width="600" height="320"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <h3>选择函数</h3>
                        <div class="formula-box" onclick="compareFunc('x')">
                            $f(x) = x$
                        </div>
                        <div class="formula-box" onclick="compareFunc('x2')">
                            $f(x) = x^2$
                        </div>
                        <div class="formula-box" onclick="compareFunc('sin')">
                            $f(x) = \sin x$
                        </div>
                        <div class="formula-box" onclick="compareFunc('cos')">
                            $f(x) = \cos x$
                        </div>
                        <div class="formula-box" onclick="compareFunc('exp')">
                            $f(x) = e^x$
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="card">
                        <h3>积分 $\int f(x) \, dx$</h3>
                        <div class="canvas-container">
                            <canvas id="intCanvas" width="600" height="320"></canvas>
                        </div>
                    </div>

                    <div class="card">
                        <h3>积分结果</h3>
                        <div class="result" id="compareResult">
                            选择函数查看积分
                        </div>
                        <button class="btn" onclick="animateIntegration()">动画演示积分过程</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFunc = null;
        let animId = null;

        function renderMath() {
            if (window.MathJax && MathJax.typesetPromise) {
                MathJax.typesetPromise().catch(err => console.log('渲染错误:', err));
            }
        }

        function switchPanel(panel) {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(panel).classList.add('active');

            setTimeout(() => {
                renderMath();
            }, 50);
        }

        function selectFormula(type, param) {
            // 移除所有active
            document.querySelectorAll('.formula-box').forEach(box => {
                box.classList.remove('active');
            });

            // 添加active到当前
            event.target.classList.add('active');

            // 绘制对应的图形
            drawFormula(type, param);
        }

        function drawFormula(type, param) {
            const canvas = document.getElementById('formulaCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            ctx.clearRect(0, 0, width, height);

            // 坐标系
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(50, height/2);
            ctx.lineTo(width - 20, height/2);
            ctx.moveTo(width/2, 20);
            ctx.lineTo(width/2, height - 20);
            ctx.stroke();

            // 绘制被积函数 (蓝色)
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2.5;
            ctx.beginPath();

            for(let x = -3; x <= 3; x += 0.05) {
                const px = width/2 + x * 60;
                let y = 0;

                if (type === 'power') {
                    if (param === 1) y = x;
                    else if (param === 2) y = x * x;
                    else if (param === 3) y = x * x * x;
                    else if (param === -1 && x !== 0) y = 1 / x;
                } else if (type === 'trig') {
                    if (param === 'sin') y = Math.sin(x);
                    else if (param === 'cos') y = Math.cos(x);
                    else if (param === 'sec2') y = 1 / (Math.cos(x) * Math.cos(x));
                    else if (param === 'csc2') y = 1 / (Math.sin(x) * Math.sin(x));
                } else if (type === 'exp') {
                    if (param === 'e') y = Math.exp(x);
                    else if (param === 'a') y = Math.pow(2, x);
                }

                const py = height/2 - y * 30;

                if (py > -100 && py < height + 100) {
                    if (x === -3) ctx.moveTo(px, py);
                    else ctx.lineTo(px, py);
                }
            }
            ctx.stroke();

            // 绘制积分结果 (绿色)
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2.5;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();

            for(let x = -3; x <= 3; x += 0.05) {
                const px = width/2 + x * 60;
                let y = 0;

                if (type === 'power') {
                    if (param === 1) y = x * x / 2;
                    else if (param === 2) y = x * x * x / 3;
                    else if (param === 3) y = x * x * x * x / 4;
                    else if (param === -1 && x > 0) y = Math.log(x);
                } else if (type === 'trig') {
                    if (param === 'sin') y = -Math.cos(x);
                    else if (param === 'cos') y = Math.sin(x);
                    else if (param === 'sec2') y = Math.tan(x);
                    else if (param === 'csc2') y = -1 / Math.tan(x);
                } else if (type === 'exp') {
                    if (param === 'e') y = Math.exp(x);
                    else if (param === 'a') y = Math.pow(2, x) / Math.log(2);
                }

                const py = height/2 - y * 30;

                if (py > -100 && py < height + 100) {
                    if (x === -3) ctx.moveTo(px, py);
                    else ctx.lineTo(px, py);
                }
            }
            ctx.stroke();
            ctx.setLineDash([]);

            // 图例
            ctx.fillStyle = '#3b82f6';
            ctx.font = '14px Arial';
            ctx.fillText('f(x) - 被积函数', 20, 30);
            ctx.fillStyle = '#10b981';
            ctx.fillText('F(x) - 原函数', 20, 50);

            // 更新结果文本
            let resultText = '';
            if (type === 'power') {
                if (param === 1) resultText = '$\\int x \\, dx = \\frac{x^2}{2} + C$';
                else if (param === 2) resultText = '$\\int x^2 \\, dx = \\frac{x^3}{3} + C$';
                else if (param === 3) resultText = '$\\int x^3 \\, dx = \\frac{x^4}{4} + C$';
                else if (param === -1) resultText = '$\\int \\frac{1}{x} \\, dx = \\ln|x| + C$';
            } else if (type === 'trig') {
                if (param === 'sin') resultText = '$\\int \\sin x \\, dx = -\\cos x + C$';
                else if (param === 'cos') resultText = '$\\int \\cos x \\, dx = \\sin x + C$';
                else if (param === 'sec2') resultText = '$\\int \\sec^2 x \\, dx = \\tan x + C$';
                else if (param === 'csc2') resultText = '$\\int \\csc^2 x \\, dx = -\\cot x + C$';
            } else if (type === 'exp') {
                if (param === 'e') resultText = '$\\int e^x \\, dx = e^x + C$';
                else if (param === 'a') resultText = '$\\int a^x \\, dx = \\frac{a^x}{\\ln a} + C$';
            }

            document.getElementById('formulaResult').innerHTML = resultText;
            renderMath();
        }

        function compareFunc(func) {
            currentFunc = func;

            // 移除所有active
            document.querySelectorAll('#compare .formula-box').forEach(box => {
                box.classList.remove('active');
            });

            // 添加active到当前
            event.target.classList.add('active');

            drawCompare();
        }

        function drawCompare() {
            if (!currentFunc) return;

            drawFx();
            drawInt();
        }

        function drawFx() {
            const canvas = document.getElementById('fxCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            ctx.clearRect(0, 0, width, height);

            // 坐标系
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(50, height/2);
            ctx.lineTo(width - 20, height/2);
            ctx.moveTo(width/2, 20);
            ctx.lineTo(width/2, height - 20);
            ctx.stroke();

            // 绘制f(x)
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();

            for(let x = -3; x <= 3; x += 0.05) {
                const px = width/2 + x * 60;
                let y = 0;

                switch(currentFunc) {
                    case 'x': y = x; break;
                    case 'x2': y = x * x; break;
                    case 'sin': y = Math.sin(x); break;
                    case 'cos': y = Math.cos(x); break;
                    case 'exp': y = Math.exp(x); break;
                }

                const py = height/2 - y * 40;

                if (x === -3) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();

            ctx.fillStyle = '#3b82f6';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('f(x)', 20, 30);
        }

        function drawInt() {
            const canvas = document.getElementById('intCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            ctx.clearRect(0, 0, width, height);

            // 坐标系
            ctx.strokeStyle = '#374151';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(50, height/2);
            ctx.lineTo(width - 20, height/2);
            ctx.moveTo(width/2, 20);
            ctx.lineTo(width/2, height - 20);
            ctx.stroke();

            // 绘制积分
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 3;
            ctx.beginPath();

            for(let x = -3; x <= 3; x += 0.05) {
                const px = width/2 + x * 60;
                let y = 0;

                switch(currentFunc) {
                    case 'x': y = x * x / 2; break;
                    case 'x2': y = x * x * x / 3; break;
                    case 'sin': y = -Math.cos(x); break;
                    case 'cos': y = Math.sin(x); break;
                    case 'exp': y = Math.exp(x); break;
                }

                const py = height/2 - y * 40;

                if (x === -3) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();

            ctx.fillStyle = '#10b981';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('∫f(x)dx', 20, 30);

            // 更新结果
            let resultText = '';
            switch(currentFunc) {
                case 'x': resultText = '$\\int x \\, dx = \\frac{x^2}{2} + C$'; break;
                case 'x2': resultText = '$\\int x^2 \\, dx = \\frac{x^3}{3} + C$'; break;
                case 'sin': resultText = '$\\int \\sin x \\, dx = -\\cos x + C$'; break;
                case 'cos': resultText = '$\\int \\cos x \\, dx = \\sin x + C$'; break;
                case 'exp': resultText = '$\\int e^x \\, dx = e^x + C$'; break;
            }

            document.getElementById('compareResult').innerHTML = resultText;
            renderMath();
        }

        function animateIntegration() {
            if (!currentFunc) return;
            if (animId) {
                clearInterval(animId);
                animId = null;
            }

            const fxCanvas = document.getElementById('fxCanvas');
            const intCanvas = document.getElementById('intCanvas');
            if (!fxCanvas || !intCanvas) return;

            const fxCtx = fxCanvas.getContext('2d');
            const intCtx = intCanvas.getContext('2d');

            let xEnd = -3;

            animId = setInterval(() => {
                xEnd += 0.1;
                if (xEnd > 3) {
                    xEnd = -3;
                }

                // 重绘f(x)
                drawFx();

                // 绘制累积区域
                fxCtx.fillStyle = 'rgba(59, 130, 246, 0.2)';
                fxCtx.beginPath();
                fxCtx.moveTo(fxCanvas.width/2 - 3 * 60, fxCanvas.height/2);

                for(let x = -3; x <= xEnd; x += 0.05) {
                    const px = fxCanvas.width/2 + x * 60;
                    let y = 0;

                    switch(currentFunc) {
                        case 'x': y = x; break;
                        case 'x2': y = x * x; break;
                        case 'sin': y = Math.sin(x); break;
                        case 'cos': y = Math.cos(x); break;
                        case 'exp': y = Math.exp(x); break;
                    }

                    const py = fxCanvas.height/2 - y * 40;
                    fxCtx.lineTo(px, py);
                }

                fxCtx.lineTo(fxCanvas.width/2 + xEnd * 60, fxCanvas.height/2);
                fxCtx.closePath();
                fxCtx.fill();

                // 重绘积分
                drawInt();

                // 标记当前点
                let yInt = 0;
                switch(currentFunc) {
                    case 'x': yInt = xEnd * xEnd / 2; break;
                    case 'x2': yInt = xEnd * xEnd * xEnd / 3; break;
                    case 'sin': yInt = -Math.cos(xEnd); break;
                    case 'cos': yInt = Math.sin(xEnd); break;
                    case 'exp': yInt = Math.exp(xEnd); break;
                }

                const px = intCanvas.width/2 + xEnd * 60;
                const py = intCanvas.height/2 - yInt * 40;

                intCtx.fillStyle = '#ef4444';
                intCtx.beginPath();
                intCtx.arc(px, py, 5, 0, Math.PI * 2);
                intCtx.fill();
            }, 50);
        }

        // 初始化
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                renderMath();
            }, 100);
        });

        function toggleReturnLinks() { const p = document.querySelector('.return-links'); if (!p) return; if (p.style.display === 'flex') { p.style.opacity = '0'; setTimeout(() => p.style.display = 'none', 160); } else { p.style.display = 'flex'; requestAnimationFrame(() => p.style.opacity = '1'); } }
    </script>

    <div class="return-home-panel"><button class="return-toggle" onclick="toggleReturnLinks()"><i class="fa-solid fa-house"></i></button><div class="return-links"><a class="return-link" href="index.html"><i class="fa-solid fa-arrow-left"></i> 返回目录</a><a class="return-link" href="../index.html"><i class="fa-solid fa-house"></i> 返回主站</a></div></div>
</body>
</html>
