<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>复合函数实验室</title>
    
    <!-- 本地化资源 -->
    <!-- Tailwind CSS (运行时编译) -->
    <script src="../common-assets/js/tailwind.min.js"></script>
    
    <!-- Material Symbols 图标字体 -->
    <link rel="stylesheet" href="../common-assets/css/lab1-material-symbols.css">
    
    <!-- 页面专用样式 -->
    <link rel="stylesheet" href="assets/lab1-7.css">

    <!-- MathJax 配置 -->
    <script src="../common-assets/js/mathjax-config.js"></script>
    <script defer src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js"></script>
</head>

<body class="bg-gray-50 text-gray-800 font-sans h-screen w-screen overflow-hidden flex flex-col md:flex-row">

    <!-- 返回主页浮动面板 -->
    <div class="fixed bottom-4 right-4 z-50 flex flex-col items-end space-y-2">
        <div class="hidden flex-col space-y-2 p-3 bg-white/95 backdrop-blur shadow-xl border border-indigo-100 rounded-xl transition-all duration-300 origin-bottom-right transform scale-95 opacity-0" id="return-links">
            <a class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-colors text-sm" href="index.html">
                <span class="material-symbols-outlined text-[18px]">arrow_back</span>
                <span>返回目录</span>
            </a>
            <a class="flex items-center space-x-2 px-3 py-2 rounded-lg bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-colors text-sm" href="../index.html">
                <span class="material-symbols-outlined text-[18px]">home</span>
                <span>返回主站</span>
            </a>
        </div>
        <button class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-indigo-500 text-white shadow-lg shadow-indigo-500/30 hover:scale-105 hover:shadow-indigo-500/50 transition-all duration-300 flex items-center justify-center group" onclick="toggleReturnLinks()">
            <span class="material-symbols-outlined group-hover:rotate-12 transition-transform">home</span>
        </button>
    </div>

    <!-- Header (Mobile Only) -->
    <header class="md:hidden bg-indigo-600 text-white p-4 shadow-md flex items-center justify-between z-20">
        <h1 class="text-lg font-bold flex items-center gap-2">
            <span class="material-symbols-outlined">layers</span>
            复合函数实验室
        </h1>
    </header>

    <!-- Sidebar Navigation -->
    <nav class="w-full md:w-64 bg-white border-b md:border-b-0 md:border-r border-gray-200 flex md:flex-col shrink-0 overflow-x-auto md:overflow-visible z-10 p-2 md:p-4 gap-2 md:gap-3 shadow-sm">
        <div class="hidden md:flex items-center gap-2 mb-6 px-2 text-indigo-600">
            <span class="material-symbols-outlined text-3xl">layers</span>
            <h1 class="text-xl font-bold text-gray-800">复合实验室</h1>
        </div>
        <button class="nav-btn group flex items-center gap-3 w-full p-3 rounded-lg text-left transition-all duration-200 bg-indigo-50 text-indigo-700 font-medium" onclick="switchPanel('first-jump')">
            <span class="material-symbols-outlined">looks_one</span>
            <span class="whitespace-nowrap">第一跳：内层函数</span>
        </button>
        <button class="nav-btn group flex items-center gap-3 w-full p-3 rounded-lg text-left transition-all duration-200 hover:bg-gray-100 text-gray-600" onclick="switchPanel('second-jump')">
            <span class="material-symbols-outlined">looks_two</span>
            <span class="whitespace-nowrap">第二跳：外层函数</span>
        </button>
        <button class="nav-btn group flex items-center gap-3 w-full p-3 rounded-lg text-left transition-all duration-200 hover:bg-gray-100 text-gray-600" onclick="switchPanel('composite')">
            <span class="material-symbols-outlined">merge</span>
            <span class="whitespace-nowrap">复合全景</span>
        </button>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto no-scrollbar relative bg-slate-50 p-4 md:p-6 lg:p-8">
        <!-- Panel 1: First Jump (Inner Function) -->
        <div class="panel-content active grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto" id="first-jump">
            <!-- Controls -->
            <div class="space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-indigo-600 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined">input</span> 内层函数 $u = g(x)$
                    </h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">选择函数 $g(x)$</label>
                        <select class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 outline-none" id="g-function" onchange="firstJump()">
                            <option selected value="cos">$g(x) = \cos(x)$</option>
                            <option value="sin">$g(x) = \sin(x)$</option>
                            <option value="exp">$g(x) = e^x$</option>
                            <option value="log">$g(x) = \ln(x)$</option>
                            <option value="sqrt">$g(x) = \sqrt{x}$</option>
                            <option value="square">$g(x) = x^2$</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">输入 $x$ 值</label>
                        <input class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" id="x-value" oninput="firstJump()" step="0.1" type="number" value="0.5">
                    </div>
                    <div class="bg-indigo-50 border border-indigo-100 rounded-lg p-4 text-center">
                        <div class="text-xl font-bold text-indigo-900 mb-1" id="first-result">$u \approx 0.878$</div>
                        <div class="text-sm text-indigo-600">中间变量 $u$ 的值</div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">定义域检查</h3>
                    <div class="text-sm text-gray-600 leading-relaxed" id="first-steps">计算过程：$x=0.5 \xrightarrow{g} u=0.878$</div>
                </div>
            </div>

            <!-- Visualization -->
            <div class="space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined">insights</span> 映射可视化
                    </h3>
                    <div class="w-full min-h-[300px]">
                        <canvas id="axisCanvas"></canvas>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">
                        上方数轴：输入 $x$ &nbsp;|&nbsp; 下方数轴：输出 $u$
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel 2: Second Jump (Outer Function) -->
        <div class="panel-content grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto" id="second-jump">
            <div class="space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-indigo-600 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined">output</span> 外层函数 $y = f(u)$
                    </h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">选择函数 $f(u)$</label>
                        <select class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-indigo-500 outline-none" id="f-function" onchange="secondJump()">
                            <option selected value="square">$f(u) = u^2$</option>
                            <option value="sqrt">$f(u) = \sqrt{u}$</option>
                            <option value="exp">$f(u) = e^u$</option>
                            <option value="log">$f(u) = \ln(u)$</option>
                            <option value="recip">$f(u) = 1/u$</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">输入 $u$ 值</label>
                        <input class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" id="u-value" oninput="secondJump()" step="0.1" type="number" value="0.878">
                    </div>
                    <div class="bg-green-50 border border-green-100 rounded-lg p-4 text-center">
                        <div class="text-xl font-bold text-green-900 mb-1" id="y-result">$y \approx 0.771$</div>
                        <div class="text-sm text-green-600">最终输出 $y$ 的值</div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">定义域检查</h3>
                    <div class="text-sm text-gray-600 leading-relaxed" id="y-analysis">确保 $u$ 在 $f$ 的定义域内。</div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined">insights</span> 映射可视化
                    </h3>
                    <div class="w-full min-h-[300px]">
                        <canvas id="secondAxisCanvas"></canvas>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">
                        上方数轴：输入 $u$ &nbsp;|&nbsp; 下方数轴：输出 $y$
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel 3: Composite Function -->
        <div class="panel-content grid-cols-1 lg:grid-cols-2 gap-6 max-w-7xl mx-auto" id="composite">
            <div class="space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-indigo-600 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined">merge</span> 复合函数 $y = f(g(x))$
                    </h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">内层 $g(x)$</label>
                            <select class="w-full p-2 border border-gray-300 rounded-lg" id="comp-g" onchange="compositeDemo()">
                                <option value="sin">$\sin(x)$</option>
                                <option value="cos">$\cos(x)$</option>
                                <option value="exp">$e^x$</option>
                                <option value="sqrt">$\sqrt{x}$</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">外层 $f(u)$</label>
                            <select class="w-full p-2 border border-gray-300 rounded-lg" id="comp-f" onchange="compositeDemo()">
                                <option value="square">$u^2$</option>
                                <option value="cos">$\cos(u)$</option>
                                <option value="sin">$\sin(u)$</option>
                                <option value="log">$\ln(u)$</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">输入 $x$：<span id="compXVal">x = 1.0</span></label>
                        <input class="w-full appearance-none h-2 bg-gray-200 rounded" id="composite-x" max="3" min="-2" oninput="compositeDemo()" step="0.1" type="range" value="1">
                    </div>
                    <div class="bg-indigo-50 border border-indigo-100 rounded-lg p-4" id="composite-result">
                        输入 $x=1 \to u=0.84 \to y=0.71$
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">动画演示</h3>
                    <button class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 transition flex items-center justify-center gap-2" onclick="animateJumps()">
                        <span class="material-symbols-outlined">play_arrow</span> 播放两跳动画
                    </button>
                    <div class="mt-3 text-sm text-gray-500 text-center" id="compositeInfo">点击按钮观察复合过程</div>
                </div>
            </div>

            <div class="space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined">schema</span> 三轴复合可视化
                    </h3>
                    <div id="composite-container" class="w-full min-h-[300px]">
                        <canvas id="compositeCanvas"></canvas>
                    </div>
                    <div class="mt-4 text-sm text-gray-500">
                        <p><strong class="text-indigo-600">x 轴</strong> → <strong class="text-red-500">u 轴</strong> → <strong class="text-green-600">y 轴</strong></p>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">复合函数关键点</h3>
                    <ul class="text-sm text-gray-600 space-y-2">
                        <li><strong>定义域：</strong>$g(x)$ 的值必须在 $f$ 的定义域内</li>
                        <li><strong>计算顺序：</strong>从内到外，先计算 $g(x)$</li>
                        <li><strong>嵌套结构：</strong>$y = f(g(x))$ 表示将 $g$ 的输出作为 $f$ 的输入</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- 页面专用脚本 -->
    <script src="assets/lab1-7.js"></script>
</body>
</html>
