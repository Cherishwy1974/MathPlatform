<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‡½æ•°æ™ºç»˜ - è¯­ä¹‰å¯è§†åŒ–æ•™å­¦åŠ©æ‰‹</title>
    
    <!-- æœ¬åœ°åŒ–èµ„æº -->
    <script src="../common-assets/js/tailwind.min.js"></script>
    <link rel="stylesheet" href="../common-assets/css/lab1-material-symbols.css">
    
    <!-- Function Plot -->
    <script src="../common-assets/js/function-plot.js"></script>
    
    <!-- MathJax (SVGæ¸²æŸ“ï¼Œç¦»çº¿å‹å¥½) -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: { scale: 1.3, fontCache: 'global' },
            startup: { typeset: false }
        };
    </script>
    <script src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js"></script>

    <style>
        /* ä½¿ç”¨ç³»ç»Ÿä¸­æ–‡å­—ä½“æ›¿ä»£ Noto Sans SC */
        * { font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', -apple-system, sans-serif; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 3px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .function-plot .axis line { stroke: #e2e8f0; }
        .function-plot .axis path { stroke: #94a3b8; stroke-width: 1.5px; }
        .function-plot text { font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif !important; fill: #64748b !important; font-size: 12px !important; }
        
        mjx-container { font-size: 130% !important; }
        mjx-container[display="true"] { margin: 0.5em 0 !important; font-size: 150% !important; }

        .loading-dot { animation: bounce 1.4s infinite ease-in-out both; }
        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        .hidden-force { display: none !important; }
        
        .tool-btn {
            transition: all 0.2s ease;
        }
        .tool-btn:hover {
            transform: translateY(-1px);
        }
        .tool-btn.active {
            background-color: #3b82f6 !important;
            color: white !important;
            border-color: #3b82f6 !important;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #64748b;
        }
    </style>
</head>
<body class="bg-white h-screen flex flex-col overflow-hidden">

    <!-- é¡¶éƒ¨æ  -->
    <header class="bg-white border-b border-gray-100 px-5 py-3 flex items-center justify-between flex-shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-lg bg-blue-50 flex items-center justify-center">
                <span class="material-symbols-outlined text-blue-400 text-xl">ssid_chart</span>
            </div>
            <h1 class="font-medium text-gray-600 text-lg">å‡½æ•°æ™ºç»˜</h1>
            <span class="text-xs text-gray-400 hidden sm:inline">é«˜èŒæ•°å­¦å¯è§†åŒ–æ•™å­¦</span>
        </div>
        
        <div class="flex items-center gap-3">
            <div id="conn-status" class="flex items-center gap-1.5 text-sm text-gray-400">
                <span class="w-2 h-2 rounded-full bg-gray-300"></span>
                <span>æœªè¿æ¥</span>
            </div>
            
            <div class="relative">
                <input type="password" id="api-input" 
                    class="w-36 text-sm bg-gray-50 border border-gray-200 rounded-lg pl-3 pr-8 py-1.5 text-gray-600 focus:outline-none focus:border-blue-200 placeholder-gray-400"
                    placeholder="å¯†ç  0828">
                <button onclick="connect()" class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-blue-400">
                    <span class="material-symbols-outlined text-lg">login</span>
                </button>
            </div>
            
            <button onclick="resetAll()" class="p-1.5 text-gray-400 hover:text-red-400 rounded-lg" title="é‡ç½®">
                <span class="material-symbols-outlined text-xl">refresh</span>
            </button>
        </div>
    </header>

    <!-- ä¸»å†…å®¹ -->
    <main class="flex-1 flex flex-col overflow-hidden">
        
        <!-- è¾“å…¥åŒº -->
        <div class="bg-white border-b border-gray-100 px-5 py-4">
            <div class="max-w-6xl mx-auto">
                <!-- è¾“å…¥æ¡† -->
                <div class="flex items-center gap-3 mb-3">
                    <div class="flex-1 bg-gray-50 rounded-xl border border-gray-200 focus-within:border-blue-200 flex items-center">
                        <span class="material-symbols-outlined text-gray-400 ml-4">edit</span>
                        <input type="text" id="prompt-input" 
                            class="flex-1 px-3 py-3 bg-transparent border-none focus:outline-none text-gray-700"
                            placeholder="è¾“å…¥å‡½æ•°ï¼Œå¦‚ï¼šx^2-2x+1ã€sin(x)/xã€e^x..."
                            onkeydown="if(event.key === 'Enter') generate()">
                    </div>
                    <button id="gen-btn" onclick="generate()" 
                        class="px-5 py-3 bg-blue-400 hover:bg-blue-500 disabled:bg-gray-300 text-white rounded-xl flex items-center gap-2">
                        <span class="material-symbols-outlined">auto_awesome</span>
                        <span>åˆ†æ</span>
                    </button>
                </div>
                
                <!-- å·¥å…·æŒ‰é’®ç»„ -->
                <div class="space-y-2">
                    <!-- ç¬¬ä¸€è¡Œï¼šåŸºç¡€å‡½æ•° -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-400 w-16 shrink-0">åŸºç¡€å‡½æ•°</span>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1">
                            <button onclick="quickAnalysis('x^2', 'basic')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-gray-50 hover:bg-blue-50 text-gray-500 hover:text-blue-500 text-sm rounded-full border border-gray-200 hover:border-blue-200">
                                xÂ² æŠ›ç‰©çº¿
                            </button>
                            <button onclick="quickAnalysis('sin(x)', 'basic')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-gray-50 hover:bg-blue-50 text-gray-500 hover:text-blue-500 text-sm rounded-full border border-gray-200 hover:border-blue-200">
                                sin(x)
                            </button>
                            <button onclick="quickAnalysis('cos(x)', 'basic')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-gray-50 hover:bg-blue-50 text-gray-500 hover:text-blue-500 text-sm rounded-full border border-gray-200 hover:border-blue-200">
                                cos(x)
                            </button>
                            <button onclick="quickAnalysis('exp(x)', 'basic')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-gray-50 hover:bg-blue-50 text-gray-500 hover:text-blue-500 text-sm rounded-full border border-gray-200 hover:border-blue-200">
                                eË£ æŒ‡æ•°
                            </button>
                            <button onclick="quickAnalysis('log(x)', 'basic')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-gray-50 hover:bg-blue-50 text-gray-500 hover:text-blue-500 text-sm rounded-full border border-gray-200 hover:border-blue-200">
                                ln(x) å¯¹æ•°
                            </button>
                            <button onclick="quickAnalysis('1/x', 'basic')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-gray-50 hover:bg-blue-50 text-gray-500 hover:text-blue-500 text-sm rounded-full border border-gray-200 hover:border-blue-200">
                                1/x åæ¯”ä¾‹
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç¬¬äºŒè¡Œï¼šé—´æ–­ç‚¹ -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-400 w-16 shrink-0">é—´æ–­ç‚¹</span>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1">
                            <button onclick="quickAnalysis('sin(x)/x', 'discontinuity')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-orange-50 hover:bg-orange-100 text-orange-600 text-sm rounded-full border border-orange-200 hover:border-orange-300">
                                â­• sin(x)/x å¯å»é—´æ–­
                            </button>
                            <button onclick="quickAnalysis('(x^2-1)/(x-1)', 'discontinuity')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-orange-50 hover:bg-orange-100 text-orange-600 text-sm rounded-full border border-orange-200 hover:border-orange-300">
                                â­• (xÂ²-1)/(x-1)
                            </button>
                            <button onclick="quickAnalysis('1/x', 'discontinuity')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-orange-50 hover:bg-orange-100 text-orange-600 text-sm rounded-full border border-orange-200 hover:border-orange-300">
                                âˆ 1/x æ— ç©·é—´æ–­
                            </button>
                            <button onclick="quickAnalysis('tan(x)', 'discontinuity')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-orange-50 hover:bg-orange-100 text-orange-600 text-sm rounded-full border border-orange-200 hover:border-orange-300">
                                âˆ tan(x) æ— ç©·é—´æ–­
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç¬¬ä¸‰è¡Œï¼šæå€¼ä¸å•è°ƒæ€§ -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-400 w-16 shrink-0">æå€¼å•è°ƒ</span>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1">
                            <button onclick="quickAnalysis('x^3-3*x', 'extrema')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-green-50 hover:bg-green-100 text-green-600 text-sm rounded-full border border-green-200 hover:border-green-300">
                                ğŸ“ xÂ³-3x æå€¼ç‚¹
                            </button>
                            <button onclick="quickAnalysis('x^4-2*x^2', 'extrema')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-green-50 hover:bg-green-100 text-green-600 text-sm rounded-full border border-green-200 hover:border-green-300">
                                ğŸ“ xâ´-2xÂ² å¤šæå€¼
                            </button>
                            <button onclick="quickAnalysis('-x^2+4*x-3', 'extrema')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-green-50 hover:bg-green-100 text-green-600 text-sm rounded-full border border-green-200 hover:border-green-300">
                                ğŸ“ˆ -xÂ²+4x-3 æœ€å¤§å€¼
                            </button>
                            <button onclick="quickAnalysis('x^2-4*x+5', 'extrema')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-green-50 hover:bg-green-100 text-green-600 text-sm rounded-full border border-green-200 hover:border-green-300">
                                ğŸ“‰ xÂ²-4x+5 æœ€å°å€¼
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç¬¬å››è¡Œï¼šå‡¹å‡¸æ€§ä¸æ‹ç‚¹ -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-400 w-16 shrink-0">å‡¹å‡¸æ‹ç‚¹</span>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1">
                            <button onclick="quickAnalysis('x^3', 'concavity')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-purple-50 hover:bg-purple-100 text-purple-600 text-sm rounded-full border border-purple-200 hover:border-purple-300">
                                ğŸ”„ xÂ³ æ‹ç‚¹
                            </button>
                            <button onclick="quickAnalysis('x^3-3*x^2+2', 'concavity')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-purple-50 hover:bg-purple-100 text-purple-600 text-sm rounded-full border border-purple-200 hover:border-purple-300">
                                ğŸ”„ xÂ³-3xÂ²+2 å‡¹å‡¸æ€§
                            </button>
                            <button onclick="quickAnalysis('sin(x)', 'concavity')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-purple-50 hover:bg-purple-100 text-purple-600 text-sm rounded-full border border-purple-200 hover:border-purple-300">
                                ğŸ”„ sin(x) å¤šæ‹ç‚¹
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç¬¬äº”è¡Œï¼šå®šç§¯åˆ†ä¸é¢ç§¯ -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-400 w-16 shrink-0">ç§¯åˆ†é¢ç§¯</span>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1">
                            <button onclick="quickAnalysis('x^2 ä»0åˆ°2', 'integral')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-600 text-sm rounded-full border border-blue-200 hover:border-blue-300">
                                âˆ« xÂ² [0,2] é¢ç§¯
                            </button>
                            <button onclick="quickAnalysis('sin(x) ä»0åˆ°Ï€', 'integral')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-600 text-sm rounded-full border border-blue-200 hover:border-blue-300">
                                âˆ« sin(x) [0,Ï€]
                            </button>
                            <button onclick="quickAnalysis('exp(x) ä»0åˆ°1', 'integral')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-600 text-sm rounded-full border border-blue-200 hover:border-blue-300">
                                âˆ« eË£ [0,1]
                            </button>
                            <button onclick="quickAnalysis('1/x ä»1åˆ°e', 'integral')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-600 text-sm rounded-full border border-blue-200 hover:border-blue-300">
                                âˆ« 1/x [1,e]
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç¬¬å…­è¡Œï¼šæé™æ¼”ç¤º -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-400 w-16 shrink-0">æé™åŠ¨ç”»</span>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1">
                            <button onclick="quickAnalysis('sin(x)/x å½“xè¶‹å‘0', 'limit')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-teal-50 hover:bg-teal-100 text-teal-600 text-sm rounded-full border border-teal-200 hover:border-teal-300">
                                â†’ lim sin(x)/x = 1
                            </button>
                            <button onclick="quickAnalysis('(1+1/x)^x å½“xè¶‹å‘æ— ç©·', 'limit')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-teal-50 hover:bg-teal-100 text-teal-600 text-sm rounded-full border border-teal-200 hover:border-teal-300">
                                â†’ lim (1+1/x)Ë£ = e
                            </button>
                            <button onclick="quickAnalysis('(exp(x)-1)/x å½“xè¶‹å‘0', 'limit')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-teal-50 hover:bg-teal-100 text-teal-600 text-sm rounded-full border border-teal-200 hover:border-teal-300">
                                â†’ lim (eË£-1)/x = 1
                            </button>
                        </div>
                    </div>
                    
                    <!-- ç¬¬ä¸ƒè¡Œï¼šæ¸è¿‘çº¿ä¸åˆ‡çº¿ -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-400 w-16 shrink-0">æ¸è¿‘åˆ‡çº¿</span>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar flex-1">
                            <button onclick="quickAnalysis('1/x çš„æ¸è¿‘çº¿', 'asymptote')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-pink-50 hover:bg-pink-100 text-pink-600 text-sm rounded-full border border-pink-200 hover:border-pink-300">
                                â‹¯ 1/x æ¸è¿‘çº¿
                            </button>
                            <button onclick="quickAnalysis('exp(x) çš„æ¸è¿‘çº¿', 'asymptote')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-pink-50 hover:bg-pink-100 text-pink-600 text-sm rounded-full border border-pink-200 hover:border-pink-300">
                                â‹¯ eË£ æ°´å¹³æ¸è¿‘çº¿
                            </button>
                            <button onclick="quickAnalysis('x^2 åœ¨x=1å¤„çš„åˆ‡çº¿', 'tangent')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-pink-50 hover:bg-pink-100 text-pink-600 text-sm rounded-full border border-pink-200 hover:border-pink-300">
                                ğŸ“ xÂ² åˆ‡çº¿(x=1)
                            </button>
                            <button onclick="quickAnalysis('sin(x) åœ¨x=0å¤„çš„åˆ‡çº¿', 'tangent')" class="tool-btn flex-shrink-0 px-3 py-1.5 bg-pink-50 hover:bg-pink-100 text-pink-600 text-sm rounded-full border border-pink-200 hover:border-pink-300">
                                ğŸ“ sin(x) åˆ‡çº¿(x=0)
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading-bar" class="hidden-force bg-blue-50 border-b border-blue-100 px-5 py-3 flex items-center justify-center gap-3">
            <div class="flex items-center gap-1.5">
                <span class="w-2 h-2 rounded-full bg-blue-400 loading-dot"></span>
                <span class="w-2 h-2 rounded-full bg-blue-400 loading-dot"></span>
                <span class="w-2 h-2 rounded-full bg-blue-400 loading-dot"></span>
            </div>
            <span class="text-blue-500 text-sm">æ­£åœ¨åˆ†æå‡½æ•°ç‰¹å¾...</span>
        </div>

        <!-- å›¾åƒåŒº -->
        <div class="flex-1 overflow-auto p-5 bg-gray-50">
            
            <!-- ç©ºçŠ¶æ€ -->
            <div id="empty-state" class="h-full flex items-center justify-center">
                <div class="text-center max-w-lg">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gray-100 flex items-center justify-center">
                        <span class="material-symbols-outlined text-gray-300 text-4xl">functions</span>
                    </div>
                    <h3 class="text-xl font-medium text-gray-500 mb-2">é€‰æ‹©å·¥å…·æŒ‰é’®æˆ–è¾“å…¥å‡½æ•°</h3>
                    <p class="text-gray-400 text-sm mb-4">æ”¯æŒé—´æ–­ç‚¹ã€æå€¼ç‚¹ã€å‡¹å‡¸æ€§ã€ç§¯åˆ†é¢ç§¯ç­‰åˆ†æ</p>
                    <p class="text-gray-400 text-xs">è¯·å…ˆè¾“å…¥å¯†ç  <strong class="text-gray-500">0828</strong> è¿æ¥</p>
                    
                    <!-- å›¾ä¾‹ -->
                    <div class="mt-6 flex flex-wrap items-center justify-center gap-4 text-xs">
                        <div class="legend-item"><span class="w-3 h-3 rounded-full border-2 border-orange-400 bg-white"></span> é—´æ–­ç‚¹</div>
                        <div class="legend-item"><span class="w-3 h-3 rounded-full bg-red-400"></span> æå¤§å€¼</div>
                        <div class="legend-item"><span class="w-3 h-3 rounded-full bg-green-400"></span> æå°å€¼</div>
                        <div class="legend-item"><span class="w-3 h-3 rounded-full bg-purple-400"></span> æ‹ç‚¹</div>
                        <div class="legend-item"><span class="w-3 h-3 bg-blue-200"></span> ç§¯åˆ†åŒºåŸŸ</div>
                    </div>
                </div>
            </div>

            <!-- åˆ†æç»“æœåŒº -->
            <div id="result-view" class="hidden-force max-w-5xl mx-auto">
                <!-- å…¬å¼ä¸è¯´æ˜ -->
                <div class="bg-white rounded-xl border border-gray-100 p-5 mb-4">
                    <div id="formula-display" class="text-2xl text-gray-700 text-center mb-3"></div>
                    <div id="analysis-info" class="text-sm text-gray-600 space-y-1"></div>
                </div>
                
                <!-- ä¸»å›¾ -->
                <div class="bg-white rounded-xl border border-gray-100 overflow-hidden mb-4">
                    <div class="px-4 py-3 border-b border-gray-50 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-blue-400"></span>
                            <span class="font-medium text-gray-600">å‡½æ•°å›¾åƒ</span>
                        </div>
                        <div id="graph-legend" class="flex items-center gap-3 text-xs"></div>
                    </div>
                    <div id="main-plot" class="h-96"></div>
                </div>
                
                <!-- å¯¼æ•°å›¾ï¼ˆå¯é€‰ï¼‰ -->
                <div id="derivative-section" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-4">
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <div class="px-4 py-3 border-b border-gray-50 flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-green-400"></span>
                            <span class="font-medium text-gray-600">ä¸€é˜¶å¯¼æ•°</span>
                            <span id="tex-d1" class="ml-auto text-green-500 text-sm"></span>
                        </div>
                        <div id="plot-d1" class="h-64"></div>
                    </div>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                        <div class="px-4 py-3 border-b border-gray-50 flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-purple-400"></span>
                            <span class="font-medium text-gray-600">äºŒé˜¶å¯¼æ•°</span>
                            <span id="tex-d2" class="ml-auto text-purple-500 text-sm"></span>
                        </div>
                        <div id="plot-d2" class="h-64"></div>
                    </div>
                </div>
            </div>

            <!-- æé™åŠ¨ç”»åŒº -->
            <div id="limit-view" class="hidden-force max-w-4xl mx-auto">
                <div class="bg-white rounded-xl border border-gray-100 p-6 mb-4 text-center">
                    <div id="limit-formula" class="text-3xl text-gray-700 mb-3"></div>
                    <div id="limit-value" class="text-lg text-blue-500 font-mono"></div>
                </div>
                
                <div class="bg-white rounded-xl border border-gray-100 overflow-hidden mb-4">
                    <div id="plot-limit" class="h-80"></div>
                </div>
                
                <div class="bg-white rounded-xl border border-gray-100 p-4 flex items-center justify-center gap-6">
                    <button id="anim-btn" onclick="toggleAnim()" class="px-6 py-2.5 bg-blue-400 hover:bg-blue-500 text-white rounded-full flex items-center gap-2">
                        <span class="material-symbols-outlined" id="anim-icon">play_arrow</span>
                        <span id="anim-text">å¼€å§‹æ¼”ç¤º</span>
                    </button>
                    <div class="flex items-center gap-3 bg-gray-50 rounded-full px-4 py-2 w-56">
                        <span class="text-xs text-gray-500">x =</span>
                        <input type="range" id="limit-slider" class="flex-1 accent-blue-400" step="0.01" oninput="manualSlide(this.value)">
                        <span id="slider-val" class="text-xs text-gray-500 font-mono w-10 text-right">0</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ========== é…ç½® ==========
        const CONFIG = {
            password: "0828",
            api: {
                key: "sk-eb1e9427a3624b48b706015c771d08b5",
                url: "https://api.deepseek.com/chat/completions",
                model: "deepseek-chat"
            }
        };

        const state = {
            connected: false,
            currentData: null,
            animating: false,
            animFrame: null,
            limitData: null
        };

        const $ = id => document.getElementById(id);

        // ========== è¿æ¥ ==========
        function connect() {
            const input = $('api-input').value.trim();
            if (input === CONFIG.password || (input.startsWith('sk-') && input.length > 20)) {
                if (input.startsWith('sk-')) CONFIG.api.key = input;
                state.connected = true;
                $('conn-status').innerHTML = '<span class="w-2 h-2 rounded-full bg-green-400"></span><span class="text-green-500">å·²è¿æ¥</span>';
                $('api-input').value = '';
                $('api-input').placeholder = 'å·²è¿æ¥';
            } else {
                $('api-input').classList.add('border-red-300');
                setTimeout(() => $('api-input').classList.remove('border-red-300'), 1500);
            }
        }
        $('api-input').addEventListener('keydown', e => { if (e.key === 'Enter') connect(); });

        // ========== å¿«æ·åˆ†æ ==========
        function quickAnalysis(expr, type) {
            $('prompt-input').value = expr;
            generate(type);
        }

        // ========== ä¸»ç”Ÿæˆå‡½æ•° ==========
        async function generate(analysisType = 'auto') {
            const prompt = $('prompt-input').value.trim();
            if (!prompt) return;
            if (!state.connected) { alert('è¯·å…ˆè¾“å…¥å¯†ç è¿æ¥'); return; }

            $('loading-bar').classList.remove('hidden-force');
            $('empty-state').classList.add('hidden-force');
            $('result-view').classList.add('hidden-force');
            $('limit-view').classList.add('hidden-force');
            $('gen-btn').disabled = true;
            stopAnim();

            const systemPrompt = `ä½ æ˜¯é«˜èŒæ•°å­¦å¯è§†åŒ–æ•™å­¦åŠ©æ‰‹ã€‚åˆ†æç”¨æˆ·è¾“å…¥çš„å‡½æ•°ï¼Œè¿”å›JSONã€‚

ã€åˆ†æç±»å‹åˆ¤æ–­ã€‘
- basic: åŸºç¡€å‡½æ•°å›¾åƒ + å¯¼æ•°
- discontinuity: é‡ç‚¹åˆ†æé—´æ–­ç‚¹
- extrema: é‡ç‚¹åˆ†ææå€¼ç‚¹ã€æœ€å€¼ã€å•è°ƒåŒºé—´
- concavity: é‡ç‚¹åˆ†æå‡¹å‡¸æ€§ã€æ‹ç‚¹
- integral: å®šç§¯åˆ†ã€é¢ç§¯è®¡ç®—
- limit: æé™åŠ¨ç”»æ¼”ç¤º
- asymptote: æ¸è¿‘çº¿åˆ†æ
- tangent: åˆ‡çº¿åˆ†æ

ç”¨æˆ·è¯·æ±‚ç±»å‹æç¤º: ${analysisType}

ã€è¿”å›JSONæ ¼å¼ã€‘
{
    "mode": "analysis" æˆ– "limit",
    "function": {
        "tex": "f(x)=x^2",
        "plot": "x^2",
        "description": "äºŒæ¬¡å‡½æ•°ï¼Œå¼€å£å‘ä¸Šçš„æŠ›ç‰©çº¿"
    },
    "derivative1": {"tex": "f'(x)=2x", "plot": "2*x"},
    "derivative2": {"tex": "f''(x)=2", "plot": "2"},
    "domain": [-5, 5],
    "yRange": [-2, 10],
    
    "discontinuities": [
        {"x": 0, "type": "removable", "limitValue": 1, "description": "å¯å»é—´æ–­ç‚¹ï¼Œæé™ä¸º1"}
    ],
    
    "extrema": [
        {"x": 1, "y": -2, "type": "minimum", "description": "æå°å€¼ç‚¹"},
        {"x": -1, "y": 2, "type": "maximum", "description": "æå¤§å€¼ç‚¹"}
    ],
    
    "monotonicity": [
        {"interval": "(-âˆ, -1)", "type": "increasing"},
        {"interval": "(-1, 1)", "type": "decreasing"}
    ],
    
    "concavity": [
        {"interval": "(-âˆ, 0)", "type": "concave_down", "description": "å‡¹ï¼ˆä¸Šå‡¸ï¼‰"},
        {"interval": "(0, +âˆ)", "type": "concave_up", "description": "å‡¸ï¼ˆä¸‹å‡¸ï¼‰"}
    ],
    
    "inflectionPoints": [
        {"x": 0, "y": 0, "description": "æ‹ç‚¹"}
    ],
    
    "integral": {
        "from": 0, "to": 2,
        "value": 2.667,
        "tex": "\\\\int_0^2 x^2 dx = \\\\frac{8}{3}",
        "description": "å®šç§¯åˆ†å€¼ä¸º8/3"
    },
    
    "asymptotes": [
        {"type": "vertical", "equation": "x=0"},
        {"type": "horizontal", "equation": "y=0"}
    ],
    
    "tangent": {
        "atX": 1,
        "slope": 2,
        "equation": "y=2x-1",
        "plot": "2*x-1",
        "tex": "y=2x-1"
    },
    
    "limit": {
        "target": 0,
        "result": 1,
        "tex": "\\\\lim_{x \\\\to 0}\\\\frac{\\\\sin x}{x}=1"
    },
    
    "analysis_summary": [
        "è¿™æ˜¯ä¸€ä¸ªäºŒæ¬¡å‡½æ•°",
        "åœ¨x=0å¤„å–å¾—æœ€å°å€¼0",
        "å‡½æ•°åœ¨æ•´ä¸ªå®šä¹‰åŸŸä¸Šæ˜¯å‡¹çš„"
    ]
}

ã€plotæ ¼å¼è§„åˆ™ã€‘
- ä¹˜æ³•ç”¨*: 2*x
- æŒ‡æ•°ç”¨exp(x)
- å¯¹æ•°ç”¨log(x)
- å¹‚è¿ç®—ç”¨^: x^2
- åœ†å‘¨ç‡ç”¨pi: 3.14159

ã€é‡è¦ã€‘
1. é—´æ–­ç‚¹ä¸€å®šè¦å‡†ç¡®è¯†åˆ«ï¼sin(x)/xåœ¨x=0æ— å®šä¹‰ä½†æé™ä¸º1
2. æå€¼ç‚¹è¦é€šè¿‡å¯¼æ•°ä¸º0æ±‚å‡º
3. æ‹ç‚¹è¦é€šè¿‡äºŒé˜¶å¯¼æ•°ä¸º0æ±‚å‡º
4. ç§¯åˆ†åŒºåŸŸå¦‚ç”¨æˆ·æœªæŒ‡å®šï¼Œç»™å‡ºåˆç†é»˜è®¤åŒºé—´`;

            try {
                const response = await fetch(CONFIG.api.url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.api.key}`
                    },
                    body: JSON.stringify({
                        model: CONFIG.api.model,
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: prompt }
                        ],
                        temperature: 0.1,
                        response_format: { type: 'json_object' }
                    })
                });

                if (!response.ok) throw new Error(`è¯·æ±‚å¤±è´¥ (${response.status})`);
                const data = await response.json();
                const result = JSON.parse(data.choices[0].message.content);
                console.log('åˆ†æç»“æœ:', result);
                state.currentData = result;

                if (result.mode === 'limit' || result.limit) {
                    renderLimitMode(result);
                } else {
                    renderAnalysisMode(result);
                }
            } catch (err) {
                console.error(err);
                alert('åˆ†æå¤±è´¥: ' + err.message);
                $('empty-state').classList.remove('hidden-force');
            } finally {
                $('loading-bar').classList.add('hidden-force');
                $('gen-btn').disabled = false;
            }
        }

        // ========== æ¸²æŸ“åˆ†æç»“æœ ==========
        function renderAnalysisMode(data) {
            $('result-view').classList.remove('hidden-force');
            
            // å…¬å¼
            setMath('formula-display', `$${data.function.tex}$`);
            
            // åˆ†æè¯´æ˜
            const infoEl = $('analysis-info');
            infoEl.innerHTML = '';
            
            if (data.analysis_summary) {
                data.analysis_summary.forEach(text => {
                    infoEl.innerHTML += `<p>â€¢ ${text}</p>`;
                });
            }
            
            // é—´æ–­ç‚¹ä¿¡æ¯
            if (data.discontinuities?.length) {
                data.discontinuities.forEach(d => {
                    infoEl.innerHTML += `<p class="text-orange-600">â­• ${d.description || `x=${d.x} æ˜¯${d.type === 'removable' ? 'å¯å»' : d.type === 'infinite' ? 'æ— ç©·' : ''}é—´æ–­ç‚¹`}</p>`;
                });
            }
            
            // æå€¼ä¿¡æ¯
            if (data.extrema?.length) {
                data.extrema.forEach(e => {
                    const icon = e.type === 'maximum' ? 'ğŸ”´' : 'ğŸŸ¢';
                    const text = e.type === 'maximum' ? 'æå¤§å€¼' : 'æå°å€¼';
                    infoEl.innerHTML += `<p class="text-green-600">${icon} åœ¨ x=${e.x} å¤„å–å¾—${text} ${e.y}</p>`;
                });
            }
            
            // æ‹ç‚¹ä¿¡æ¯
            if (data.inflectionPoints?.length) {
                data.inflectionPoints.forEach(p => {
                    infoEl.innerHTML += `<p class="text-purple-600">ğŸ”„ åœ¨ x=${p.x} å¤„æœ‰æ‹ç‚¹</p>`;
                });
            }
            
            // ç§¯åˆ†ä¿¡æ¯
            if (data.integral) {
                infoEl.innerHTML += `<p class="text-blue-600">âˆ« ${data.integral.description || `ä»${data.integral.from}åˆ°${data.integral.to}çš„å®šç§¯åˆ† = ${data.integral.value}`}</p>`;
            }

            // ç»‘å›¾
            setTimeout(() => {
                drawMainPlot(data);
                
                // å¯¼æ•°å›¾
                if (data.derivative1 && data.derivative2) {
                    $('derivative-section').classList.remove('hidden');
                    setMath('tex-d1', `$${data.derivative1.tex}$`);
                    setMath('tex-d2', `$${data.derivative2.tex}$`);
                    drawSimplePlot('plot-d1', data.derivative1.plot, data.domain, '#4ade80');
                    drawSimplePlot('plot-d2', data.derivative2.plot, data.domain, '#c084fc');
                } else {
                    $('derivative-section').classList.add('hidden');
                }
            }, 100);
        }

        // ========== ä¸»å›¾ç»‘åˆ¶ ==========
        function drawMainPlot(data) {
            const container = $('main-plot');
            const domain = data.domain || [-5, 5];
            const yRange = data.yRange || [-6, 6];
            
            const plotData = [
                {
                    fn: data.function.plot,
                    color: '#3b82f6',
                    graphType: 'polyline',
                    nSamples: 1000
                }
            ];

            // ç§¯åˆ†åŒºåŸŸå¡«å……
            if (data.integral) {
                plotData.unshift({
                    fn: data.function.plot,
                    range: [data.integral.from, data.integral.to],
                    closed: true,
                    color: 'rgba(59, 130, 246, 0.2)'
                });
            }

            // é—´æ–­ç‚¹ï¼ˆç©ºå¿ƒåœ†ï¼‰
            if (data.discontinuities) {
                data.discontinuities.forEach(d => {
                    if (d.type === 'removable' && d.limitValue !== undefined) {
                        plotData.push({
                            points: [[d.x, d.limitValue]],
                            fnType: 'points',
                            graphType: 'scatter',
                            color: '#f97316',
                            attr: { r: 7, 'stroke-width': 2.5, stroke: '#f97316', fill: 'white' }
                        });
                    }
                });
            }

            // æå€¼ç‚¹
            if (data.extrema) {
                data.extrema.forEach(e => {
                    const color = e.type === 'maximum' ? '#ef4444' : '#22c55e';
                    plotData.push({
                        points: [[e.x, e.y]],
                        fnType: 'points',
                        graphType: 'scatter',
                        color: color,
                        attr: { r: 7 }
                    });
                });
            }

            // æ‹ç‚¹
            if (data.inflectionPoints) {
                data.inflectionPoints.forEach(p => {
                    plotData.push({
                        points: [[p.x, p.y]],
                        fnType: 'points',
                        graphType: 'scatter',
                        color: '#a855f7',
                        attr: { r: 7 }
                    });
                });
            }

            // åˆ‡çº¿
            if (data.tangent) {
                plotData.push({
                    fn: data.tangent.plot,
                    color: '#f43f5e',
                    graphType: 'polyline',
                    nSamples: 100
                });
                plotData.push({
                    points: [[data.tangent.atX, evalExpr(data.function.plot, data.tangent.atX)]],
                    fnType: 'points',
                    graphType: 'scatter',
                    color: '#f43f5e',
                    attr: { r: 6 }
                });
            }

            // æ¸è¿‘çº¿
            if (data.asymptotes) {
                data.asymptotes.forEach(a => {
                    if (a.type === 'horizontal') {
                        const y = parseFloat(a.equation.replace('y=', ''));
                        plotData.push({
                            fn: `${y}`,
                            color: '#94a3b8',
                            graphType: 'polyline',
                            nSamples: 2
                        });
                    }
                });
            }

            try {
                functionPlot({
                    target: '#main-plot',
                    width: container.clientWidth,
                    height: container.clientHeight || 380,
                    xAxis: { domain: domain, label: 'x' },
                    yAxis: { domain: yRange, label: 'y' },
                    grid: true,
                    data: plotData
                });
            } catch (e) {
                console.error('ç»‘å›¾å¤±è´¥:', e);
            }
        }

        function drawSimplePlot(id, expr, domain, color) {
            const container = $(id);
            try {
                functionPlot({
                    target: '#' + id,
                    width: container.clientWidth,
                    height: container.clientHeight || 250,
                    xAxis: { domain: domain || [-5, 5] },
                    yAxis: { domain: [-6, 6] },
                    grid: true,
                    data: [{ fn: expr, color: color, graphType: 'polyline' }]
                });
            } catch (e) {
                container.innerHTML = '<div class="flex items-center justify-center h-full text-red-400 text-sm">ç»˜å›¾å¤±è´¥</div>';
            }
        }

        function evalExpr(expr, x) {
            try {
                const safeExpr = expr.replace(/sin/g,'Math.sin').replace(/cos/g,'Math.cos').replace(/tan/g,'Math.tan')
                    .replace(/exp/g,'Math.exp').replace(/log/g,'Math.log').replace(/sqrt/g,'Math.sqrt')
                    .replace(/pi/g,'Math.PI').replace(/\^/g,'**');
                return new Function('x', `return ${safeExpr}`)(x);
            } catch { return 0; }
        }

        // ========== æé™æ¨¡å¼ ==========
        function renderLimitMode(data) {
            $('limit-view').classList.remove('hidden-force');
            state.limitData = data;
            
            const limitInfo = data.limit || data;
            setMath('limit-formula', `$$${limitInfo.tex || data.function?.tex}$$`);

            const target = limitInfo.target ?? 0;
            const domain = data.domain || [target - 5, target + 5];
            const slider = $('limit-slider');
            slider.min = domain[0];
            slider.max = domain[1];
            slider.value = domain[0];

            updateLimitPlot(parseFloat(slider.value));
            setTimeout(() => toggleAnim(true), 500);
        }

        function updateLimitPlot(xVal) {
            const data = state.limitData;
            const expr = data.function?.plot || data.expression?.plot;
            const target = data.limit?.target ?? data.target ?? 0;
            const result = data.limit?.result ?? data.result ?? 1;
            const domain = data.domain || [target - 5, target + 5];

            const yVal = evalExpr(expr, xVal);
            $('limit-value').textContent = `x = ${xVal.toFixed(3)} â†’ f(x) â‰ˆ ${isFinite(yVal) ? yVal.toFixed(4) : 'æœªå®šä¹‰'}`;
            $('slider-val').textContent = xVal.toFixed(2);

            const plotData = [
                { fn: expr, color: '#3b82f6', graphType: 'polyline', nSamples: 1000 },
                { points: [[xVal, yVal]], fnType: 'points', graphType: 'scatter', color: '#f97316', attr: { r: 8 } },
                { fn: `${result}`, color: '#94a3b8', graphType: 'polyline', nSamples: 2 }
            ];

            // é—´æ–­ç‚¹
            if (data.discontinuities) {
                data.discontinuities.forEach(d => {
                    if (d.limitValue !== undefined) {
                        plotData.push({
                            points: [[d.x, d.limitValue]],
                            fnType: 'points', graphType: 'scatter', color: '#f97316',
                            attr: { r: 6, 'stroke-width': 2, stroke: '#f97316', fill: 'white' }
                        });
                    }
                });
            }

            try {
                functionPlot({
                    target: '#plot-limit',
                    width: $('plot-limit').clientWidth,
                    height: 320,
                    xAxis: { domain: domain },
                    yAxis: { domain: [-2, 3] },
                    grid: true,
                    data: plotData
                });
            } catch (e) { console.error(e); }
        }

        function toggleAnim(forceStart = false) {
            if (state.animating && !forceStart) { stopAnim(); } 
            else { startAnim(); }
        }

        function startAnim() {
            state.animating = true;
            $('anim-text').textContent = 'æš‚åœ';
            $('anim-icon').textContent = 'pause';
            const slider = $('limit-slider');
            const max = parseFloat(slider.max), min = parseFloat(slider.min);
            const animate = () => {
                if (!state.animating) return;
                let val = parseFloat(slider.value) + 0.02;
                if (val > max) val = min;
                slider.value = val;
                updateLimitPlot(val);
                state.animFrame = requestAnimationFrame(animate);
            };
            animate();
        }

        function stopAnim() {
            state.animating = false;
            if (state.animFrame) cancelAnimationFrame(state.animFrame);
            $('anim-text').textContent = 'å¼€å§‹æ¼”ç¤º';
            $('anim-icon').textContent = 'play_arrow';
        }

        function manualSlide(val) { stopAnim(); updateLimitPlot(parseFloat(val)); }

        function setMath(id, tex) {
            $(id).innerHTML = tex;
            if (window.MathJax?.typesetPromise) MathJax.typesetPromise([$(id)]).catch(()=>{});
        }

        function resetAll() { location.reload(); }
    </script>
</body>
</html>