<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜èŒæ•°å­¦ç‹¼äººæ€ v6.0</title>
    <!-- æœ¬åœ°åŒ–èµ„æº -->
    <script src="./assets/vendor/tailwindcss.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            overflow: hidden; 
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .missing-slot {
            display: inline-block;
            min-width: 40px;
            padding: 2px 8px;
            margin: 0 2px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border-radius: 4px;
            color: #1a1a2e;
            font-weight: bold;
            text-align: center;
            vertical-align: middle;
        }
        .missing-slot.filled { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .missing-slot.wolf-deleted { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); }
        .missing-slot.witch-restored { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
        .step-reveal { opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; }
        .step-reveal.active { opacity: 1; transform: translateY(0); }
        .wolf-eye-anim { animation: wolf-pulse 3s infinite ease-in-out; }
        @keyframes wolf-pulse {
            0%, 100% { text-shadow: 0 0 10px #ef4444; transform: scale(1); }
            50% { text-shadow: 0 0 30px #ef4444; transform: scale(1.1); }
        }
        .question-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.95) 100%);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
        }
        .math-content { font-size: 1.2em; line-height: 2; }
        .math-content mjx-container { display: inline !important; }
        /* é«˜äº®æ˜¾ç¤ºMathJaxæ¸²æŸ“åçš„å ä½ç¬¦ */
        .math-content mjx-container mjx-mtext:has-text("[???]"),
        .math-content mjx-container mjx-mtext:has-text("[å·²åˆ ]") {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 2px 6px;
            border-radius: 4px;
            color: #1a1a2e;
            font-weight: bold;
        }
        /* ä½¿ç”¨å±æ€§é€‰æ‹©å™¨ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ */
        .math-content mjx-container mjx-mtext[data-placeholder="missing"] {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            padding: 2px 6px;
            border-radius: 4px;
            color: #1a1a2e;
            font-weight: bold;
        }
        .god-section { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); }
        body.projection-mode #controlSidebar { display: none !important; }
        body.projection-mode #mainStage { width: 100% !important; }
        body.projection-mode header { display: none !important; }
    </style>
</head>
<body class="h-screen flex flex-col text-gray-200">

<header class="h-12 bg-gray-900/80 border-b border-gray-800 flex items-center justify-between px-4 z-50">
    <div class="flex items-center gap-2">
        <span class="text-amber-500 text-xl">ğŸ§ </span>
        <h1 class="text-base font-bold text-gray-100">é«˜èŒæ•°å­¦ç‹¼äººæ€</h1>
        <span class="text-xs text-gray-500">v6.0</span>
            </div>
    <div class="flex items-center gap-2">
        <div class="px-2 py-1 rounded-full bg-amber-900/50 text-amber-200 text-xs font-bold" id="headerPhaseBadge">âš™ï¸ å‡†å¤‡</div>
        <button class="bg-purple-700 hover:bg-purple-600 text-white px-2 py-1 rounded text-xs" onclick="Game.toggleProjection()">ğŸ“º</button>
        </div>
    </header>

    <main class="flex-1 flex overflow-hidden">
        <section class="w-3/4 relative flex flex-col p-6 overflow-hidden" id="mainStage">
            <div class="w-full h-full flex flex-col items-center justify-center" id="setupView">
            <h2 class="text-4xl font-bold opacity-50 animate-pulse text-amber-500/50">ç­‰å¾…é…ç½®æ¸¸æˆ...</h2>
                <div class="hidden w-full h-full flex-col items-center justify-center" id="cardDrawArea">
                <h3 class="text-2xl text-amber-500 mb-8 font-bold">è¯·ç©å®¶ä¾æ¬¡æŸ¥çœ‹èº«ä»½</h3>
                <div class="perspective-1000 w-56 h-80 cursor-pointer" onclick="Game.revealCard()">
                        <div class="relative w-full h-full transition-transform duration-700 transform-style-3d shadow-2xl" id="gameCard">
                        <div class="absolute w-full h-full bg-gradient-to-br from-slate-800 to-black rounded-xl border-4 border-amber-700 flex flex-col items-center justify-center backface-hidden">
                            <span class="text-6xl text-amber-800 opacity-50 mb-4">â“</span>
                            <div class="text-amber-600 font-bold text-sm">ç‚¹å‡»ç¿»ç‰Œ</div>
                            </div>
                        <div class="absolute w-full h-full bg-white rounded-xl border-4 flex flex-col items-center justify-center backface-hidden rotate-y-180 text-gray-900" id="cardFace">
                            <span class="text-5xl mb-3" id="cardIcon">ğŸ´</span>
                            <h2 class="text-3xl font-bold mb-2" id="cardRoleName">èº«ä»½</h2>
                            <p class="text-sm text-gray-600 px-4 text-center" id="cardDesc">...</p>
                            <button class="mt-4 px-4 py-1.5 bg-gray-900 text-white rounded text-sm" onclick="Game.hideCard(event)">è®°ä½äº†</button>
                            </div>
                        </div>
                    </div>
                <p class="mt-8 text-gray-500">ç©å®¶ <span class="text-amber-500 font-bold text-xl" id="drawIndexDisplay">1</span></p>
                </div>
            </div>

            <div class="hidden w-full h-full flex flex-col relative" id="gameView">
                <div class="absolute inset-0 bg-black/95 z-40 flex flex-col items-center justify-center transition-opacity duration-1000 opacity-0 pointer-events-none" id="nightOverlay">
                <span class="text-7xl text-red-700 wolf-eye-anim">ğŸ‘ï¸</span>
                <h2 class="text-5xl font-bold text-gray-200 mt-8 tracking-widest">å¤©é»‘è¯·é—­çœ¼</h2>
                <p class="text-xl text-red-500 mt-4 animate-pulse" id="nightActionText">...</p>
                </div>

                <div class="flex-1 flex flex-col relative z-10 overflow-hidden" id="dayContent">
                <div class="flex justify-between items-center mb-2 pb-2 border-b border-gray-700/50">
                        <div>
                        <span class="text-xs text-gray-500" id="displayChapter">ç« èŠ‚</span>
                        <h2 class="text-lg font-bold text-white" id="displayTitle">ç­‰å¾…å‘é¢˜...</h2>
                        </div>
                    <div class="flex gap-1">
                        <span class="px-2 py-0.5 rounded bg-slate-800 text-slate-400 text-xs" id="displayType">TYPE</span>
                        <span class="px-2 py-0.5 rounded text-xs" id="displayDiff">DIFF</span>
                        <span class="px-2 py-0.5 rounded bg-amber-900/50 text-amber-300 text-xs" id="missingCount">ç¼ºå¤±:0</span>
                        </div>
                    </div>

                <div class="question-card rounded-lg p-4 mb-2">
                    <div class="leading-relaxed text-slate-100 math-content" id="displayQuestion">
                            <span class="text-gray-500 italic">(è¯·ä¸Šå¸å‘é¢˜)</span>
                        </div>
                    </div>
                    
                <div class="bg-gray-800/50 rounded-lg p-2 mb-2 border border-gray-700 hidden" id="fillArea">
                    <h4 class="text-amber-400 text-xs font-bold mb-2">âœï¸ å¡«å……ç¼ºå¤±éƒ¨åˆ†</h4>
                    <div class="grid grid-cols-3 gap-2" id="fillInputs"></div>
                    <button class="mt-2 w-full bg-amber-600 hover:bg-amber-500 text-white py-1.5 rounded font-bold text-sm" onclick="Game.submitFill()">âœ… æäº¤</button>
                    </div>

                <div class="flex-1 overflow-y-auto pr-2 space-y-2 pb-16 no-scrollbar" id="displaySteps"></div>
                </div>
            </div>
        </section>

    <aside class="w-1/4 bg-gray-900/90 border-l border-gray-800 flex flex-col z-50 text-sm" id="controlSidebar">
            <div class="flex border-b border-gray-800 bg-gray-900">
            <button class="flex-1 py-2 text-xs font-bold text-amber-400 border-b-2 border-amber-500 bg-gray-800" id="tab-setup" onclick="Game.switchTab('setup')">é…ç½®</button>
            <button class="flex-1 py-2 text-xs font-bold text-gray-500" id="tab-flow" onclick="Game.switchTab('flow')">æµç¨‹</button>
            <button class="flex-1 py-2 text-xs font-bold text-gray-500" id="tab-skills" onclick="Game.switchTab('skills')">æŠ€èƒ½</button>
            <button class="flex-1 py-2 text-xs font-bold text-gray-500" id="tab-god" onclick="Game.switchTab('god')">ä¸Šå¸</button>
            </div>

        <div class="flex-1 p-2 overflow-y-auto no-scrollbar" id="panel-setup">
            <div class="grid grid-cols-2 gap-1 mb-2">
                <div class="bg-gray-800 p-1.5 rounded"><label class="text-xs text-red-400 block">ğŸºç‹¼äºº</label><input class="w-full bg-gray-900 text-white text-center rounded p-1 text-sm" id="wolfCount" type="number" value="0" min="0" oninput="Game.updateTotal()"></div>
                <div class="bg-gray-800 p-1.5 rounded"><label class="text-xs text-blue-400 block">ğŸ”®é¢„è¨€å®¶</label><input class="w-full bg-gray-900 text-white text-center rounded p-1 text-sm" id="seerCount" type="number" value="0" min="0" oninput="Game.updateTotal()"></div>
                <div class="bg-gray-800 p-1.5 rounded"><label class="text-xs text-purple-400 block">ğŸ§ªå¥³å·«</label><input class="w-full bg-gray-900 text-white text-center rounded p-1 text-sm" id="witchCount" type="number" value="0" min="0" oninput="Game.updateTotal()"></div>
                <div class="bg-gray-800 p-1.5 rounded"><label class="text-xs text-green-400 block">ğŸ§‘æ‘æ°‘</label><input class="w-full bg-gray-900 text-white text-center rounded p-1 text-sm" id="villagerCount" type="number" value="0" min="0" oninput="Game.updateTotal()"></div>
                        </div>
            <div class="bg-gray-800 px-2 py-1 rounded flex justify-between items-center mb-2">
                <span class="text-xs text-gray-400">æ€»äººæ•°</span>
                <span class="text-lg font-bold text-white" id="totalCountDisplay">0</span>
                        </div>
            <button class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 rounded text-sm" onclick="Game.generateRoles()">ğŸ”€ ç”Ÿæˆè§’è‰²å¹¶æŠ½ç‰Œ</button>
            <div class="hidden mt-2" id="playerList">
                <div class="space-y-0.5 max-h-28 overflow-y-auto no-scrollbar" id="playerListContent"></div>
                        </div>
                </div>
                
        <div class="hidden flex-1 p-2 overflow-y-auto no-scrollbar flex flex-col" id="panel-flow">
            <div class="bg-gray-800/50 rounded p-2 mb-2 border border-gray-700">
                <div class="grid grid-cols-2 gap-1">
                    <button class="col-span-2 bg-gray-700 hover:bg-gray-600 text-white py-1 rounded text-xs" onclick="Game.night('close')">å¤©é»‘è¯·é—­çœ¼</button>
                    <button class="bg-red-900/40 text-red-200 py-1 rounded text-xs" onclick="Game.night('wolf')">ç‹¼äººççœ¼</button>
                    <button class="bg-blue-900/40 text-blue-200 py-1 rounded text-xs" onclick="Game.night('seer')">é¢„è¨€å®¶ççœ¼</button>
                    <button class="bg-purple-900/40 text-purple-200 py-1 rounded text-xs" onclick="Game.night('witch')">å¥³å·«ççœ¼</button>
                    <button class="col-span-2 bg-amber-600 text-white py-1 rounded text-xs font-bold" onclick="Game.night('open')">å¤©äº®äº†</button>
                </div>
            </div>
            <div class="bg-gray-800/50 rounded p-2 mb-2 border border-gray-700">
                <div class="text-xl font-mono text-white text-center" id="timerDisplay">03:00</div>
                <div class="flex justify-center gap-1 mt-1">
                    <button class="px-2 py-0.5 bg-gray-700 text-gray-400 text-xs rounded" onclick="Game.setTimer(180)">3m</button>
                    <button class="px-2 py-0.5 bg-gray-700 text-gray-400 text-xs rounded" onclick="Game.setTimer(60)">1m</button>
                    <button class="px-2 py-0.5 bg-green-700 text-white text-xs rounded" id="timerBtn" onclick="Game.toggleTimer()">START</button>
                    </div>
                </div>
            <div class="space-y-1">
                <button class="w-full bg-blue-600 hover:bg-blue-500 text-white py-1.5 rounded font-bold text-xs" onclick="Game.nextStep()">â­ï¸ ä¸‹ä¸€æ­¥</button>
                <button class="w-full bg-green-600 hover:bg-green-500 text-white py-1.5 rounded font-bold text-xs" onclick="Game.revealAnswer()">âœ… å…¬å¸ƒç­”æ¡ˆ</button>
                <button class="w-full bg-gray-700 text-gray-300 py-1 rounded text-xs" onclick="Game.revealAll()">ğŸ‘ï¸ æ˜¾ç¤ºå…¨è§£</button>
                    </div>
                </div>

        <div class="hidden flex-1 p-2 overflow-y-auto no-scrollbar" id="panel-skills">
            <div class="bg-red-900/20 rounded p-2 mb-2 border border-red-900/30">
                <h4 class="text-red-400 text-xs font-bold mb-1">ğŸº ç‹¼äºº - åˆ é™¤æ¡ä»¶</h4>
                <select class="w-full bg-gray-900 text-white p-1 rounded text-xs mb-1" id="wolfDeleteSelect"><option value="">é€‰æ‹©...</option></select>
                <button class="w-full bg-red-700 text-white py-1 rounded text-xs font-bold" onclick="Game.wolfDelete()">ğŸ”ª åˆ é™¤</button>
                    </div>
            <div class="bg-blue-900/20 rounded p-2 mb-2 border border-blue-900/30">
                <h4 class="text-blue-400 text-xs font-bold mb-1">ğŸ”® é¢„è¨€å®¶ - æŸ¥çœ‹å®Œæ•´</h4>
                <button class="w-full bg-blue-700 text-white py-1 rounded text-xs font-bold" onclick="Game.seerView()">ğŸ‘ï¸ æŸ¥çœ‹</button>
                </div>
            <div class="bg-purple-900/20 rounded p-2 border border-purple-900/30">
                <h4 class="text-purple-400 text-xs font-bold mb-1">ğŸ§ª å¥³å·« - è¿˜åŸæ¡ä»¶</h4>
                <select class="w-full bg-gray-900 text-white p-1 rounded text-xs mb-1" id="witchRestoreSelect"><option value="">é€‰æ‹©...</option></select>
                <button class="w-full bg-purple-700 text-white py-1 rounded text-xs font-bold" onclick="Game.witchRestore()">ğŸ’Š è¿˜åŸ</button>
            </div>
                </div>
                
        <div class="hidden flex-1 p-2 overflow-y-auto no-scrollbar" id="panel-god">
            <div class="mb-2">
                <label class="text-xs text-gray-500">ç« èŠ‚</label>
                <select class="w-full bg-gray-800 text-white p-1 rounded text-xs" id="chapterSelect">
                    <option value="all">å…¨éƒ¨ç« èŠ‚</option>
                    <option value="ch1">ç¬¬1ç«  å‡½æ•°</option>
                    <option value="ch2">ç¬¬2ç«  æé™</option>
                    <option value="ch3">ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†</option>
                    <option value="ch4">ç¬¬4ç«  å¯¼æ•°åº”ç”¨</option>
                    <option value="ch5">ç¬¬5ç«  ä¸å®šç§¯åˆ†</option>
                    <option value="ch6">ç¬¬6ç«  å®šç§¯åˆ†</option>
                    <option value="ch7">ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹</option>
                    </select>
                </div>
            <div class="mb-2">
                <label class="text-xs text-gray-500">éš¾åº¦</label>
                <select class="w-full bg-gray-800 text-white p-1 rounded text-xs" id="missingLevelSelect">
                    <option value="2">ç®€å•ï¼ˆ2ä¸ªç¼ºå¤±ï¼‰</option>
                    <option value="3" selected>ä¸­ç­‰ï¼ˆ3ä¸ªç¼ºå¤±ï¼‰</option>
                    <option value="4">å›°éš¾ï¼ˆ4ä¸ªç¼ºå¤±ï¼‰</option>
                    </select>
                </div>
            <button class="w-full bg-gradient-to-r from-amber-600 to-orange-600 text-white font-bold py-2 rounded mb-2" onclick="Game.distribute()">ğŸ² å‘ ç‰Œ</button>
            
            <div class="god-section p-2 rounded mb-2">
                <div class="flex items-center justify-between">
                    <span class="text-xs text-green-400 font-bold">ğŸ‘ï¸ ä¸Šå¸è§†è§’</span>
                    <button class="text-xs text-gray-500" onclick="Game.toggleGodView()">å±•å¼€</button>
                </div>
                <div class="text-xs text-gray-300 hidden mt-1" id="godViewContent"><span class="text-gray-600">ç­‰å¾…å‘é¢˜...</span></div>
                </div>
                
            <div class="p-1.5 bg-gray-800/50 rounded border border-gray-700 text-xs">
                <div class="text-gray-500 mb-1">é¢˜åº“ç»Ÿè®¡ï¼š</div>
                <div id="bankStats" class="text-gray-400"></div>
                </div>
            </div>
        </aside>
    </main>

<div class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center" id="seerModal">
    <div class="bg-gray-900 rounded-xl p-5 max-w-xl w-full mx-4 border border-blue-500/30">
        <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-bold text-blue-400">ğŸ”® é¢„è¨€å®¶è§†è§’</h3>
            <button class="text-gray-500 hover:text-white" onclick="Game.closeSeerModal()">âœ–</button>
            </div>
        <div class="bg-black/30 rounded-lg p-3 border border-blue-500/20">
            <div class="text-base text-white leading-relaxed" id="seerModalContent"></div>
            </div>
        <div class="mt-3 text-center">
            <button class="bg-blue-600 hover:bg-blue-500 text-white px-5 py-1.5 rounded font-bold" onclick="Game.closeSeerModal()">æˆ‘è®°ä½äº†</button>
            </div>
        </div>
    </div>

    <script>
window.MathJax = {
    tex: { 
        inlineMath: [['$', '$'], ['\\(', '\\)']], 
        displayMath: [['$$', '$$'], ['\\[', '\\]']], 
        processEscapes: true,
        processEnvironments: true
    },
    svg: { fontCache: 'global' },
    loader: {
        // ç¦ç”¨å¤–éƒ¨èµ„æºåŠ è½½ï¼Œç¡®ä¿å®Œå…¨æœ¬åœ°åŒ–
        load: ['[tex]/require', '[tex]/autoload', '[tex]/configmacros']
    },
    options: {
        // ç¦ç”¨å¤–éƒ¨èµ„æºè¯·æ±‚
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
    },
    startup: {
        ready: () => {
            MathJax.startup.defaultReady();
            MathJax.startup.document.state(0);
            window.mathJaxReady = true;
            console.log('MathJax ready (localized)');
        }
    }
};
</script>
<!-- MathJax æœ¬åœ°åŒ– -->
<script src="./assets/vendor/mathjax/tex-svg.js" id="MathJax-script" async></script>

<script>
const QB = {
// ========== ç¬¬1ç«  å‡½æ•° ==========
ch1: [
    { id:"F01", title:"å‡½æ•°å®šä¹‰åŸŸ", ch:"ç¬¬1ç«  å‡½æ•°", diff:"easy", full:"æ±‚å‡½æ•° $y=\\sqrt{x-1}$ çš„å®šä¹‰åŸŸ", logic:"æ ¹å·å†…â‰¥0 âŸ¹ x-1â‰¥0 âŸ¹ xâ‰¥1", slots:[{id:"s1",label:"æ ¹å·å†…",value:"x-1"},{id:"s2",label:"ä¸ç­‰å¼",value:"x-1\\geq 0"},{id:"s3",label:"å®šä¹‰åŸŸ",value:"[1,+\\infty)"}], tpl:"æ±‚å‡½æ•° $y=\\sqrt{[s1]}$ çš„å®šä¹‰åŸŸ", ans:"[1,+âˆ)", steps:["æ ¹å·å†…å¿…é¡»â‰¥0ï¼š$x-1\\geq 0$","è§£å¾—ï¼š$x\\geq 1$","å®šä¹‰åŸŸï¼š$[1,+\\infty)$"] },
    { id:"F02", title:"å‡½æ•°å®šä¹‰åŸŸ", ch:"ç¬¬1ç«  å‡½æ•°", diff:"easy", full:"æ±‚å‡½æ•° $y=\\frac{1}{x-2}$ çš„å®šä¹‰åŸŸ", logic:"åˆ†æ¯â‰ 0 âŸ¹ x-2â‰ 0 âŸ¹ xâ‰ 2", slots:[{id:"s1",label:"åˆ†æ¯",value:"x-2"},{id:"s2",label:"é™åˆ¶æ¡ä»¶",value:"x\\neq 2"},{id:"s3",label:"å®šä¹‰åŸŸ",value:"(-\\infty,2)\\cup(2,+\\infty)"}], tpl:"æ±‚å‡½æ•° $y=\\frac{1}{[s1]}$ çš„å®šä¹‰åŸŸ", ans:"(-âˆ,2)âˆª(2,+âˆ)", steps:["åˆ†æ¯ä¸èƒ½ä¸º0ï¼š$x-2\\neq 0$","è§£å¾—ï¼š$x\\neq 2$","å®šä¹‰åŸŸï¼š$(-\\infty,2)\\cup(2,+\\infty)$"] },
    { id:"F03", title:"å‡½æ•°å®šä¹‰åŸŸ", ch:"ç¬¬1ç«  å‡½æ•°", diff:"medium", full:"æ±‚å‡½æ•° $y=\\frac{\\sqrt{x-1}}{x-3}$ çš„å®šä¹‰åŸŸ", logic:"æ ¹å·å†…â‰¥0ä¸”åˆ†æ¯â‰ 0 âŸ¹ xâ‰¥1ä¸”xâ‰ 3", slots:[{id:"s1",label:"æ ¹å·å†…",value:"x-1"},{id:"s2",label:"åˆ†æ¯",value:"x-3"},{id:"s3",label:"å®šä¹‰åŸŸ",value:"[1,3)\\cup(3,+\\infty)"}], tpl:"æ±‚å‡½æ•° $y=\\frac{\\sqrt{[s1]}}{[s2]}$ çš„å®šä¹‰åŸŸ", ans:"[1,3)âˆª(3,+âˆ)", steps:["æ ¹å·å†…â‰¥0ï¼š$x-1\\geq 0$ âŸ¹ $x\\geq 1$","åˆ†æ¯â‰ 0ï¼š$x-3\\neq 0$ âŸ¹ $x\\neq 3$","å®šä¹‰åŸŸï¼š$[1,3)\\cup(3,+\\infty)$"] },
    { id:"F04", title:"å¤åˆå‡½æ•°", ch:"ç¬¬1ç«  å‡½æ•°", diff:"medium", full:"è®¾ $f(x)=x^2$ï¼Œ$g(x)=x+1$ï¼Œæ±‚ $f(g(x))$", logic:"f(g(x))=f(x+1)=(x+1)Â²", slots:[{id:"s1",label:"f(x)",value:"x^2"},{id:"s2",label:"g(x)",value:"x+1"},{id:"s3",label:"f(g(x))",value:"(x+1)^2"}], tpl:"è®¾ $f(x)=[s1]$ï¼Œ$g(x)=[s2]$ï¼Œæ±‚ $f(g(x))$", ans:"(x+1)Â²", steps:["$g(x)=x+1$","$f(g(x))=f(x+1)=(x+1)^2$"] },
    { id:"F05", title:"åå‡½æ•°", ch:"ç¬¬1ç«  å‡½æ•°", diff:"medium", full:"æ±‚ $y=2x+1$ çš„åå‡½æ•°", logic:"y=2x+1 âŸ¹ x=(y-1)/2 âŸ¹ yâ»Â¹=(x-1)/2", slots:[{id:"s1",label:"åŸå‡½æ•°",value:"2x+1"},{id:"s2",label:"è§£å‡ºx",value:"\\frac{y-1}{2}"},{id:"s3",label:"åå‡½æ•°",value:"\\frac{x-1}{2}"}], tpl:"æ±‚ $y=[s1]$ çš„åå‡½æ•°", ans:"y=(x-1)/2", steps:["ç”± $y=2x+1$ è§£å‡º $x$","$2x=y-1$ âŸ¹ $x=\\frac{y-1}{2}$","åå‡½æ•°ï¼š$y=\\frac{x-1}{2}$"] },
    { id:"F06", title:"å¥‡å¶æ€§", ch:"ç¬¬1ç«  å‡½æ•°", diff:"easy", full:"åˆ¤æ–­ $f(x)=x^3$ çš„å¥‡å¶æ€§", logic:"f(-x)=(-x)Â³=-xÂ³=-f(x) âŸ¹ å¥‡å‡½æ•°", slots:[{id:"s1",label:"f(x)",value:"x^3"},{id:"s2",label:"f(-x)",value:"-x^3"},{id:"s3",label:"ç»“è®º",value:"å¥‡å‡½æ•°"}], tpl:"åˆ¤æ–­ $f(x)=[s1]$ çš„å¥‡å¶æ€§", ans:"å¥‡å‡½æ•°", steps:["$f(-x)=(-x)^3=-x^3$","$f(-x)=-f(x)$","æ‰€ä»¥æ˜¯å¥‡å‡½æ•°"] },
    { id:"F07", title:"å¥‡å¶æ€§", ch:"ç¬¬1ç«  å‡½æ•°", diff:"easy", full:"åˆ¤æ–­ $f(x)=x^2+1$ çš„å¥‡å¶æ€§", logic:"f(-x)=(-x)Â²+1=xÂ²+1=f(x) âŸ¹ å¶å‡½æ•°", slots:[{id:"s1",label:"f(x)",value:"x^2+1"},{id:"s2",label:"f(-x)",value:"x^2+1"},{id:"s3",label:"ç»“è®º",value:"å¶å‡½æ•°"}], tpl:"åˆ¤æ–­ $f(x)=[s1]$ çš„å¥‡å¶æ€§", ans:"å¶å‡½æ•°", steps:["$f(-x)=(-x)^2+1=x^2+1$","$f(-x)=f(x)$","æ‰€ä»¥æ˜¯å¶å‡½æ•°"] },
],
// ========== ç¬¬2ç«  æé™ ==========
ch2: [
    { id:"L01", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"easy", full:"æ±‚ $\\lim\\limits_{x\\to 2}(3x+1)$", logic:"ç›´æ¥ä»£å…¥ï¼š3Ã—2+1=7", slots:[{id:"s1",label:"xè¶‹è¿‘",value:"2"},{id:"s2",label:"è¡¨è¾¾å¼",value:"3x+1"},{id:"s3",label:"æé™å€¼",value:"7"}], tpl:"æ±‚ $\\lim\\limits_{x\\to [s1]}([s2])$", ans:"7", steps:["ç›´æ¥ä»£å…¥ $x=2$","$3\\times 2+1=7$"] },
    { id:"L02", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"easy", full:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{\\sin 4x}{2x}$", logic:"sin4x~4x âŸ¹ 4x/2x=2", slots:[{id:"s1",label:"sinå†…ç³»æ•°",value:"4"},{id:"s2",label:"åˆ†æ¯ç³»æ•°",value:"2"},{id:"s3",label:"æé™å€¼",value:"2"}], tpl:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{\\sin [s1]x}{[s2]x}$", ans:"2", steps:["ç­‰ä»·æ— ç©·å°ï¼š$\\sin 4x\\sim 4x$","$\\frac{4x}{2x}=2$"] },
    { id:"L03", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"easy", full:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{\\sin 3x}{x}$", logic:"sin3x~3x âŸ¹ 3x/x=3", slots:[{id:"s1",label:"sinå†…ç³»æ•°",value:"3"},{id:"s2",label:"åˆ†æ¯",value:"x"},{id:"s3",label:"æé™å€¼",value:"3"}], tpl:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{\\sin [s1]x}{[s2]}$", ans:"3", steps:["ç­‰ä»·æ— ç©·å°ï¼š$\\sin 3x\\sim 3x$","$\\frac{3x}{x}=3$"] },
    { id:"L04", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"easy", full:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{\\tan 2x}{x}$", logic:"tan2x~2x âŸ¹ 2x/x=2", slots:[{id:"s1",label:"tanå†…ç³»æ•°",value:"2"},{id:"s2",label:"åˆ†æ¯",value:"x"},{id:"s3",label:"æé™å€¼",value:"2"}], tpl:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{\\tan [s1]x}{[s2]}$", ans:"2", steps:["ç­‰ä»·æ— ç©·å°ï¼š$\\tan 2x\\sim 2x$","$\\frac{2x}{x}=2$"] },
    { id:"L05", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"medium", full:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{e^{2x}-1}{3x}$", logic:"e^2x-1~2x âŸ¹ 2x/3x=2/3", slots:[{id:"s1",label:"æŒ‡æ•°ç³»æ•°",value:"2"},{id:"s2",label:"åˆ†æ¯ç³»æ•°",value:"3"},{id:"s3",label:"æé™å€¼",value:"\\frac{2}{3}"}], tpl:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{e^{[s1]x}-1}{[s2]x}$", ans:"2/3", steps:["ç­‰ä»·æ— ç©·å°ï¼š$e^{2x}-1\\sim 2x$","$\\frac{2x}{3x}=\\frac{2}{3}$"] },
    { id:"L06", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"medium", full:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{\\ln(1+3x)}{2x}$", logic:"ln(1+3x)~3x âŸ¹ 3x/2x=3/2", slots:[{id:"s1",label:"lnå†…ç³»æ•°",value:"3"},{id:"s2",label:"åˆ†æ¯ç³»æ•°",value:"2"},{id:"s3",label:"æé™å€¼",value:"\\frac{3}{2}"}], tpl:"æ±‚ $\\lim\\limits_{x\\to 0}\\frac{\\ln(1+[s1]x)}{[s2]x}$", ans:"3/2", steps:["ç­‰ä»·æ— ç©·å°ï¼š$\\ln(1+3x)\\sim 3x$","$\\frac{3x}{2x}=\\frac{3}{2}$"] },
    { id:"L07", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"medium", full:"æ±‚ $\\lim\\limits_{x\\to\\infty}(1+\\frac{2}{x})^{3x}$", logic:"(1+2/x)^3x=[(1+2/x)^(x/2)]^6â†’e^6", slots:[{id:"s1",label:"åˆ†å­",value:"2"},{id:"s2",label:"æŒ‡æ•°ç³»æ•°",value:"3"},{id:"s3",label:"æé™å€¼",value:"e^6"}], tpl:"æ±‚ $\\lim\\limits_{x\\to\\infty}\\left(1+\\frac{[s1]}{x}\\right)^{[s2]x}$", ans:"eâ¶", steps:["é…å‡‘ï¼š$[(1+\\frac{2}{x})^{x/2}]^6$","ç¬¬äºŒé‡è¦æé™ï¼šå†…å±‚â†’$e$","ç»“æœï¼š$e^6$"] },
    { id:"L08", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"medium", full:"æ±‚ $\\lim\\limits_{x\\to\\infty}(1+\\frac{3}{x})^{2x}$", logic:"(1+3/x)^2xâ†’e^6", slots:[{id:"s1",label:"åˆ†å­",value:"3"},{id:"s2",label:"æŒ‡æ•°ç³»æ•°",value:"2"},{id:"s3",label:"æé™å€¼",value:"e^6"}], tpl:"æ±‚ $\\lim\\limits_{x\\to\\infty}\\left(1+\\frac{[s1]}{x}\\right)^{[s2]x}$", ans:"eâ¶", steps:["$(1+\\frac{3}{x})^{2x}=[(1+\\frac{3}{x})^{x/3}]^6$","â†’$e^6$"] },
    { id:"L09", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"medium", full:"æ±‚ $\\lim\\limits_{x\\to 1}\\frac{x^2-1}{x-1}$", logic:"xÂ²-1=(x+1)(x-1) âŸ¹ çº¦åˆ†å¾—x+1â†’2", slots:[{id:"s1",label:"è¶‹è¿‘ç‚¹",value:"1"},{id:"s2",label:"åˆ†å­",value:"x^2-1"},{id:"s3",label:"æé™å€¼",value:"2"}], tpl:"æ±‚ $\\lim\\limits_{x\\to [s1]}\\frac{[s2]}{x-[s1]}$", ans:"2", steps:["å› å¼åˆ†è§£ï¼š$x^2-1=(x+1)(x-1)$","çº¦åˆ†ï¼š$\\frac{(x+1)(x-1)}{x-1}=x+1$","ä»£å…¥ï¼š$1+1=2$"] },
    { id:"L10", title:"æé™è®¡ç®—", ch:"ç¬¬2ç«  æé™", diff:"medium", full:"æ±‚ $\\lim\\limits_{x\\to 2}\\frac{x^2-4}{x-2}$", logic:"xÂ²-4=(x+2)(x-2) âŸ¹ x+2â†’4", slots:[{id:"s1",label:"è¶‹è¿‘ç‚¹",value:"2"},{id:"s2",label:"åˆ†å­å¸¸æ•°",value:"4"},{id:"s3",label:"æé™å€¼",value:"4"}], tpl:"æ±‚ $\\lim\\limits_{x\\to [s1]}\\frac{x^2-[s2]}{x-[s1]}$", ans:"4", steps:["å› å¼åˆ†è§£ï¼š$x^2-4=(x+2)(x-2)$","çº¦åˆ†å¾— $x+2$","ä»£å…¥ï¼š$2+2=4$"] },
    { id:"L11", title:"è¿ç»­æ€§", ch:"ç¬¬2ç«  æé™", diff:"medium", full:"è®¾ $f(x)=\\begin{cases}\\frac{\\sin 2x}{x},&x\\neq 0\\\\a,&x=0\\end{cases}$ åœ¨ $x=0$ è¿ç»­ï¼Œæ±‚ $a$", logic:"lim(sin2x/x)=2 âŸ¹ a=2", slots:[{id:"s1",label:"sinå†…ç³»æ•°",value:"2"},{id:"s2",label:"è¿ç»­ç‚¹",value:"0"},{id:"s3",label:"açš„å€¼",value:"2"}], tpl:"è®¾ $f(x)=\\begin{cases}\\frac{\\sin [s1]x}{x},&x\\neq [s2]\\\\a,&x=[s2]\\end{cases}$ åœ¨ $x=[s2]$ è¿ç»­ï¼Œæ±‚ $a$", ans:"a=2", steps:["è¿ç»­æ¡ä»¶ï¼š$\\lim\\limits_{x\\to 0}f(x)=f(0)=a$","$\\lim\\limits_{x\\to 0}\\frac{\\sin 2x}{x}=2$","æ‰€ä»¥ $a=2$"] },
    { id:"L12", title:"è¿ç»­æ€§", ch:"ç¬¬2ç«  æé™", diff:"medium", full:"è®¾ $f(x)=\\begin{cases}x+a,&x<1\\\\2x,&x\\geq 1\\end{cases}$ åœ¨ $x=1$ è¿ç»­ï¼Œæ±‚ $a$", logic:"å·¦æé™1+a=å³æé™2 âŸ¹ a=1", slots:[{id:"s1",label:"åˆ†ç•Œç‚¹",value:"1"},{id:"s2",label:"å³å‡½æ•°åœ¨åˆ†ç•Œç‚¹å€¼",value:"2"},{id:"s3",label:"açš„å€¼",value:"1"}], tpl:"è®¾ $f(x)=\\begin{cases}x+a,&x<[s1]\\\\2x,&x\\geq [s1]\\end{cases}$ åœ¨ $x=[s1]$ è¿ç»­ï¼Œæ±‚ $a$", ans:"a=1", steps:["å·¦æé™ï¼š$1+a$","å³æé™ï¼š$2\\times 1=2$","è¿ç»­ï¼š$1+a=2$ âŸ¹ $a=1$"] },
],
// ========== ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ† ==========
ch3: [
    { id:"D01", title:"å¯¼æ•°è®¡ç®—", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"easy", full:"æ±‚ $y=x^4$ çš„å¯¼æ•°", logic:"(x^n)'=nx^(n-1) âŸ¹ 4xÂ³", slots:[{id:"s1",label:"æŒ‡æ•°",value:"4"},{id:"s2",label:"å¯¼æ•°",value:"4x^3"}], tpl:"æ±‚ $y=x^{[s1]}$ çš„å¯¼æ•°", ans:"y'=4xÂ³", steps:["å…¬å¼ï¼š$(x^n)'=nx^{n-1}$","$y'=4x^3$"] },
    { id:"D02", title:"å¯¼æ•°è®¡ç®—", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"easy", full:"æ±‚ $y=3x^2$ çš„å¯¼æ•°", logic:"(ax^n)'=anx^(n-1) âŸ¹ 6x", slots:[{id:"s1",label:"ç³»æ•°",value:"3"},{id:"s2",label:"æŒ‡æ•°",value:"2"},{id:"s3",label:"å¯¼æ•°",value:"6x"}], tpl:"æ±‚ $y=[s1]x^{[s2]}$ çš„å¯¼æ•°", ans:"y'=6x", steps:["$y'=3\\times 2x=6x$"] },
    { id:"D03", title:"å¯¼æ•°è®¡ç®—", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"easy", full:"æ±‚ $y=e^x$ çš„å¯¼æ•°", logic:"(e^x)'=e^x", slots:[{id:"s1",label:"å‡½æ•°",value:"e^x"},{id:"s2",label:"å¯¼æ•°",value:"e^x"}], tpl:"æ±‚ $y=[s1]$ çš„å¯¼æ•°", ans:"y'=eË£", steps:["$(e^x)'=e^x$"] },
    { id:"D04", title:"å¯¼æ•°è®¡ç®—", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"easy", full:"æ±‚ $y=\\ln x$ çš„å¯¼æ•°", logic:"(ln x)'=1/x", slots:[{id:"s1",label:"å‡½æ•°",value:"\\ln x"},{id:"s2",label:"å¯¼æ•°",value:"\\frac{1}{x}"}], tpl:"æ±‚ $y=[s1]$ çš„å¯¼æ•°", ans:"y'=1/x", steps:["$(\\ln x)'=\\frac{1}{x}$"] },
    { id:"D05", title:"å¯¼æ•°è®¡ç®—", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"easy", full:"æ±‚ $y=\\sin x$ çš„å¯¼æ•°", logic:"(sin x)'=cos x", slots:[{id:"s1",label:"å‡½æ•°",value:"\\sin x"},{id:"s2",label:"å¯¼æ•°",value:"\\cos x"}], tpl:"æ±‚ $y=[s1]$ çš„å¯¼æ•°", ans:"y'=cos x", steps:["$(\\sin x)'=\\cos x$"] },
    { id:"D06", title:"å¯¼æ•°è®¡ç®—", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"easy", full:"æ±‚ $y=\\cos x$ çš„å¯¼æ•°", logic:"(cos x)'=-sin x", slots:[{id:"s1",label:"å‡½æ•°",value:"\\cos x"},{id:"s2",label:"å¯¼æ•°",value:"-\\sin x"}], tpl:"æ±‚ $y=[s1]$ çš„å¯¼æ•°", ans:"y'=-sin x", steps:["$(\\cos x)'=-\\sin x$"] },
    { id:"D07", title:"å¤åˆå‡½æ•°æ±‚å¯¼", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"medium", full:"æ±‚ $y=e^{3x}$ çš„å¯¼æ•°", logic:"é“¾å¼æ³•åˆ™ï¼še^3x Ã— 3 = 3e^3x", slots:[{id:"s1",label:"æŒ‡æ•°ç³»æ•°",value:"3"},{id:"s2",label:"å¯¼æ•°",value:"3e^{3x}"}], tpl:"æ±‚ $y=e^{[s1]x}$ çš„å¯¼æ•°", ans:"y'=3e^{3x}", steps:["é“¾å¼æ³•åˆ™ï¼š$(e^u)'=e^u\\cdot u'$","$y'=e^{3x}\\times 3=3e^{3x}$"] },
    { id:"D08", title:"å¤åˆå‡½æ•°æ±‚å¯¼", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"medium", full:"æ±‚ $y=\\ln(2x)$ çš„å¯¼æ•°", logic:"(ln u)'=u'/u âŸ¹ 2/(2x)=1/x", slots:[{id:"s1",label:"lnå†…ç³»æ•°",value:"2"},{id:"s2",label:"å¯¼æ•°",value:"\\frac{1}{x}"}], tpl:"æ±‚ $y=\\ln([s1]x)$ çš„å¯¼æ•°", ans:"y'=1/x", steps:["$(\\ln u)'=\\frac{u'}{u}$","$y'=\\frac{2}{2x}=\\frac{1}{x}$"] },
    { id:"D09", title:"å¤åˆå‡½æ•°æ±‚å¯¼", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"medium", full:"æ±‚ $y=\\sin(2x)$ çš„å¯¼æ•°", logic:"é“¾å¼æ³•åˆ™ï¼šcos(2x)Ã—2=2cos(2x)", slots:[{id:"s1",label:"ç³»æ•°",value:"2"},{id:"s2",label:"å¯¼æ•°",value:"2\\cos(2x)"}], tpl:"æ±‚ $y=\\sin([s1]x)$ çš„å¯¼æ•°", ans:"y'=2cos(2x)", steps:["é“¾å¼æ³•åˆ™","$y'=\\cos(2x)\\times 2=2\\cos(2x)$"] },
    { id:"D10", title:"å¤åˆå‡½æ•°æ±‚å¯¼", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"medium", full:"æ±‚ $y=(2x+1)^3$ çš„å¯¼æ•°", logic:"3(2x+1)Â²Ã—2=6(2x+1)Â²", slots:[{id:"s1",label:"å†…å±‚",value:"2x+1"},{id:"s2",label:"æŒ‡æ•°",value:"3"},{id:"s3",label:"å¯¼æ•°",value:"6(2x+1)^2"}], tpl:"æ±‚ $y=([s1])^{[s2]}$ çš„å¯¼æ•°", ans:"y'=6(2x+1)Â²", steps:["$(u^n)'=nu^{n-1}\\cdot u'$","$y'=3(2x+1)^2\\times 2=6(2x+1)^2$"] },
    { id:"D11", title:"ä¹˜æ³•æ³•åˆ™", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"medium", full:"æ±‚ $y=x\\cdot e^x$ çš„å¯¼æ•°", logic:"(uv)'=u'v+uv' âŸ¹ e^x+xe^x=(1+x)e^x", slots:[{id:"s1",label:"u",value:"x"},{id:"s2",label:"v",value:"e^x"},{id:"s3",label:"å¯¼æ•°",value:"(1+x)e^x"}], tpl:"æ±‚ $y=[s1]\\cdot [s2]$ çš„å¯¼æ•°", ans:"y'=(1+x)eË£", steps:["$(uv)'=u'v+uv'$","$y'=1\\cdot e^x+x\\cdot e^x=(1+x)e^x$"] },
    { id:"D12", title:"ä¹˜æ³•æ³•åˆ™", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"medium", full:"æ±‚ $y=x^2\\cdot e^x$ çš„å¯¼æ•°", logic:"2xe^x+xÂ²e^x=(xÂ²+2x)e^x", slots:[{id:"s1",label:"u",value:"x^2"},{id:"s2",label:"v",value:"e^x"},{id:"s3",label:"å¯¼æ•°",value:"(x^2+2x)e^x"}], tpl:"æ±‚ $y=[s1]\\cdot [s2]$ çš„å¯¼æ•°", ans:"y'=(xÂ²+2x)eË£", steps:["$y'=2x\\cdot e^x+x^2\\cdot e^x$","$=(x^2+2x)e^x$"] },
    { id:"D13", title:"é™¤æ³•æ³•åˆ™", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"medium", full:"æ±‚ $y=\\frac{x}{x+1}$ çš„å¯¼æ•°", logic:"(u/v)'=(u'v-uv')/vÂ² âŸ¹ 1/(x+1)Â²", slots:[{id:"s1",label:"åˆ†å­",value:"x"},{id:"s2",label:"åˆ†æ¯",value:"x+1"},{id:"s3",label:"å¯¼æ•°",value:"\\frac{1}{(x+1)^2}"}], tpl:"æ±‚ $y=\\frac{[s1]}{[s2]}$ çš„å¯¼æ•°", ans:"y'=1/(x+1)Â²", steps:["$(\\frac{u}{v})'=\\frac{u'v-uv'}{v^2}$","$y'=\\frac{1\\cdot(x+1)-x\\cdot 1}{(x+1)^2}=\\frac{1}{(x+1)^2}$"] },
    { id:"D14", title:"å¾®åˆ†", ch:"ç¬¬3ç«  å¯¼æ•°ä¸å¾®åˆ†", diff:"easy", full:"æ±‚ $y=x^3$ çš„å¾®åˆ†", logic:"dy=y'dx=3xÂ²dx", slots:[{id:"s1",label:"å‡½æ•°",value:"x^3"},{id:"s2",label:"å¯¼æ•°",value:"3x^2"},{id:"s3",label:"å¾®åˆ†",value:"3x^2dx"}], tpl:"æ±‚ $y=[s1]$ çš„å¾®åˆ†", ans:"dy=3xÂ²dx", steps:["$y'=3x^2$","$dy=y'dx=3x^2dx$"] },
],
// ========== ç¬¬4ç«  å¯¼æ•°åº”ç”¨ ==========
ch4: [
    { id:"A01", title:"åˆ‡çº¿æ–¹ç¨‹", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"æ±‚ $y=x^2$ åœ¨ç‚¹ $(1,1)$ å¤„çš„åˆ‡çº¿æ–œç‡", logic:"y'=2x âŸ¹ k=y'(1)=2", slots:[{id:"s1",label:"å‡½æ•°",value:"x^2"},{id:"s2",label:"åˆ‡ç‚¹x",value:"1"},{id:"s3",label:"æ–œç‡",value:"2"}], tpl:"æ±‚ $y=[s1]$ åœ¨ç‚¹ $([s2],[s2]^2)$ å¤„çš„åˆ‡çº¿æ–œç‡", ans:"k=2", steps:["$y'=2x$","$k=y'(1)=2$"] },
    { id:"A02", title:"åˆ‡çº¿æ–¹ç¨‹", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"æ±‚ $y=x^3$ åœ¨ç‚¹ $(1,1)$ å¤„çš„åˆ‡çº¿æ–œç‡", logic:"y'=3xÂ² âŸ¹ k=3", slots:[{id:"s1",label:"å‡½æ•°",value:"x^3"},{id:"s2",label:"åˆ‡ç‚¹x",value:"1"},{id:"s3",label:"æ–œç‡",value:"3"}], tpl:"æ±‚ $y=[s1]$ åœ¨ç‚¹ $([s2],1)$ å¤„çš„åˆ‡çº¿æ–œç‡", ans:"k=3", steps:["$y'=3x^2$","$k=y'(1)=3$"] },
    { id:"A03", title:"åˆ‡çº¿æ–¹ç¨‹", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"æ›²çº¿ $y=x^2+ax+b$ åœ¨ç‚¹ $(1,2)$ å¤„åˆ‡çº¿æ–œç‡ä¸º $3$ï¼Œæ±‚ $a,b$", logic:"è¿‡ç‚¹âŸ¹1+a+b=2, æ–œç‡âŸ¹2+a=3 âŸ¹ a=1,b=0", slots:[{id:"s1",label:"åˆ‡ç‚¹x",value:"1"},{id:"s2",label:"åˆ‡ç‚¹y",value:"2"},{id:"s3",label:"æ–œç‡",value:"3"},{id:"s4",label:"a",value:"1"},{id:"s5",label:"b",value:"0"}], tpl:"æ›²çº¿ $y=x^2+ax+b$ åœ¨ç‚¹ $([s1],[s2])$ å¤„åˆ‡çº¿æ–œç‡ä¸º $[s3]$ï¼Œæ±‚ $a,b$", ans:"a=1,b=0", steps:["è¿‡ç‚¹ï¼š$1+a+b=2$ âŸ¹ $a+b=1$","æ–œç‡ï¼š$y'=2x+a$ï¼Œ$y'(1)=2+a=3$ âŸ¹ $a=1$","ä»£å…¥ï¼š$b=0$"] },
    { id:"A04", title:"å•è°ƒæ€§", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"æ±‚ $y=x^3-3x$ çš„å•è°ƒé€’å¢åŒºé—´", logic:"y'=3xÂ²-3=3(x+1)(x-1)>0 âŸ¹ x<-1æˆ–x>1", slots:[{id:"s1",label:"ä¸€æ¬¡é¡¹ç³»æ•°",value:"3"},{id:"s2",label:"é©»ç‚¹",value:"\\pm 1"},{id:"s3",label:"é€’å¢åŒºé—´",value:"(-\\infty,-1)\\cup(1,+\\infty)"}], tpl:"æ±‚ $y=x^3-[s1]x$ çš„å•è°ƒé€’å¢åŒºé—´", ans:"(-âˆ,-1)âˆª(1,+âˆ)", steps:["$y'=3x^2-3=3(x+1)(x-1)$","ä»¤ $y'>0$ï¼š$x<-1$ æˆ– $x>1$"] },
    { id:"A05", title:"å•è°ƒæ€§", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"æ±‚ $y=x^3-6x^2+9x$ çš„å•è°ƒé€’å‡åŒºé—´", logic:"y'=3xÂ²-12x+9=3(x-1)(x-3)<0 âŸ¹ 1<x<3", slots:[{id:"s1",label:"é©»ç‚¹1",value:"1"},{id:"s2",label:"é©»ç‚¹2",value:"3"},{id:"s3",label:"é€’å‡åŒºé—´",value:"(1,3)"}], tpl:"æ±‚ $y=x^3-6x^2+9x$ çš„å•è°ƒé€’å‡åŒºé—´", ans:"(1,3)", steps:["$y'=3x^2-12x+9=3(x-1)(x-3)$","ä»¤ $y'<0$ï¼š$1<x<3$"] },
    { id:"A06", title:"æå€¼", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"æ±‚ $y=x^3-3x$ çš„æå€¼", logic:"y'=3xÂ²-3=0 âŸ¹ x=Â±1, æå¤§y(-1)=2, æå°y(1)=-2", slots:[{id:"s1",label:"æå¤§å€¼ç‚¹",value:"-1"},{id:"s2",label:"æå¤§å€¼",value:"2"},{id:"s3",label:"æå°å€¼ç‚¹",value:"1"},{id:"s4",label:"æå°å€¼",value:"-2"}], tpl:"æ±‚ $y=x^3-3x$ çš„æå€¼", ans:"æå¤§å€¼2ï¼Œæå°å€¼-2", steps:["$y'=3x^2-3=0$ âŸ¹ $x=\\pm 1$","$y(-1)=-1+3=2$ï¼ˆæå¤§ï¼‰","$y(1)=1-3=-2$ï¼ˆæå°ï¼‰"] },
    { id:"A07", title:"æå€¼", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"è®¾ $f(x)=x^3-3x^2+a$ çš„æå°å€¼ä¸º $-4$ï¼Œæ±‚ $a$", logic:"f'=3xÂ²-6x=0 âŸ¹ x=0,2, æå°ç‚¹x=2, f(2)=a-4=-4 âŸ¹ a=0", slots:[{id:"s1",label:"æå°å€¼",value:"-4"},{id:"s2",label:"æå°ç‚¹",value:"2"},{id:"s3",label:"a",value:"0"}], tpl:"è®¾ $f(x)=x^3-3x^2+a$ çš„æå°å€¼ä¸º $[s1]$ï¼Œæ±‚ $a$", ans:"a=0", steps:["$f'(x)=3x^2-6x=3x(x-2)=0$","æå°ç‚¹ $x=2$","$f(2)=8-12+a=a-4=-4$ âŸ¹ $a=0$"] },
    { id:"A08", title:"æå€¼", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"è®¾ $f(x)=x^3+ax^2+bx+1$ åœ¨ $x=1$ å¤„æœ‰æå€¼ï¼Œä¸” $f(1)=0$ï¼Œæ±‚ $a,b$", logic:"f(1)=0âŸ¹a+b=-2, f'(1)=0âŸ¹2a+b=-3 âŸ¹ a=-1,b=-1", slots:[{id:"s1",label:"æå€¼ç‚¹",value:"1"},{id:"s2",label:"f(1)",value:"0"},{id:"s3",label:"a",value:"-1"},{id:"s4",label:"b",value:"-1"}], tpl:"è®¾ $f(x)=x^3+ax^2+bx+1$ åœ¨ $x=[s1]$ å¤„æœ‰æå€¼ï¼Œä¸” $f([s1])=[s2]$ï¼Œæ±‚ $a,b$", ans:"a=-1,b=-1", steps:["$f(1)=1+a+b+1=0$ âŸ¹ $a+b=-2$","$f'(x)=3x^2+2ax+b$","$f'(1)=3+2a+b=0$ âŸ¹ $2a+b=-3$","è§£å¾— $a=-1,b=-1$"] },
    { id:"A09", title:"æœ€å€¼", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"æ±‚ $y=x^3-3x$ åœ¨ $[-2,2]$ ä¸Šçš„æœ€å¤§å€¼", logic:"y'=0âŸ¹x=Â±1, y(-2)=-2,y(-1)=2,y(1)=-2,y(2)=2 âŸ¹ max=2", slots:[{id:"s1",label:"åŒºé—´",value:"[-2,2]"},{id:"s2",label:"æœ€å¤§å€¼",value:"2"}], tpl:"æ±‚ $y=x^3-3x$ åœ¨ $[s1]$ ä¸Šçš„æœ€å¤§å€¼", ans:"æœ€å¤§å€¼=2", steps:["$y'=3x^2-3=0$ âŸ¹ $x=\\pm 1$","$y(-2)=-2,y(-1)=2,y(1)=-2,y(2)=2$","æœ€å¤§å€¼ä¸º $2$"] },
    { id:"A10", title:"æœ€å€¼", ch:"ç¬¬4ç«  å¯¼æ•°åº”ç”¨", diff:"medium", full:"æ±‚ $y=x^2-4x+5$ åœ¨ $[0,3]$ ä¸Šçš„æœ€å°å€¼", logic:"y'=2x-4=0âŸ¹x=2, y(0)=5,y(2)=1,y(3)=2 âŸ¹ min=1", slots:[{id:"s1",label:"åŒºé—´",value:"[0,3]"},{id:"s2",label:"é©»ç‚¹",value:"2"},{id:"s3",label:"æœ€å°å€¼",value:"1"}], tpl:"æ±‚ $y=x^2-4x+5$ åœ¨ $[s1]$ ä¸Šçš„æœ€å°å€¼", ans:"æœ€å°å€¼=1", steps:["$y'=2x-4=0$ âŸ¹ $x=2$","$y(0)=5,y(2)=1,y(3)=2$","æœ€å°å€¼ä¸º $1$"] },
],
// ========== ç¬¬5ç«  ä¸å®šç§¯åˆ† ==========
ch5: [
    { id:"I01", title:"åŸºæœ¬ç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"easy", full:"æ±‚ $\\int x^3 dx$", logic:"âˆ«x^n dx=x^(n+1)/(n+1)+C", slots:[{id:"s1",label:"è¢«ç§¯å‡½æ•°",value:"x^3"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"\\frac{x^4}{4}+C"}], tpl:"æ±‚ $\\int [s1] dx$", ans:"xâ´/4+C", steps:["$\\int x^n dx=\\frac{x^{n+1}}{n+1}+C$","$\\int x^3 dx=\\frac{x^4}{4}+C$"] },
    { id:"I02", title:"åŸºæœ¬ç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"easy", full:"æ±‚ $\\int 2x dx$", logic:"âˆ«2x dx=xÂ²+C", slots:[{id:"s1",label:"ç³»æ•°",value:"2"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"x^2+C"}], tpl:"æ±‚ $\\int [s1]x dx$", ans:"xÂ²+C", steps:["$\\int 2x dx=2\\cdot\\frac{x^2}{2}+C=x^2+C$"] },
    { id:"I03", title:"åŸºæœ¬ç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"easy", full:"æ±‚ $\\int e^x dx$", logic:"âˆ«e^x dx=e^x+C", slots:[{id:"s1",label:"è¢«ç§¯å‡½æ•°",value:"e^x"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"e^x+C"}], tpl:"æ±‚ $\\int [s1] dx$", ans:"eË£+C", steps:["$\\int e^x dx=e^x+C$"] },
    { id:"I04", title:"åŸºæœ¬ç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"easy", full:"æ±‚ $\\int \\frac{1}{x} dx$", logic:"âˆ«1/x dx=ln|x|+C", slots:[{id:"s1",label:"è¢«ç§¯å‡½æ•°",value:"\\frac{1}{x}"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"\\ln|x|+C"}], tpl:"æ±‚ $\\int [s1] dx$", ans:"ln|x|+C", steps:["$\\int \\frac{1}{x} dx=\\ln|x|+C$"] },
    { id:"I05", title:"åŸºæœ¬ç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"easy", full:"æ±‚ $\\int \\cos x dx$", logic:"âˆ«cos x dx=sin x+C", slots:[{id:"s1",label:"è¢«ç§¯å‡½æ•°",value:"\\cos x"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"\\sin x+C"}], tpl:"æ±‚ $\\int [s1] dx$", ans:"sin x+C", steps:["$\\int \\cos x dx=\\sin x+C$"] },
    { id:"I06", title:"åŸºæœ¬ç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"easy", full:"æ±‚ $\\int \\sin x dx$", logic:"âˆ«sin x dx=-cos x+C", slots:[{id:"s1",label:"è¢«ç§¯å‡½æ•°",value:"\\sin x"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"-\\cos x+C"}], tpl:"æ±‚ $\\int [s1] dx$", ans:"-cos x+C", steps:["$\\int \\sin x dx=-\\cos x+C$"] },
    { id:"I07", title:"æ¢å…ƒç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"medium", full:"æ±‚ $\\int e^{2x} dx$", logic:"âˆ«e^(2x) dx=(1/2)e^(2x)+C", slots:[{id:"s1",label:"æŒ‡æ•°ç³»æ•°",value:"2"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"\\frac{1}{2}e^{2x}+C"}], tpl:"æ±‚ $\\int e^{[s1]x} dx$", ans:"(1/2)e^{2x}+C", steps:["$\\int e^{2x} dx=\\frac{1}{2}e^{2x}+C$"] },
    { id:"I08", title:"æ¢å…ƒç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"medium", full:"æ±‚ $\\int \\frac{1}{2x+1} dx$", logic:"âˆ«1/(2x+1) dx=(1/2)ln|2x+1|+C", slots:[{id:"s1",label:"åˆ†æ¯ç³»æ•°",value:"2"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"\\frac{1}{2}\\ln|2x+1|+C"}], tpl:"æ±‚ $\\int \\frac{1}{[s1]x+1} dx$", ans:"(1/2)ln|2x+1|+C", steps:["$\\int \\frac{1}{2x+1} dx=\\frac{1}{2}\\ln|2x+1|+C$"] },
    { id:"I09", title:"æ¢å…ƒç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"medium", full:"æ±‚ $\\int \\cos(3x) dx$", logic:"âˆ«cos(3x) dx=(1/3)sin(3x)+C", slots:[{id:"s1",label:"ç³»æ•°",value:"3"},{id:"s2",label:"ç§¯åˆ†ç»“æœ",value:"\\frac{1}{3}\\sin(3x)+C"}], tpl:"æ±‚ $\\int \\cos([s1]x) dx$", ans:"(1/3)sin(3x)+C", steps:["$\\int \\cos(3x) dx=\\frac{1}{3}\\sin(3x)+C$"] },
    { id:"I10", title:"æ¢å…ƒç§¯åˆ†", ch:"ç¬¬5ç«  ä¸å®šç§¯åˆ†", diff:"medium", full:"æ±‚ $\\int (2x+1)^3 dx$", logic:"âˆ«(2x+1)Â³ dx=(1/8)(2x+1)â´+C", slots:[{id:"s1",label:"å†…å±‚",value:"2x+1"},{id:"s2",label:"æŒ‡æ•°",value:"3"},{id:"s3",label:"ç§¯åˆ†ç»“æœ",value:"\\frac{1}{8}(2x+1)^4+C"}], tpl:"æ±‚ $\\int ([s1])^{[s2]} dx$", ans:"(1/8)(2x+1)â´+C", steps:["ä»¤ $u=2x+1$","$\\int u^3\\cdot\\frac{1}{2}du=\\frac{1}{8}u^4+C$"] },
],
// ========== ç¬¬6ç«  å®šç§¯åˆ† ==========
ch6: [
    { id:"J01", title:"å®šç§¯åˆ†", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"easy", full:"è®¡ç®— $\\int_0^1 x dx$", logic:"[xÂ²/2]â‚€Â¹=1/2", slots:[{id:"s1",label:"ä¸‹é™",value:"0"},{id:"s2",label:"ä¸Šé™",value:"1"},{id:"s3",label:"ç§¯åˆ†å€¼",value:"\\frac{1}{2}"}], tpl:"è®¡ç®— $\\int_{[s1]}^{[s2]} x dx$", ans:"1/2", steps:["$\\int x dx=\\frac{x^2}{2}$","$[\\frac{x^2}{2}]_0^1=\\frac{1}{2}-0=\\frac{1}{2}$"] },
    { id:"J02", title:"å®šç§¯åˆ†", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"easy", full:"è®¡ç®— $\\int_0^2 x dx$", logic:"[xÂ²/2]â‚€Â²=2", slots:[{id:"s1",label:"ä¸‹é™",value:"0"},{id:"s2",label:"ä¸Šé™",value:"2"},{id:"s3",label:"ç§¯åˆ†å€¼",value:"2"}], tpl:"è®¡ç®— $\\int_{[s1]}^{[s2]} x dx$", ans:"2", steps:["$[\\frac{x^2}{2}]_0^2=2-0=2$"] },
    { id:"J03", title:"å®šç§¯åˆ†", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"easy", full:"è®¡ç®— $\\int_0^1 x^2 dx$", logic:"[xÂ³/3]â‚€Â¹=1/3", slots:[{id:"s1",label:"ä¸‹é™",value:"0"},{id:"s2",label:"ä¸Šé™",value:"1"},{id:"s3",label:"ç§¯åˆ†å€¼",value:"\\frac{1}{3}"}], tpl:"è®¡ç®— $\\int_{[s1]}^{[s2]} x^2 dx$", ans:"1/3", steps:["$[\\frac{x^3}{3}]_0^1=\\frac{1}{3}$"] },
    { id:"J04", title:"å®šç§¯åˆ†", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"medium", full:"è®¡ç®— $\\int_0^{\\pi} \\sin x dx$", logic:"[-cos x]â‚€^Ï€=2", slots:[{id:"s1",label:"ä¸‹é™",value:"0"},{id:"s2",label:"ä¸Šé™",value:"\\pi"},{id:"s3",label:"ç§¯åˆ†å€¼",value:"2"}], tpl:"è®¡ç®— $\\int_{[s1]}^{[s2]} \\sin x dx$", ans:"2", steps:["$[-\\cos x]_0^{\\pi}=-(-1)-(-1)=2$"] },
    { id:"J05", title:"å®šç§¯åˆ†", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"medium", full:"è®¡ç®— $\\int_0^{\\frac{\\pi}{2}} \\cos x dx$", logic:"[sin x]â‚€^(Ï€/2)=1", slots:[{id:"s1",label:"ä¸‹é™",value:"0"},{id:"s2",label:"ä¸Šé™",value:"\\frac{\\pi}{2}"},{id:"s3",label:"ç§¯åˆ†å€¼",value:"1"}], tpl:"è®¡ç®— $\\int_{[s1]}^{[s2]} \\cos x dx$", ans:"1", steps:["$[\\sin x]_0^{\\frac{\\pi}{2}}=1-0=1$"] },
    { id:"J06", title:"å®šç§¯åˆ†", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"medium", full:"è®¡ç®— $\\int_1^e \\frac{1}{x} dx$", logic:"[ln x]â‚^e=1", slots:[{id:"s1",label:"ä¸‹é™",value:"1"},{id:"s2",label:"ä¸Šé™",value:"e"},{id:"s3",label:"ç§¯åˆ†å€¼",value:"1"}], tpl:"è®¡ç®— $\\int_{[s1]}^{[s2]} \\frac{1}{x} dx$", ans:"1", steps:["$[\\ln x]_1^e=1-0=1$"] },
    { id:"J07", title:"å®šç§¯åˆ†æ±‚å‚æ•°", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"medium", full:"è‹¥ $\\int_0^a x^2 dx=\\frac{8}{3}$ï¼Œ$a>0$ï¼Œæ±‚ $a$", logic:"aÂ³/3=8/3 âŸ¹ a=2", slots:[{id:"s1",label:"ç§¯åˆ†å€¼",value:"\\frac{8}{3}"},{id:"s2",label:"açš„å€¼",value:"2"}], tpl:"è‹¥ $\\int_0^a x^2 dx=[s1]$ï¼Œ$a>0$ï¼Œæ±‚ $a$", ans:"a=2", steps:["$\\frac{a^3}{3}=\\frac{8}{3}$","$a^3=8$ âŸ¹ $a=2$"] },
    { id:"J08", title:"å®šç§¯åˆ†æ±‚å‚æ•°", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"medium", full:"è‹¥ $\\int_0^a x dx=2$ï¼Œ$a>0$ï¼Œæ±‚ $a$", logic:"aÂ²/2=2 âŸ¹ a=2", slots:[{id:"s1",label:"ç§¯åˆ†å€¼",value:"2"},{id:"s2",label:"açš„å€¼",value:"2"}], tpl:"è‹¥ $\\int_0^a x dx=[s1]$ï¼Œ$a>0$ï¼Œæ±‚ $a$", ans:"a=2", steps:["$\\frac{a^2}{2}=2$","$a^2=4$ âŸ¹ $a=2$"] },
    { id:"J09", title:"å®šç§¯åˆ†æ±‚é¢ç§¯", ch:"ç¬¬6ç«  å®šç§¯åˆ†", diff:"medium", full:"æ±‚ $y=x^2$ ä¸ $x$ è½´åœ¨ $[0,1]$ ä¸Šå›´æˆçš„é¢ç§¯", logic:"S=âˆ«â‚€Â¹xÂ²dx=1/3", slots:[{id:"s1",label:"æ›²çº¿",value:"x^2"},{id:"s2",label:"åŒºé—´",value:"[0,1]"},{id:"s3",label:"é¢ç§¯",value:"\\frac{1}{3}"}], tpl:"æ±‚ $y=[s1]$ ä¸ $x$ è½´åœ¨ $[s2]$ ä¸Šå›´æˆçš„é¢ç§¯", ans:"S=1/3", steps:["$S=\\int_0^1 x^2 dx=\\frac{1}{3}$"] },
],
// ========== ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹ ==========
ch7: [
    { id:"E01", title:"å¾®åˆ†æ–¹ç¨‹", ch:"ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹", diff:"easy", full:"æ±‚ $y'=2x$ çš„é€šè§£", logic:"y=âˆ«2x dx=xÂ²+C", slots:[{id:"s1",label:"y'",value:"2x"},{id:"s2",label:"é€šè§£",value:"x^2+C"}], tpl:"æ±‚ $y'=[s1]$ çš„é€šè§£", ans:"y=xÂ²+C", steps:["$y=\\int 2x dx=x^2+C$"] },
    { id:"E02", title:"å¾®åˆ†æ–¹ç¨‹", ch:"ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹", diff:"easy", full:"æ±‚ $y'=3x^2$ çš„é€šè§£", logic:"y=âˆ«3xÂ² dx=xÂ³+C", slots:[{id:"s1",label:"y'",value:"3x^2"},{id:"s2",label:"é€šè§£",value:"x^3+C"}], tpl:"æ±‚ $y'=[s1]$ çš„é€šè§£", ans:"y=xÂ³+C", steps:["$y=\\int 3x^2 dx=x^3+C$"] },
    { id:"E03", title:"å¾®åˆ†æ–¹ç¨‹", ch:"ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹", diff:"easy", full:"æ±‚ $y'=e^x$ çš„é€šè§£", logic:"y=âˆ«e^x dx=e^x+C", slots:[{id:"s1",label:"y'",value:"e^x"},{id:"s2",label:"é€šè§£",value:"e^x+C"}], tpl:"æ±‚ $y'=[s1]$ çš„é€šè§£", ans:"y=eË£+C", steps:["$y=\\int e^x dx=e^x+C$"] },
    { id:"E04", title:"åˆå€¼é—®é¢˜", ch:"ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹", diff:"medium", full:"æ±‚ $y'=2x$ï¼Œ$y(0)=1$ çš„ç‰¹è§£", logic:"y=xÂ²+C, y(0)=C=1 âŸ¹ y=xÂ²+1", slots:[{id:"s1",label:"y'",value:"2x"},{id:"s2",label:"åˆå€¼ç‚¹",value:"0"},{id:"s3",label:"åˆå€¼",value:"1"},{id:"s4",label:"ç‰¹è§£",value:"x^2+1"}], tpl:"æ±‚ $y'=[s1]$ï¼Œ$y([s2])=[s3]$ çš„ç‰¹è§£", ans:"y=xÂ²+1", steps:["é€šè§£ï¼š$y=x^2+C$","$y(0)=C=1$","ç‰¹è§£ï¼š$y=x^2+1$"] },
    { id:"E05", title:"åˆå€¼é—®é¢˜", ch:"ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹", diff:"medium", full:"æ±‚ $y'=3x^2$ï¼Œ$y(1)=2$ çš„ç‰¹è§£", logic:"y=xÂ³+C, y(1)=1+C=2 âŸ¹ C=1, y=xÂ³+1", slots:[{id:"s1",label:"y'",value:"3x^2"},{id:"s2",label:"åˆå€¼ç‚¹",value:"1"},{id:"s3",label:"åˆå€¼",value:"2"},{id:"s4",label:"ç‰¹è§£",value:"x^3+1"}], tpl:"æ±‚ $y'=[s1]$ï¼Œ$y([s2])=[s3]$ çš„ç‰¹è§£", ans:"y=xÂ³+1", steps:["é€šè§£ï¼š$y=x^3+C$","$y(1)=1+C=2$ âŸ¹ $C=1$","ç‰¹è§£ï¼š$y=x^3+1$"] },
    { id:"E06", title:"åˆå€¼é—®é¢˜", ch:"ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹", diff:"medium", full:"æ±‚ $y'=2x$ï¼Œ$y(1)=3$ å $y(2)$ çš„å€¼", logic:"y=xÂ²+C, y(1)=1+C=3âŸ¹C=2, y(2)=4+2=6", slots:[{id:"s1",label:"åˆå€¼ç‚¹",value:"1"},{id:"s2",label:"åˆå€¼",value:"3"},{id:"s3",label:"æ±‚å€¼ç‚¹",value:"2"},{id:"s4",label:"y(2)",value:"6"}], tpl:"æ±‚ $y'=2x$ï¼Œ$y([s1])=[s2]$ å $y([s3])$ çš„å€¼", ans:"y(2)=6", steps:["é€šè§£ï¼š$y=x^2+C$","$y(1)=1+C=3$ âŸ¹ $C=2$","$y(2)=4+2=6$"] },
    { id:"E07", title:"å¯åˆ†ç¦»å˜é‡", ch:"ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹", diff:"medium", full:"æ±‚ $y'=y$ çš„é€šè§£", logic:"dy/y=dx âŸ¹ ln|y|=x+Câ‚ âŸ¹ y=Ce^x", slots:[{id:"s1",label:"æ–¹ç¨‹",value:"y'=y"},{id:"s2",label:"é€šè§£",value:"Ce^x"}], tpl:"æ±‚ $[s1]$ çš„é€šè§£", ans:"y=CeË£", steps:["åˆ†ç¦»å˜é‡ï¼š$\\frac{dy}{y}=dx$","ç§¯åˆ†ï¼š$\\ln|y|=x+C_1$","$y=Ce^x$"] },
    { id:"E08", title:"å¯åˆ†ç¦»å˜é‡", ch:"ç¬¬7ç«  å¾®åˆ†æ–¹ç¨‹", diff:"medium", full:"æ±‚ $y'=2y$ï¼Œ$y(0)=1$ çš„ç‰¹è§£", logic:"y=Ce^(2x), y(0)=C=1 âŸ¹ y=e^(2x)", slots:[{id:"s1",label:"æ–¹ç¨‹ç³»æ•°",value:"2"},{id:"s2",label:"åˆå€¼",value:"1"},{id:"s3",label:"ç‰¹è§£",value:"e^{2x}"}], tpl:"æ±‚ $y'=[s1]y$ï¼Œ$y(0)=[s2]$ çš„ç‰¹è§£", ans:"y=e^{2x}", steps:["é€šè§£ï¼š$y=Ce^{2x}$","$y(0)=C=1$","ç‰¹è§£ï¼š$y=e^{2x}$"] },
]
};

QB.all = [...QB.ch1,...QB.ch2,...QB.ch3,...QB.ch4,...QB.ch5,...QB.ch6,...QB.ch7];

const Game = (function() {
    const S = { roles:[], currentQ:null, currentStep:0, timer:null, timeTotal:180, timeLeft:180, drawIndex:0, slotStates:{}, godViewVisible:false };
    
    function renderMath(el) {
        if (!el) return Promise.resolve();
        
        // å¦‚æœMathJaxå·²ç»å‡†å¤‡å¥½
        if (window.MathJax && MathJax.typesetPromise) {
            return MathJax.typesetPromise([el]).then(() => {
                console.log('Math rendered for:', el.id || 'element');
            }).catch(e => {
                console.warn('MathJax render error:', e);
                return Promise.resolve();
            });
        }
        
        // å¦‚æœMathJaxæ­£åœ¨åŠ è½½
        if (window.MathJax && MathJax.startup && MathJax.startup.promise) {
            return MathJax.startup.promise.then(() => {
                if (MathJax.typesetPromise) {
                    return MathJax.typesetPromise([el]).catch(e => {
                        console.warn(e);
                        return Promise.resolve();
                    });
                }
                return Promise.resolve();
            }).catch(() => {
                return new Promise(resolve => {
                    setTimeout(() => {
                        renderMath(el).then(resolve);
                    }, 100);
                });
            });
        }
        
        // ç­‰å¾…MathJaxåŠ è½½
        return new Promise(resolve => {
            setTimeout(() => {
                renderMath(el).then(resolve);
            }, 100);
        });
    }
    
    function updateTotal() {
        const t = ['wolfCount','seerCount','witchCount','villagerCount'].reduce((s,id) => s + (parseInt(document.getElementById(id).value) || 0), 0);
        document.getElementById('totalCountDisplay').innerText = t;
    }
    
        function switchTab(tab) {
        ['setup','flow','skills','god'].forEach(t => {
                document.getElementById(`panel-${t}`).classList.add('hidden');
            document.getElementById(`tab-${t}`).classList.remove('text-amber-400','border-b-2','border-amber-500','bg-gray-800');
                document.getElementById(`tab-${t}`).classList.add('text-gray-500');
            });
            document.getElementById(`panel-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.remove('text-gray-500');
        document.getElementById(`tab-${tab}`).classList.add('text-amber-400','border-b-2','border-amber-500','bg-gray-800');
        }
        
        function generateRoles() {
        const counts = { wolf: +document.getElementById('wolfCount').value, seer: +document.getElementById('seerCount').value, witch: +document.getElementById('witchCount').value, villager: +document.getElementById('villagerCount').value };
            let pool = [];
        for (let r in counts) for (let i = 0; i < counts[r]; i++) pool.push(r);
            pool.sort(() => Math.random() - 0.5);
        S.roles = pool.map((r,i)=>({id:i+1,role:r,status:'alive'}));
        renderPlayerList(); startDrawPhase();
    }
    
        function renderPlayerList() {
        const b = {wolf:'bg-red-900 text-red-200',villager:'bg-green-900 text-green-200',seer:'bg-blue-900 text-blue-200',witch:'bg-purple-900 text-purple-200'};
        const n = {wolf:'ç‹¼',villager:'æ°‘',seer:'é¢„',witch:'å·«'};
        document.getElementById('playerListContent').innerHTML = S.roles.map(p=>`<div class="flex items-center justify-between bg-gray-800 p-1 rounded text-xs"><span class="text-gray-500 w-3">${p.id}</span><span class="px-1 rounded ${b[p.role]} text-[10px]">${n[p.role]}</span><button onclick="Game.toggleLife(${p.id},this)" class="px-1 rounded bg-gray-700 text-gray-300 text-[10px]">å­˜</button></div>`).join('');
            document.getElementById('playerList').classList.remove('hidden');
        }
        
    function toggleLife(id,btn) { const p=S.roles.find(r=>r.id===id); if(p.status==='alive'){p.status='dead';btn.innerText='äº¡';btn.className="px-1 rounded bg-red-900 text-red-300 text-[10px]";}else{p.status='alive';btn.innerText='å­˜';btn.className="px-1 rounded bg-gray-700 text-gray-300 text-[10px]";} }
    
        function startDrawPhase() {
            document.getElementById('setupView').classList.remove('hidden');
            document.getElementById('gameView').classList.add('hidden');
            document.querySelector('#setupView > h2').classList.add('hidden');
            document.getElementById('cardDrawArea').classList.remove('hidden');
            document.getElementById('cardDrawArea').classList.add('flex');
        S.drawIndex = 0; updateDrawCardUI();
        }
        
        function updateDrawCardUI() {
        if(S.drawIndex >= S.roles.length) { document.getElementById('setupView').innerHTML = `<div class="text-center"><h2 class="text-2xl text-green-500 font-bold mb-3">èº«ä»½åˆ†é…å®Œæˆï¼</h2><button onclick="Game.startGame()" class="px-6 py-2 bg-amber-600 text-white rounded font-bold">è¿›å…¥æ¸¸æˆ</button></div>`; return; }
        document.getElementById('drawIndexDisplay').innerText = S.drawIndex + 1;
            document.getElementById('gameCard').classList.remove('rotate-y-180');
        }
        
        function revealCard() {
            const card = document.getElementById('gameCard');
        if(card.classList.contains('rotate-y-180')) return;
        const role = S.roles[S.drawIndex].role;
        const d = { wolf:{icon:'ğŸº',name:'ç‹¼äºº',desc:'åˆ é™¤æ¡ä»¶',color:'border-red-500'}, villager:{icon:'ğŸ§‘',name:'æ‘æ°‘',desc:'æ¨ç†è¿˜åŸ',color:'border-green-500'}, seer:{icon:'ğŸ”®',name:'é¢„è¨€å®¶',desc:'æŸ¥çœ‹å®Œæ•´',color:'border-blue-500'}, witch:{icon:'ğŸ§ª',name:'å¥³å·«',desc:'è¿˜åŸæ¡ä»¶',color:'border-purple-500'} };
        const info = d[role];
        document.getElementById('cardFace').className = `absolute w-full h-full bg-white rounded-xl border-4 ${info.color} flex flex-col items-center justify-center backface-hidden rotate-y-180 text-gray-900`;
            document.getElementById('cardIcon').innerText = info.icon;
            document.getElementById('cardRoleName').innerText = info.name;
            document.getElementById('cardDesc').innerText = info.desc;
            card.classList.add('rotate-y-180');
        }
        
    function hideCard(e) { e.stopPropagation(); S.drawIndex++; updateDrawCardUI(); }
    
        function startGame() {
            document.getElementById('setupView').classList.add('hidden');
            document.getElementById('gameView').classList.remove('hidden');
        switchTab('god'); night('open'); updateBankStats();
    }
    
    function updateBankStats() {
        const stats = Object.keys(QB).filter(k=>k!=='all').map(k=>`${k.replace('ch','ç¬¬')}ç« : ${QB[k].length}é¢˜`).join('<br>');
        document.getElementById('bankStats').innerHTML = stats + `<br><strong>æ€»è®¡: ${QB.all.length}é¢˜</strong>`;
    }
    
    function night(type) {
        const o = document.getElementById('nightOverlay');
        const t = document.getElementById('nightActionText');
        const b = document.getElementById('headerPhaseBadge');
        if(type==='close') { o.style.opacity='1'; o.style.pointerEvents='auto'; t.innerText="ç‹¼äººè¯·ççœ¼..."; b.innerHTML='ğŸŒ™ å¤œæ™š'; b.className="px-2 py-1 rounded-full bg-indigo-900/50 text-indigo-200 text-xs font-bold"; }
        else if(type==='open') { o.style.opacity='0'; o.style.pointerEvents='none'; b.innerHTML='â˜€ï¸ ç™½å¤©'; b.className="px-2 py-1 rounded-full bg-amber-600/50 text-amber-100 text-xs font-bold"; }
        else { const m={wolf:"ç‹¼äººé€‰æ‹©...",seer:"é¢„è¨€å®¶æŸ¥çœ‹...",witch:"å¥³å·«é€‰æ‹©..."}; t.innerText=m[type]; }
    }
    
    function distribute() {
        const ch = document.getElementById('chapterSelect').value;
        const ml = parseInt(document.getElementById('missingLevelSelect').value);
        let pool = ch==='all' ? QB.all : QB[ch];
        if(!pool||!pool.length) { alert('è¯¥ç« èŠ‚æš‚æ— é¢˜ç›®'); return; }
        const q = pool[Math.floor(Math.random()*pool.length)];
        S.currentQ = q; S.currentStep = 0; S.slotStates = {};
        const shuffled = [...q.slots].sort(()=>Math.random()-0.5);
        const hc = Math.min(ml, q.slots.length);
        q.slots.forEach(slot => { S.slotStates[slot.id] = { hidden: shuffled.indexOf(slot)<hc, value:slot.value, filledValue:'', wolfDeleted:false, witchRestored:false, label:slot.label }; });
        renderQuestion(); updateGodView(); updateSkillOptions(); switchTab('flow'); night('open');
    }
        
        function renderQuestion() {
        if(!S.currentQ) return;
        const q = S.currentQ;
        let html = q.tpl, hc = 0;
            q.slots.forEach(slot => {
            const s = S.slotStates[slot.id];
            let r;
            if(s.witchRestored) r = slot.value;
            else if(s.wolfDeleted) { r = '\\text{[å·²åˆ ]}'; hc++; }
            else if(s.hidden) { 
                if(s.filledValue) {
                    r = s.filledValue;
                } else {
                    r = '\\text{[???]}';
                    hc++;
                }
            }
            else r = slot.value;
            html = html.replace(new RegExp(`\\[${slot.id}\\]`,'g'), r);
        });
        document.getElementById('displayChapter').innerText = q.ch;
            document.getElementById('displayTitle').innerText = q.title;
        document.getElementById('displayType').innerText = q.diff==='easy'?'åŸºç¡€':q.diff==='medium'?'ä¸­ç­‰':'å›°éš¾';
        const dc = {easy:'bg-green-900/50 text-green-300',medium:'bg-amber-900/50 text-amber-300',hard:'bg-red-900/50 text-red-300'};
        document.getElementById('displayDiff').className = `px-2 py-0.5 rounded text-xs ${dc[q.diff]}`;
        document.getElementById('displayDiff').innerText = q.diff==='easy'?'â˜…':q.diff==='medium'?'â˜…â˜…':'â˜…â˜…â˜…';
        document.getElementById('missingCount').innerText = `ç¼ºå¤±:${hc}`;
        const qe = document.getElementById('displayQuestion');
        qe.innerHTML = html;
            document.getElementById('displaySteps').innerHTML = '';
            renderFillInputs();
        renderMath(qe);
    }
    
        function renderFillInputs() {
            if (!S.currentQ) return;
            const fillArea = document.getElementById('fillArea');
            const fillInputs = document.getElementById('fillInputs');
            const hiddenSlots = S.currentQ.slots.filter(slot => {
                const s = S.slotStates[slot.id];
                return (s.hidden || s.wolfDeleted) && !s.witchRestored && !s.filledValue;
            });
        if (hiddenSlots.length === 0) { fillArea.classList.add('hidden'); return; }
            fillArea.classList.remove('hidden');
            fillInputs.innerHTML = hiddenSlots.map(slot => `
            <div class="bg-gray-900/50 p-1.5 rounded border border-gray-700">
                <label class="text-xs text-gray-500 block mb-1">${slot.label}</label>
                <input type="text" class="w-full px-2 py-1 rounded bg-gray-800 text-white text-sm border border-gray-600 focus:border-amber-500 focus:outline-none" data-slot="${slot.id}" id="fill-${slot.id}">
                </div>
            `).join('');
        }
        
        function submitFill() {
            if (!S.currentQ) return;
        document.querySelectorAll('#fillInputs input').forEach(input => {
                const slotId = input.dataset.slot;
            const val = input.value.trim();
            if (val) S.slotStates[slotId].filledValue = val;
        });
            renderQuestion();
    }
    
    function updateGodView() {
        if (!S.currentQ) return;
        const q = S.currentQ;
        document.getElementById('godViewContent').innerHTML = `
            <div class="mb-2 pb-2 border-b border-green-700/30">
                <span class="text-green-400 font-bold text-xs">å®Œæ•´é¢˜ç›®ï¼š</span><br>
                <span class="text-white text-xs">${q.full}</span>
            </div>
            <div class="mb-2">
                <span class="text-amber-400 font-bold text-xs">ç­”æ¡ˆï¼š</span>
                <span class="text-white">${q.ans}</span>
            </div>
            <div class="p-2 bg-blue-900/30 rounded border border-blue-500/30">
                <span class="text-blue-400 font-bold text-xs">ğŸ”— é€»è¾‘é“¾ï¼š</span>
                <pre class="text-gray-300 text-xs mt-1 whitespace-pre-wrap">${q.logic}</pre>
            </div>
        `;
        renderMath(document.getElementById('godViewContent'));
    }
    
    function toggleGodView() {
        const el = document.getElementById('godViewContent');
        el.classList.toggle('hidden');
        S.godViewVisible = !el.classList.contains('hidden');
    }
    
        function updateSkillOptions() {
            if (!S.currentQ) return;
            const wolfSelect = document.getElementById('wolfDeleteSelect');
            const visibleSlots = S.currentQ.slots.filter(s => !S.slotStates[s.id].hidden && !S.slotStates[s.id].wolfDeleted);
        wolfSelect.innerHTML = '<option value="">é€‰æ‹©...</option>' + visibleSlots.map(s => `<option value="${s.id}">${s.label}</option>`).join('');
            const witchSelect = document.getElementById('witchRestoreSelect');
        const hiddenSlots = S.currentQ.slots.filter(s => (S.slotStates[s.id].hidden || S.slotStates[s.id].wolfDeleted) && !S.slotStates[s.id].witchRestored);
        witchSelect.innerHTML = '<option value="">é€‰æ‹©...</option>' + hiddenSlots.map(s => `<option value="${s.id}">${s.label}</option>`).join('');
    }
    
    function updateMissingStatus() {
            if (!S.currentQ) return;
        document.getElementById('missingStatusList').innerHTML = S.currentQ.slots.map(slot => {
                const s = S.slotStates[slot.id];
                let status, color;
            if (s.witchRestored) { status = 'å·²è¿˜åŸ'; color = 'text-pink-400'; }
            else if (s.wolfDeleted) { status = 'è¢«åˆ é™¤'; color = 'text-purple-400'; }
            else if (s.hidden) { status = s.filledValue ? 'å·²å¡«å……' : 'ç¼ºå¤±'; color = s.filledValue ? 'text-green-400' : 'text-amber-400'; }
            else { status = 'æ˜¾ç¤º'; color = 'text-gray-500'; }
                return `<div class="flex justify-between"><span class="text-gray-400">${slot.label}:</span><span class="${color}">${status}</span></div>`;
        }).join('');
        }
        
        function wolfDelete() {
        const slotId = document.getElementById('wolfDeleteSelect').value;
        if (!slotId) { alert('è¯·é€‰æ‹©'); return; }
            S.slotStates[slotId].wolfDeleted = true;
            renderQuestion();
            updateSkillOptions();
        alert('ç‹¼äººå·²åˆ é™¤è¯¥æ¡ä»¶ï¼');
        }
        
        function seerView() {
        if (!S.currentQ) { alert('è¿˜æ²¡å‘é¢˜ï¼'); return; }
            const content = document.getElementById('seerModalContent');
        content.innerHTML = `<div class="mb-3">${S.currentQ.full}</div><div class="pt-3 border-t border-blue-500/30"><span class="text-blue-400 font-bold">ç­”æ¡ˆï¼š</span><span class="text-white">${S.currentQ.ans}</span></div>`;
        document.getElementById('seerModal').classList.remove('hidden');
        renderMath(content);
    }
    
    function closeSeerModal() { document.getElementById('seerModal').classList.add('hidden'); }
    
        function witchRestore() {
        const slotId = document.getElementById('witchRestoreSelect').value;
        if (!slotId) { alert('è¯·é€‰æ‹©'); return; }
            S.slotStates[slotId].witchRestored = true;
            S.slotStates[slotId].hidden = false;
            S.slotStates[slotId].wolfDeleted = false;
            renderQuestion();
            updateSkillOptions();
        alert('å¥³å·«å·²è¿˜åŸè¯¥æ¡ä»¶ï¼');
        }
        
        function nextStep() {
            if (!S.currentQ || S.currentStep >= S.currentQ.steps.length) return;
            const container = document.getElementById('displaySteps');
            const div = document.createElement('div');
        div.className = "step-reveal bg-amber-900/20 border-l-4 border-amber-500 p-3 rounded text-gray-100 text-sm";
        div.innerHTML = S.currentQ.steps[S.currentStep];
            container.appendChild(div);
        requestAnimationFrame(() => { div.classList.add('active'); container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' }); renderMath(div); });
            S.currentStep++;
        }
        
        function revealAnswer() {
            if (!S.currentQ) return;
        S.currentQ.slots.forEach(slot => { S.slotStates[slot.id].hidden = false; S.slotStates[slot.id].wolfDeleted = false; });
            renderQuestion();
            const container = document.getElementById('displaySteps');
            const div = document.createElement('div');
        div.className = "step-reveal bg-green-900/30 border-2 border-green-500 p-4 rounded-lg text-white text-lg";
        div.innerHTML = `<div class="text-green-400 font-bold mb-1">âœ… æ­£ç¡®ç­”æ¡ˆ</div><div>${S.currentQ.ans}</div>`;
            container.appendChild(div);
        requestAnimationFrame(() => { div.classList.add('active'); container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' }); });
    }
    
    function revealAll() { while (S.currentQ && S.currentStep < S.currentQ.steps.length) nextStep(); }
    
    function setTimer(sec) { clearInterval(S.timer); S.timer = null; S.timeTotal = sec; S.timeLeft = sec; updateTimerUI(); document.getElementById('timerBtn').innerText = 'START'; }
        
        function toggleTimer() {
            const btn = document.getElementById('timerBtn');
        if (S.timer) { clearInterval(S.timer); S.timer = null; btn.innerText = 'RESUME'; }
        else { btn.innerText = 'PAUSE'; S.timer = setInterval(() => { S.timeLeft--; updateTimerUI(); if (S.timeLeft <= 0) { clearInterval(S.timer); S.timer = null; btn.innerText = 'DONE'; } }, 1000); }
    }
    
    function updateTimerUI() {
            const m = Math.floor(S.timeLeft / 60).toString().padStart(2, '0');
            const s = (S.timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').innerText = `${m}:${s}`;
    }
    
    function toggleProjection() { document.body.classList.toggle('projection-mode'); }
    
    updateTotal();
    
    return { updateTotal, switchTab, generateRoles, toggleLife, revealCard, hideCard, startGame, night, distribute, nextStep, revealAll, revealAnswer, setTimer, toggleTimer, toggleProjection, submitFill, wolfDelete, seerView, closeSeerModal, witchRestore, toggleGodView };
})();

// ç¡®ä¿MathJaxåŠ è½½å®Œæˆåæ¸²æŸ“é¡µé¢ä¸­çš„å…¬å¼
(function() {
    function checkMathJax() {
        if (window.MathJax && MathJax.typesetPromise) {
            // MathJaxå·²åŠ è½½ï¼Œæ¸²æŸ“é¡µé¢ä¸­çš„å…¬å¼
            const mathElements = document.querySelectorAll('.math-content, #displayQuestion, #godViewContent, #seerModalContent');
            mathElements.forEach(el => {
                if (el.textContent && el.textContent.includes('$')) {
                    MathJax.typesetPromise([el]).catch(e => console.warn('MathJax render error:', e));
                }
            });
        } else if (window.MathJax && MathJax.startup && MathJax.startup.promise) {
            MathJax.startup.promise.then(() => {
                checkMathJax();
            });
            } else {
            setTimeout(checkMathJax, 100);
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkMathJax);
    } else {
        checkMathJax();
    }
    })();
    </script>
</body>
</html>