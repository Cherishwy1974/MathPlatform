<!DOCTYPE html>

<html lang="zh-CN">
<head>
    <link rel="stylesheet" href="../common-assets/css/fontawesome.min.css">
    <link rel="stylesheet" href="../common-assets/css/solid.min.css">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>第12章：向量代数与空间解析几何 (互动式课件)</title>
<script src="../common-assets/js/d3-7.8.5.min.js"></script>
<script src="../common-assets/js/three-0.160.0.min.js"></script>
<script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                pageReady: () => {
                    return window.MathJax.startup.defaultPageReady().then(() => {
                        console.log('MathJax is ready');
                    });
                }
            }
        };
    </script>
<script src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js"></script>
<style>
        /* === RESET AND BASE STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            height: 100%;
        }

        body {
            font-family: 'Inter', 'Source Han Sans SC', 'Noto Sans SC', 'Microsoft YaHei', system-ui, -apple-system, sans-serif;
            background: #FAFAFA;
            overflow: hidden;
            color: #1a1a1a;
            height: 100%;
            line-height: 1.6;
            font-weight: 400;
        }

        /* === SLIDE LAYOUT === */
        .slide-container {
            width: 100%;
            height: 100vh;
            display: flex;
            position: relative;
            gap: 0;
            padding: 0;
        }

        /* Left Content Area - Academic Journal Style */
        .left-content {
            width: 50%;
            height: 100vh;
            padding: 60px 80px 60px 60px;
            background: #FBFBFB;
            overflow-y: auto;
            font-size: 16px;
            line-height: 1.6;
            border: none;
            box-shadow: none;
            border-radius: 0;
        }

        .slide-container.single-column .left-content {
            width: 100%;
            max-width: 960px;
            border-right: none;
        }

        /* Right Visualization Area - Subtle Contrast */
        .right-visual {
            width: 50%;
            height: 100vh;
            background: #F8F9FA;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: none;
            box-shadow: none;
            border-radius: 0;
        }

        .slide-container.single-column .right-visual {
            display: none;
        }

        .right-visual > div {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            padding: 24px;
            position: relative;
        }

        .right-visual > div > :not(.info-panel):not(.control-panel) {
            width: 100%;
            height: 100%;
        }

        .right-visual canvas,
        .right-visual svg {
            max-width: 100%;
            max-height: 100%;
        }

        /* === Overlay panels inside visual area === */
        .right-visual .info-panel {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255, 255, 255, 0.92);
            color: #1a1a1a;
            border: 1px solid #E5E7EB;
            border-radius: 10px;
            padding: 12px 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            width: auto;
            height: auto;
            max-width: min(340px, 45%);
            z-index: 1000;
            pointer-events: none;
            line-height: 1.5;
            font-size: 14px;
        }

        .right-visual .info-panel h4 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: #2c3e50;
        }

        .right-visual .info-panel p {
            margin: 4px 0;
        }

        .right-visual .control-panel {
            position: absolute;
            right: 16px;
            bottom: 16px;
            display: flex;
            gap: 8px;
            background: rgba(251, 251, 251, 0.95);
            border: 1px solid #E5E7EB;
            border-radius: 10px;
            padding: 8px 10px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            z-index: 1000;
        }

        .right-visual .control-panel .control-btn {
            background: transparent;
            border: 1px solid #E5E7EB;
            color: #003366;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .right-visual .control-panel .control-btn:hover {
            background: #003366;
            color: #ffffff;
            border-color: #003366;
        }

        /* === Responsive fixes for narrow screens === */
        @media (max-width: 1200px) {
            .left-content {
                padding: 32px 24px;
            }
        }

        @media (max-width: 960px) {
            .slide-container {
                flex-direction: column;
                height: auto;
            }
            .left-content {
                width: 100%;
                height: auto;
                padding: 24px 18px;
                overflow-wrap: anywhere;
                word-break: break-word;
            }
            .right-visual {
                width: 100%;
                height: 50vh;
                min-height: 320px;
            }
            .right-visual > div {
                padding: 12px;
            }
        }

        /* === SLIDE TRANSITIONS === */
        .slide {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .slide.active {
            display: flex;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* === 统一的字体系统 === */
        h1 {
            color: #003366;
            font-size: 28px;
            line-height: 1.3;
            font-weight: 700;
            margin: 0 0 24px 0;
            padding: 0;
            letter-spacing: -0.02em;
        }

        h2 {
            color: #008080;
            font-size: 22px;
            line-height: 1.4;
            font-weight: 600;
            margin: 32px 0 16px 0;
            position: relative;
            padding-left: 0;
        }

        h2::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #008080;
            border-radius: 2px;
        }

        h3 {
            color: #1a1a1a;
            font-size: 20px;
            line-height: 1.4;
            font-weight: 600;
            margin: 24px 0 12px 0;
        }

        h4 {
            color: #333333;
            font-size: 18px;
            line-height: 1.4;
            font-weight: 500;
            margin: 20px 0 8px 0;
        }

        h5 {
            color: #555555;
            font-size: 16px;
            line-height: 1.4;
            font-weight: 500;
            margin: 16px 0 8px 0;
        }

        p {
            margin-bottom: 16px;
            color: #2d2d2d;
            font-weight: 400;
            font-size: 16px;
            line-height: 1.6;
        }

        ul, ol {
            margin: 0 0 16px 0;
            line-height: 1.6;
            padding-left: 24px;
            font-size: 16px;
        }

        li {
            margin-bottom: 8px;
            color: #2d2d2d;
            font-size: 16px;
            line-height: 1.6;
        }

        /* === CONTENT MODULES - 去框化设计 === */
        .definition, .theorem, .example, .note {
            background: transparent;
            border: none;
            border-left: 4px solid;
            padding: 16px 0 16px 20px;
            margin: 20px 0;
        }

        .definition {
            border-left-color: #1e40af;
        }

        .theorem {
            border-left-color: #059669;
        }

        .example {
            border-left-color: #dc2626;
        }

        .note {
            border-left-color: #6b7280;
            font-style: italic;
            color: #4b5563;
        }

        .math-formula {
            background: transparent;
            border: none;
            border-left: 4px solid #008080;
            padding: 16px 0 16px 20px;
            margin: 20px 0;
            border-radius: 0;
            font-size: 16px;
        }

        .highlight {
            color: #008080;
            font-weight: 600;
        }

        .formula-highlight {
            background: transparent;
            padding: 24px 0;
            margin: 24px 0;
            text-align: center;
            font-size: 18px;
            border: none;
            box-shadow: none;
        }

        /* === MATHJAX FORMULA STYLING === */
        .MathJax {
            outline: none;
            display: inline-block;
        }

        .MathJax_Display {
            text-align: center !important;
            margin: 20px 0 !important;
        }

        /* SVG Container Styling */
        mjx-container[jax="SVG"] {
            display: inline-block !important;
            line-height: 1;
            vertical-align: baseline;
        }

        mjx-container[jax="SVG"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 20px 0 !important;
        }

        mjx-container[jax="SVG"] svg {
            display: inline-block !important;
            vertical-align: baseline;
            max-width: 100%;
            height: auto;
        }

        mjx-container[jax="SVG"][display="true"] svg {
            display: block !important;
            margin: 0 auto !important;
        }

        /* Enhanced SVG Rendering */
        mjx-container svg {
            shape-rendering: geometricPrecision;
            text-rendering: geometricPrecision;
            font-family: 'MJXZERO', 'MJXTEX';
        }

        /* Force Visibility and Proper Display */
        mjx-container[jax="SVG"] {
            visibility: visible !important;
            opacity: 1 !important;
            overflow: visible !important;
        }

        mjx-container[jax="SVG"] svg {
            visibility: visible !important;
            opacity: 1 !important;
            width: auto !important;
            height: auto !important;
        }

        /* Content Area Formula Display */
        .left-content mjx-container {
            display: inline-block !important;
            margin: 0 3px;
        }

        .left-content mjx-container[display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 20px 0 !important;
        }

        /* === SIMPLIFIED INTERACTIVE ELEMENTS === */
        .step-stack {
            margin: 32px 0;
        }

        .step-item {
            border: none;
            border-left: 3px solid #008080;
            border-radius: 0;
            padding: 0 0 0 20px;
            background: transparent;
            display: none;
            margin: 24px 0;
        }

        .step-item.active {
            display: block;
            background: transparent;
            border-left-color: #003366;
        }

        .step-btn {
            margin-top: 16px;
            padding: 8px 16px;
            border-radius: 0;
            border: 1px solid #E5E7EB;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            color: #003366;
            transition: all 0.2s ease;
        }

        .step-btn:hover {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .prompt-card {
            background: transparent;
            border: none;
            border-left: 3px solid #008080;
            border-radius: 0;
            padding: 0 0 0 20px;
            margin: 32px 0;
        }

        .teacher-note {
            background: transparent;
            border: none;
            border-left: 3px solid #CC5500;
            border-radius: 0;
            padding: 0 0 0 20px;
            margin: 32px 0;
            font-style: normal;
        }

        /* === CANVAS STYLING === */
        canvas {
            max-width: 95%;
            max-height: 95%;
            border-radius: 0;
            box-shadow: none;
        }

        /* === 导航控制 - 第二章极简设计 === */
        .nav-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            align-items: center;
            z-index: 1000;
        }

        .nav-btn {
            background: rgba(0, 0, 0, 0.15);
            color: transparent;
            border: none;
            padding: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0;
            transition: all 0.2s;
            position: relative;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-top: 2px solid rgba(0, 0, 0, 0.5);
            border-right: 2px solid rgba(0, 0, 0, 0.5);
        }

        .nav-btn:first-child::before {
            transform: translate(-40%, -50%) rotate(-135deg);
        }

        .nav-btn:last-child::before {
            transform: translate(-60%, -50%) rotate(45deg);
        }

        .nav-btn:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        .nav-btn:hover::before {
            border-color: rgba(0, 0, 0, 0.7);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn:disabled::before {
            border-color: rgba(0, 0, 0, 0.2);
        }

        .slide-number {
            font-size: 11px;
            color: #9ca3af;
            font-weight: 400;
            display: flex;
            align-items: center;
            gap: 0;
            opacity: 0.6;
        }

        .slide-number input {
            width: 50px;
            text-align: right;
            border: none;
            background: transparent;
            font-size: 11px;
            padding: 0 2px;
            margin: 0;
            color: #000000;
            font-weight: 700;
        }

        .slide-number input::-webkit-outer-spin-button,
        .slide-number input::-webkit-inner-spin-button {
            display: none;
        }

        .slide-number input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .slide-number input:focus {
            outline: none;
            color: #000000;
        }

        #slideNumberTotal {
            color: #9ca3af;
            font-size: 14px;
            font-weight: 400;
            padding: 0 12px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
        }

        .directory-toggle {
            border: none;
            background: transparent;
            color: #003366;
            padding: 8px 12px;
            border-radius: 0;
            cursor: pointer;
            border: 1px solid #E5E7EB;
            transition: all 0.2s ease;
        }

        .directory-toggle:hover {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .directory-menu {
            position: fixed;
            bottom: 90px;
            right: 24px;
            width: 320px;
            max-height: 60vh;
            overflow-y: auto;
            background: rgba(251, 251, 251, 0.95);
            border: 1px solid #E5E7EB;
            border-radius: 0;
            padding: 20px;
            box-shadow: none;
            display: none;
            z-index: 1200;
            backdrop-filter: blur(10px);
        }

        .directory-menu.active {
            display: block;
        }

        .directory-menu h3 {
            margin-bottom: 16px;
            font-size: 16px;
            color: #003366;
        }

        .directory-item {
            margin-bottom: 12px;
            color: #2d2d2d;
            text-decoration: none;
            display: block;
            padding: 10px 12px;
            border-radius: 0;
            transition: background 0.2s ease;
            border: 1px solid transparent;
        }

        .directory-item:hover {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .global-animation-controls {
            position: fixed;
            bottom: 30px;
            left: 30px;
            display: flex;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(251, 251, 251, 0.95);
            border: 1px solid #E5E7EB;
            border-radius: 0;
            box-shadow: none;
            backdrop-filter: blur(10px);
            z-index: 1100;
        }

        .global-control-btn {
            background: transparent;
            border: 1px solid #E5E7EB;
            color: #003366;
            padding: 6px 12px;
            border-radius: 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .global-control-btn:hover {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .global-control-btn.pause {
            color: #dc2626;
            border-color: #dc2626;
        }

        .global-control-btn.pause:hover {
            background: #dc2626;
            color: white;
        }

        .slide-note {
            font-size: 14px;
            color: #666666;
            margin-top: 12px;
            font-style: italic;
        }

        /* === UTILITY CLASSES === */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #003366;
            z-index: 9999;
            font-weight: 500;
        }

        /* === VISUAL HINTS AND UTILITY === */
        .visual-hint {
            font-style: italic;
            color: #666666;
            font-size: 15px;
            margin: 24px 0;
            padding-left: 20px;
            border-left: 2px solid #E5E7EB;
        }

        /* === CLEAN SCROLLBAR === */
        .left-content::-webkit-scrollbar {
            width: 6px;
        }

        .left-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .left-content::-webkit-scrollbar-thumb {
            background: #E5E7EB;
            border-radius: 3px;
        }

        .left-content::-webkit-scrollbar-thumb:hover {
            background: #D1D5DB;
        }

        .error-message {
            color: #ef4444;
            text-align: center;
            padding: 20px;
            font-size: 16px;
            background: #fef2f2;
        }

        @media print {
            body {
                overflow: visible;
            }
            .slide {
                display: block !important;
                page-break-after: always;
            }
            .nav-container,
            .global-animation-controls,
            .directory-menu,
            .directory-toggle {
                display: none !important;
            }
        }
    </style>
    <style>
        /* 统一封面样式（与第1–11章一致） */
        .slide-container.cover { align-items: stretch; }
        .cover-left { padding: 60px; display: flex; flex-direction: column; justify-content: center; }
        .cover-badge { display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(90deg, #4a90e2, #9b59b6); color: #fff; padding: 6px 12px; border-radius: 999px; font-size: 14px; width: fit-content; box-shadow: 0 6px 16px rgba(74,144,226,0.35); }
        .cover-title { font-size: 4rem; line-height: 1.1; margin: 18px 0 8px 0; color: #1a1a2e; background: linear-gradient(90deg, #1a1a2e 0%, #4a90e2 60%, #9b59b6 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .cover-subtitle { font-size: 1.6rem; color: #4f5b6a; margin: 10px 0 18px 0; }
        .cover-meta { display: flex; gap: 14px; flex-wrap: wrap; color: #6b7b8c; font-size: 0.95rem; }
        .cover-meta span { display: inline-flex; align-items: center; gap: 6px; }
        .cover-actions { display: flex; gap: 14px; margin-top: 26px; flex-wrap: wrap; }
        .cover-right { position: relative; overflow: hidden; }
        .cover-visual { position: relative; width: 100%; height: 100%; background:
                radial-gradient(1200px 800px at 80% 20%, rgba(155, 89, 182, 0.18), transparent 60%),
                radial-gradient(900px 700px at 20% 80%, rgba(74, 144, 226, 0.18), transparent 60%),
                linear-gradient(135deg, #ffffff 0%, #f7faff 50%, #f9f6ff 100%);
        }
        .cover-visual::after { content: ""; position: absolute; inset: 0; background: radial-gradient(600px 300px at 50% -10%, rgba(255,255,255,0.7), transparent 70%); pointer-events: none; }
        .math-badge { position: absolute; padding: 0; background: transparent; border: none; border-radius: 0; box-shadow: none; color: #334155; font-weight: 700; animation: floatY 6s ease-in-out infinite; backdrop-filter: none; pointer-events: none; }
        .math-badge.b1 { left: 12%; top: 22%; animation-delay: 0s; }
        .math-badge.b2 { right: 14%; top: 30%; animation-delay: 0.8s; }
        .math-badge.b3 { left: 20%; bottom: 18%; animation-delay: 1.5s; }
        .math-badge.b4 { right: 18%; bottom: 22%; animation-delay: 2.2s; }
        @keyframes floatY { 0% { transform: translateY(0px); } 50% { transform: translateY(-12px); } 100% { transform: translateY(0px); } }
        .orbit { position: absolute; left: 50%; top: 50%; width: 320px; height: 320px; margin-left: -160px; margin-top: -160px; border-radius: 50%; border: 1px dashed rgba(52, 152, 219, 0.35); animation: spin 18s linear infinite; }
        .orbit .dot { position: absolute; top: -6px; left: 50%; width: 12px; height: 12px; margin-left: -6px; background: #4a90e2; border-radius: 50%; box-shadow: 0 0 0 6px rgba(74,144,226,0.15); }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
<style>
        .return-home-panel {
            position: fixed;
            top: 16px;
            left: 16px;
            display: flex;
            gap: 10px;
            z-index: 9999;
            flex-wrap: wrap;
        }
        .return-home-panel .return-link {
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.8);
            color: #f8fafc;
            font-size: 14px;
            text-decoration: none;
            box-shadow: 0 6px 20px rgba(15, 23, 42, 0.25);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .return-home-panel .return-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(15, 23, 42, 0.35);
        }
        .return-home-panel .return-link.return-main {
            background: rgba(79, 70, 229, 0.85);
        }
        @media (max-width: 640px) {
            .return-home-panel {
                top: 12px;
                left: 12px;
                right: 12px;
                justify-content: center;
            }
            .return-home-panel .return-link {
                width: 100%;
                text-align: center;
            }
        }
    </style>
    <style>
        /* 返回按钮样式（统一为第1/2章风格） */
        .return-home-panel {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 9999;
            display: flex;
            gap: 10px;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }
        .return-home-panel:hover { opacity: 1; }
        .return-home-panel .return-link {
            padding: 6px 12px;
            background: rgba(15, 23, 42, 0.7);
            color: #f8fafc;
            text-decoration: none;
            border-radius: 999px;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        .return-home-panel .return-link:hover {
            background: rgba(15, 23, 42, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(15, 23, 42, 0.3);
        }
        .return-home-panel .return-link.return-main {
            background: rgba(79, 70, 229, 0.7);
        }
        .return-home-panel .return-link.return-main:hover {
            background: rgba(79, 70, 229, 0.9);
            box-shadow: 0 8px 16px rgba(79, 70, 229, 0.3);
        }
    </style>
</head>
<body>
    <div class="return-home-panel">
        <a class="return-link" href="../index.html"><i class="fa-solid fa-house"></i> 返回主站</a>
        <a class="return-link return-main" href="javascript:void(0)" onclick="event.stopPropagation(); toggleCourseSubmenu()"><i class="fa-solid fa-arrow-left"></i> 返回目录</a>
    </div>
<div id="slidesContainer">
<!-- 第1页：标题页 -->
<div class="slide active"><div class="slide-container cover"><div class="left-content tex2jax_process cover-left">
<div class="cover-badge"><i class="fa-solid fa-seedling"></i><span> 第十二章</span></div>
<h1 class="cover-title">向量代数与空间解析几何</h1>
<p class="cover-subtitle">探索三维空间的奥秘</p>
<div class="cover-meta">
<span><i class="fa-solid fa-book-open"></i> 基础篇</span>
<span><i class="fa-solid fa-bolt"></i> 关键概念速览</span>
</div>
<div class="cover-actions">
<a class="home-link-btn" href="../index.html"><span>主页</span></a>
<a class="home-link-btn" href="../故事书/第12章/游戏世界的光影魔法师.html"><span>故事书</span></a>
<a class="home-link-btn" href="../习题/index.html"><span>习题</span></a>
<a class="home-link-btn" href="https://ai.projectmath.xyz/project/index.html"><span>产教融合</span></a>
</div>
</div><div class="right-visual cover-right"><div class="cover-visual">
<div class="math-badge b1">a·b</div>
<div class="math-badge b2">a×b</div>
<div class="math-badge b3">|r|</div>
<div class="math-badge b4">n·(r−r₀)=0</div>
<div class="orbit"><span class="dot"></span></div>
<div id="vis-title"></div>
</div></div></div></div>
<!-- 第2页：目录 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<div style="font-size: 3rem; margin-bottom: 1.5rem; height: 8rem; display: flex; align-items: flex-start; justify-content: center">
                目录
            </div>
<div style="display: grid; gap: 1.5rem; margin: 0 auto; max-width: 1400px; text-align: left">
<div style="padding: 0.8rem">
<h3 style="font-size: 1.3rem; margin-bottom: 0.5rem; padding-bottom: 0.2rem">1. 向量基础</h3>
<div style="display: grid; gap: 0.5rem; font-size: 1rem; line-height: 1.3">
<div>• 生活中的向量</div>
<div>• 向量的表示方法</div>
<div>• 向量的基本运算</div>
<div></div>
</div>
</div>
<div style="padding: 0.8rem">
<h3 style="font-size: 1.3rem; margin-bottom: 0.5rem; padding-bottom: 0.2rem">2. 向量运算</h3>
<div style="display: grid; gap: 0.5rem; font-size: 1rem; line-height: 1.3">
<div>• 向量加法与减法</div>
<div>• 向量数乘</div>
<div>• 向量的点积</div>
<div>• 向量的叉积</div>
</div>
</div>
<div style="padding: 0.8rem">
<h3 style="font-size: 1.3rem; margin-bottom: 0.5rem; padding-bottom: 0.2rem">3. 空间几何</h3>
<div style="display: grid; gap: 0.5rem; font-size: 1rem; line-height: 1.3">
<div>• 空间直角坐标系</div>
<div>• 点、线、面的方程</div>
<div>• 距离与角度计算</div>
<div></div>
</div>
</div>
</div>
</div><div class="right-visual"><div id="vis-contents"></div></div></div></div>
<!-- 第3页：过渡页 - 第一部分 向量基础 -->
<div class="slide"><div class="slide-container single-column"><div class="left-content tex2jax_process">
<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; text-align: center;">
<h1 style="font-size: 3rem; color: #3498db; margin-bottom: 2rem;">第一部分</h1>
<h2 style="font-size: 2.5rem; color: #2c3e50; margin-bottom: 1rem;">向量的基本概念</h2>
<p style="font-size: 1.5rem; color: #666;">从生活实例理解向量</p>
<div style="margin-top: 3rem; padding: 1.5rem; background: #f0f8ff; border-left: 5px solid #3498db; border-radius: 8px;">
<p style="font-size: 1.2rem; color: #2c3e50; margin: 0;">核心内容：向量定义、表示方法、模与方向</p>
</div>
</div>
</div></div></div>
<!-- 第2.1页：学习目标 -->
<div class="slide"><div class="slide-container single-column"><div class="left-content tex2jax_process">
<h2>学习目标（对齐高职课程标准）</h2>
<ul>
<li>理解并掌握空间向量的表示、模、方向余弦与基本运算（加减、数乘、点积、叉积、混合积），能进行应用判断（平行、垂直、投影、面积、体积）。</li>
<li>会建立空间直角坐标系下的直线与平面方程（参数式、对称式、一般式、点法式），能进行位置关系判定与求交。</li>
<li>能计算常见几何量：点到直线/平面距离，直线与平面夹角、两平面夹角、两异面直线距离；理解平行平面间距离公式。</li>
<li>认识典型二次曲面（球面、椭球、圆锥、柱面、抛物面、双曲面）的标准方程与基本形态。</li>
</ul>
</div></div></div>
<!-- 第4页：生活中的向量 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>生活中的向量</h2>
<h3>什么时候需要向量？</h3>
<div class="example-card">
<h4>开车导航</h4>
<p>不仅要知道"距离多远"（10公里），还要知道"往哪个方向"（东北方向）</p>
</div>
<div class="example-card">
<h4>踢足球</h4>
<p>踢球的"力度"和"方向"决定了球的轨迹</p>
</div>
<div class="example-card">
<h4>游戏角色移动</h4>
<p>角色的"速度"和"朝向"控制移动</p>
</div>
<div class="math-formula">
                向量 = 大小 + 方向
            </div>
<p><span class="highlight">记住：</span>向量就像是带箭头的线段，箭头指向告诉我们方向，长度告诉我们大小。</p>
</div><div class="right-visual"><div id="vis-intro"></div></div></div></div>
<!-- 第5页：向量的表示 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>向量的表示方法</h2>
<h3>怎么写出一个向量？</h3>
<p>在平面上（2D）：</p>
<div class="math-formula">
                $\vec{a} = (3, 4)$
            </div>
<p>意思是：向右3个单位，向上4个单位</p>
<p>在空间中（3D）：</p>
<div class="math-formula">
                $\vec{b} = (2, 3, 5)$
            </div>
<p>意思是：向右2个单位，向前3个单位，向上5个单位</p>
<div class="example-card">
<h4><i class="fa-solid fa-lightbulb"></i> 小技巧</h4>
<p>把向量想象成从原点出发的箭头，坐标就是箭头尖端的位置！</p>
</div>
</div><div class="right-visual"><div id="vis-vector-representation"></div></div></div></div>
<!-- 第4页：向量加法 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>向量加法</h2>
<h3>向量相加 = 接力赛</h3>
<div class="example-card">
<h4>接力赛原理</h4>
<p>第一个人跑完后，第二个人从他停下的地方继续跑</p>
</div>
<p>数学表示：</p>
<div class="math-formula">
                $\vec{a} + \vec{b} = (a_x + b_x, a_y + b_y)$
            </div>
<p>实例：</p>
<p>$\vec{a} = (3, 2)$，$\vec{b} = (1, 4)$</p>
<p>$\vec{a} + \vec{b} = (3+1, 2+4) = (4, 6)$</p>
<p><span class="highlight">记忆方法：</span>对应坐标相加即可！</p>
</div><div class="right-visual"><div id="vis-vector-addition"></div></div></div></div>
<!-- 第7页：向量减法 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>向量减法</h2>
<h3>向量相减 = 求位移</h3>
<div class="example-card">
<h4><i class="fa-solid fa-bullseye"></i> 从A点到B点</h4>
<p>向量减法告诉我们：从一个位置到另一个位置要怎么走</p>
</div>
<div class="math-formula">
                $\vec{a} - \vec{b} = (a_x - b_x, a_y - b_y)$
            </div>
<p>实例：</p>
<p>小明在$(5, 3)$，小红在$(2, 1)$</p>
<p>从小红走到小明：$(5-2, 3-1) = (3, 2)$</p>
<p>意思是：向右走3步，向前走2步</p>
<p><span class="highlight">技巧：</span>终点坐标 - 起点坐标 = 位移向量</p>
</div><div class="right-visual"><div id="vis-vector-subtraction"></div></div></div></div>
<!-- 第6页：向量数乘 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>向量的数乘</h2>
<h3>数乘 = 缩放向量</h3>
<div class="math-formula">
                $k \cdot \vec{a} = (k \cdot a_x, k \cdot a_y)$
            </div>
<div class="example-card">
<h4>不同k值的效果：</h4>
<ul>
<li>$k = 2$：向量变为2倍长</li>
<li>$k = 0.5$：向量变为一半长</li>
<li>$k = -1$：向量反向</li>
<li>$k = 0$：变成零向量</li>
</ul>
</div>
<p>实例：速度加倍</p>
<p>原速度：$\vec{v} = (3, 4)$ km/h</p>
<p>加速2倍：$2\vec{v} = (6, 8)$ km/h</p>
<p><span class="highlight">形象理解：</span>像调节音量一样调节向量的"强度"</p>
</div><div class="right-visual"><div id="vis-scalar-multiplication"></div></div></div></div>
<!-- 第9页：向量的模 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>向量的模（长度）</h2>
<h3>如何计算向量的长度？</h3>
<p>向量的模就是向量的长度，用勾股定理计算：</p>
<div class="math-formula">
                $|\vec{a}| = \sqrt{a_x^2 + a_y^2 + a_z^2}$
            </div>
<h3>例子</h3>
<p>求向量 $\vec{a} = (3, 4)$ 的模：</p>
<p>$|\vec{a}| = \sqrt{3^2 + 4^2} = \sqrt{9 + 16} = \sqrt{25} = 5$</p>
<h3>单位向量</h3>
<p>模为1的向量叫<span class="highlight">单位向量</span></p>
<div class="math-formula">
                单位向量：$\vec{e}_a = \frac{\vec{a}}{|\vec{a}|}$
            </div>
<p>单位向量保持方向，但长度变为1</p>
</div><div class="right-visual"><div id="vis-vector-magnitude"></div></div></div></div>
<!-- 第10页：过渡页 - 第二部分 向量运算 -->
<div class="slide"><div class="slide-container single-column"><div class="left-content tex2jax_process">
<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; text-align: center;">
<h1 style="font-size: 3rem; color: #2ecc71; margin-bottom: 2rem;">第二部分</h1>
<h2 style="font-size: 2.5rem; color: #2c3e50; margin-bottom: 1rem;">向量的运算</h2>
<p style="font-size: 1.5rem; color: #666;">点积、叉积与混合积</p>
<div style="margin-top: 3rem; padding: 1.5rem; background: #f0fff4; border-left: 5px solid #2ecc71; border-radius: 8px;">
<p style="font-size: 1.2rem; color: #2c3e50; margin: 0;">核心内容：数量积、向量积、混合积及其应用</p>
</div>
</div>
</div></div></div>
<!-- 第11页：点积 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>向量的点积（数量积）</h2>
<h3>点积 = 投影 × 长度</h3>
<div class="math-formula">
                $\vec{a} \cdot \vec{b} = a_x b_x + a_y b_y + a_z b_z$
            </div>
<div class="example-card">
<h4>手电筒照墙</h4>
<p>点积就像手电筒光束在墙上的投影长度</p>
</div>
<p>点积的含义：</p>
<ul>
<li>结果 &gt; 0：两向量夹角 &lt; 90°（同向）</li>
<li>结果 = 0：两向量垂直</li>
<li>结果 &lt; 0：两向量夹角 &gt; 90°（反向）</li>
</ul>
<p><span class="highlight">应用：</span>计算功、判断垂直、求夹角</p>
</div><div class="right-visual"><div id="vis-dot-product"></div></div></div></div>
<!-- 第8页：叉积 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>向量的叉积</h2>
<h3>叉积 = 垂直新向量</h3>
<div class="math-formula">
                $\vec{a} \times \vec{b} = $ 垂直于$\vec{a}$和$\vec{b}$的新向量
            </div>
<div class="example-card">
<h4>螺丝钉原理</h4>
<p>右手握住螺丝，四指从$\vec{a}$转向$\vec{b}$，大拇指指向就是叉积方向</p>
</div>
<p>叉积的特点：</p>
<ul>
<li>结果是一个<span class="highlight">新向量</span></li>
<li>垂直于原来两个向量</li>
<li>大小等于平行四边形面积</li>
</ul>
<p><span class="highlight">应用：</span>计算法向量、力矩、面积</p>
</div><div class="right-visual"><div id="vis-cross-product"></div></div></div></div>
<!-- 第13页：混合积 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>向量的混合积</h2>
<h3>混合积 = 体积</h3>
<div class="math-formula">
                $(\vec{a} \times \vec{b}) \cdot \vec{c} = [\vec{a}, \vec{b}, \vec{c}]$
            </div>
<h3>几何意义</h3>
<p>混合积的绝对值等于以三个向量为棱的<span class="highlight">平行六面体的体积</span></p>
<h3>计算方法</h3>
<div class="math-formula">
$[\vec{a}, \vec{b}, \vec{c}] = \begin{vmatrix} 
a_x & a_y & a_z \\ 
b_x & b_y & b_z \\ 
c_x & c_y & c_z 
\end{vmatrix}$
            </div>
<h3>性质</h3>
<ul>
<li>如果混合积 = 0，则三向量<span class="highlight">共面</span></li>
<li>混合积的符号表示右手/左手系</li>
</ul>
</div><div class="right-visual"><div id="vis-mixed-product"></div></div></div></div>
<!-- 第14页：过渡页 - 第三部分 空间解析几何 -->
<div class="slide"><div class="slide-container single-column"><div class="left-content tex2jax_process">
<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; text-align: center;">
<h1 style="font-size: 3rem; color: #e74c3c; margin-bottom: 2rem;">第三部分</h1>
<h2 style="font-size: 2.5rem; color: #2c3e50; margin-bottom: 1rem;">空间解析几何</h2>
<p style="font-size: 1.5rem; color: #666;">点、线、面的方程与关系</p>
<div style="margin-top: 3rem; padding: 1.5rem; background: #fff5f5; border-left: 5px solid #e74c3c; border-radius: 8px;">
<p style="font-size: 1.2rem; color: #2c3e50; margin: 0;">核心内容：空间坐标系、直线与平面方程、距离与角度</p>
</div>
</div>
</div></div></div>
<!-- 第15页：空间坐标系 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>空间直角坐标系</h2>
<h3>三维定位系统</h3>
<div class="example-card">
<h4>楼层定位</h4>
<p>X轴：东西方向（左右）</p>
<p>Y轴：南北方向（前后）</p>
<p>Z轴：上下方向（楼层）</p>
</div>
<p>空间中任意一点：</p>
<div class="math-formula">
                $P(x, y, z)$
            </div>
<p>例如：$P(3, 4, 5)$表示：</p>
<ul>
<li>向东3米</li>
<li>向北4米</li>
<li>向上5米（5楼）</li>
</ul>
<p><span class="highlight">记忆技巧：</span>伸出右手，拇指X、食指Y、中指Z</p>
</div><div class="right-visual"><div id="vis-3d-coordinate"></div></div></div></div>
<!-- 第16页：空间直线方程 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>空间直线方程</h2>
<h3>参数方程</h3>
<p>过点 $M_0(x_0, y_0, z_0)$，方向向量为 $\vec{s} = (m, n, p)$ 的直线：</p>
<div class="math-formula">
$\begin{cases}
x = x_0 + mt \\
y = y_0 + nt \\
z = z_0 + pt
\end{cases}$
            </div>
<h3>对称式方程</h3>
<div class="math-formula">
$\frac{x - x_0}{m} = \frac{y - y_0}{n} = \frac{z - z_0}{p}$
            </div>
<h3>例子</h3>
<p>过点 $(1, 2, 3)$，方向向量 $(2, -1, 4)$ 的直线：</p>
<p>$\frac{x - 1}{2} = \frac{y - 2}{-1} = \frac{z - 3}{4}$</p>
</div><div class="right-visual"><div id="vis-line-equation"></div></div></div></div>
<!-- 第17页：空间平面方程 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>空间平面方程</h2>
<h3>一般式方程</h3>
<p>法向量为 $\vec{n} = (A, B, C)$ 的平面：</p>
<div class="math-formula">
                $Ax + By + Cz + D = 0$
            </div>
<h3>点法式方程</h3>
<p>过点 $M_0(x_0, y_0, z_0)$，法向量 $\vec{n} = (A, B, C)$：</p>
<div class="math-formula">
                $A(x - x_0) + B(y - y_0) + C(z - z_0) = 0$
            </div>
<h3>例子</h3>
<p>过点 $(1, 2, 3)$，法向量 $(2, -1, 4)$ 的平面：</p>
<p>$2(x - 1) - 1(y - 2) + 4(z - 3) = 0$</p>
<p>即：$2x - y + 4z - 12 = 0$</p>
</div><div class="right-visual"><div id="vis-plane-equation"></div></div></div></div>
<!-- 第18页：点到平面的距离 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>点到平面的距离</h2>
<h3>距离公式</h3>
<p>点 $P(x_0, y_0, z_0)$ 到平面 $Ax + By + Cz + D = 0$ 的距离：</p>
<div class="math-formula">
                $d = \frac{|Ax_0 + By_0 + Cz_0 + D|}{\sqrt{A^2 + B^2 + C^2}}$
            </div>
<h3>例子</h3>
<p>求点 $(1, 1, 1)$ 到平面 $2x - y + 2z - 3 = 0$ 的距离：</p>
<p>$d = \frac{|2 \cdot 1 - 1 \cdot 1 + 2 \cdot 1 - 3|}{\sqrt{2^2 + (-1)^2 + 2^2}}$</p>
<p>$= \frac{|2 - 1 + 2 - 3|}{\sqrt{4 + 1 + 4}} = \frac{0}{3} = 0$</p>
<p>点在平面上！</p>
</div><div class="right-visual"><div id="vis-distance"></div></div></div></div>
<!-- 补充页：点到直线的距离 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>点到直线的距离</h2>
<h3>空间中点 $P$ 到直线 $l: \vec{r}=\vec{r}_0+t\vec{s}$</h3>
<div class="math-formula">
                $d(P,l)=\dfrac{\big\|\overrightarrow{P\!A}\times\vec{s}\big\|}{\|\vec{s}\|}$，其中 $A$ 为直线上任一点
            </div>
<h3>要点</h3>
<ul>
<li>叉积的几何意义：平行四边形面积；再除以底边长度得到高。</li>
<li>直线在参数式或对称式时，统一取方向向量 $\vec{s}$ 即可。</li>
</ul>
</div><div class="right-visual"><div id="vis-point-line-distance"></div></div></div></div>
<!-- 补充页：直线与平面夹角 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>直线与平面的夹角</h2>
<p>直线方向向量为 $\vec{d}$，平面法向量为 $\vec{n}$。</p>
<div class="math-formula">
                $\sin\theta=\dfrac{|\vec{n}\cdot\vec{d}|}{\|\vec{n}\|\,\|\vec{d}\|}$，其中 $\theta$ 为直线与平面的夹角
            </div>
<p>也常写成与法向量夹角 $\varphi$ 的余弦：$\cos\varphi=\dfrac{|\vec{n}\cdot\vec{d}|}{\|\vec{n}\|\,\|\vec{d}\|}$，且 $\theta=90^\circ-\varphi$。</p>
</div><div class="right-visual"><div id="vis-line-plane-angle"></div></div></div></div>
<!-- 补充页：两平面夹角与平行平面距离 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>两平面的夹角与距离</h2>
<h3>夹角</h3>
<div class="math-formula">
                $\cos\theta=\dfrac{|\vec{n}_1\cdot\vec{n}_2|}{\|\vec{n}_1\|\,\|\vec{n}_2\|}$
            </div>
<h3>平行平面间距离</h3>
<p>若 $A x+By+Cz+D_1=0$ 与 $A x+By+Cz+D_2=0$ 平行，则</p>
<div class="math-formula">
                $d=\dfrac{|D_2-D_1|}{\sqrt{A^2+B^2+C^2}}$
            </div>
</div><div class="right-visual"><div id="vis-plane-plane"></div></div></div></div>
<!-- 补充页：两异面直线的距离与夹角 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>两异面直线的距离与夹角</h2>
<p>直线 $l_1: \vec{r}=\vec{r}_1+t\vec{d}_1$，$l_2: \vec{r}=\vec{r}_2+s\vec{d}_2$。</p>
<h3>距离（不共面时）</h3>
<div class="math-formula">
                $d=\dfrac{\big|\,(\vec{r}_2-\vec{r}_1)\cdot(\vec{d}_1\times\vec{d}_2)\,\big|}{\|\vec{d}_1\times\vec{d}_2\|}$
            </div>
<h3>夹角</h3>
<div class="math-formula">
                $\cos\theta=\dfrac{|\vec{d}_1\cdot\vec{d}_2|}{\|\vec{d}_1\|\,\|\vec{d}_2\|}$
            </div>
<p>若 $\vec{d}_1\times\vec{d}_2=\vec{0}$ 则两直线平行或重合；此时可转化为点到直线或平行线间距离。</p>
</div><div class="right-visual"><div id="vis-skew-lines"></div></div></div></div>
<!-- 第19页：两向量夹角 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>两向量的夹角</h2>
<h3>夹角公式</h3>
<div class="math-formula">
                $\cos \theta = \frac{\vec{a} \cdot \vec{b}}{|\vec{a}| \cdot |\vec{b}|}$
            </div>
<h3>例子</h3>
<p>求 $\vec{a} = (1, 2, 2)$ 和 $\vec{b} = (2, 3, 6)$ 的夹角：</p>
<p>$\vec{a} \cdot \vec{b} = 1 \cdot 2 + 2 \cdot 3 + 2 \cdot 6 = 2 + 6 + 12 = 20$</p>
<p>$|\vec{a}| = \sqrt{1 + 4 + 4} = 3$</p>
<p>$|\vec{b}| = \sqrt{4 + 9 + 36} = 7$</p>
<p>$\cos \theta = \frac{20}{3 \times 7} = \frac{20}{21}$</p>
<h3>特殊情况</h3>
<ul>
<li>$\vec{a} \cdot \vec{b} = 0$ → 垂直</li>
<li>$\cos \theta = 1$ → 同向</li>
<li>$\cos \theta = -1$ → 反向</li>
</ul>
</div><div class="right-visual"><div id="vis-angle"></div></div></div></div>
<!-- 第20页：例题 · 向量加法（二维） -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>例题 · 向量加法（二维）</h2>
<p>已知 $\vec{a}=(2,1)$，$\vec{b}=(-1,3)$，求 $\vec{a}+\vec{b}$ 并说明几何意义。</p>
<h3>要点</h3>
<ul>
<li>坐标相加：$(x_a+x_b,\; y_a+y_b)$</li>
<li>几何：平行四边形（首尾相接）</li>
</ul>
</div><div class="right-visual"><div id="vis-example-add"></div></div></div></div>

<!-- 第21页：例题 · 点积与夹角 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>例题 · 点积与夹角</h2>
<p>设 $\vec{a}=(1,2,2)$，$\vec{b}=(2,3,6)$，计算 $\vec{a}\cdot\vec{b}$ 并求夹角。</p>
<h3>要点</h3>
<ul>
<li>$\vec{a}\cdot\vec{b}=x_ax_b+y_ay_b+z_az_b$</li>
<li>$\cos\theta=\dfrac{\vec{a}\cdot\vec{b}}{|\vec{a}|\,|\vec{b}|}$</li>
</ul>
</div><div class="right-visual"><div id="vis-example-dot-steps"></div></div></div></div>

<!-- 第22页：例题 · 直线两点式到参数式 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>例题 · 直线两点式到参数式</h2>
<p>过 $A(1,2,0)$ 与 $B(3,1,2)$ 的空间直线，写出参数方程。</p>
<h3>要点</h3>
<ul>
<li>方向向量 $\vec{d}=\overrightarrow{AB}=(2,-1,2)$</li>
<li>参数式：$\;\begin{cases}x=1+2t\\y=2- t\\z=0+2t\end{cases}$</li>
</ul>
</div><div class="right-visual"><div id="vis-example-line"></div></div></div></div>

<!-- 第23页：总结 -->
<div class="slide"><div class="slide-container single-column"><div class="left-content tex2jax_process">
<h2 style="font-size: 3rem; margin-bottom: 30px">本章小结</h2>
<div style="display: grid; gap: 20px; text-align: left">
<div class="example-card">
<h4>向量基础</h4>
<ul>
<li>向量 = 大小 + 方向</li>
<li>用坐标表示：(x, y, z)</li>
<li>可以相加、相减、数乘</li>
</ul>
</div>
<div class="example-card">
<h4>向量运算</h4>
<ul>
<li>点积：判断夹角关系</li>
<li>叉积：得到垂直向量</li>
<li>应用于力学、图形学</li>
</ul>
</div>
<div class="example-card">
<h4>空间几何</h4>
<ul>
<li>三维坐标系定位</li>
<li>点、线、面的描述</li>
<li>距离和角度计算</li>
</ul>
</div>
<div class="example-card">
<h4>实际应用</h4>
<ul>
<li>游戏开发中的移动</li>
<li>工程中的力分析</li>
<li>导航中的方向计算</li>
</ul>
</div>
</div>
<p style="margin-top: 30px; font-size: 1.2rem">
                恭喜你！现在你已经掌握了向量的基本知识！
            </p>
</div></div></div>
</div>
<!-- 页码指示器 -->
<!-- 翻页按钮 -->
<!-- 全局动画控制面板 -->
<div class="nav-controls" role="navigation" aria-label="幻灯片导航">
    <button class="nav-btn" onclick="previousSlide()" aria-label="上一页" title="上一页 (<i class="fa-solid fa-arrow-left"></i>)"><i class="fa-solid fa-arrow-left"></i> 上一页</button>
    <div class="slide-number" role="status" aria-live="polite">
        <input type="number" id="slideNumberInput" min="1" max="23" value="1"
               onchange="jumpToSlide(this.value)"
               aria-label="当前页码">/<span id="slideNumberTotal">23</span>
    </div>
    <button class="nav-btn" onclick="nextSlide()" aria-label="下一页" title="下一页 (→)">下一页 →</button>
</div>
<script>
    // 全局变量
    let currentSlide = 0;
    let slides = null;
    let totalSlides = 0;
    let threeScenes = {};
    let animationFrames = [];
    
    // 主题颜色配置
    const themeColors = {
        text: '#2c3e50',
        axis: '#475569',
        muted: '#94a3b8',
        surface: '#ffffff'
    };

    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
        console.log('课件初始化中...');
        
        // 检查依赖库
        if (typeof d3 === 'undefined') {
            console.error('错误: D3.js 未加载！');
            alert('可视化库(D3.js)加载失败，请检查网络连接或刷新页面');
            return;
        }
        if (typeof THREE === 'undefined') {
            console.error('错误: Three.js 未加载！');
            alert('3D库(Three.js)加载失败，请检查网络连接或刷新页面');
            return;
        }
        console.log('所有库已加载');
        
        slides = document.querySelectorAll('.slide');
        totalSlides = slides.length;
        console.log('找到', totalSlides, '个幻灯片');
        const totalEl = document.getElementById('slideNumberTotal');
        if (totalEl) { totalEl.textContent = totalSlides; }
        const numberInput = document.getElementById('slideNumberInput');
        if (numberInput) { numberInput.max = totalSlides; }
        
        // 显示第一张幻灯片
        showSlide(0);
        
        // 键盘导航
        document.addEventListener('keydown', handleKeyNavigation);
        
        // 初始化浮动菜单
        initFloatingMenu();
        
        console.log('课件初始化完成');
    });

    // 显示指定幻灯片
    function showSlide(index) {
        console.log('显示幻灯片:', index + 1);
        
        // 清理之前的动画
        cleanupAnimations();
        
        // 隐藏所有幻灯片
        slides.forEach(slide => slide.classList.remove('active'));
        
        // 显示当前幻灯片
        currentSlide = index;
        slides[currentSlide].classList.add('active');
        
        // 更新页码
        updatePageIndicator();
        
        // 更新按钮状态
        updateNavigationButtons();
        
        // 运行当前幻灯片的可视化
        runVisualization(currentSlide);
    }

    // 下一页
    function nextSlide() {
        if (currentSlide < totalSlides - 1) {
            showSlide(currentSlide + 1);
        }
    }

    // 上一页
    function previousSlide() {
        if (currentSlide > 0) {
            showSlide(currentSlide - 1);
        }
    }

    // 跳转到指定页
    function jumpToSlide(value) {
        const slideNumber = parseInt(value);
        if (slideNumber >= 1 && slideNumber <= totalSlides) {
            currentSlide = slideNumber - 1;
            showSlide(currentSlide);
        }
    }

    // 更新页码指示器
    function updatePageIndicator() {
        const slideInput = document.getElementById('slideNumberInput');
        const slideTotal = document.getElementById('slideNumberTotal');
        if (slideInput) {
            slideInput.value = currentSlide + 1;
            slideInput.max = totalSlides;
        }
        if (slideTotal) {
            slideTotal.textContent = totalSlides;
        }
    }

    // 更新导航按钮状态
    function updateNavigationButtons() {
        const navButtons = document.querySelectorAll('.nav-controls .nav-btn');
        if (navButtons.length >= 2) {
            const prevBtn = navButtons[0];
            const nextBtn = navButtons[1];

            prevBtn.disabled = currentSlide === 0;
            nextBtn.disabled = currentSlide === totalSlides - 1;
        }
    }

    // 键盘导航
    function handleKeyNavigation(e) {
        if (e.key === 'ArrowRight' || e.key === ' ') {
            e.preventDefault();
            nextSlide();
        } else if (e.key === 'ArrowLeft') {
            e.preventDefault();
            previousSlide();
        }
    }

    // 鼠标滚轮导航
    document.addEventListener('wheel', (e) => {
        // 如果鼠标在左侧内容区域，则不阻止默认的滚动行为
        if (e.target.closest('.left-content')) {
            return;
        }
        e.preventDefault();
        if (e.deltaY > 0) {
            nextSlide();
        } else {
            previousSlide();
        }
    }, { passive: false });

    // 初始化浮动菜单
    function initFloatingMenu() {
        const menuToggle = document.getElementById('menu-toggle');
        const menuContent = document.getElementById('menu-content');
        
        if (menuToggle && menuContent) {
            menuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                menuToggle.classList.toggle('active');
                menuContent.classList.toggle('active');
            });
            
            document.addEventListener('click', function(e) {
                if (!menuToggle.contains(e.target) && !menuContent.contains(e.target)) {
                    menuToggle.classList.remove('active');
                    menuContent.classList.remove('active');
                }
            });
        }
    }

    // 清理动画
    function cleanupAnimations() {
        animationFrames.forEach(frame => cancelAnimationFrame(frame));
        animationFrames = [];
        
        // 清理Three.js场景
        Object.values(threeScenes).forEach(scene => {
            if (scene && scene.renderer) {
                scene.renderer.dispose();
                if (scene.container && scene.container.firstChild) {
                    scene.container.removeChild(scene.container.firstChild);
                }
            }
        });
        threeScenes = {};
    }

    // 运行可视化
    function runVisualization(slideIndex) {
        switch(slideIndex) {
            case 0: // 标题页
                visualizeTitleVector();
                break;
            case 1: // 目录
                visualizeContents();
                break;
            case 2: // 过渡页 - 第一部分
                visualizeSection1Transition();
                break;
            case 3: // 生活中的向量
                visualizeIntro();
                break;
            case 4: // 向量的表示
                visualizeVectorRepresentation();
                break;
            case 5: // 向量加法
                visualizeVectorAddition();
                break;
            case 6: // 向量减法
                visualizeVectorSubtraction();
                break;
            case 7: // 向量数乘
                visualizeScalarMultiplication();
                break;
            case 8: // 向量的模
                visualizeVectorMagnitude();
                break;
            case 9: // 过渡页 - 第二部分
                visualizeSection2Transition();
                break;
            case 10: // 点积
                visualizeDotProduct();
                break;
            case 11: // 叉积
                visualizeCrossProduct();
                break;
            case 12: // 混合积
                visualizeMixedProduct();
                break;
            case 13: // 过渡页 - 第三部分
                visualizeSection3Transition();
                break;
            case 14: // 空间坐标系
                visualize3DCoordinate();
                break;
            case 15: // 空间直线方程
                visualizeLineEquation();
                break;
            case 16: // 空间平面方程
                visualizePlaneEquation();
                break;
            case 17: // 点到平面距离
                visualizeDistance();
                break;
            case 18: // 两向量夹角
                visualizeAngle();
                break;
            case 19: // 例题 · 向量加法
                visualizeExampleAdd();
                break;
            case 20: // 例题 · 点积与夹角
                visualizeExampleDotSteps();
                break;
            case 21: // 例题 · 直线两点式到参数式
                visualizeExampleLineParam();
                break;
        }
    }

    // 目录页可视化
    function visualizeContents() {
        const container = d3.select('#vis-contents');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        
        const rect = container.node().getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        
        if (width === 0 || height === 0) return;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 创建三个部分的图标
        const sections = [
            { icon: '→', color: '#3498db', label: '基础', angle: -Math.PI/3 },
            { icon: '×', color: '#2ecc71', label: '运算', angle: Math.PI/3 },
            { icon: '◇', color: '#e74c3c', label: '空间', angle: Math.PI }
        ];
        
        const radius = Math.min(width, height) * 0.25;
        
        sections.forEach((section, i) => {
            const x = radius * Math.cos(section.angle);
            const y = radius * Math.sin(section.angle);
            
            // 图标
            g.append('text')
                .attr('x', x)
                .attr('y', y)
                .attr('text-anchor', 'middle')
                .attr('font-size', '48px')
                .attr('fill', section.color)
                .text(section.icon)
                .style('opacity', 0)
                .transition()
                .delay(i * 200)
                .duration(800)
                .style('opacity', 1);
            
            // 标签
            g.append('text')
                .attr('x', x)
                .attr('y', y + 40)
                .attr('text-anchor', 'middle')
                .attr('font-size', '18px')
                .attr('fill', '#666')
                .text(section.label)
                .style('opacity', 0)
                .transition()
                .delay(i * 200 + 400)
                .duration(800)
                .style('opacity', 1);
        });
        
        // 中心标题
        g.append('text')
            .attr('text-anchor', 'middle')
            .attr('font-size', '28px')
            .attr('fill', '#2c3e50')
            .attr('font-weight', 'bold')
            .text('向量')
            .style('opacity', 0)
            .transition()
            .delay(600)
            .duration(1000)
            .style('opacity', 1);
    }

    // 标题页可视化
    function visualizeTitleVector() {
        const container = d3.select('#vis-title');
        if (container.empty()) return;
        container.selectAll('*').remove();
        
        const bounds = container.node().getBoundingClientRect();
        const width = bounds.width;
        const height = bounds.height;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 向量符号
        g.append('text')
            .attr('text-anchor', 'middle')
            .attr('font-size', '90px')
            .attr('fill', '#2ecc71')
            .attr('font-weight', 'bold')
            .text('⃗v')
            .style('opacity', 0)
            .transition()
            .duration(1000)
            .style('opacity', 1);
        
        // 等号和分量
        g.append('text')
            .attr('text-anchor', 'middle')
            .attr('x', 100)
            .attr('font-size', '50px')
            .attr('fill', '#666')
            .text('=')
            .style('opacity', 0)
            .transition()
            .delay(600)
            .duration(800)
            .style('opacity', 1);
        
        g.append('text')
            .attr('text-anchor', 'middle')
            .attr('x', 180)
            .attr('font-size', '60px')
            .attr('fill', '#3498db')
            .text('(x,y,z)')
            .style('opacity', 0)
            .transition()
            .delay(1200)
            .duration(1000)
            .style('opacity', 1);
        
        // 3D坐标系装饰
        const axisGroup = g.append('g')
            .attr('transform', 'translate(-150, 100)');
        
        // X轴
        axisGroup.append('line')
            .attr('x1', 0)
            .attr('y1', 0)
            .attr('x2', 60)
            .attr('y2', 0)
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('marker-end', 'url(#arrow)')
            .style('opacity', 0)
            .transition()
            .delay(1600)
            .duration(800)
            .style('opacity', 1);
        
        // Y轴
        axisGroup.append('line')
            .attr('x1', 0)
            .attr('y1', 0)
            .attr('x2', -30)
            .attr('y2', 40)
            .attr('stroke', '#2ecc71')
            .attr('stroke-width', 2)
            .style('opacity', 0)
            .transition()
            .delay(1800)
            .duration(800)
            .style('opacity', 1);
        
        // Z轴
        axisGroup.append('line')
            .attr('x1', 0)
            .attr('y1', 0)
            .attr('x2', 0)
            .attr('y2', -60)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2)
            .style('opacity', 0)
            .transition()
            .delay(2000)
            .duration(800)
            .style('opacity', 1);
        
        // 装饰圆环
        g.append('circle')
            .attr('r', 0)
            .attr('fill', 'none')
            .attr('stroke', '#9b59b6')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '10,5')
            .transition()
            .delay(2200)
            .duration(1500)
            .attr('r', 180);
    }

    // 可视化函数：生活中的向量
    function visualizeIntro() {
        const container = document.getElementById('vis-intro');
        if (!container) return;
        container.innerHTML = '';
        
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        const svg = d3.select(container)
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 创建多个生活实例动画
        const examples = [
            {
                x: width * 0.25,
                y: height * 0.3,
                icon: '→',
                dx: 100,
                dy: -60,
                label: '导航：向东北10公里',
                color: '#3498db'
            },
            {
                x: width * 0.75,
                y: height * 0.3,
                icon: '⊙',
                dx: -80,
                dy: 80,
                label: '踢球：45度角，20米/秒',
                color: '#2ecc71'
            },
            {
                x: width * 0.5,
                y: height * 0.7,
                icon: '△',
                dx: 120,
                dy: -40,
                label: '飞机：爬升角30度',
                color: '#e74c3c'
            }
        ];
        
        examples.forEach((ex, i) => {
            const g = svg.append('g');
            
            // 图标
            g.append('text')
                .attr('x', ex.x)
                .attr('y', ex.y)
                .attr('font-size', '40px')
                .attr('text-anchor', 'middle')
                .text(ex.icon)
                .style('opacity', 0)
                .transition()
                .delay(i * 500)
                .duration(500)
                .style('opacity', 1);
            
            // 定义箭头标记
            svg.append('defs')
                .append('marker')
                .attr('id', `arrow-${i}`)
                .attr('viewBox', '0 0 10 10')
                .attr('refX', 8)
                .attr('refY', 5)
                .attr('markerWidth', 8)
                .attr('markerHeight', 8)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M 0 0 L 10 5 L 0 10 z')
                .attr('fill', ex.color);
            
            // 向量箭头
            g.append('line')
                .attr('x1', ex.x)
                .attr('y1', ex.y + 20)
                .attr('x2', ex.x)
                .attr('y2', ex.y + 20)
                .attr('stroke', ex.color)
                .attr('stroke-width', 3)
                .attr('marker-end', `url(#arrow-${i})`)
                .transition()
                .delay(i * 500 + 500)
                .duration(1000)
                .attr('x2', ex.x + ex.dx)
                .attr('y2', ex.y + 20 + ex.dy);
            
            // 标签
            g.append('text')
                .attr('x', ex.x + ex.dx / 2)
                .attr('y', ex.y + 20 + ex.dy / 2 - 10)
                .attr('text-anchor', 'middle')
                .attr('fill', themeColors.text)
                .style('font-size', '14px')
                .text(ex.label)
                .style('opacity', 0)
                .transition()
                .delay(i * 500 + 1500)
                .duration(500)
                .style('opacity', 1);
        });
    }

    // 可视化函数：向量表示（3D）
    function visualizeVectorRepresentation() {
        const container = document.getElementById('vis-vector-representation');
        if (!container) return;
        container.innerHTML = '';
        
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        // 创建Three.js场景
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        
        renderer.setSize(width, height);
        container.appendChild(renderer.domElement);
        
        // 相机位置
        camera.position.set(10, 10, 10);
        camera.lookAt(0, 0, 0);
        
        // 光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        // 创建坐标轴
        const axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);
        
        // 创建网格平面
        const gridHelper = new THREE.GridHelper(10, 10, 0x444444, 0x222222);
        scene.add(gridHelper);
        
        // 创建向量
        const origin = new THREE.Vector3(0, 0, 0);
        const vector = new THREE.Vector3(3, 4, 2);
        
        // 向量箭头
        const arrowHelper = new THREE.ArrowHelper(
            vector.clone().normalize(),
            origin,
            vector.length(),
            0x00ffff,
            1,
            1
        );
        scene.add(arrowHelper);
        
        // 创建坐标点
        const pointGeometry = new THREE.SphereGeometry(0.2);
        const pointMaterial = new THREE.MeshPhongMaterial({ 
            color: 0xff0000,
            emissive: 0xff0000,
            emissiveIntensity: 0.5
        });
        const point = new THREE.Mesh(pointGeometry, pointMaterial);
        point.position.copy(vector);
        scene.add(point);
        
        // 添加信息面板
        const infoPanel = document.createElement('div');
        infoPanel.className = 'info-panel';
        infoPanel.innerHTML = `
            <h4>向量坐标</h4>
            <p>X = 3（向右）</p>
            <p>Y = 4（向上）</p>
            <p>Z = 2（向前）</p>
            <p>长度 = ${vector.length().toFixed(2)}</p>
        `;
        container.appendChild(infoPanel);
        
        // 动画
        function animate() {
            const frame = requestAnimationFrame(animate);
            animationFrames.push(frame);
            
            scene.rotation.y += 0.005;
            
            renderer.render(scene, camera);
        }
        animate();
        
        // 保存场景引用
        threeScenes['vector-representation'] = { 
            scene, 
            camera, 
            renderer,
            container
        };
    }

    // 可视化函数：向量加法
    function visualizeVectorAddition() {
        const container = document.getElementById('vis-vector-addition');
        if (!container) return;
        container.innerHTML = '';
        
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        const svg = d3.select(container)
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 坐标系
        const centerX = width / 2;
        const centerY = height / 2;
        const scale = 40;
        
        // 绘制坐标轴
        drawCoordinateSystem(svg, centerX, centerY, scale);
        
        const v1 = {x: 3, y: 2};
        const v2 = {x: 1, y: 4};
        const sum = {x: v1.x + v2.x, y: v1.y + v2.y};
        
        const g = svg.append('g');
        
        // 动画序列
        setTimeout(() => {
            drawAnimatedVector(g, centerX, centerY, 
                v1.x * scale, -v1.y * scale, '#3498db', 0, 'v₁');
        }, 0);
        
        setTimeout(() => {
            drawAnimatedVector(g, 
                centerX + v1.x * scale, 
                centerY - v1.y * scale, 
                v2.x * scale, 
                -v2.y * scale, 
                '#2ecc71', 
                0,
                'v₂'
            );
        }, 1500);
        
        setTimeout(() => {
            drawAnimatedVector(g, centerX, centerY, 
                sum.x * scale, -sum.y * scale, '#e74c3c', 0, 'v₁ + v₂');
            
            // 添加说明文字
            g.append('text')
                .attr('x', centerX)
                .attr('y', height - 50)
                .attr('text-anchor', 'middle')
                .attr('fill', themeColors.text)
                .style('font-size', '16px')
                .text('向量加法：首尾相接法则');
        }, 3000);
    }

    // 可视化函数：向量减法
    function visualizeVectorSubtraction() {
        const container = document.getElementById('vis-vector-subtraction');
        if (!container) return;
        container.innerHTML = '';
        
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        const svg = d3.select(container)
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const centerX = width / 2;
        const centerY = height / 2;
        const scale = 40;
        
        drawCoordinateSystem(svg, centerX, centerY, scale);
        
        const v1 = {x: 4, y: 3};
        const v2 = {x: 2, y: 1};
        const diff = {x: v1.x - v2.x, y: v1.y - v2.y};
        
        const g = svg.append('g');
        
        // 画出两个向量
        setTimeout(() => {
            drawAnimatedVector(g, centerX, centerY, 
                v1.x * scale, -v1.y * scale, '#3498db', 0, 'v₁');
            drawAnimatedVector(g, centerX, centerY, 
                v2.x * scale, -v2.y * scale, '#2ecc71', 500, 'v₂');
        }, 0);
        
        // 画出差向量
        setTimeout(() => {
            drawAnimatedVector(g, 
                centerX + v2.x * scale, 
                centerY - v2.y * scale, 
                diff.x * scale, 
                -diff.y * scale, 
                '#e74c3c', 
                0, 
                'v₁ - v₂'
            );
            
            g.append('text')
                .attr('x', centerX)
                .attr('y', height - 50)
                .attr('text-anchor', 'middle')
                .attr('fill', themeColors.text)
                .style('font-size', '16px')
                .text('向量减法：从v₂指向v₁');
        }, 2000);
    }

    // 可视化函数：数乘
    function visualizeScalarMultiplication() {
        const container = document.getElementById('vis-scalar-multiplication');
        if (!container) return;
        container.innerHTML = '';
        
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        const svg = d3.select(container)
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const centerX = width / 2;
        const centerY = height / 2;
        const scale = 30;
        
        drawCoordinateSystem(svg, centerX, centerY, scale);
        
        const v = {x: 2, y: 1.5};
        const scalars = [0.5, 1, 2, -1];
        const colors = ['#f39c12', '#3498db', '#2ecc71', '#e74c3c'];
        
        const g = svg.append('g');
        
        scalars.forEach((k, i) => {
            setTimeout(() => {
                drawAnimatedVector(g, centerX, centerY, 
                    v.x * k * scale, -v.y * k * scale, 
                    colors[i], 0, `${k}v`);
            }, i * 1000);
        });
        
        setTimeout(() => {
            g.append('text')
                .attr('x', centerX)
                .attr('y', height - 50)
                .attr('text-anchor', 'middle')
                .attr('fill', themeColors.text)
                .style('font-size', '16px')
                .text('数乘：改变向量长度和方向');
        }, 4000);
    }

    // 可视化函数：点积
    function visualizeDotProduct() {
        const container = document.getElementById('vis-dot-product');
        if (!container) return;
        container.innerHTML = '';
        
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        const svg = d3.select(container)
            .append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const centerX = width / 2;
        const centerY = height / 2;
        const scale = 50;
        
        drawCoordinateSystem(svg, centerX, centerY, scale);
        
        const v1 = {x: 3, y: 1};
        const v2 = {x: 2, y: 2};
        
        const g = svg.append('g');
        
        // 画向量
        drawAnimatedVector(g, centerX, centerY, 
            v1.x * scale, -v1.y * scale, '#3498db', 0, 'a');
        drawAnimatedVector(g, centerX, centerY, 
            v2.x * scale, -v2.y * scale, '#2ecc71', 500, 'b');
        
        // 计算点积
        const dotProduct = v1.x * v2.x + v1.y * v2.y;
        const angle = Math.acos(dotProduct / 
            (Math.sqrt(v1.x*v1.x + v1.y*v1.y) * 
             Math.sqrt(v2.x*v2.x + v2.y*v2.y)));
        
        // 画投影线
        setTimeout(() => {
            const projLength = Math.sqrt(v1.x*v1.x + v1.y*v1.y) * Math.cos(angle);
            const projX = projLength * v2.x / Math.sqrt(v2.x*v2.x + v2.y*v2.y);
            const projY = projLength * v2.y / Math.sqrt(v2.x*v2.x + v2.y*v2.y);
            
            g.append('line')
                .attr('x1', centerX + v1.x * scale)
                .attr('y1', centerY - v1.y * scale)
                .attr('x2', centerX + projX * scale)
                .attr('y2', centerY - projY * scale)
                .attr('stroke', '#f39c12')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5')
                .style('opacity', 0)
                .transition()
                .duration(500)
                .style('opacity', 1);
            
            // 显示结果
            g.append('text')
                .attr('x', centerX)
                .attr('y', 50)
                .attr('text-anchor', 'middle')
                .attr('fill', themeColors.text)
                .style('font-size', '18px')
                .text(`a·b = ${dotProduct.toFixed(1)}`);
            
            g.append('text')
                .attr('x', centerX)
                .attr('y', height - 50)
                .attr('text-anchor', 'middle')
                .attr('fill', themeColors.text)
                .style('font-size', '16px')
                .text(`夹角 = ${(angle * 180 / Math.PI).toFixed(1)}°`);
        }, 1500);
    }

    // 可视化函数：叉积（3D）
    function visualizeCrossProduct() {
        const container = document.getElementById('vis-cross-product');
        if (!container) return;
        container.innerHTML = '';
        
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        // 创建Three.js场景
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        
        renderer.setSize(width, height);
        container.appendChild(renderer.domElement);
        
        camera.position.set(8, 8, 8);
        camera.lookAt(0, 0, 0);
        
        // 光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        // 坐标轴
        const axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);
        
        // 创建向量
        const v1 = new THREE.Vector3(3, 0, 0);
        const v2 = new THREE.Vector3(0, 3, 0);
        const cross = new THREE.Vector3();
        cross.crossVectors(v1, v2);
        
        // 向量箭头
        const arrow1 = new THREE.ArrowHelper(v1.clone().normalize(), 
            new THREE.Vector3(0, 0, 0), v1.length(), 0x3498db, 1, 1);
        const arrow2 = new THREE.ArrowHelper(v2.clone().normalize(), 
            new THREE.Vector3(0, 0, 0), v2.length(), 0x2ecc71, 1, 1);
        const arrow3 = new THREE.ArrowHelper(cross.clone().normalize(), 
            new THREE.Vector3(0, 0, 0), cross.length(), 0xe74c3c, 1, 1);
        
        scene.add(arrow1);
        scene.add(arrow2);
        
        // 延迟添加叉积向量
        setTimeout(() => {
            scene.add(arrow3);
        }, 1500);
        
        // 添加平面表示
        const planeGeometry = new THREE.PlaneGeometry(3, 3);
        const planeMaterial = new THREE.MeshBasicMaterial({
            color: 0x00ffff,
            side: THREE.DoubleSide,
            transparent: true,
            opacity: 0.2
        });
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.position.set(1.5, 1.5, 0);
        scene.add(plane);
        
        // 信息面板
        const infoPanel = document.createElement('div');
        infoPanel.className = 'info-panel';
        infoPanel.innerHTML = `
            <h4>向量叉积</h4>
            <p>蓝色 × 绿色 = 红色</p>
            <p>红色向量垂直于蓝绿平面</p>
            <p>大小 = 平行四边形面积</p>
        `;
        container.appendChild(infoPanel);
        
        // 动画
        function animate() {
            const frame = requestAnimationFrame(animate);
            animationFrames.push(frame);
            
            scene.rotation.y += 0.005;
            
            renderer.render(scene, camera);
        }
        animate();
        
        threeScenes['cross-product'] = { scene, camera, renderer, container };
    }

    // 可视化函数：3D坐标系
    function visualize3DCoordinate() {
        const container = document.getElementById('vis-3d-coordinate');
        if (!container) return;
        container.innerHTML = '';
        
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        // 创建Three.js场景
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        
        renderer.setSize(width, height);
        container.appendChild(renderer.domElement);
        
        camera.position.set(10, 10, 10);
        camera.lookAt(0, 0, 0);
        
        // 光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        // 创建更大的坐标轴
        const axesHelper = new THREE.AxesHelper(6);
        scene.add(axesHelper);
        
        // 创建网格
        const gridHelper = new THREE.GridHelper(10, 10, 0x444444, 0x222222);
        scene.add(gridHelper);
        
        // 创建一个示例点 P(3, 4, 5)
        const pointGeometry = new THREE.SphereGeometry(0.3);
        const pointMaterial = new THREE.MeshPhongMaterial({
            color: 0xff0000,
            emissive: 0xff0000,
            emissiveIntensity: 0.5
        });
        const point = new THREE.Mesh(pointGeometry, pointMaterial);
        point.position.set(3, 5, 4); // 注意Three.js中Y是向上的
        scene.add(point);
        
        // 从原点到点的向量
        const arrowHelper = new THREE.ArrowHelper(
            new THREE.Vector3(3, 5, 4).normalize(),
            new THREE.Vector3(0, 0, 0),
            Math.sqrt(3*3 + 5*5 + 4*4),
            0x00ffff,
            1,
            1
        );
        scene.add(arrowHelper);
        
        // 添加投影线
        const lineMaterial = new THREE.LineBasicMaterial({ 
            color: 0xffff00,
            linewidth: 2,
            transparent: true,
            opacity: 0.5
        });
        
        // XY平面投影
        const xyProjection = new THREE.BufferGeometry().setFromPoints([
            new THREE.Vector3(0, 0, 0),
            new THREE.Vector3(3, 0, 0),
            new THREE.Vector3(3, 0, 4),
            new THREE.Vector3(0, 0, 4),
            new THREE.Vector3(0, 0, 0)
        ]);
        const xyLine = new THREE.Line(xyProjection, lineMaterial);
        scene.add(xyLine);
        
        // 垂直线
        const verticalLine = new THREE.BufferGeometry().setFromPoints([
            new THREE.Vector3(3, 0, 4),
            new THREE.Vector3(3, 5, 4)
        ]);
        const vLine = new THREE.Line(verticalLine, lineMaterial);
        scene.add(vLine);
        
        // 信息面板
        const infoPanel = document.createElement('div');
        infoPanel.className = 'info-panel';
        infoPanel.innerHTML = `
            <h4>空间点 P(3, 4, 5)</h4>
            <p>X = 3（向右）</p>
            <p>Y = 4（向前）</p>
            <p>Z = 5（向上）</p>
            <p>距离 = ${Math.sqrt(3*3 + 4*4 + 5*5).toFixed(2)}</p>
        `;
        container.appendChild(infoPanel);
        
        // 控制面板
        const controlPanel = document.createElement('div');
        controlPanel.className = 'control-panel';
        controlPanel.innerHTML = `
            <button class="control-btn" onclick="resetView()">重置视角</button>
            <button class="control-btn" onclick="toggleRotation()">旋转开关</button>
        `;
        container.appendChild(controlPanel);
        
        let isRotating = true;
        
        window.resetView = function() {
            camera.position.set(10, 10, 10);
            camera.lookAt(0, 0, 0);
        };
        
        window.toggleRotation = function() {
            isRotating = !isRotating;
        };
        
        // 动画
        function animate() {
            const frame = requestAnimationFrame(animate);
            animationFrames.push(frame);
            
            if (isRotating) {
                scene.rotation.y += 0.005;
            }
            
            renderer.render(scene, camera);
        }
        animate();
        
        threeScenes['3d-coordinate'] = { scene, camera, renderer, container };
    }

    // 向量的模可视化
    function visualizeVectorMagnitude() {
        const container = d3.select('#vis-vector-magnitude');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        
        const rect = container.node().getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        
        if (width === 0 || height === 0) return;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const centerX = width / 2;
        const centerY = height / 2;
        const scale = 50;
        
        drawCoordinateSystem(svg, centerX, centerY, scale);
        
        // 向量 a = (3, 4)
        const ax = 3, ay = 4;
        drawVector(svg, centerX, centerY, ax, ay, scale, '#3498db', '→a');
        
        // 绘制长度标注
        const length = Math.sqrt(ax*ax + ay*ay);
        svg.append('text')
            .attr('x', centerX + ax * scale / 2)
            .attr('y', centerY - ay * scale / 2 - 10)
            .attr('fill', '#e74c3c')
            .attr('font-size', '18px')
            .attr('font-weight', 'bold')
            .text(`|→a| = ${length}`);
        
        // 显示计算过程
        const info = svg.append('g');
        info.append('text')
            .attr('x', 20)
            .attr('y', height - 60)
            .attr('fill', '#2c3e50')
            .attr('font-size', '16px')
            .text(`→a = (${ax}, ${ay})`);
        
        info.append('text')
            .attr('x', 20)
            .attr('y', height - 35)
            .attr('fill', '#2c3e50')
            .attr('font-size', '16px')
            .text(`|→a| = √(${ax}² + ${ay}²) = ${length}`);
    }

    // 第一部分过渡页可视化
    function visualizeSection1Transition() {
        const container = d3.select('#vis-section1-transition');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        // 空白或简单的装饰即可
    }

    // 第二部分过渡页可视化
    function visualizeSection2Transition() {
        const container = d3.select('#vis-section2-transition');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        // 空白或简单的装饰即可
    }

    // 第三部分过渡页可视化
    function visualizeSection3Transition() {
        const container = d3.select('#vis-section3-transition');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        // 空白或简单的装饰即可
    }

    // 混合积可视化
    function visualizeMixedProduct() {
        const container = d3.select('#vis-mixed-product');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        
        const rect = container.node().getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        
        if (width === 0 || height === 0) return;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 绘制平行六面体的示意图
        svg.append('text')
            .attr('x', width / 2)
            .attr('y', height / 2 - 30)
            .attr('text-anchor', 'middle')
            .attr('fill', '#3498db')
            .attr('font-size', '24px')
            .attr('font-weight', 'bold')
            .text('混合积的几何意义');
        
        svg.append('text')
            .attr('x', width / 2)
            .attr('y', height / 2 + 10)
            .attr('text-anchor', 'middle')
            .attr('fill', '#2c3e50')
            .attr('font-size', '18px')
            .text('|[→a, →b, →c]| = 平行六面体体积');
        
        svg.append('text')
            .attr('x', width / 2)
            .attr('y', height / 2 + 40)
            .attr('text-anchor', 'middle')
            .attr('fill', '#7f8c8d')
            .attr('font-size', '16px')
            .text('若混合积 = 0，则三向量共面');
    }

    // 空间直线方程可视化
    function visualizeLineEquation() {
        const container = d3.select('#vis-line-equation');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        
        const rect = container.node().getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        
        if (width === 0 || height === 0) return;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const centerX = width / 2;
        const centerY = height / 2;
        
        // 绘制直线示意图
        svg.append('line')
            .attr('x1', 50)
            .attr('y1', height - 50)
            .attr('x2', width - 50)
            .attr('y2', 50)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3);
        
        // 标注点和方向向量
        svg.append('circle')
            .attr('cx', centerX - 50)
            .attr('cy', centerY + 50)
            .attr('r', 6)
            .attr('fill', '#e74c3c');
        
        svg.append('text')
            .attr('x', centerX - 50)
            .attr('y', centerY + 75)
            .attr('text-anchor', 'middle')
            .attr('fill', '#2c3e50')
            .attr('font-size', '16px')
            .text('M₀(x₀, y₀, z₀)');
        
        // 方向向量
        svg.append('line')
            .attr('x1', centerX + 50)
            .attr('y1', centerY - 50)
            .attr('x2', centerX + 120)
            .attr('y2', centerY - 85)
            .attr('stroke', '#2ecc71')
            .attr('stroke-width', 2)
            .attr('marker-end', 'url(#arrowhead)');
        
        svg.append('text')
            .attr('x', centerX + 150)
            .attr('y', centerY - 80)
            .attr('fill', '#2ecc71')
            .attr('font-size', '16px')
            .text('→s');
    }

    // 空间平面方程可视化
    function visualizePlaneEquation() {
        const container = d3.select('#vis-plane-equation');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        
        const rect = container.node().getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        
        if (width === 0 || height === 0) return;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const centerX = width / 2;
        const centerY = height / 2;
        
        // 绘制平面示意图（椭圆形表示）
        svg.append('ellipse')
            .attr('cx', centerX)
            .attr('cy', centerY)
            .attr('rx', 150)
            .attr('ry', 80)
            .attr('fill', '#3498db')
            .attr('fill-opacity', 0.3)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2);
        
        // 法向量
        svg.append('line')
            .attr('x1', centerX)
            .attr('y1', centerY)
            .attr('x2', centerX)
            .attr('y2', centerY - 100)
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 3)
            .attr('marker-end', 'url(#arrowhead)');
        
        svg.append('text')
            .attr('x', centerX + 15)
            .attr('y', centerY - 50)
            .attr('fill', '#e74c3c')
            .attr('font-size', '18px')
            .attr('font-weight', 'bold')
            .text('→n');
        
        svg.append('text')
            .attr('x', centerX)
            .attr('y', height - 30)
            .attr('text-anchor', 'middle')
            .attr('fill', '#2c3e50')
            .attr('font-size', '16px')
            .text('法向量垂直于平面');
    }

    // 点到平面距离可视化
    function visualizeDistance() {
        const container = d3.select('#vis-distance');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        
        const rect = container.node().getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        
        if (width === 0 || height === 0) return;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 绘制平面
        svg.append('line')
            .attr('x1', 50)
            .attr('y1', height - 100)
            .attr('x2', width - 50)
            .attr('y2', height - 100)
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3);
        
        // 绘制点
        const px = width / 2;
        const py = height / 2 - 50;
        svg.append('circle')
            .attr('cx', px)
            .attr('cy', py)
            .attr('r', 8)
            .attr('fill', '#e74c3c');
        
        svg.append('text')
            .attr('x', px + 15)
            .attr('y', py)
            .attr('fill', '#2c3e50')
            .attr('font-size', '16px')
            .text('P');
        
        // 绘制垂直距离
        svg.append('line')
            .attr('x1', px)
            .attr('y1', py)
            .attr('x2', px)
            .attr('y2', height - 100)
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '5,5');
        
        svg.append('text')
            .attr('x', px + 15)
            .attr('y', (py + height - 100) / 2)
            .attr('fill', '#e74c3c')
            .attr('font-size', '18px')
            .attr('font-weight', 'bold')
            .text('d');
    }

    // 两向量夹角可视化
    function visualizeAngle() {
        const container = d3.select('#vis-angle');
        if (container.empty()) return;
        
        container.selectAll('*').remove();
        
        const rect = container.node().getBoundingClientRect();
        const width = rect.width;
        const height = rect.height;
        
        if (width === 0 || height === 0) return;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const centerX = width / 2;
        const centerY = height / 2;
        const scale = 60;
        
        drawCoordinateSystem(svg, centerX, centerY, scale);
        
        // 向量 a = (3, 2)
        const ax = 3, ay = 2;
        drawVector(svg, centerX, centerY, ax, ay, scale, '#3498db', '→a');
        
        // 向量 b = (1, 3)
        const bx = 1, by = 3;
        drawVector(svg, centerX, centerY, bx, by, scale, '#2ecc71', '→b');
        
        // 绘制夹角弧线
        const startAngle = 0;
        const endAngle = Math.atan2(by, bx);
        const arcRadius = 40;
        
        const arc = d3.arc()
            .innerRadius(arcRadius)
            .outerRadius(arcRadius + 2)
            .startAngle(startAngle)
            .endAngle(endAngle);
        
        svg.append('path')
            .attr('d', arc)
            .attr('fill', 'none')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('transform', `translate(${centerX}, ${centerY}) rotate(${Math.atan2(ay, ax) * 180 / Math.PI})`);
        
        svg.append('text')
            .attr('x', centerX + 50)
            .attr('y', centerY - 30)
            .attr('fill', '#e74c3c')
            .attr('font-size', '18px')
            .text('θ');
        
        // 显示夹角值
        const dotProduct = ax * bx + ay * by;
        const magA = Math.sqrt(ax*ax + ay*ay);
        const magB = Math.sqrt(bx*bx + by*by);
        const cosTheta = dotProduct / (magA * magB);
        
        svg.append('text')
            .attr('x', 20)
            .attr('y', height - 30)
            .attr('fill', '#2c3e50')
            .attr('font-size', '16px')
            .text(`cos θ = ${cosTheta.toFixed(3)}`);
    }

    // 辅助函数：绘制坐标系
    function drawCoordinateSystem(svg, centerX, centerY, scale) {
        const g = svg.append('g');
        
        // X轴
        g.append('line')
            .attr('x1', 0)
            .attr('y1', centerY)
            .attr('x2', svg.attr('width') || centerX * 2)
            .attr('y2', centerY)
            .attr('stroke', 'rgba(255, 255, 255, 0.3)')
            .attr('stroke-width', 1);
        
        // Y轴
        g.append('line')
            .attr('x1', centerX)
            .attr('y1', 0)
            .attr('x2', centerX)
            .attr('y2', svg.attr('height') || centerY * 2)
            .attr('stroke', 'rgba(255, 255, 255, 0.3)')
            .attr('stroke-width', 1);
        
        // 网格线
        for (let i = -10; i <= 10; i++) {
            if (i !== 0) {
                // 竖线
                g.append('line')
                    .attr('x1', centerX + i * scale)
                    .attr('y1', 0)
                    .attr('x2', centerX + i * scale)
                    .attr('y2', centerY * 2)
                    .attr('stroke', 'rgba(255, 255, 255, 0.1)')
                    .attr('stroke-width', 0.5);
                
                // 横线
                g.append('line')
                    .attr('x1', 0)
                    .attr('y1', centerY + i * scale)
                    .attr('x2', centerX * 2)
                    .attr('y2', centerY + i * scale)
                    .attr('stroke', 'rgba(255, 255, 255, 0.1)')
                    .attr('stroke-width', 0.5);
            }
        }
        
        // 坐标轴标签
        g.append('text')
            .attr('x', centerX * 2 - 20)
            .attr('y', centerY - 10)
            .attr('fill', 'rgba(255, 255, 255, 0.7)')
            .style('font-size', '14px')
            .text('X');
        
        g.append('text')
            .attr('x', centerX + 10)
            .attr('y', 20)
            .attr('fill', 'rgba(255, 255, 255, 0.7)')
            .style('font-size', '14px')
            .text('Y');
    }

    // 辅助函数：绘制动画向量
    function drawAnimatedVector(g, x1, y1, dx, dy, color, delay, label) {
        const group = g.append('g');
        
        // 向量主体
        const line = group.append('line')
            .attr('x1', x1)
            .attr('y1', y1)
            .attr('x2', x1)
            .attr('y2', y1)
            .attr('stroke', color)
            .attr('stroke-width', 3)
            .style('filter', `drop-shadow(0 0 10px ${color})`);
        
        line.transition()
            .delay(delay)
            .duration(1000)
            .attr('x2', x1 + dx)
            .attr('y2', y1 + dy);
        
        // 箭头
        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
        const arrow = group.append('polygon')
            .attr('points', '0,0 -15,-5 -15,5')
            .attr('fill', color)
            .attr('transform', `translate(${x1 + dx}, ${y1 + dy}) rotate(${angle})`)
            .style('opacity', 0);
        
        arrow.transition()
            .delay(delay + 1000)
            .duration(500)
            .style('opacity', 1);
        
        // 标签
        if (label) {
            group.append('text')
                .attr('x', x1 + dx / 2)
                .attr('y', y1 + dy / 2 - 10)
                .attr('text-anchor', 'middle')
                .attr('fill', color)
                .style('font-size', '14px')
                .style('font-weight', 'bold')
                .text(label)
                .style('opacity', 0)
                .transition()
                .delay(delay + 1200)
                .duration(500)
                .style('opacity', 1);
        }
    }

    // 渲染MathJax公式
    if (window.MathJax) {
        window.MathJax.startup.defaultReady();
    }

    // —— 例题步骤渲染与可视化 ——
    function renderSteps12(containerId, steps){
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        const wrap = document.createElement('div');
        wrap.style.cssText = 'width:100%;height:100%;padding:24px;overflow:auto;';
        steps.forEach((s,i)=>{
            const d = document.createElement('div');
            d.className = 'tex2jax_process';
            d.style.cssText = 'margin:8px 0;line-height:1.9;font-size:16px;opacity:0;transition:opacity .3s';
            d.innerHTML = s;
            wrap.appendChild(d);
            setTimeout(()=>{ d.style.opacity='1'; }, 80*i);
        });
        container.appendChild(wrap);
        if (window.MathJax && window.MathJax.typesetPromise) {
            setTimeout(()=> window.MathJax.typesetPromise([wrap]).catch(()=>{}), 120);
        }
    }

    function visualizeExampleAdd(){
        renderSteps12('vis-example-add', [
            '计算：$\\vec a+\\vec b=(2,1)+(-1,3)=(1,4)$',
            '几何：平行四边形法，结果为对角线向量',
            '分量：先加 x 再加 y，更直观'
        ]);
    }

    function visualizeExampleDotSteps(){
        renderSteps12('vis-example-dot-steps', [
            '点积：$\\vec a\\cdot\\vec b=1\\cdot2+2\\cdot3+2\\cdot6=20$',
            '模长：$|\\vec a|=3,\; |\\vec b|=7$',
            '夹角：$\\cos\\theta=\\dfrac{20}{3\\cdot7}=\\dfrac{20}{21}$'
        ]);
    }

    function visualizeExampleLineParam(){
        renderSteps12('vis-example-line', [
            '方向：$\\overrightarrow{AB}=(3-1,1-2,2-0)=(2,-1,2)$',
            '参数式：$x=1+2t,\; y=2-t,\; z=2t$',
            '理解：以 $A$ 为起点，沿方向向量移动 $t$ 倍'
        ]);
    }
</script>

<style>
/* 悬浮控制与面板（统一样式） */
.floating-control-btn { position: fixed; bottom: 20px; left: 20px; width: 56px; height: 56px; border: none; border-radius: 16px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1100; background: rgba(15,23,42,0.7); color: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.25); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); transition: transform .2s ease, box-shadow .2s ease; }
.floating-control-btn:hover { transform: translateY(-2px); box-shadow: 0 16px 36px rgba(0,0,0,0.32); }
.floating-control-btn .btn-icon { font-size: 22px; font-weight: 700; }
.floating-menu-items { position: fixed; bottom: 20px; left: 86px; display: none; gap: 10px; z-index: 1100; }
.floating-menu-items.active { display: flex; }
.floating-menu-item { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 14px; cursor: pointer; background: rgba(255,255,255,0.9); color: #0f172a; box-shadow: 0 10px 30px rgba(0,0,0,0.18); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); transition: transform .18s ease, box-shadow .18s ease; }
.floating-menu-item:hover { transform: translateY(-1px); box-shadow: 0 14px 36px rgba(0,0,0,0.24); }
.floating-menu-item .item-icon { font-size: 16px; width: 18px; text-align: center; }
.lab-submenu, .chapter-submenu { position: fixed; left: 20px; bottom: 86px; display: none; z-index: 1100; }
.course-submenu { position: fixed; right: 20px; top: 70px; display: none; z-index: 1100; }
.submenu-content { position: relative; width: min(920px, calc(100vw - 40px)); max-height: min(70vh, 620px); overflow-y: auto; background: rgba(255,255,255,0.88); border: 1px solid rgba(0,0,0,0.06); border-radius: 16px; padding: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.25); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
.submenu-title { font-weight: 700; color: #0f172a; margin-bottom: 10px; }
.submenu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; }
.submenu-item { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 12px; cursor: pointer; background: rgba(255,255,255,0.95); border: 1px solid rgba(0,0,0,0.05); transition: background .15s ease, transform .15s ease; }
.submenu-item:hover { background: rgba(241,245,249,0.95); transform: translateY(-1px); }
.submenu-icon { width: 18px; text-align: center; color: #64748b; }
.submenu-text { color: #111827; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.submenu-close { position: absolute; right: 10px; top: 6px; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; background: rgba(0,0,0,0.55); color: #fff; font-weight: 700; }
.submenu-close:hover { background: rgba(0,0,0,0.72); }
</style>

<!-- 悬浮主按钮与二级菜单 -->
<button id="floating-control-btn" class="floating-control-btn" title="工具菜单" aria-label="工具菜单"><span class="btn-icon">≡</span></button>
<div class="floating-menu-items" id="floating-menu-items">
    <div class="floating-menu-item" onclick="event.stopPropagation(); toggleLabSubmenu()">
        <span class="item-icon"><i class="fa-solid fa-flask"></i></span>
        <span class="item-text">实验室</span>
    </div>
    <div class="floating-menu-item" onclick="event.stopPropagation(); toggleChapterSubmenu()">
        <span class="item-icon"><i class="fa-solid fa-clipboard-list"></i></span>
        <span class="item-text">本章目录</span>
    </div>
</div>

<!-- 子面板：实验室 -->
<div class="lab-submenu" id="lab-submenu">
    <div class="submenu-content">
        <div class="submenu-close" onclick="closeAllSubmenus()">×</div>
        <div class="submenu-title">第十二章 · 实验室与资源</div>
        <div class="submenu-grid">
            <a class="submenu-item" href="../网页资源/index.html" target="_blank">
                <span class="submenu-icon"><i class="fa-solid fa-layer-group"></i></span>
                <span class="submenu-text">资源总览</span>
            </a>
            <a class="submenu-item" href="../网页资源/lab 12-1.html" target="_blank"><span class="submenu-icon"><i class="fa-solid fa-flask"></i></span><span class="submenu-text">Lab 12-1</span></a>
            <a class="submenu-item" href="../网页资源/lab 12-2.html" target="_blank"><span class="submenu-icon"><i class="fa-solid fa-flask"></i></span><span class="submenu-text">Lab 12-2</span></a>
            <a class="submenu-item" href="../网页资源/lab 12-3.html" target="_blank"><span class="submenu-icon"><i class="fa-solid fa-flask"></i></span><span class="submenu-text">Lab 12-3</span></a>
            <a class="submenu-item" href="../网页资源/lab 12-4.html" target="_blank"><span class="submenu-icon"><i class="fa-solid fa-flask"></i></span><span class="submenu-text">Lab 12-4</span></a>
            <a class="submenu-item" href="../网页资源/lab 12-5.html" target="_blank"><span class="submenu-icon"><i class="fa-solid fa-flask"></i></span><span class="submenu-text">Lab 12-5</span></a>
            <a class="submenu-item" href="../网页资源/lab 12-6.html" target="_blank"><span class="submenu-icon"><i class="fa-solid fa-flask"></i></span><span class="submenu-text">Lab 12-6</span></a>
        </div>
    </div>
    </div>

<!-- 子面板：本章目录（动态） -->
<div class="chapter-submenu" id="chapter-submenu">
    <div class="submenu-content">
        <div class="submenu-close" onclick="closeAllSubmenus()">×</div>
        <div class="submenu-title">本章目录</div>
        <div class="submenu-grid" id="ch12-menu-grid"></div>
    </div>
</div>

<!-- 子面板：课程目录 -->
<div class="course-submenu" id="course-submenu">
    <div class="submenu-content">
        <div class="submenu-close" onclick="closeAllSubmenus()">×</div>
        <div class="submenu-title">全部课程目录</div>
        <div class="submenu-grid">
            <a class="submenu-item" href="第1章代数.html"><span class="submenu-text">第1章 代数</span></a>
            <a class="submenu-item" href="第2章极限与连续.html"><span class="submenu-text">第2章 极限与连续</span></a>
            <a class="submenu-item" href="第3章导数与微分.html"><span class="submenu-text">第3章 导数与微分</span></a>
            <a class="submenu-item" href="第4章导数应用.html"><span class="submenu-text">第4章 导数应用</span></a>
            <a class="submenu-item" href="第5章不定积分.html"><span class="submenu-text">第5章 不定积分</span></a>
            <a class="submenu-item" href="第6章定积分.html"><span class="submenu-text">第6章 定积分</span></a>
            <a class="submenu-item" href="第7章常微分方程.html"><span class="submenu-text">第7章 常微分方程</span></a>
            <a class="submenu-item" href="第8章多元函数微分学.html"><span class="submenu-text">第8章 多元函数微分学</span></a>
            <a class="submenu-item" href="第9章多元函数积分学初步.html"><span class="submenu-text">第9章 多元函数积分学初步</span></a>
            <a class="submenu-item" href="第10章线性代数.html"><span class="submenu-text">第10章 线性代数</span></a>
            <a class="submenu-item" href="第11章无穷级数.html"><span class="submenu-text">第11章 无穷级数</span></a>
            <a class="submenu-item" href="第12章向量代数与空间解析几何.html"><span class="submenu-text">第12章 向量代数与空间解析几何</span></a>
            <a class="submenu-item" href="第13章概率与统计.html"><span class="submenu-text">第13章 概率与统计</span></a>
        </div>
    </div>
</div>

<script>
// 统一的开合控制
function closeAllSubmenus() {
    document.getElementById('floating-menu-items')?.classList.remove('active');
    document.getElementById('lab-submenu')?.style && (document.getElementById('lab-submenu').style.display = 'none');
    document.getElementById('chapter-submenu')?.style && (document.getElementById('chapter-submenu').style.display = 'none');
    document.getElementById('course-submenu')?.style && (document.getElementById('course-submenu').style.display = 'none');
}
function toggleLabSubmenu(){
    const el = document.getElementById('lab-submenu');
    if(!el) return; 
    document.getElementById('chapter-submenu')?.style && (document.getElementById('chapter-submenu').style.display = 'none');
    document.getElementById('course-submenu')?.style && (document.getElementById('course-submenu').style.display = 'none');
    el.style.display = (el.style.display === 'block') ? 'none' : 'block';
}
function toggleChapterSubmenu(){
    const el = document.getElementById('chapter-submenu');
    if(!el) return;
    document.getElementById('lab-submenu')?.style && (document.getElementById('lab-submenu').style.display = 'none');
    document.getElementById('course-submenu')?.style && (document.getElementById('course-submenu').style.display = 'none');
    el.style.display = (el.style.display === 'block') ? 'none' : 'block';
}
function toggleCourseSubmenu(){
    const el = document.getElementById('course-submenu');
    if(!el) return;
    document.getElementById('lab-submenu')?.style && (document.getElementById('lab-submenu').style.display = 'none');
    document.getElementById('chapter-submenu')?.style && (document.getElementById('chapter-submenu').style.display = 'none');
    el.style.display = (el.style.display === 'block') ? 'none' : 'block';
}

// 构建本章目录（通用）
function buildChapterMenuCh12(){
    const grid = document.getElementById('ch12-menu-grid');
    if(!grid) return;
    grid.innerHTML = '';
    const slides = Array.from(document.querySelectorAll('#slidesContainer > .slide'));
    slides.forEach((slide, idx) => {
        const t1 = slide.querySelector('.left-content h1');
        const t2 = slide.querySelector('.left-content h2');
        const t3 = slide.querySelector('.left-content h3');
        const title = ((t1 && t1.textContent) || (t2 && t2.textContent) || (t3 && t3.textContent) || '').trim();
        if(!title) return;
        const item = document.createElement('div');
        item.className = 'submenu-item';
        item.innerHTML = '<span class="submenu-icon"><i class="fa-solid fa-file"></i></span><span class="submenu-text"></span>';
        item.querySelector('.submenu-text').textContent = title;
        item.addEventListener('click', () => { if (typeof window.goToSlide === 'function') { window.goToSlide(idx); } closeAllSubmenus(); });
        grid.appendChild(item);
    });
}

// 初始化悬浮控制
function initFloatingControl(){
    const btn = document.getElementById('floating-control-btn');
    const menu = document.getElementById('floating-menu-items');
    if(btn && menu){
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); menu.classList.toggle('active'); });
    }
    document.addEventListener('click', ()=> closeAllSubmenus());
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeAllSubmenus(); });
    // 防止点击子面板触发关闭
    ['lab-submenu','chapter-submenu','course-submenu'].forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.addEventListener('click', (e)=> e.stopPropagation());
    });
    buildChapterMenuCh12();
}

window.addEventListener('DOMContentLoaded', initFloatingControl);

// 兼容跳转
window.goToSlide = window.goToSlide || function(index){
    try{
        if (typeof window.showSlide === 'function') window.showSlide(index);
        else if (typeof window.jumpToSlide === 'function') window.jumpToSlide(index + 1);
    }catch(e){}
};
</script>

</body>
</html>
