<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>为什么 f'(x)=0 只是"嫌疑点"？</title>
    
    <!-- MathJax 配置 - 只保留内联配置，避免冲突 -->
    <script>
        window.onerror = function(msg, url, line, col, error) {
            console.error('页面错误:', msg, 'at', line + ':' + col);
            return true;
        };
    </script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                pageReady: () => {
                    return window.MathJax.startup.defaultPageReady().then(() => {
                        console.log('MathJax is ready!');
                    });
                }
            }
        };
    </script>
    <script async id="MathJax-script" type="text/javascript" src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js"></script>

    <!-- Font Awesome 图标库 -->
    <link rel="stylesheet" href="../common-assets/css/fontawesome.min.css">
    <link rel="stylesheet" href="../common-assets/css/solid.min.css">

    <style>
        /* === RESET AND BASE STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            height: 100%;
        }

        body {
            font-family: 'Inter', 'Source Han Sans SC', 'Noto Sans SC', 'Microsoft YaHei', system-ui, -apple-system, sans-serif;
            background: #FAFAFA;
            overflow: hidden;
            color: #1a1a1a;
            height: 100%;
            line-height: 1.6;
            font-weight: 400;
        }

        /* === SLIDE LAYOUT === */
        .slide-container {
            width: 100%;
            height: 100vh;
            display: flex;
            position: relative;
            gap: 0;
            padding: 0;
        }

        /* Left Content Area - Academic Journal Style */
        .left-content {
            width: 50%;
            height: 100vh;
            padding: 60px 80px 60px 60px;
            background: #FBFBFB;
            overflow-y: auto;
            font-size: 16px;
            line-height: 1.6;
            border: none;
            box-shadow: none;
            border-radius: 0;
        }

        /* Right Visualization Area - Subtle Contrast */
        .right-visual {
            width: 50%;
            height: 100vh;
            background: #F8F9FA;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: none;
            box-shadow: none;
            border-radius: 0;
            padding: 40px;
        }

        /* === SLIDE TRANSITIONS === */
        .slide {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .slide.active {
            display: flex;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* === 统一的字体系统 === */
        h1 {
            color: #003366;
            font-size: 24px;
            line-height: 1.2;
            font-weight: 700;
            margin: 0 0 16px 0;
            padding: 0;
            letter-spacing: -0.02em;
        }

        h2 {
            color: #008080;
            font-size: 20px;
            line-height: 1.3;
            font-weight: 600;
            margin: 20px 0 12px 0;
            position: relative;
            padding-left: 0;
        }

        h2::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #008080;
            border-radius: 2px;
        }

        h3 {
            color: #1a1a1a;
            font-size: 18px;
            line-height: 1.3;
            font-weight: 600;
            margin: 16px 0 8px 0;
        }

        p {
            margin-bottom: 12px;
            color: #2d2d2d;
            font-weight: 400;
            font-size: 15px;
            line-height: 1.5;
        }

        /* 特殊样式 */
        .highlight {
            background: rgba(59, 130, 246, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
            color: #2563eb;
            font-weight: 500;
        }

        .formula-highlight {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 16px;
            margin: 20px 0;
            border-radius: 4px;
        }

        /* 图形容器 */
        .graph-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            padding: 20px;
        }

        canvas {
            flex: 1;
            width: 100%;
            cursor: crosshair;
            display: block;
            border-radius: 8px;
        }

        /* 控制面板 */
        .controls-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .control-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .control-button.active {
            background: #10b981;
        }

        /* 信息面板 */
        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            min-width: 150px;
        }

        .info-panel strong {
            color: #1a1a1a;
            font-weight: 600;
        }

        .info-panel span {
            color: #3b82f6;
            font-weight: 500;
        }

        /* 导航按钮 */
        .nav-buttons {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .nav-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 24px;
            font-size: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: #2563eb;
            transform: scale(1.02);
        }

        .nav-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: scale(1);
        }

        /* 幻灯片计数器 */
        .slide-counter {
            position: fixed;
            top: 30px;
            right: 30px;
            font-size: 16px;
            color: #64748b;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        /* 工具提示 */
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 13px;
            pointer-events: none;
            display: none;
            z-index: 1000;
        }

        /* 重点说明框 */
        .key-point {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            padding: 12px 16px;
            border-radius: 6px;
            margin: 16px 0;
            font-size: 14px;
            color: #92400e;
        }

        .key-point strong {
            color: #78350f;
        }

        /* 响应式设计 */
        @media (max-width: 1024px) {
            .slide-container {
                flex-direction: column;
            }

            .left-content, .right-visual {
                width: 100%;
                height: 50vh;
                padding: 30px;
            }

            .left-content {
                padding: 30px 40px;
            }

            h1 {
                font-size: 20px;
            }

            h2 {
                font-size: 18px;
            }

            h3 {
                font-size: 16px;
            }

            .control-button {
                font-size: 12px;
                padding: 6px 12px;
            }
        }

        @media (max-width: 768px) {
            .left-content {
                padding: 20px;
            }

            .right-visual {
                padding: 20px;
            }

            .nav-buttons {
                bottom: 20px;
                gap: 10px;
            }

            .nav-btn {
                padding: 8px 16px;
                font-size: 14px;
            }

            .slide-counter {
                top: 20px;
                right: 20px;
                font-size: 14px;
                padding: 6px 12px;
            }

            .info-panel {
                font-size: 12px;
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="slide-counter"><span id="currentSlide">1</span> / 3</div>
    <div class="tooltip" id="tooltip"></div>

    <!-- 幻灯片 1: 局部最大值 -->
    <div class="slide active">
        <div class="slide-container">
            <div class="left-content">
                <h1>为什么 f'(x)=0 只是"嫌疑点"？</h1>
                <h2>1. 局部最大值 (山顶)</h2>
                
                <p>想象你在爬山，当你到达<span class="highlight">山顶</span>时，会发生什么？</p>
                
                <h3>关键观察</h3>
                <p>在山顶的那一刻，你既不是在上坡，也不是在下坡——你处于<strong>水平状态</strong>。</p>
                
                <div class="formula-highlight">
                    <p><strong>数学表达：</strong>在极大值点 $x_0$ 处，有 $f'(x_0) = 0$</p>
                    <p><strong>几何意义：</strong>切线是水平的（斜率为0）</p>
                </div>
                
                <h3>判断极大值的方法</h3>
                <p>在 $x_0$ 附近：</p>
                <p>• 左侧：$f'(x) > 0$（函数递增，像上坡）</p>
                <p>• 右侧：$f'(x) < 0$（函数递减，像下坡）</p>
                
                <div class="key-point">
                    <strong>记忆口诀：</strong>"左增右减是山顶"——这是真正的极大值点！
                </div>
                
                <p style="color: #3b82f6; margin-top: 20px;">
                    <i class="fas fa-hand-pointer"></i> 
                    <strong>互动提示：</strong>点击右侧图形查看任意点的切线和导数值
                </p>
            </div>
            
            <div class="right-visual">
                <div class="graph-container">
                    <canvas id="maxCanvas"></canvas>
                    <div class="info-panel" id="maxInfo" style="display: none;">
                        <strong>点击信息</strong><br>
                        x = <span id="maxX">0</span><br>
                        y = <span id="maxY">0</span><br>
                        f'(x) = <span id="maxDerivative">0</span>
                    </div>
                    <div class="controls-panel">
                        <button class="control-button" onclick="toggleAnimation('max')">
                            <i class="fas fa-play"></i>
                            <span>播放动画</span>
                        </button>
                        <button class="control-button active" onclick="toggleTangent('max')">
                            <i class="fas fa-ruler-horizontal"></i>
                            <span>显示切线</span>
                        </button>
                        <button class="control-button" onclick="toggleDerivative('max')">
                            <i class="fas fa-chart-line"></i>
                            <span>显示导数</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 幻灯片 2: 局部最小值 -->
    <div class="slide">
        <div class="slide-container">
            <div class="left-content">
                <h1>为什么 f'(x)=0 只是"嫌疑点"？</h1>
                <h2>2. 局部最小值 (谷底)</h2>
                
                <p>现在想象你在<span class="highlight">山谷</span>的最低处，情况又如何？</p>
                
                <h3>关键观察</h3>
                <p>在谷底，你同样处于<strong>水平状态</strong>——既不是下坡，也不是上坡。</p>
                
                <div class="formula-highlight">
                    <p><strong>数学表达：</strong>在极小值点 $x_0$ 处，有 $f'(x_0) = 0$</p>
                    <p><strong>几何意义：</strong>切线是水平的（斜率为0）</p>
                </div>
                
                <h3>判断极小值的方法</h3>
                <p>在 $x_0$ 附近：</p>
                <p>• 左侧：$f'(x) < 0$（函数递减，像下坡）</p>
                <p>• 右侧：$f'(x) > 0$（函数递增，像上坡）</p>
                
                <div class="key-point">
                    <strong>记忆口诀：</strong>"左减右增是谷底"——这是真正的极小值点！
                </div>
                
                <h3>实际应用</h3>
                <p>极小值在优化问题中非常重要，比如：</p>
                <p>• 最小成本</p>
                <p>• 最短路径</p>
                <p>• 最少时间</p>
                
                <p style="color: #3b82f6; margin-top: 20px;">
                    <i class="fas fa-hand-pointer"></i> 
                    <strong>互动提示：</strong>试试点击动画按钮，观察导数如何变化
                </p>
            </div>
            
            <div class="right-visual">
                <div class="graph-container">
                    <canvas id="minCanvas"></canvas>
                    <div class="info-panel" id="minInfo" style="display: none;">
                        <strong>点击信息</strong><br>
                        x = <span id="minX">0</span><br>
                        y = <span id="minY">0</span><br>
                        f'(x) = <span id="minDerivative">0</span>
                    </div>
                    <div class="controls-panel">
                        <button class="control-button" onclick="toggleAnimation('min')">
                            <i class="fas fa-play"></i>
                            <span>播放动画</span>
                        </button>
                        <button class="control-button active" onclick="toggleTangent('min')">
                            <i class="fas fa-ruler-horizontal"></i>
                            <span>显示切线</span>
                        </button>
                        <button class="control-button" onclick="toggleDerivative('min')">
                            <i class="fas fa-chart-line"></i>
                            <span>显示导数</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 幻灯片 3: 拐点 -->
    <div class="slide">
        <div class="slide-container">
            <div class="left-content">
                <h1>为什么 f'(x)=0 只是"嫌疑点"？</h1>
                <h2>3. 拐点 (半山腰平台)</h2>
                
                <p>但是！不是所有 $f'(x) = 0$ 的点都是极值点。看看这个<span class="highlight">特殊情况</span>：</p>
                
                <h3>拐点的特征</h3>
                <p>在某些点，虽然切线是水平的，但函数<strong>一直在增加</strong>（或一直在减少）。</p>
                
                <div class="formula-highlight">
                    <p><strong>例子：</strong>$f(x) = x^3$ 在 $x = 0$ 处</p>
                    <p>• $f'(0) = 0$（切线水平）</p>
                    <p>• 但 $x < 0$ 时 $f'(x) > 0$，$x > 0$ 时 $f'(x) > 0$</p>
                    <p>• 函数始终递增，<strong>不是极值点！</strong></p>
                </div>
                
                <h3>为什么会这样？</h3>
                <p>想象在爬山途中遇到一个<strong>平台</strong>：</p>
                <p>• 你暂时走在水平路上（$f'(x) = 0$）</p>
                <p>• 但整体趋势仍是上山（函数递增）</p>
                <p>• 这只是一个"喘息点"，不是山顶或谷底</p>
                
                <div class="key-point">
                    <strong>重要结论：</strong>$f'(x) = 0$ 只是极值点的<strong>必要条件</strong>，不是充分条件。
                    这就是为什么我们称它为"嫌疑点"——需要进一步检验！
                </div>
                
                <h3>判断方法总结</h3>
                <p><strong>第一步：</strong>找出所有 $f'(x) = 0$ 的点（嫌疑点）</p>
                <p><strong>第二步：</strong>检查每个点两侧导数的符号变化</p>
                <p><strong>第三步：</strong>只有符号发生变化的点才是真正的极值点</p>
            </div>
            
            <div class="right-visual">
                <div class="graph-container">
                    <canvas id="inflectionCanvas"></canvas>
                    <div class="info-panel" id="inflectionInfo" style="display: none;">
                        <strong>点击信息</strong><br>
                        x = <span id="inflectionX">0</span><br>
                        y = <span id="inflectionY">0</span><br>
                        f'(x) = <span id="inflectionDerivative">0</span>
                    </div>
                    <div class="controls-panel">
                        <button class="control-button" onclick="toggleAnimation('inflection')">
                            <i class="fas fa-play"></i>
                            <span>播放动画</span>
                        </button>
                        <button class="control-button active" onclick="toggleTangent('inflection')">
                            <i class="fas fa-ruler-horizontal"></i>
                            <span>显示切线</span>
                        </button>
                        <button class="control-button" onclick="toggleDerivative('inflection')">
                            <i class="fas fa-chart-line"></i>
                            <span>显示导数</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSlide = 1;
        const totalSlides = 3;
        
        // 状态管理
        const graphStates = {
            max: { animation: false, tangent: true, derivative: false, clickPoint: null },
            min: { animation: false, tangent: true, derivative: false, clickPoint: null },
            inflection: { animation: false, tangent: true, derivative: false, clickPoint: null }
        };
        
        // 动画相关
        let animationFrames = {};
        let animationProgress = {};

        // Canvas 高DPI支持
        function setupCanvas(canvas) {
            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            
            ctx.scale(dpr, dpr);
            
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            
            return ctx;
        }

        function showSlide(n) {
            const slides = document.querySelectorAll('.slide');
            if (n > totalSlides) currentSlide = totalSlides;
            if (n < 1) currentSlide = 1;
            
            slides.forEach(slide => slide.classList.remove('active'));
            slides[currentSlide - 1].classList.add('active');
            
            document.getElementById('currentSlide').textContent = currentSlide;
            
            // 停止所有动画
            Object.keys(animationFrames).forEach(key => {
                if (animationFrames[key]) {
                    cancelAnimationFrame(animationFrames[key]);
                    animationFrames[key] = null;
                }
            });
            
            // 绘制当前幻灯片的图形
            setTimeout(() => drawCurrentSlide(), 100);
        }

        function nextSlide() {
            currentSlide++;
            showSlide(currentSlide);
        }

        function prevSlide() {
            currentSlide--;
            showSlide(currentSlide);
        }

        function drawCurrentSlide() {
            if (currentSlide === 1) drawMaximum();
            if (currentSlide === 2) drawMinimum();
            if (currentSlide === 3) drawInflection();
        }

        // 绘制局部最大值
        function drawMaximum() {
            const canvas = document.getElementById('maxCanvas');
            const ctx = setupCanvas(canvas);
            const rect = canvas.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const padding = 40;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // 绘制坐标轴
            drawAxes(ctx, width, height, padding);
            
            // 绘制函数 f(x) = -x^2 + 2
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let px = padding; px < width - padding; px++) {
                const x = ((px - centerX) / (width - 2 * padding)) * 6;
                const y = -x * x + 2;
                const py = centerY - y * 50;
                
                if (px === padding) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
            
            const state = graphStates.max;
            
            // 标记极值点或点击点
            const targetX = state.clickPoint ? state.clickPoint.x : 0;
            const targetY = -targetX * targetX + 2;
            const targetPx = centerX + targetX * (width - 2 * padding) / 6;
            const targetPy = centerY - targetY * 50;
            
            // 绘制点
            ctx.fillStyle = state.clickPoint ? '#f59e0b' : '#ef4444';
            ctx.beginPath();
            ctx.arc(targetPx, targetPy, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // 显示切线
            if (state.tangent) {
                const derivative = -2 * targetX;
                const xScale = (width - 2 * padding) / 6;
                drawTangentLine(ctx, targetPx, targetPy, derivative, width, 50, xScale);
            }
            
            // 显示导数图
            if (state.derivative) {
                drawDerivativeGraph(ctx, width, height, padding, centerX, centerY, 
                    (x) => -2 * x, '#10b981');
            }
            
            // 更新信息面板
            if (state.clickPoint) {
                document.getElementById('maxInfo').style.display = 'block';
                document.getElementById('maxX').textContent = targetX.toFixed(2);
                document.getElementById('maxY').textContent = targetY.toFixed(2);
                document.getElementById('maxDerivative').textContent = (-2 * targetX).toFixed(2);
            }
            
            // 添加标签
            ctx.fillStyle = '#1e293b';
            ctx.font = '14px sans-serif';
            ctx.fillText('f(x) = -x² + 2', padding + 10, padding + 20);
            
            if (state.derivative) {
                ctx.fillStyle = '#10b981';
                ctx.fillText("f'(x) = -2x", padding + 10, padding + 40);
            }
        }

        // 绘制局部最小值
        function drawMinimum() {
            const canvas = document.getElementById('minCanvas');
            const ctx = setupCanvas(canvas);
            const rect = canvas.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const padding = 40;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // 绘制坐标轴
            drawAxes(ctx, width, height, padding);
            
            // 绘制函数 f(x) = x^2 - 2
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let px = padding; px < width - padding; px++) {
                const x = ((px - centerX) / (width - 2 * padding)) * 6;
                const y = x * x - 2;
                const py = centerY - y * 50;
                
                if (px === padding) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
            
            const state = graphStates.min;
            
            // 标记极值点或点击点
            const targetX = state.clickPoint ? state.clickPoint.x : 0;
            const targetY = targetX * targetX - 2;
            const targetPx = centerX + targetX * (width - 2 * padding) / 6;
            const targetPy = centerY - targetY * 50;
            
            // 绘制点
            ctx.fillStyle = state.clickPoint ? '#f59e0b' : '#ef4444';
            ctx.beginPath();
            ctx.arc(targetPx, targetPy, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // 显示切线
            if (state.tangent) {
                const derivative = 2 * targetX;
                const xScale = (width - 2 * padding) / 6;
                drawTangentLine(ctx, targetPx, targetPy, derivative, width, 50, xScale);
            }
            
            // 显示导数图
            if (state.derivative) {
                drawDerivativeGraph(ctx, width, height, padding, centerX, centerY, 
                    (x) => 2 * x, '#10b981');
            }
            
            // 更新信息面板
            if (state.clickPoint) {
                document.getElementById('minInfo').style.display = 'block';
                document.getElementById('minX').textContent = targetX.toFixed(2);
                document.getElementById('minY').textContent = targetY.toFixed(2);
                document.getElementById('minDerivative').textContent = (2 * targetX).toFixed(2);
            }
            
            // 添加标签
            ctx.fillStyle = '#1e293b';
            ctx.font = '14px sans-serif';
            ctx.fillText('f(x) = x² - 2', padding + 10, padding + 20);
            
            if (state.derivative) {
                ctx.fillStyle = '#10b981';
                ctx.fillText("f'(x) = 2x", padding + 10, padding + 40);
            }
        }

        // 绘制拐点
        function drawInflection() {
            const canvas = document.getElementById('inflectionCanvas');
            const ctx = setupCanvas(canvas);
            const rect = canvas.getBoundingClientRect();
            const width = rect.width;
            const height = rect.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const padding = 40;
            const centerX = width / 2;
            const centerY = height / 2;
            
            // 绘制坐标轴
            drawAxes(ctx, width, height, padding);
            
            // 绘制函数 f(x) = x^3
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let px = padding; px < width - padding; px++) {
                const x = ((px - centerX) / (width - 2 * padding)) * 4;
                const y = x * x * x;
                const py = centerY - y * 30;
                
                if (px === padding) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
            
            const state = graphStates.inflection;
            
            // 标记拐点或点击点
            const targetX = state.clickPoint ? state.clickPoint.x : 0;
            const targetY = targetX * targetX * targetX;
            const targetPx = centerX + targetX * (width - 2 * padding) / 4;
            const targetPy = centerY - targetY * 30;
            
            // 绘制点
            ctx.fillStyle = state.clickPoint ? '#f59e0b' : '#f59e0b';
            ctx.beginPath();
            ctx.arc(targetPx, targetPy, 6, 0, Math.PI * 2);
            ctx.fill();
            
            // 显示切线
            if (state.tangent) {
                const derivative = 3 * targetX * targetX;
                const xScale = (width - 2 * padding) / 4;  // 拐点的x范围是4
                drawTangentLine(ctx, targetPx, targetPy, derivative, width, 30, xScale);
            }
            
            // 显示导数图
            if (state.derivative) {
                drawDerivativeGraph(ctx, width, height, padding, centerX, centerY, 
                    (x) => 3 * x * x, '#10b981', 30);
            }
            
            // 更新信息面板
            if (state.clickPoint) {
                document.getElementById('inflectionInfo').style.display = 'block';
                document.getElementById('inflectionX').textContent = targetX.toFixed(2);
                document.getElementById('inflectionY').textContent = targetY.toFixed(2);
                document.getElementById('inflectionDerivative').textContent = (3 * targetX * targetX).toFixed(2);
            }
            
            // 添加标签
            ctx.fillStyle = '#1e293b';
            ctx.font = '14px sans-serif';
            ctx.fillText('f(x) = x³', padding + 10, padding + 20);
            
            if (state.derivative) {
                ctx.fillStyle = '#10b981';
                ctx.fillText("f'(x) = 3x²", padding + 10, padding + 40);
            }
        }

        // 辅助函数：绘制坐标轴
        function drawAxes(ctx, width, height, padding) {
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1.5;
            
            // X轴
            ctx.beginPath();
            ctx.moveTo(padding, height / 2);
            ctx.lineTo(width - padding, height / 2);
            ctx.stroke();
            
            // Y轴
            ctx.beginPath();
            ctx.moveTo(width / 2, padding);
            ctx.lineTo(width / 2, height - padding);
            ctx.stroke();
            
            // 箭头
            ctx.fillStyle = '#9ca3af';
            // X轴箭头
            ctx.beginPath();
            ctx.moveTo(width - padding, height / 2);
            ctx.lineTo(width - padding - 8, height / 2 - 4);
            ctx.lineTo(width - padding - 8, height / 2 + 4);
            ctx.closePath();
            ctx.fill();
            
            // Y轴箭头
            ctx.beginPath();
            ctx.moveTo(width / 2, padding);
            ctx.lineTo(width / 2 - 4, padding + 8);
            ctx.lineTo(width / 2 + 4, padding + 8);
            ctx.closePath();
            ctx.fill();
            
            // 标签
            ctx.fillStyle = '#6b7280';
            ctx.font = '13px sans-serif';
            ctx.fillText('x', width - padding + 10, height / 2 + 20);
            ctx.fillText('y', width / 2 + 10, padding - 10);
            ctx.fillText('O', width / 2 - 15, height / 2 + 18);
        }

        // 绘制切线
        function drawTangentLine(ctx, px, py, slope, width, scale = 50, xScale = null) {
            ctx.strokeStyle = '#10b981';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            ctx.beginPath();
            const extend = 150;
            
            // 如果没有提供xScale，使用默认的x轴缩放
            if (!xScale) {
                xScale = (width - 80) / 6;  // 默认x范围是6
            }
            
            // 使用点斜式方程：y - y0 = m(x - x0)
            // 斜率需要考虑x和y的缩放比例
            const adjustedSlope = -slope * scale / xScale;  // 负号是因为canvas的y轴向下
            
            // 向左延伸
            const leftX = px - extend;
            const leftY = py + adjustedSlope * (leftX - px);
            
            // 向右延伸
            const rightX = px + extend;
            const rightY = py + adjustedSlope * (rightX - px);
            
            ctx.moveTo(leftX, leftY);
            ctx.lineTo(rightX, rightY);
            ctx.stroke();
            
            ctx.setLineDash([]);
        }

        // 绘制导数图
        function drawDerivativeGraph(ctx, width, height, padding, centerX, centerY, derivFunc, color, scale = 50) {
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.setLineDash([3, 3]);
            ctx.beginPath();
            
            for (let px = padding; px < width - padding; px++) {
                const x = ((px - centerX) / (width - 2 * padding)) * 6;
                const dy = derivFunc(x);
                const py = centerY - dy * scale;
                
                if (px === padding) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.stroke();
            ctx.setLineDash([]);
        }

        // 交互功能
        function setupInteraction() {
            ['maxCanvas', 'minCanvas', 'inflectionCanvas'].forEach((canvasId, index) => {
                const canvas = document.getElementById(canvasId);
                const type = ['max', 'min', 'inflection'][index];
                
                canvas.addEventListener('click', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    const centerX = rect.width / 2;
                    const padding = 40;
                    
                    // 转换为函数坐标
                    const range = type === 'inflection' ? 4 : 6;
                    const fx = ((x - centerX) / (rect.width - 2 * padding)) * range;
                    
                    if (Math.abs(fx) <= range/2) {
                        graphStates[type].clickPoint = { x: fx };
                        drawCurrentSlide();
                    }
                });
                
                canvas.addEventListener('mousemove', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const centerX = rect.width / 2;
                    const padding = 40;
                    
                    const range = type === 'inflection' ? 4 : 6;
                    const fx = ((x - centerX) / (rect.width - 2 * padding)) * range;
                    
                    if (Math.abs(fx) <= range/2) {
                        canvas.style.cursor = 'pointer';
                        
                        // 显示提示
                        const tooltip = document.getElementById('tooltip');
                        tooltip.style.display = 'block';
                        tooltip.style.left = e.clientX + 10 + 'px';
                        tooltip.style.top = e.clientY - 30 + 'px';
                        tooltip.textContent = `x = ${fx.toFixed(2)}`;
                    } else {
                        canvas.style.cursor = 'default';
                        document.getElementById('tooltip').style.display = 'none';
                    }
                });
                
                canvas.addEventListener('mouseleave', () => {
                    document.getElementById('tooltip').style.display = 'none';
                });
            });
        }

        // 控制函数
        function toggleAnimation(type) {
            graphStates[type].animation = !graphStates[type].animation;
            
            if (graphStates[type].animation) {
                animateFunction(type);
            } else if (animationFrames[type]) {
                cancelAnimationFrame(animationFrames[type]);
                animationFrames[type] = null;
            }
            
            // 更新按钮状态
            const button = event.target.closest('.control-button');
            if (graphStates[type].animation) {
                button.classList.add('active');
                button.querySelector('span').textContent = '暂停动画';
            } else {
                button.classList.remove('active');
                button.querySelector('span').textContent = '播放动画';
            }
        }

        function toggleTangent(type) {
            graphStates[type].tangent = !graphStates[type].tangent;
            drawCurrentSlide();
            
            const button = event.target.closest('.control-button');
            if (graphStates[type].tangent) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        }

        function toggleDerivative(type) {
            graphStates[type].derivative = !graphStates[type].derivative;
            drawCurrentSlide();
            
            const button = event.target.closest('.control-button');
            if (graphStates[type].derivative) {
                button.classList.add('active');
            } else {
                button.classList.remove('active');
            }
        }

        // 动画函数
        function animateFunction(type) {
            if (!animationProgress[type]) {
                animationProgress[type] = type === 'inflection' ? -2 : -3;
            }
            
            const range = type === 'inflection' ? 2 : 3;
            animationProgress[type] += 0.02;
            if (animationProgress[type] > range) {
                animationProgress[type] = -range;
            }
            
            graphStates[type].clickPoint = { x: animationProgress[type] };
            drawCurrentSlide();
            
            if (graphStates[type].animation) {
                animationFrames[type] = requestAnimationFrame(() => animateFunction(type));
            }
        }

        // 初始化
        window.addEventListener('load', () => {
            showSlide(1);
            setupInteraction();
        });

        // 键盘导航
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') prevSlide();
            if (e.key === 'ArrowRight') nextSlide();
        });

        // 窗口调整
        window.addEventListener('resize', () => {
            drawCurrentSlide();
        });
    </script>
</body>
</html>