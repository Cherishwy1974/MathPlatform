<!DOCTYPE html>

<html lang="zh-CN">
<head>
    <link rel="stylesheet" href="../common-assets/css/fontawesome.min.css">
    <link rel="stylesheet" href="../common-assets/css/solid.min.css">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>多元函数积分学 (交互式课件)</title>
<script src="../common-assets/js/d3-7.8.5.min.js"></script>
<script src="../common-assets/js/three-0.160.0.min.js"></script>
<script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                pageReady: () => {
                    return window.MathJax.startup.defaultPageReady().then(() => {
                        console.log('MathJax is ready');
                    });
                }
            }
        };
</script>
<script src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js"></script>
<style>
        /* === RESET AND BASE STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            height: 100%;
        }

        body {
            font-family: 'Inter', 'Source Han Sans SC', 'Noto Sans SC', 'Microsoft YaHei', system-ui, -apple-system, sans-serif;
            background: #FAFAFA;
            overflow: hidden;
            color: #1a1a1a;
            height: 100%;
            line-height: 1.6;
            font-weight: 400;
        }

        /* === SLIDE LAYOUT === */
        .slide-container {
            width: 100%;
            height: 100vh;
            display: flex;
            position: relative;
            gap: 0;
            padding: 0;
        }

        /* Left Content Area - Academic Journal Style */
        .left-content {
            width: 50%;
            height: 100vh;
            padding: 60px 80px 60px 60px;
            background: #FBFBFB;
            overflow-y: auto;
            font-size: 16px;
            line-height: 1.6;
            border: none;
            box-shadow: none;
            border-radius: 0;
        }

        .slide-container.single-column .left-content {
            width: 100%;
            max-width: 960px;
            border-right: none;
        }

        /* Right Visualization Area - Subtle Contrast */
        .right-visual {
            width: 50%;
            height: 100vh;
            background: #F8F9FA;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: none;
            box-shadow: none;
            border-radius: 0;
        }

        .slide-container.single-column .right-visual {
            display: none;
        }

        .right-visual > div {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            padding: 24px;
            position: relative; /* 允许右侧内部元素绝对定位，不干扰布局 */
        }

        .right-visual > div > * {
            width: 100%;
            height: 100%;
        }

        /* 删除/屏蔽右侧的覆盖式信息面板（如存在） */
        .right-visual .info-panel { display: none !important; }

        /* 左侧精简信息块（用于承载原右侧信息，避免过高） */
        .left-content .info-box-left {
            margin: 10px 0 6px 0;
            padding: 8px 10px;
            border-left: 4px solid #3b82f6;
            background: rgba(59, 130, 246, 0.06);
            border-radius: 0 8px 8px 0;
            color: #0f172a;
            font-size: 14px;
            line-height: 1.5;
            max-height: 160px; /* 控制高度不过高 */
            overflow: auto;
        }

        .right-visual canvas,
        .right-visual svg {
            max-width: 100%;
            max-height: 100%;
        }

        /* === SLIDE TRANSITIONS === */
        .slide {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .slide.active {
            display: flex;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* === 统一的字体系统 === */
        h1 {
            color: #003366;
            font-size: 28px;
            line-height: 1.3;
            font-weight: 700;
            margin: 0 0 24px 0;
            padding: 0;
            letter-spacing: -0.02em;
        }

        h2 {
            color: #008080;
            font-size: 22px;
            line-height: 1.4;
            font-weight: 600;
            margin: 32px 0 16px 0;
            position: relative;
            padding-left: 0;
        }

        h2::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #008080;
            border-radius: 2px;
        }

        h3 {
            color: #1a1a1a;
            font-size: 20px;
            line-height: 1.4;
            font-weight: 600;
            margin: 24px 0 12px 0;
        }

        h4 {
            color: #333333;
            font-size: 18px;
            line-height: 1.4;
            font-weight: 500;
            margin: 20px 0 8px 0;
        }

        h5 {
            color: #555555;
            font-size: 16px;
            line-height: 1.4;
            font-weight: 500;
            margin: 16px 0 8px 0;
        }

        p {
            margin-bottom: 16px;
            color: #2d2d2d;
            font-weight: 400;
            font-size: 16px;
            line-height: 1.6;
        }

        ul, ol {
            margin: 0 0 16px 0;
            line-height: 1.6;
            padding-left: 24px;
            font-size: 16px;
        }

        li {
            margin-bottom: 8px;
            color: #2d2d2d;
            font-size: 16px;
            line-height: 1.6;
        }

        /* === CONTENT MODULES - 去框化设计 === */
        .definition, .theorem, .example, .note {
            background: transparent;
            border: none;
            border-left: 4px solid;
            padding: 16px 0 16px 20px;
            margin: 20px 0;
        }

        .definition {
            border-left-color: #1e40af;
        }

        .theorem {
            border-left-color: #059669;
        }

        .example {
            border-left-color: #dc2626;
        }

        .note {
            border-left-color: #6b7280;
            font-style: italic;
            color: #4b5563;
        }

        .math-formula {
            background: transparent;
            border: none;
            border-left: 4px solid #008080;
            padding: 16px 0 16px 20px;
            margin: 20px 0;
            border-radius: 0;
            font-size: 16px;
        }

        .highlight {
            color: #008080;
            font-weight: 600;
        }

        .formula-highlight {
            background: transparent;
            padding: 24px 0;
            margin: 24px 0;
            text-align: center;
            font-size: 18px;
            border: none;
            box-shadow: none;
        }

        .formula-rule {
            background: transparent;
            border: none;
            border-left: 4px solid #008080;
            padding: 16px 0 16px 20px;
            margin: 20px 0;
            border-radius: 0;
            font-size: 16px;
        }

        /* === MATHJAX FORMULA STYLING === */
        .MathJax {
            outline: none;
            display: inline-block;
        }

        .MathJax_Display {
            text-align: center !important;
            margin: 20px 0 !important;
        }

        /* SVG Container Styling */
        mjx-container[jax="SVG"] {
            display: inline-block !important;
            line-height: 1;
            vertical-align: baseline;
        }

        mjx-container[jax="SVG"][display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 20px 0 !important;
        }

        mjx-container[jax="SVG"] svg {
            display: inline-block !important;
            vertical-align: baseline;
            max-width: 100%;
            height: auto;
        }

        mjx-container[jax="SVG"][display="true"] svg {
            display: block !important;
            margin: 0 auto !important;
        }

        /* Enhanced SVG Rendering */
        mjx-container svg {
            shape-rendering: geometricPrecision;
            text-rendering: geometricPrecision;
            font-family: 'MJXZERO', 'MJXTEX';
        }

        /* Force Visibility and Proper Display */
        mjx-container[jax="SVG"] {
            visibility: visible !important;
            opacity: 1 !important;
            overflow: visible !important;
        }

        mjx-container[jax="SVG"] svg {
            visibility: visible !important;
            opacity: 1 !important;
            width: auto !important;
            height: auto !important;
        }

        /* Content Area Formula Display */
        .left-content mjx-container {
            display: inline-block !important;
            margin: 0 3px;
        }

        .left-content mjx-container[display="true"] {
            display: block !important;
            text-align: center !important;
            margin: 20px 0 !important;
        }

        /* === SIMPLIFIED INTERACTIVE ELEMENTS === */
        .step-stack {
            margin: 32px 0;
        }

        .step-item {
            border: none;
            border-left: 3px solid #008080;
            border-radius: 0;
            padding: 0 0 0 20px;
            background: transparent;
            display: none;
            margin: 24px 0;
        }

        .step-item.active {
            display: block;
            background: transparent;
            border-left-color: #003366;
        }

        .step-btn {
            margin-top: 16px;
            padding: 8px 16px;
            border-radius: 0;
            border: 1px solid #E5E7EB;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            color: #003366;
            transition: all 0.2s ease;
        }

        .step-btn:hover {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .prompt-card {
            background: transparent;
            border: none;
            border-left: 3px solid #008080;
            border-radius: 0;
            padding: 0 0 0 20px;
            margin: 32px 0;
        }

        .teacher-note {
            background: transparent;
            border: none;
            border-left: 3px solid #CC5500;
            border-radius: 0;
            padding: 0 0 0 20px;
            margin: 32px 0;
            font-style: normal;
        }

        /* === CANVAS STYLING === */
        canvas {
            max-width: 95%;
            max-height: 95%;
            border-radius: 0;
            box-shadow: none;
        }

        /* === 导航控制 - 第二章极简设计 === */
        .nav-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            align-items: center;
            z-index: 1000;
        }

        .nav-btn {
            background: rgba(0, 0, 0, 0.15);
            color: transparent;
            border: none;
            padding: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0;
            transition: all 0.2s;
            position: relative;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            border-top: 2px solid rgba(0, 0, 0, 0.5);
            border-right: 2px solid rgba(0, 0, 0, 0.5);
        }

        .nav-btn:first-child::before {
            transform: translate(-40%, -50%) rotate(-135deg);
        }

        .nav-btn:last-child::before {
            transform: translate(-60%, -50%) rotate(45deg);
        }

        .nav-btn:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        .nav-btn:hover::before {
            border-color: rgba(0, 0, 0, 0.7);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-btn:disabled::before {
            border-color: rgba(0, 0, 0, 0.2);
        }

        .slide-number {
            font-size: 11px;
            color: #9ca3af;
            font-weight: 400;
            display: flex;
            align-items: center;
            gap: 0;
            opacity: 0.6;
        }

        .slide-number input {
            width: 50px;
            text-align: right;
            border: none;
            background: transparent;
            font-size: 11px;
            padding: 0 2px;
            margin: 0;
            color: #000000;
            font-weight: 700;
        }

        .slide-number input::-webkit-outer-spin-button,
        .slide-number input::-webkit-inner-spin-button {
            display: none;
        }

        .slide-number input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .slide-number input:focus {
            outline: none;
            color: #000000;
        }

        #slideNumberTotal {
            color: #9ca3af;
            font-size: 14px;
            font-weight: 400;
            padding: 0 12px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
        }

        .directory-toggle {
            border: none;
            background: transparent;
            color: #003366;
            padding: 8px 12px;
            border-radius: 0;
            cursor: pointer;
            border: 1px solid #E5E7EB;
            transition: all 0.2s ease;
        }

        .directory-toggle:hover {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .directory-menu {
            position: fixed;
            bottom: 90px;
            right: 24px;
            width: 320px;
            max-height: 60vh;
            overflow-y: auto;
            background: rgba(251, 251, 251, 0.95);
            border: 1px solid #E5E7EB;
            border-radius: 0;
            padding: 20px;
            box-shadow: none;
            display: none;
            z-index: 1200;
            backdrop-filter: blur(10px);
        }

        .directory-menu.active {
            display: block;
        }

        .directory-menu h3 {
            margin-bottom: 16px;
            font-size: 16px;
            color: #003366;
        }

        .directory-item {
            margin-bottom: 12px;
            color: #2d2d2d;
            text-decoration: none;
            display: block;
            padding: 10px 12px;
            border-radius: 0;
            transition: background 0.2s ease;
            border: 1px solid transparent;
        }

        .directory-item:hover {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .global-animation-controls {
            position: fixed;
            bottom: 30px;
            left: 30px;
            display: flex;
            gap: 12px;
            padding: 8px 16px;
            background: rgba(251, 251, 251, 0.95);
            border: 1px solid #E5E7EB;
            border-radius: 0;
            box-shadow: none;
            backdrop-filter: blur(10px);
            z-index: 1100;
        }

        .global-control-btn {
            background: transparent;
            border: 1px solid #E5E7EB;
            color: #003366;
            padding: 6px 12px;
            border-radius: 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .global-control-btn:hover {
            background: #003366;
            color: white;
            border-color: #003366;
        }

        .global-control-btn.pause {
            color: #dc2626;
            border-color: #dc2626;
        }

        .global-control-btn.pause:hover {
            background: #dc2626;
            color: white;
        }

        .slide-note {
            font-size: 14px;
            color: #666666;
            margin-top: 12px;
            font-style: italic;
        }

        /* === UTILITY CLASSES === */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #003366;
            z-index: 9999;
            font-weight: 500;
        }

        /* === VISUAL HINTS AND UTILITY === */
        .visual-hint {
            font-style: italic;
            color: #666666;
            font-size: 15px;
            margin: 24px 0;
            padding-left: 20px;
            border-left: 2px solid #E5E7EB;
        }

        /* === CLEAN SCROLLBAR === */
        .left-content::-webkit-scrollbar {
            width: 6px;
        }

        .left-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .left-content::-webkit-scrollbar-thumb {
            background: #E5E7EB;
            border-radius: 3px;
        }

        .left-content::-webkit-scrollbar-thumb:hover {
            background: #D1D5DB;
        }

        .error-message {
            color: #ef4444;
            text-align: center;
            padding: 20px;
            font-size: 16px;
            background: #fef2f2;
        }

        @media print {
            body {
                overflow: visible;
            }
            .slide {
                display: block !important;
                page-break-after: always;
            }
            .nav-container,
            .global-animation-controls,
            .directory-menu,
            .directory-toggle {
                display: none !important;
            }
        }
    </style>
    <style>
        /* 悬浮控制与面板（统一样式） */
        .floating-control-btn { position: fixed; bottom: 20px; left: 20px; width: 56px; height: 56px; border: none; border-radius: 16px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1100; background: rgba(15,23,42,0.7); color: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.25); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); transition: transform .2s ease, box-shadow .2s ease; }
        .floating-control-btn:hover { transform: translateY(-2px); box-shadow: 0 16px 36px rgba(0,0,0,0.32); }
        .floating-control-btn .btn-icon { font-size: 22px; font-weight: 700; }
        .floating-menu-items { position: fixed; bottom: 20px; left: 86px; display: none; gap: 10px; z-index: 1100; }
        .floating-menu-items.active { display: flex; }
        .floating-menu-item { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 14px; cursor: pointer; background: rgba(255,255,255,0.9); color: #0f172a; box-shadow: 0 10px 30px rgba(0,0,0,0.18); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); transition: transform .18s ease, box-shadow .18s ease; }
        .floating-menu-item:hover { transform: translateY(-1px); box-shadow: 0 14px 36px rgba(0,0,0,0.24); }
        .floating-menu-item .item-icon { font-size: 16px; width: 18px; text-align: center; }
        .lab-submenu, .chapter-submenu { position: fixed; left: 20px; bottom: 86px; display: none; z-index: 1100; }
        .course-submenu { position: fixed; right: 20px; top: 70px; display: none; z-index: 1100; }
        .submenu-content { position: relative; width: min(920px, calc(100vw - 40px)); max-height: min(70vh, 620px); overflow-y: auto; background: rgba(255,255,255,0.88); border: 1px solid rgba(0,0,0,0.06); border-radius: 16px; padding: 16px; box-shadow: 0 20px 50px rgba(0,0,0,0.25); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .submenu-title { font-weight: 700; color: #0f172a; margin-bottom: 10px; }
        .submenu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; }
        .submenu-item { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 12px; cursor: pointer; background: rgba(255,255,255,0.95); border: 1px solid rgba(0,0,0,0.05); transition: background .15s ease, transform .15s ease; }
        .submenu-item:hover { background: rgba(241,245,249,0.95); transform: translateY(-1px); }
        .submenu-icon { width: 18px; text-align: center; color: #64748b; }
        .submenu-text { color: #111827; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .submenu-close { position: absolute; right: 10px; top: 6px; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; background: rgba(0,0,0,0.55); color: #fff; font-weight: 700; }
        .submenu-close:hover { background: rgba(0,0,0,0.72); }
    </style>
    <style>
        /* 统一封面样式（与第1–8章一致） */
        .slide-container.cover { align-items: stretch; }
        .cover-left { padding: 60px; display: flex; flex-direction: column; justify-content: center; }
        .cover-badge { display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(90deg, #4a90e2, #9b59b6); color: #fff; padding: 6px 12px; border-radius: 999px; font-size: 14px; width: fit-content; box-shadow: 0 6px 16px rgba(74,144,226,0.35); }
        .cover-title { font-size: 4rem; line-height: 1.1; margin: 18px 0 8px 0; color: #1a1a2e; background: linear-gradient(90deg, #1a1a2e 0%, #4a90e2 60%, #9b59b6 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .cover-subtitle { font-size: 1.6rem; color: #4f5b6a; margin: 10px 0 18px 0; }
        .cover-meta { display: flex; gap: 14px; flex-wrap: wrap; color: #6b7b8c; font-size: 0.95rem; }
        .cover-meta span { display: inline-flex; align-items: center; gap: 6px; }
        .cover-actions { display: flex; gap: 14px; margin-top: 26px; flex-wrap: wrap; }
        .cover-right { position: relative; overflow: hidden; }
        .cover-visual { position: relative; width: 100%; height: 100%; background:
                radial-gradient(1200px 800px at 80% 20%, rgba(155, 89, 182, 0.18), transparent 60%),
                radial-gradient(900px 700px at 20% 80%, rgba(74, 144, 226, 0.18), transparent 60%),
                linear-gradient(135deg, #ffffff 0%, #f7faff 50%, #f9f6ff 100%);
        }
        .cover-visual::after { content: ""; position: absolute; inset: 0; background: radial-gradient(600px 300px at 50% -10%, rgba(255,255,255,0.7), transparent 70%); pointer-events: none; }
        .cover-visual::before { content: ""; position: absolute; inset: -15%; background: conic-gradient(from 0deg, rgba(74,144,226,0.16), rgba(155,89,182,0.16), rgba(99,102,241,0.16), rgba(74,144,226,0.16)); filter: blur(80px); opacity: 0.18; animation: rotateAurora 30s linear infinite; pointer-events: none; }
        .math-badge { position: absolute; padding: 0; background: transparent; border: none; border-radius: 0; box-shadow: none; color: #334155; font-weight: 700; animation: floatY 6s ease-in-out infinite; backdrop-filter: none; pointer-events: none; }
        .math-badge.b1 { left: 12%; top: 22%; animation-delay: 0s; }
        .math-badge.b2 { right: 14%; top: 30%; animation-delay: 0.8s; }
        .math-badge.b3 { left: 20%; bottom: 18%; animation-delay: 1.5s; }
        .math-badge.b4 { right: 18%; bottom: 22%; animation-delay: 2.2s; }
        @keyframes floatY { 0% { transform: translateY(0px); } 50% { transform: translateY(-12px); } 100% { transform: translateY(0px); } }
        @keyframes rotateAurora { to { transform: rotate(360deg); } }
        .orbit { position: absolute; left: 50%; top: 50%; width: 320px; height: 320px; margin-left: -160px; margin-top: -160px; border-radius: 50%; border: 1px dashed rgba(52, 152, 219, 0.35); animation: spin 18s linear infinite; }
        .orbit .dot { position: absolute; top: -6px; left: 50%; width: 12px; height: 12px; margin-left: -6px; background: #4a90e2; border-radius: 50%; box-shadow: 0 0 0 6px rgba(74,144,226,0.15); }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
<style>
        .return-home-panel {
            position: fixed;
            top: 16px;
            left: 16px;
            display: flex;
            gap: 10px;
            z-index: 9999;
            flex-wrap: wrap;
        }
        .return-home-panel .return-link {
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.8);
            color: #f8fafc;
            font-size: 14px;
            text-decoration: none;
            box-shadow: 0 6px 20px rgba(15, 23, 42, 0.25);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .return-home-panel .return-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(15, 23, 42, 0.35);
        }
        .return-home-panel .return-link.return-main {
            background: rgba(79, 70, 229, 0.85);
        }
        @media (max-width: 640px) {
            .return-home-panel {
                top: 12px;
                left: 12px;
                right: 12px;
                justify-content: center;
            }
            .return-home-panel .return-link {
                width: 100%;
                text-align: center;
            }
        }
    </style>
    <style>
        /* 返回按钮样式（统一为第1/2章风格） */
        .return-home-panel {
            position: fixed;
            top: 16px;
            right: 16px;
            z-index: 9999;
            display: flex;
            gap: 10px;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }
        .return-home-panel:hover { opacity: 1; }
        .return-home-panel .return-link {
            padding: 6px 12px;
            background: rgba(15, 23, 42, 0.7);
            color: #f8fafc;
            text-decoration: none;
            border-radius: 999px;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        .return-home-panel .return-link:hover {
            background: rgba(15, 23, 42, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(15, 23, 42, 0.3);
        }
        .return-home-panel .return-link.return-main {
            background: rgba(79, 70, 229, 0.7);
        }
        .return-home-panel .return-link.return-main:hover {
            background: rgba(79, 70, 229, 0.9);
            box-shadow: 0 8px 16px rgba(79, 70, 229, 0.3);
        }
    </style>
</head>
<body>
    <div class="return-home-panel">
        <a class="return-link" href="../index.html"><i class="fa-solid fa-house"></i> 返回主站</a>
        <a class="return-link return-main" href="javascript:void(0)" onclick="event.stopPropagation(); toggleCourseSubmenu()"><i class="fa-solid fa-arrow-left"></i> 返回目录</a>
    </div>
<div id="slidesContainer">
<!-- 第1页：标题页 -->
<div class="slide active"><div class="slide-container cover"><div class="left-content tex2jax_process cover-left">
<div class="cover-badge"><i class="fa-solid fa-seedling"></i><span> 第九章</span></div>
<h1 class="cover-title">多元函数积分学初步</h1>
<p class="cover-subtitle">从平面到空间的积分</p>
<div class="cover-meta">
<span><i class="fa-solid fa-book-open"></i> 基础篇</span>
<span><i class="fa-solid fa-bolt"></i> 关键概念速览</span>
</div>
<div class="cover-actions">
<a class="home-link-btn" href="../index.html"><span>主页</span></a>
<a class="home-link-btn" href="../故事书/第9章/上帝的语言.html"><span>故事书</span></a>
<a class="home-link-btn" href="../习题/index.html"><span>习题</span></a>
<a class="home-link-btn" href="https://ai.projectmath.xyz/project/index.html"><span>产教融合</span></a>
</div>
</div><div class="right-visual cover-right"><div class="cover-visual">
<div class="math-badge b1">∬</div>
<div class="math-badge b2">∭</div>
<div class="math-badge b3">Jacobian</div>
<div class="math-badge b4">dA / dV</div>
<div class="orbit"><span class="dot"></span></div>
<div id="vis-title"></div>
</div></div></div></div>
<!-- 第2页：本章目录 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2 style="text-align: center; font-size: 2.4rem; margin-bottom: 16px; letter-spacing: 2px">本章目录</h2>
<div style="display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 14px; padding: 10px 10px 0">
<div style="padding: 10px">
<h3 style="padding-bottom: 5px; color: #3498db; font-size: 1.2rem; margin: 0 0 8px 0">9.1 二重积分基础</h3>
<ul>
<li>二重积分概念与几何意义</li>
<li>二重积分性质</li>
<li>直角坐标（X/Y 型区域）</li>
<li>极坐标计算</li>
</ul>
</div>
<div style="padding: 10px">
<h3 style="padding-bottom: 5px; color: #2ecc71; font-size: 1.2rem; margin: 0 0 8px 0">9.2 二重积分应用</h3>
<ul>
<li>体积与面积</li>
<li>质量与重心</li>
<li>对称性技巧</li>
</ul>
</div>
<!-- 取消相关目录块（高职不涉及） -->
<div style="padding: 10px">
<h3 style="padding-bottom: 5px; color: #16a085; font-size: 1.2rem; margin: 0 0 8px 0">9.5 方法与总结</h3>
<ul>
<li>积分换序</li>
<li>常见错误与注意</li>
<li>知识总结</li>
</ul>
</div>
</div>
</div><div class="right-visual"><div style="width:100%;height:100%;background:
                radial-gradient(900px 600px at 80% 20%, rgba(99,102,241,0.10), transparent 60%),
                radial-gradient(700px 500px at 20% 80%, rgba(59,130,246,0.10), transparent 60%),
                linear-gradient(135deg, #ffffff 0%, #f8fbff 50%, #faf7ff 100%)"></div></div></div></div>
<!-- 第3页：为什么需要多元积分 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>为什么需要多元积分？</h2>
<h3>实际问题</h3>
<ul>
<li>求<span class="highlight">曲顶柱体</span>的体积</li>
<li>计算<span class="highlight">不规则平面</span>的面积</li>
<li>求<span class="highlight">平面薄片</span>的质量</li>
<li>计算<span class="highlight">重心</span>和<span class="highlight">转动惯量</span></li>
</ul>
<h3>核心思想</h3>
<p>将复杂区域<span class="highlight">分割</span>成小块，每块近似计算，最后<span class="highlight">求和取极限</span>。</p>
</div><div class="right-visual"><div id="vis-why-double-integral"></div></div></div></div>
<!-- 过渡页：第一部分 二重积分 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;text-align:center">
<h1 style="font-size: 4.4rem; color: #3498db; margin-bottom: 20px">第一部分</h1>
<h2 style="font-size: 2.6rem; color: #334155; margin-bottom: 12px">二重积分</h2>
<div style="width: 260px; height: 4px; background: linear-gradient(to right, #3498db, #2ecc71); margin: 24px 0"></div>
<p style="font-size: 1.2rem; color: #6b7280; margin-top: 10px">概念 · 性质 · 计算 · 应用</p>
</div>
</div><div class="right-visual"><div style="width:100%;height:100%;background:
                radial-gradient(900px 600px at 80% 20%, rgba(52,152,219,0.12), transparent 60%),
                radial-gradient(700px 500px at 20% 80%, rgba(46,204,113,0.12), transparent 60%),
                linear-gradient(135deg, #ffffff 0%, #f8fbff 50%, #faf7ff 100%)"></div></div></div></div>
<!-- 第4页：二重积分的概念 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>二重积分</h2>
<h3>定义</h3>
<p>设函数 $z = f(x,y)$ 在有界闭区域 $D$ 上有定义。</p>
<div class="math-formula">
                $$\iint_D f(x,y) \, dA = \lim\limits_{\Delta A \to 0} \sum f(x_i, y_i) \Delta A_i$$
            </div>
<h3>几何意义</h3>
<p>当 $f(x,y) \geq 0$ 时，二重积分表示以 $D$ 为底，以曲面 $z = f(x,y)$ 为顶的<span class="highlight">曲顶柱体的体积</span>。</p>
</div><div class="right-visual"><div id="vis-double-integral-concept"></div></div></div></div>
<!-- 第4页：二重积分的性质 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>二重积分的性质</h2>
<h3>1. 线性性质</h3>
<div class="formula-rule">
                $$\iint_D [af(x,y) + bg(x,y)] \, dA = a\iint_D f \, dA + b\iint_D g \, dA$$
            </div>
<h3>2. 区域可加性</h3>
<p>若 $D = D_1 \cup D_2$，且 $D_1 \cap D_2 = \emptyset$，则：</p>
<div class="formula-rule">
                $$\iint_D f \, dA = \iint_{D_1} f \, dA + \iint_{D_2} f \, dA$$
            </div>
<h3>3. 比较性质</h3>
<p>若在 $D$ 上 $f(x,y) \leq g(x,y)$，则 $\iint_D f \, dA \leq \iint_D g \, dA$</p>
</div><div class="right-visual"><div id="vis-properties"></div></div></div></div>
<!-- 第5页：直角坐标系下的计算 - X型区域 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>直角坐标系计算</h2>
<h3>X型区域</h3>
<p>积分区域：$D = \{(x,y) | a \leq x \leq b, \varphi_1(x) \leq y \leq \varphi_2(x)\}$</p>
<div class="math-formula">
                $$\iint_D f(x,y) \, dA = \int_a^b \left[ \int_{\varphi_1(x)}^{\varphi_2(x)} f(x,y) \, dy \right] dx$$
            </div>
<p><span class="highlight">计算步骤：</span></p>
<ol>
<li>先对 $y$ 积分（内层）</li>
<li>再对 $x$ 积分（外层）</li>
</ol>
</div><div class="right-visual"><div id="vis-x-type-region"></div></div></div></div>
<!-- 第6页：直角坐标系下的计算 - Y型区域 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>Y型区域</h2>
<p>积分区域：$D = \{(x,y) | c \leq y \leq d, \psi_1(y) \leq x \leq \psi_2(y)\}$</p>
<div class="math-formula">
                $$\iint_D f(x,y) \, dA = \int_c^d \left[ \int_{\psi_1(y)}^{\psi_2(y)} f(x,y) \, dx \right] dy$$
            </div>
<p><span class="highlight">选择技巧：</span></p>
<ul>
<li>观察积分区域的形状</li>
<li>选择使计算更简单的积分次序</li>
<li>有时需要分割区域</li>
</ul>
</div><div class="right-visual"><div id="vis-y-type-region"></div></div></div></div>
<!-- 第7页：极坐标系下的计算 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>极坐标系</h2>
<h3>坐标变换</h3>
<p>$x = r\cos\theta$，$y = r\sin\theta$</p>
<p>面积元素：$dA = r \, dr \, d\theta$</p>
<div class="math-formula">
                $$\iint_D f(x,y) \, dA = \iint_{D'} f(r\cos\theta, r\sin\theta) \cdot r \, dr \, d\theta$$
            </div>
<h3>适用情况</h3>
<ul>
<li>圆形或扇形区域</li>
<li>被积函数含 $x^2 + y^2$</li>
<li>旋转对称的问题</li>
</ul>
</div><div class="right-visual"><div id="vis-polar-coordinates"></div></div></div></div>
<!-- 第8页：二重积分应用 - 体积 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>应用：求体积</h2>
<h3>曲顶柱体体积</h3>
<p>上曲面：$z = f(x,y)$</p>
<p>下曲面：$z = g(x,y)$</p>
<div class="math-formula">
                $$V = \iint_D [f(x,y) - g(x,y)] \, dA$$
            </div>
<h3>例：半球体积</h3>
<p>求半径为 $R$ 的半球体积。</p>
<p>曲面：$z = \sqrt{R^2 - x^2 - y^2}$</p>
<p>底面：$x^2 + y^2 \leq R^2$</p>
</div><div class="right-visual"><div id="vis-volume-application"></div></div></div></div>
<!-- 第9页：二重积分应用 - 面积 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>应用：求面积</h2>
<h3>平面区域面积</h3>
<p>区域 $D$ 的面积：</p>
<div class="math-formula">
                $$A = \iint_D 1 \, dA = \iint_D dx \, dy$$
            </div>
<h3>曲面面积</h3>
<p>曲面 $z = f(x,y)$ 在区域 $D$ 上的面积：</p>
<div class="math-formula">
                $$S = \iint_D \sqrt{1 + \left(\frac{\partial f}{\partial x}\right)^2 + \left(\frac{\partial f}{\partial y}\right)^2} \, dA$$
            </div>
</div><div class="right-visual"><div id="vis-area-application"></div></div></div></div>
<!-- 第10页：二重积分应用 - 质量与重心 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>应用：质量与重心</h2>
<h3>平面薄片的质量</h3>
<p>密度函数：$\rho(x,y)$</p>
<div class="formula-rule">
                $$M = \iint_D \rho(x,y) \, dA$$
            </div>
<h3>重心坐标</h3>
<p>质心坐标 $(\bar{x}, \bar{y})$：</p>
<div class="formula-rule">
                $$\bar{x} = \frac{1}{M}\iint_D x\rho(x,y) \, dA, \quad \bar{y} = \frac{1}{M}\iint_D y\rho(x,y) \, dA$$
            </div>
</div><div class="right-visual"><div id="vis-mass-center"></div></div></div></div>
<!-- 新增：应用案例 - 薄片质心定位 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>应用案例：薄片质心定位</h2>
<h3>问题</h3>
<p>密度函数 $\rho(x,y)=1+x$，薄片区域 $D=\{(x,y)\mid 0\le x\le 1,\, 0\le y\le x\}$，求质心 $(\bar{x},\bar{y})$。</p>
<h3>思路</h3>
<ol>
<li>总质量 $M=\iint_D \rho\,dA$</li>
<li>$\bar{x}=\dfrac{1}{M}\iint_D x\rho\,dA$，$\bar{y}=\dfrac{1}{M}\iint_D y\rho\,dA$</li>
</ol>
<h3>结果（计算略）</h3>
<p>$M=\dfrac{2}{3}$，$\,\bar{x}=\dfrac{7}{12}$，$\,\bar{y}=\dfrac{5}{24}$（保留三位小数：$0.583,\,0.208$）</p>
</div><div class="right-visual"><div id="vis-mass-center-case"></div></div></div></div>
<!-- 第11页：计算实例1 - 简单区域 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>计算实例</h2>
<h3>例1：矩形区域</h3>
<p>计算 $\iint_D xy \, dA$，其中 $D = [0,1] \times [0,2]$</p>
<p><span class="highlight">解：</span></p>
<div class="math-formula">
                $$\iint_D xy \, dA = \int_0^1 \int_0^2 xy \, dy \, dx$$
            </div>
<p>先对 $y$ 积分：$\int_0^2 xy \, dy = x \cdot \frac{y^2}{2}\Big|_0^2 = 2x$</p>
<p>再对 $x$ 积分：$\int_0^1 2x \, dx = x^2\Big|_0^1 = 1$</p>
</div><div class="right-visual"><div id="vis-example1"></div></div></div></div>
<!-- 第12页：计算实例2 - 三角形区域 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>例2：三角形区域</h2>
<p>计算 $\iint_D (x+y) \, dA$</p>
<p>其中 $D$ 是顶点为 $(0,0)$, $(1,0)$, $(0,1)$ 的三角形。</p>
<p><span class="highlight">解：</span>X型区域描述</p>
<p>$D: 0 \leq x \leq 1, 0 \leq y \leq 1-x$</p>
<div class="math-formula">
                $$\int_0^1 \int_0^{1-x} (x+y) \, dy \, dx = \frac{1}{3}$$
            </div>
</div><div class="right-visual"><div id="vis-example2"></div></div></div></div>
<!-- 第13页：计算实例3 - 圆形区域（极坐标） -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>例3：圆形区域</h2>
<p>计算 $\iint_D e^{-(x^2+y^2)} \, dA$</p>
<p>其中 $D: x^2 + y^2 \leq R^2$</p>
<p><span class="highlight">解：</span>使用极坐标</p>
<p>$x = r\cos\theta$, $y = r\sin\theta$</p>
<div class="math-formula">
                $$\int_0^{2\pi} \int_0^R e^{-r^2} \cdot r \, dr \, d\theta = \pi(1-e^{-R^2})$$
            </div>
</div><div class="right-visual"><div id="vis-example3"></div></div></div></div>
<!-- 第14页：对称性的应用 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>对称性的应用</h2>
<h3>关于坐标轴对称</h3>
<p>若 $D$ 关于 $y$ 轴对称：</p>
<ul>
<li>$f(-x,y) = -f(x,y)$ （奇函数）→ 积分为0</li>
<li>$f(-x,y) = f(x,y)$ （偶函数）→ 积分为右半部分的2倍</li>
</ul>
<h3>关于原点对称</h3>
<p>若 $f(-x,-y) = -f(x,y)$，则 $\iint_D f \, dA = 0$</p>
</div><div class="right-visual"><div id="vis-symmetry"></div></div></div></div>
<!-- 过渡页：第二部分  -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;text-align:center">
<h1 style="font-size: 4.4rem; color: #9b59b6; margin-bottom: 20px">第二部分</h1>
<h2 style="font-size: 2.6rem; color: #334155; margin-bottom: 12px"></h2>
<div style="width: 260px; height: 4px; background: linear-gradient(to right, #9b59b6, #e74c3c); margin: 24px 0"></div>
<p style="font-size: 1.2rem; color: #6b7280; margin-top: 10px">概念 · 计算 · 坐标系 · 应用</p>
</div>
</div><div class="right-visual"><div style="width:100%;height:100%;background:
                radial-gradient(900px 600px at 80% 20%, rgba(155,89,182,0.12), transparent 60%),
                radial-gradient(700px 500px at 20% 80%, rgba(231,76,60,0.12), transparent 60%),
                linear-gradient(135deg, #ffffff 0%, #f8fbff 50%, #faf7ff 100%)"></div></div></div></div>
<!-- 已移除：第16页 概念 -->
<!-- 已移除：第16页 的计算 -->
<!-- 已移除：第17页 柱坐标系 -->
<!-- 已移除：第18页 系 -->
<!-- 已移除：第19页 应用 -->
<!-- 第20页：积分换序 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>积分换序</h2>
<h3>为什么要换序？</h3>
<ul>
<li>简化计算</li>
<li>某些函数只能按特定顺序积分</li>
<li>利用对称性</li>
</ul>
<h3>换序步骤</h3>
<ol>
<li>画出积分区域</li>
<li>用新的积分变量重新描述区域</li>
<li>确定新的积分限</li>
</ol>
</div><div class="right-visual"><div id="vis-change-order"></div></div></div></div>
<!-- 新增：换序计算例题 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>换序计算例题</h2>
<h3>例：</h3>
<p>$\displaystyle I=\int_0^1\!\int_0^{1-x}(x+y)\,dy\,dx$ 改为 $\displaystyle\int\!\int (x+y)\,dx\,dy$ 并计算。</p>
<h3>换序</h3>
<p>区域为三角形：$0\le x\le 1,\,0\le y\le 1-x$；换序：$0\le y\le 1,\,0\le x\le 1-y$。</p>
<h3>计算</h3>
<p>$I=\int_0^1\!\int_0^{1-y}(x+y)\,dx\,dy=\int_0^1\big[\tfrac{(1-y)^2}{2}+y(1-y)\big]dy=\tfrac{1}{3}$</p>
</div><div class="right-visual"><div id="vis-change-order-example"></div></div></div></div>
<!-- 第21页：常见错误与注意事项 -->
<div class="slide"><div class="slide-container"><div class="left-content tex2jax_process">
<h2>常见错误</h2>
<h3>❌ 错误1：积分限弄反</h3>
<p>内层积分限应该是外层变量的函数</p>
<h3>❌ 错误2：忘记雅可比行列式</h3>
<p>极坐标要乘以 $r$</p>
<h3>❌ 错误3：区域描述不完整</h3>
<p>确保积分区域被完全覆盖，不重不漏</p>
<h3>✅ 技巧</h3>
<p>画图！画图！画图！</p>
</div><div class="right-visual"><div id="vis-common-mistakes"></div></div></div></div>
<!-- 第22页：总结 -->
<div class="slide"><div class="slide-container single-column"><div class="left-content tex2jax_process">
<h2>知识总结</h2>
<div style="display: grid; gap: 30px; margin-top: 40px">
<div>
<h3>二重积分</h3>
<ul style="text-align: left">
<li>几何意义：曲顶柱体体积</li>
<li>直角坐标：X型/Y型区域</li>
<li>极坐标：圆形区域</li>
<li>应用：面积、质量、重心</li>
</ul>
</div>
<div>
<!-- 取消总结（高职不涉及） -->
</div>
</div>
<p style="margin-top: 40px; font-size: 1.5rem">
                核心思想：分割 → 近似 → 求和 → 取极限
            </p>
</div></div></div>
</div>
<!-- 导航按钮 -->
<div class="nav-controls" role="navigation" aria-label="幻灯片导航">
    <button class="nav-btn" onclick="previousSlide()" aria-label="上一页" title="上一页 (←)"><i class="fa-solid fa-arrow-left"></i> 上一页</button>
    <div class="slide-number" role="status" aria-live="polite">
        <input type="number" id="slideNumberInput" min="1" max="22" value="1"
               onchange="jumpToSlide(this.value)"
               aria-label="当前页码">/<span id="slideNumberTotal">22</span>
    </div>
    <button class="nav-btn" onclick="nextSlide()" aria-label="下一页" title="下一页 (→)">下一页 →</button>
</div>
<script>
    let slides, totalSlides, currentSlide = 0;
    // 全局计时器跟踪与清理（D3/动画）
    const __timers = { intervals: new Set(), timeouts: new Set(), d3Timers: new Set() };
    (function(){
        const __origSetInterval = window.setInterval;
        const __origClearInterval = window.clearInterval;
        const __origSetTimeout = window.setTimeout;
        const __origClearTimeout = window.clearTimeout;
        window.setInterval = function(fn, delay, ...args) {
            const id = __origSetInterval(fn, delay, ...args);
            __timers.intervals.add(id);
            return id;
        };
        window.clearInterval = function(id) {
            __timers.intervals.delete(id);
            return __origClearInterval(id);
        };
        window.setTimeout = function(fn, delay, ...args) {
            const id = __origSetTimeout(fn, delay, ...args);
            __timers.timeouts.add(id);
            return id;
        };
        window.clearTimeout = function(id) {
            __timers.timeouts.delete(id);
            return __origClearTimeout(id);
        };
        // 追踪 d3.timer / d3.interval
        if (window.d3 && d3.timer) {
            const __origD3Timer = d3.timer;
            d3.timer = function(callback, delay, time) {
                const t = __origD3Timer(callback, delay, time);
                try { __timers.d3Timers.add(t); } catch(_) {}
                return t;
            };
        }
        if (window.d3 && d3.interval) {
            const __origD3Interval = d3.interval;
            d3.interval = function(callback, delay, time) {
                const t = __origD3Interval(callback, delay, time);
                try { __timers.d3Timers.add(t); } catch(_) {}
                return t;
            };
        }
    })();

    function cleanupBeforeShow() {
        try {
            __timers.intervals.forEach(id => { try { clearInterval(id); } catch(_){} });
            __timers.timeouts.forEach(id => { try { clearTimeout(id); } catch(_){} });
            __timers.d3Timers.forEach(t => { try { t.stop && t.stop(); } catch(_){} });
            __timers.intervals.clear();
            __timers.timeouts.clear();
            __timers.d3Timers.clear();
        } catch (e) { console.warn('cleanup timers warning:', e); }
        // 清空所有右侧可视化容器子元素（保留容器）
        try {
            document.querySelectorAll('.right-visual div[id]').forEach(el => { el.innerHTML = ''; });
        } catch(e) { console.warn('cleanup visuals warning:', e); }
    }

    // 主题色（简单回退，避免未定义导致渲染失败）
    const __rootStyles = getComputedStyle(document.documentElement);
    const themeColors = {
        text: (__rootStyles.getPropertyValue('--text-color') || '').trim() || '#34495e',
        axis: (__rootStyles.getPropertyValue('--axis-color') || '').trim() || '#475569',
        muted: (__rootStyles.getPropertyValue('--muted-color') || '').trim() || '#94a3b8',
        surface: (__rootStyles.getPropertyValue('--card-bg') || '').trim() || '#ffffff'
    };

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        slides = document.querySelectorAll('.slide');
        totalSlides = slides.length;
        
        showSlide(0);

        // 将右侧覆盖式信息面板（如存在）迁移到左侧为精简信息块，避免遮挡3D
        try {
            const slideEls = document.querySelectorAll('#slidesContainer > .slide');
            slideEls.forEach(slide => {
                const rightPanel = slide.querySelector('.right-visual .info-panel');
                if (!rightPanel) return;
                const left = slide.querySelector('.left-content');
                if (!left) return;
                const box = document.createElement('div');
                box.className = 'info-box-left';
                // 尽量保留基本结构（标题/公式/段落），去除按钮等交互
                const cloned = rightPanel.cloneNode(true);
                // 移除折叠按钮
                const tgl = cloned.querySelector('.info-toggle'); if (tgl) tgl.remove();
                const content = cloned.querySelector('.info-content') || cloned;
                box.innerHTML = content.innerHTML || content.textContent || '';
                left.appendChild(box);
                // 移除右侧面板
                rightPanel.remove();
            });
        } catch(_) {}

        // 键盘导航
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextSlide();
            else if (e.key === 'ArrowLeft') previousSlide();
            else if (e.key === 'Home') showSlide(0);
            else if (e.key === 'End') showSlide(totalSlides - 1);
        });

        // 鼠标滚轮导航
        document.addEventListener('wheel', (e) => {
            // 如果鼠标在左侧内容区域，则不阻止默认的滚动行为
            if (e.target.closest('.left-content')) {
                return;
            }
            e.preventDefault();
            if (e.deltaY > 0) {
                nextSlide();
            } else {
                previousSlide();
            }
        }, { passive: false });

        // 自适应：窗口/方向变化时重绘当前页
        let __resizeTimer;
        function __rerenderCurrent() { showSlide(currentSlide); }
        window.addEventListener('resize', () => {
            clearTimeout(__resizeTimer);
            __resizeTimer = setTimeout(__rerenderCurrent, 250);
        });
        window.addEventListener('orientationchange', () => setTimeout(__rerenderCurrent, 300));
    });

    function showSlide(index) {
        if (index < 0 || index >= totalSlides) return;
        cleanupBeforeShow();
        
        slides.forEach(slide => slide.classList.remove('active'));
        currentSlide = index;
        slides[currentSlide].classList.add('active');
        
        // 更新页码输入框
        const slideInput = document.getElementById('slideNumberInput');
        const slideTotal = document.getElementById('slideNumberTotal');
        if (slideInput) {
            slideInput.value = currentSlide + 1;
            slideInput.max = totalSlides;
        }
        if (slideTotal) {
            slideTotal.textContent = totalSlides;
        }
        
        updateNavButtons();
        
        // 运行当前页的可视化（下一帧，确保DOM已渲染并有尺寸）
        requestAnimationFrame(() => runVisualization(currentSlide));
    }

    function nextSlide() {
        if (currentSlide < totalSlides - 1) {
            showSlide(currentSlide + 1);
        }
    }

    function previousSlide() {
        if (currentSlide > 0) {
            showSlide(currentSlide - 1);
        }
    }

    function jumpToSlide(value) {
        const slideNumber = parseInt(value);
        if (slideNumber >= 1 && slideNumber <= totalSlides) {
            currentSlide = slideNumber - 1;
            showSlide(currentSlide);
        }
    }

    function updateNavButtons() {
        const prevBtn = document.querySelector('.nav-btn:first-child');
        const nextBtn = document.querySelector('.nav-btn:last-child');
        if (prevBtn) prevBtn.disabled = (currentSlide === 0);
        if (nextBtn) nextBtn.disabled = (currentSlide === totalSlides - 1);
    }

    // Three.js: 兼容 ParametricGeometry 的简易实现（本地无示例库时使用）
    function createParametricGeometry(paramFn, uSegments = 30, vSegments = 30) {
        const geometry = new THREE.BufferGeometry();
        const positions = [];
        const indices = [];
        const nx = Math.max(1, uSegments);
        const ny = Math.max(1, vSegments);
        for (let i = 0; i <= nx; i++) {
            const u = i / nx;
            for (let j = 0; j <= ny; j++) {
                const v = j / ny;
                const target = new THREE.Vector3();
                if (paramFn.length >= 3) paramFn(u, v, target);
                else {
                    const res = paramFn(u, v);
                    if (res && res.isVector3) target.copy(res);
                    else if (Array.isArray(res)) target.set(res[0], res[1], res[2]);
                }
                positions.push(target.x, target.y, target.z);
            }
        }
        for (let i = 0; i < nx; i++) {
            for (let j = 0; j < ny; j++) {
                const a = i * (ny + 1) + j;
                const b = (i + 1) * (ny + 1) + j;
                const c = (i + 1) * (ny + 1) + (j + 1);
                const d = i * (ny + 1) + (j + 1);
                indices.push(a, b, d, b, c, d);
            }
        }
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        geometry.setIndex(indices);
        geometry.computeVertexNormals();
        return geometry;
    }

    // 运行可视化
    function runVisualization(slideIndex) {
        switch(slideIndex) {
            case 0: visualizeTitle9(); break;                        // 封面
            case 1: break;                                           // 目录（静态）
            case 2: visualizeWhyDoubleIntegral(); break;              // 为什么需要多元积分
            case 3: break;                                           // 过渡：二重积分（静态）
            case 4: visualizeDoubleIntegralConcept(); break;          // 二重积分概念
            case 5: visualizeProperties(); break;                     // 二重积分性质
            case 6: visualizeXTypeRegion(); break;                    // X型区域
            case 7: visualizeYTypeRegion(); break;                    // Y型区域
            case 8: visualizePolarCoordinates(); break;               // 极坐标
            case 9: visualizeVolumeApplication(); break;              // 应用：体积
            case 10: visualizeAreaApplication(); break;               // 应用：面积
            case 11: visualizeMassCenter(); break;                    // 应用：质量与重心
            case 12: visualizeMassCenterCase && visualizeMassCenterCase(); break; // 应用案例：薄片质心
            case 13: visualizeExample1(); break;                      // 计算实例1
            case 14: visualizeExample2(); break;                      // 计算实例2
            case 15: visualizeExample3(); break;                      // 计算实例3
            case 16: visualizeSymmetry(); break;                      // 对称性
            case 17: visualizeChangeOrder(); break;                   // 积分换序（顺延）
            case 18: visualizeChangeOrderExample && visualizeChangeOrderExample(); break; // 换序例题（顺延）
            case 19: visualizeCommonMistakes(); break;                // 常见错误（顺延）
            default: break;
        }
    }

    // 第1页：标题页可视化
    function visualizeTitle9() {
        const container = d3.select('#vis-title');
        if (container.empty()) return;
        container.selectAll('*').remove();
        
        const bounds = container.node().getBoundingClientRect();
        const width = bounds.width;
        const height = bounds.height;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 二重积分符号
        g.append('text')
            .attr('text-anchor', 'middle')
            .attr('font-size', '100px')
            .attr('fill', '#3498db')
            .attr('font-weight', 'bold')
            .text('∬')
            .style('opacity', 0)
            .transition()
            .duration(1000)
            .style('opacity', 1);
        
        // f(x,y) dxdy
        g.append('text')
            .attr('text-anchor', 'middle')
            .attr('x', 120)
            .attr('font-size', '35px')
            .attr('fill', '#2ecc71')
            .text('f(x,y)dxdy')
            .style('opacity', 0)
            .transition()
            .delay(800)
            .duration(1000)
            .style('opacity', 1);
        
        // 装饰圆环
        g.append('circle')
            .attr('r', 0)
            .attr('fill', 'none')
            .attr('stroke', '#9b59b6')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '10,5')
            .transition()
            .delay(1500)
            .duration(1500)
            .attr('r', 150);
    }

    // 第2页：为什么需要二重积分
    function visualizeWhyDoubleIntegral() {
        const container = d3.select('#vis-why-double-integral');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 创建一个不规则形状
        const points = [
            [width*0.3, height*0.3],
            [width*0.7, height*0.2],
            [width*0.8, height*0.5],
            [width*0.6, height*0.7],
            [width*0.2, height*0.6]
        ];
        
        // 绘制不规则区域
        const lineGenerator = d3.line()
            .x(d => d[0])
            .y(d => d[1])
            .curve(d3.curveCardinalClosed);
        
        const region = svg.append('path')
            .datum(points)
            .attr('d', lineGenerator)
            .attr('fill', 'rgba(52, 152, 219, 0.3)')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2);
        
        // 动画：分割成小块
        const gridSize = 20;
        const grid = svg.append('g').attr('class', 'grid');
        
        for(let x = width*0.2; x < width*0.8; x += gridSize) {
            for(let y = height*0.2; y < height*0.7; y += gridSize) {
                grid.append('rect')
                    .attr('x', x)
                    .attr('y', y)
                    .attr('width', gridSize)
                    .attr('height', gridSize)
                    .attr('fill', 'none')
                    .attr('stroke', themeColors.muted)
                    .attr('stroke-width', 0.5)
                    .attr('opacity', 0)
                    .transition()
                    .delay(Math.random() * 1000)
                    .duration(500)
                    .attr('opacity', 1);
            }
        }
        
        // 添加标签
        svg.append('text')
            .attr('x', width/2)
            .attr('y', height*0.9)
            .attr('text-anchor', 'middle')
            .style('font-size', '18px')
            .style('fill', '#2c3e50')
            .text('将复杂区域分割成小矩形');
    }

    // 第3页：二重积分概念可视化
    function visualizeDoubleIntegralConcept() {
        const container = document.getElementById('vis-double-integral-concept');
        container.innerHTML = '<div id="three-container"></div>';
        
        const width = container.clientWidth || container.getBoundingClientRect().width || 800;
        const height = container.clientHeight || container.getBoundingClientRect().height || 500;
        
        // 创建Three.js场景
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);
        
        const camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 1000);
        camera.position.set(5, 5, 5);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio || 1);
        renderer.setSize(width, height);
        document.getElementById('three-container').appendChild(renderer.domElement);
        
        // 添加光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        // 创建曲面 z = x^2 + y^2
        const geometry = createParametricGeometry(
            function(u, v, target) {
                const x = (u - 0.5) * 4;
                const y = (v - 0.5) * 4;
                const z = Math.max(0, 2 - (x*x + y*y) * 0.2);
                target.set(x, z, y);
            },
            50, 50
        );
        
        const material = new THREE.MeshPhongMaterial({
            color: 0x3498db,
            side: THREE.DoubleSide,
            transparent: true,
            opacity: 0.7,
            wireframe: false
        });
        
        const surface = new THREE.Mesh(geometry, material);
        scene.add(surface);
        
        // 添加底面网格
        const gridHelper = new THREE.GridHelper(4, 20, 0x888888, 0xcccccc);
        gridHelper.rotation.x = Math.PI / 2;
        scene.add(gridHelper);
        
        // 添加坐标轴
        const axesHelper = new THREE.AxesHelper(3);
        scene.add(axesHelper);
        
        // 动画
        function animate() {
            requestAnimationFrame(animate);
            surface.rotation.z += 0.005;
            renderer.render(scene, camera);
        }
        animate();
    }

    // 第4页：二重积分性质
    function visualizeProperties() {
        const container = d3.select('#vis-properties');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 可加性演示
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 区域D1
        g.append('rect')
            .attr('x', -150)
            .attr('y', -100)
            .attr('width', 140)
            .attr('height', 200)
            .attr('fill', 'rgba(52, 152, 219, 0.3)')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2);
        
        g.append('text')
            .attr('x', -80)
            .attr('y', 0)
            .attr('text-anchor', 'middle')
            .style('font-size', '20px')
            .text('D₁');
        
        // 区域D2
        g.append('rect')
            .attr('x', 10)
            .attr('y', -100)
            .attr('width', 140)
            .attr('height', 200)
            .attr('fill', 'rgba(231, 76, 60, 0.3)')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2);
        
        g.append('text')
            .attr('x', 80)
            .attr('y', 0)
            .attr('text-anchor', 'middle')
            .style('font-size', '20px')
            .text('D₂');
        
        // 等号
        g.append('text')
            .attr('x', 0)
            .attr('y', -150)
            .attr('text-anchor', 'middle')
            .style('font-size', '24px')
            .text('D = D₁ ∪ D₂');
    }

    // 第5页：X型区域
    function visualizeXTypeRegion() {
        const container = d3.select('#vis-x-type-region');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        const margin = {top: 40, right: 40, bottom: 60, left: 60};
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);
        
        // 创建坐标轴
        const xScale = d3.scaleLinear()
            .domain([0, 4])
            .range([0, innerWidth]);
        
        const yScale = d3.scaleLinear()
            .domain([0, 4])
            .range([innerHeight, 0]);
        
        // 添加坐标轴
        g.append('g')
            .attr('transform', `translate(0, ${innerHeight})`)
            .call(d3.axisBottom(xScale));
        
        g.append('g')
            .call(d3.axisLeft(yScale));
        
        // 定义区域边界函数
        const phi1 = x => x * 0.5;
        const phi2 = x => 3 - x * 0.5;
        
        // 创建区域路径
        const areaData = [];
        for(let x = 0.5; x <= 3.5; x += 0.1) {
            areaData.push({x: x, y0: phi1(x), y1: phi2(x)});
        }
        
        const area = d3.area()
            .x(d => xScale(d.x))
            .y0(d => yScale(d.y0))
            .y1(d => yScale(d.y1));
        
        // 绘制区域
        g.append('path')
            .datum(areaData)
            .attr('d', area)
            .attr('fill', 'rgba(52, 152, 219, 0.3)')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2);
        
        // 添加边界曲线标签
        g.append('text')
            .attr('x', xScale(3))
            .attr('y', yScale(phi1(3)) + 20)
            .style('font-size', '14px')
            .text('y = φ₁(x)');
        
        g.append('text')
            .attr('x', xScale(3))
            .attr('y', yScale(phi2(3)) - 10)
            .style('font-size', '14px')
            .text('y = φ₂(x)');
        
        // 动画：扫描线
        const scanLine = g.append('line')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '5,5');
        
        function animateScan() {
            let x = 0.5;
            const timer = d3.interval(() => {
                if (x > 3.5) {
                    x = 0.5;
                }
                scanLine
                    .attr('x1', xScale(x))
                    .attr('y1', yScale(phi1(x)))
                    .attr('x2', xScale(x))
                    .attr('y2', yScale(phi2(x)));
                x += 0.05;
            }, 50);
        }
        animateScan();
    }

    // 第6页：Y型区域
    function visualizeYTypeRegion() {
        const container = d3.select('#vis-y-type-region');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        const margin = {top: 40, right: 40, bottom: 60, left: 60};
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);
        
        // 创建坐标轴
        const xScale = d3.scaleLinear()
            .domain([0, 4])
            .range([0, innerWidth]);
        
        const yScale = d3.scaleLinear()
            .domain([0, 4])
            .range([innerHeight, 0]);
        
        // 添加坐标轴
        g.append('g')
            .attr('transform', `translate(0, ${innerHeight})`)
            .call(d3.axisBottom(xScale));
        
        g.append('g')
            .call(d3.axisLeft(yScale));
        
        // 定义区域边界函数
        const psi1 = y => y * 0.5;
        const psi2 = y => 3 - y * 0.5;
        
        // 创建区域
        const path = d3.path();
        path.moveTo(xScale(psi1(0.5)), yScale(0.5));
        for(let y = 0.5; y <= 3.5; y += 0.1) {
            path.lineTo(xScale(psi1(y)), yScale(y));
        }
        for(let y = 3.5; y >= 0.5; y -= 0.1) {
            path.lineTo(xScale(psi2(y)), yScale(y));
        }
        path.closePath();
        
        g.append('path')
            .attr('d', path.toString())
            .attr('fill', 'rgba(46, 204, 113, 0.3)')
            .attr('stroke', '#2ecc71')
            .attr('stroke-width', 2);
        
        // 动画：水平扫描线
        const scanLine = g.append('line')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('stroke-dasharray', '5,5');
        
        function animateScan() {
            let y = 0.5;
            const timer = d3.interval(() => {
                if (y > 3.5) {
                    y = 0.5;
                }
                scanLine
                    .attr('x1', xScale(psi1(y)))
                    .attr('y1', yScale(y))
                    .attr('x2', xScale(psi2(y)))
                    .attr('y2', yScale(y));
                y += 0.05;
            }, 50);
        }
        animateScan();
    }

    // 第7页：极坐标系
    function visualizePolarCoordinates() {
        const container = d3.select('#vis-polar-coordinates');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        const radius = Math.min(width, height) / 2 - 40;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 绘制极坐标网格
        const radialScale = d3.scaleLinear()
            .domain([0, 3])
            .range([0, radius]);
        
        // 同心圆
        for(let r = 0.5; r <= 3; r += 0.5) {
            g.append('circle')
                .attr('r', radialScale(r))
                .attr('fill', 'none')
                .attr('stroke', '#ddd')
                .attr('stroke-width', 1);
        }
        
        // 角度线
        const angles = d3.range(0, 360, 30);
        angles.forEach(angle => {
            const radian = angle * Math.PI / 180;
            g.append('line')
                .attr('x1', 0)
                .attr('y1', 0)
                .attr('x2', radius * Math.cos(radian))
                .attr('y2', radius * Math.sin(radian))
                .attr('stroke', '#ddd')
                .attr('stroke-width', 1);
        });
        
        // 绘制一个扇形区域
        const arc = d3.arc()
            .innerRadius(radialScale(1))
            .outerRadius(radialScale(2.5))
            .startAngle(Math.PI / 6)
            .endAngle(Math.PI / 2);
        
        g.append('path')
            .attr('d', arc)
            .attr('fill', 'rgba(155, 89, 182, 0.3)')
            .attr('stroke', '#9b59b6')
            .attr('stroke-width', 2);
        
        // 添加标签
        g.append('text')
            .attr('x', 0)
            .attr('y', -radius - 20)
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('极坐标系: dA = r dr dθ');
        
        // 动画点
        const point = g.append('circle')
            .attr('r', 5)
            .attr('fill', '#e74c3c');
        
        let theta = 0;
        const r = 2;
        d3.timer(() => {
            theta += 0.01;
            const x = radialScale(r) * Math.cos(theta);
            const y = radialScale(r) * Math.sin(theta);
            point.attr('cx', x).attr('cy', y);
        });
    }

    // 第8页：体积应用
    function visualizeVolumeApplication() {
        const container = document.getElementById('vis-volume-application');
        container.innerHTML = '<div id="three-container"></div>';
        
        const width = container.clientWidth || container.getBoundingClientRect().width || 800;
        const height = container.clientHeight || container.getBoundingClientRect().height || 500;
        
        // Three.js场景设置
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf5f5f5);
        
        const camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 1000);
        camera.position.set(3, 3, 3);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio || 1);
        renderer.setSize(width, height);
        document.getElementById('three-container').appendChild(renderer.domElement);
        
        // 光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        // 创建半球
        const geometry = new THREE.SphereGeometry(1, 32, 16, 0, Math.PI * 2, 0, Math.PI / 2);
        const material = new THREE.MeshPhongMaterial({
            color: 0x3498db,
            transparent: true,
            opacity: 0.7,
            side: THREE.DoubleSide
        });
        
        const hemisphere = new THREE.Mesh(geometry, material);
        scene.add(hemisphere);
        
        // 添加底面圆
        const circleGeometry = new THREE.CircleGeometry(1, 32);
        const circleMaterial = new THREE.MeshBasicMaterial({
            color: 0x2ecc71,
            transparent: true,
            opacity: 0.3,
            side: THREE.DoubleSide
        });
        const circle = new THREE.Mesh(circleGeometry, circleMaterial);
        circle.rotation.x = -Math.PI / 2;
        scene.add(circle);
        
        // 添加网格辅助
        const gridHelper = new THREE.GridHelper(2, 20);
        scene.add(gridHelper);
        
        // 动画
        function animate() {
            requestAnimationFrame(animate);
            hemisphere.rotation.y += 0.01;
            circle.rotation.z += 0.01;
            renderer.render(scene, camera);
        }
        animate();
    }

    // 第9页：面积应用
    function visualizeAreaApplication() {
        const container = d3.select('#vis-area-application');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 创建一个参数曲线区域
        const t = d3.range(0, 2 * Math.PI, 0.01);
        const points = t.map(angle => {
            const r = 100 * (1 + 0.5 * Math.cos(3 * angle));
            return [r * Math.cos(angle), r * Math.sin(angle)];
        });
        
        const line = d3.line()
            .x(d => d[0])
            .y(d => d[1])
            .curve(d3.curveCardinalClosed);
        
        // 绘制区域
        const path = g.append('path')
            .datum(points)
            .attr('d', line)
            .attr('fill', 'rgba(52, 152, 219, 0.2)')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2);
        
        // 添加网格线动画
        const numLines = 20;
        for(let i = 0; i < numLines; i++) {
            const angle = (i / numLines) * 2 * Math.PI;
            const endR = 100 * (1 + 0.5 * Math.cos(3 * angle));
            
            g.append('line')
                .attr('x1', 0)
                .attr('y1', 0)
                .attr('x2', 0)
                .attr('y2', 0)
                .attr('stroke', themeColors.muted)
                .attr('stroke-width', 0.5)
                .attr('opacity', 0.5)
                .transition()
                .delay(i * 50)
                .duration(500)
                .attr('x2', endR * Math.cos(angle))
                .attr('y2', endR * Math.sin(angle));
        }
        
        // 添加标签
        g.append('text')
            .attr('y', -180)
            .attr('text-anchor', 'middle')
            .style('font-size', '18px')
            .text('面积 = ∬_D 1 dA');
    }

    // 第10页：质量与重心
    function visualizeMassCenter() {
        const container = d3.select('#vis-mass-center');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 创建一个不规则形状表示薄片
        const points = [
            [-100, -50],
            [50, -80],
            [120, 0],
            [80, 100],
            [-60, 90],
            [-120, 20]
        ];
        
        const line = d3.line()
            .x(d => d[0])
            .y(d => d[1])
            .curve(d3.curveCardinalClosed);
        
        // 绘制薄片
        g.append('path')
            .datum(points)
            .attr('d', line)
            .attr('fill', 'url(#density-gradient)')
            .attr('stroke', '#34495e')
            .attr('stroke-width', 2);
        
        // 创建密度渐变
        const gradient = svg.append('defs')
            .append('radialGradient')
            .attr('id', 'density-gradient');
        
        gradient.append('stop')
            .attr('offset', '0%')
            .attr('stop-color', '#e74c3c')
            .attr('stop-opacity', 0.8);
        
        gradient.append('stop')
            .attr('offset', '100%')
            .attr('stop-color', '#f39c12')
            .attr('stop-opacity', 0.3);
        
        // 标记重心
        const centerX = 10;
        const centerY = 20;
        
        const center = g.append('g');
        
        center.append('circle')
            .attr('cx', centerX)
            .attr('cy', centerY)
            .attr('r', 0)
            .attr('fill', '#2ecc71')
            .attr('stroke', '#27ae60')
            .attr('stroke-width', 2)
            .transition()
            .delay(1000)
            .duration(500)
            .attr('r', 8);
        
        center.append('text')
            .attr('x', centerX + 15)
            .attr('y', centerY - 10)
            .style('font-size', '14px')
            .style('opacity', 0)
            .text('重心')
            .transition()
            .delay(1500)
            .duration(500)
            .style('opacity', 1);
        
        // 添加坐标轴
        g.append('line')
            .attr('x1', -width/2 + 50)
            .attr('x2', width/2 - 50)
            .attr('y1', 0)
            .attr('y2', 0)
            .attr('stroke', themeColors.muted)
            .attr('stroke-width', 1)
            .attr('stroke-dasharray', '2,2');
        
        g.append('line')
            .attr('x1', 0)
            .attr('x2', 0)
            .attr('y1', -height/2 + 50)
            .attr('y2', height/2 - 50)
            .attr('stroke', themeColors.muted)
            .attr('stroke-width', 1)
            .attr('stroke-dasharray', '2,2');
    }

    // 第11页：计算实例1
    function visualizeExample1() {
        const container = d3.select('#vis-example1');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        const margin = {top: 40, right: 40, bottom: 60, left: 60};
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);
        
        // 创建坐标轴
        const xScale = d3.scaleLinear()
            .domain([0, 1.5])
            .range([0, innerWidth]);
        
        const yScale = d3.scaleLinear()
            .domain([0, 2.5])
            .range([innerHeight, 0]);
        
        g.append('g')
            .attr('transform', `translate(0, ${innerHeight})`)
            .call(d3.axisBottom(xScale));
        
        g.append('g')
            .call(d3.axisLeft(yScale));
        
        // 绘制矩形区域
        const rect = g.append('rect')
            .attr('x', xScale(0))
            .attr('y', yScale(2))
            .attr('width', xScale(1) - xScale(0))
            .attr('height', yScale(0) - yScale(2))
            .attr('fill', 'rgba(52, 152, 219, 0.3)')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2);
        
        // 添加标签
        g.append('text')
            .attr('x', xScale(0.5))
            .attr('y', yScale(1))
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('D = [0,1] × [0,2]');
        
        // 动画：积分路径
        const numLines = 20;
        for(let i = 0; i <= numLines; i++) {
            const x = i / numLines;
            g.append('line')
                .attr('x1', xScale(x))
                .attr('y1', yScale(0))
                .attr('x2', xScale(x))
                .attr('y2', yScale(0))
                .attr('stroke', '#e74c3c')
                .attr('stroke-width', 1)
                .attr('opacity', 0.5)
                .transition()
                .delay(i * 100)
                .duration(500)
                .attr('y2', yScale(2));
        }
    }

    // 第12页：计算实例2 - 三角形区域
    function visualizeExample2() {
        const container = d3.select('#vis-example2');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        const margin = {top: 40, right: 40, bottom: 60, left: 60};
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left}, ${margin.top})`);
        
        // 创建坐标轴
        const xScale = d3.scaleLinear()
            .domain([0, 1.5])
            .range([0, innerWidth]);
        
        const yScale = d3.scaleLinear()
            .domain([0, 1.5])
            .range([innerHeight, 0]);
        
        g.append('g')
            .attr('transform', `translate(0, ${innerHeight})`)
            .call(d3.axisBottom(xScale));
        
        g.append('g')
            .call(d3.axisLeft(yScale));
        
        // 绘制三角形
        const triangle = [
            [xScale(0), yScale(0)],
            [xScale(1), yScale(0)],
            [xScale(0), yScale(1)]
        ];
        
        g.append('polygon')
            .attr('points', triangle.map(p => p.join(',')).join(' '))
            .attr('fill', 'rgba(46, 204, 113, 0.3)')
            .attr('stroke', '#2ecc71')
            .attr('stroke-width', 2);
        
        // 标记顶点
        triangle.forEach((point, i) => {
            g.append('circle')
                .attr('cx', point[0])
                .attr('cy', point[1])
                .attr('r', 4)
                .attr('fill', '#e74c3c');
        });
        
        // 添加扫描线动画
        let scanX = 0;
        const scanLine = g.append('line')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2)
            .attr('opacity', 0.6);
        
        d3.timer(() => {
            scanX = (scanX + 0.01) % 1;
            scanLine
                .attr('x1', xScale(scanX))
                .attr('y1', yScale(0))
                .attr('x2', xScale(scanX))
                .attr('y2', yScale(1 - scanX));
        });
    }

    // 第13页：计算实例3 - 圆形区域（极坐标）
    function visualizeExample3() {
        const container = d3.select('#vis-example3');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        const radius = Math.min(width, height) / 2 - 40;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 绘制圆形区域
        g.append('circle')
            .attr('r', radius)
            .attr('fill', 'rgba(155, 89, 182, 0.2)')
            .attr('stroke', '#9b59b6')
            .attr('stroke-width', 2);
        
        // 绘制极坐标网格
        for(let r = radius/4; r <= radius; r += radius/4) {
            g.append('circle')
                .attr('r', r)
                .attr('fill', 'none')
                .attr('stroke', '#ddd')
                .attr('stroke-width', 0.5);
        }
        
        for(let angle = 0; angle < 360; angle += 30) {
            const radian = angle * Math.PI / 180;
            g.append('line')
                .attr('x1', 0)
                .attr('y1', 0)
                .attr('x2', radius * Math.cos(radian))
                .attr('y2', radius * Math.sin(radian))
                .attr('stroke', '#ddd')
                .attr('stroke-width', 0.5);
        }
        
        // 添加高斯函数的等高线
        const contours = [0.9, 0.7, 0.5, 0.3, 0.1];
        contours.forEach(level => {
            const r = radius * Math.sqrt(-Math.log(level));
            if (r <= radius) {
                g.append('circle')
                    .attr('r', r)
                    .attr('fill', 'none')
                    .attr('stroke', '#3498db')
                    .attr('stroke-width', 1)
                    .attr('opacity', level);
            }
        });
        
        // 添加标签
        g.append('text')
            .attr('y', -radius - 20)
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('e^(-r²) 在圆域上的积分');
    }

    // 第14页：对称性
    function visualizeSymmetry() {
        const container = d3.select('#vis-symmetry');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 创建两个子图
        const g1 = svg.append('g')
            .attr('transform', `translate(${width/4}, ${height/2})`);
        
        const g2 = svg.append('g')
            .attr('transform', `translate(${width*3/4}, ${height/2})`);
        
        const size = Math.min(width/4, height/2) - 40;
        
        // 左图：关于y轴对称的奇函数
        g1.append('text')
            .attr('y', -size - 20)
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('奇函数：积分 = 0');
        
        // 绘制对称区域
        g1.append('rect')
            .attr('x', -size)
            .attr('y', -size)
            .attr('width', size * 2)
            .attr('height', size * 2)
            .attr('fill', 'none')
            .attr('stroke', themeColors.muted)
            .attr('stroke-width', 1);
        
        // 绘制y轴
        g1.append('line')
            .attr('x1', 0)
            .attr('x2', 0)
            .attr('y1', -size)
            .attr('y2', size)
            .attr('stroke', '#333')
            .attr('stroke-width', 2);
        
        // 绘制奇函数示意（正负区域）
        g1.append('rect')
            .attr('x', 0)
            .attr('y', -size/2)
            .attr('width', size)
            .attr('height', size)
            .attr('fill', 'rgba(231, 76, 60, 0.3)');
        
        g1.append('rect')
            .attr('x', -size)
            .attr('y', -size/2)
            .attr('width', size)
            .attr('height', size)
            .attr('fill', 'rgba(52, 152, 219, 0.3)');
        
        g1.append('text')
            .attr('x', size/2)
            .attr('y', 0)
            .attr('text-anchor', 'middle')
            .text('+');
        
        g1.append('text')
            .attr('x', -size/2)
            .attr('y', 0)
            .attr('text-anchor', 'middle')
            .text('−');
        
        // 右图：关于y轴对称的偶函数
        g2.append('text')
            .attr('y', -size - 20)
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('偶函数：积分 = 2×右半部分');
        
        // 绘制对称区域
        g2.append('rect')
            .attr('x', -size)
            .attr('y', -size)
            .attr('width', size * 2)
            .attr('height', size * 2)
            .attr('fill', 'none')
            .attr('stroke', themeColors.muted)
            .attr('stroke-width', 1);
        
        // 绘制y轴
        g2.append('line')
            .attr('x1', 0)
            .attr('x2', 0)
            .attr('y1', -size)
            .attr('y2', size)
            .attr('stroke', '#333')
            .attr('stroke-width', 2);
        
        // 绘制偶函数示意（对称正区域）
        g2.append('rect')
            .attr('x', -size)
            .attr('y', -size/2)
            .attr('width', size * 2)
            .attr('height', size)
            .attr('fill', 'rgba(46, 204, 113, 0.3)');
        
        g2.append('text')
            .attr('x', size/2)
            .attr('y', 0)
            .attr('text-anchor', 'middle')
            .text('+');
        
        g2.append('text')
            .attr('x', -size/2)
            .attr('y', 0)
            .attr('text-anchor', 'middle')
            .text('+');
    }

    // 第15页：概念
    function visualizeTripleIntegral() {
        const container = document.getElementById('vis-triple-integral');
        container.innerHTML = '<div id="three-container"></div>';
        
        const width = container.clientWidth || container.getBoundingClientRect().width || 800;
        const height = container.clientHeight || container.getBoundingClientRect().height || 500;
        
        // Three.js场景
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);
        
        const camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 1000);
        camera.position.set(4, 4, 4);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio || 1);
        renderer.setSize(width, height);
        document.getElementById('three-container').appendChild(renderer.domElement);
        
        // 光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        // 创建一个立方体区域
        const geometry = new THREE.BoxGeometry(2, 2, 2);
        const material = new THREE.MeshPhongMaterial({
            color: 0x3498db,
            transparent: true,
            opacity: 0.3,
            wireframe: false
        });
        
        const cube = new THREE.Mesh(geometry, material);
        scene.add(cube);
        
        // 添加边框
        const edges = new THREE.EdgesGeometry(geometry);
        const lineMaterial = new THREE.LineBasicMaterial({ color: 0x000000 });
        const wireframe = new THREE.LineSegments(edges, lineMaterial);
        scene.add(wireframe);
        
        // 添加小立方体表示分割
        const smallCubeGeometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
        const smallCubeMaterial = new THREE.MeshPhongMaterial({
            color: 0xe74c3c,
            transparent: true,
            opacity: 0.7
        });
        
        const numDivisions = 5;
        for(let i = 0; i < numDivisions; i++) {
            for(let j = 0; j < numDivisions; j++) {
                for(let k = 0; k < numDivisions; k++) {
                    const smallCube = new THREE.Mesh(smallCubeGeometry, smallCubeMaterial);
                    smallCube.position.set(
                        -0.8 + i * 0.4,
                        -0.8 + j * 0.4,
                        -0.8 + k * 0.4
                    );
                    scene.add(smallCube);
                }
            }
        }
        
        // 动画
        function animate() {
            requestAnimationFrame(animate);
            cube.rotation.y += 0.005;
            wireframe.rotation.y += 0.005;
            renderer.render(scene, camera);
        }
        animate();
    }

    // 第16页：计算
    function visualizeTripleCalculation() {
        const container = d3.select('#vis-triple-calculation');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 绘制积分顺序示意图
        const levels = [
            { y: -100, text: '∫∫∫ f(x,y,z) dV', color: '#3498db' },
            { y: -40, text: '↓ 先对z积分', color: themeColors.muted },
            { y: 20, text: '∫∫ F(x,y) dA', color: '#2ecc71' },
            { y: 80, text: '↓ 再对y积分', color: themeColors.muted },
            { y: 140, text: '∫ G(x) dx', color: '#e74c3c' }
        ];
        
        levels.forEach((level, i) => {
            g.append('text')
                .attr('y', level.y)
                .attr('text-anchor', 'middle')
                .style('font-size', '20px')
                .style('fill', level.color)
                .style('opacity', 0)
                .text(level.text)
                .transition()
                .delay(i * 500)
                .duration(500)
                .style('opacity', 1);
        });
    }

    // 第17页：柱坐标系
    function visualizeCylindrical() {
        const container = document.getElementById('vis-cylindrical');
        container.innerHTML = '<div id="three-container"></div>';
        
        const width = container.clientWidth || container.getBoundingClientRect().width || 800;
        const height = container.clientHeight || container.getBoundingClientRect().height || 500;
        
        // Three.js场景
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf5f5f5);
        
        const camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 1000);
        camera.position.set(3, 3, 3);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio || 1);
        renderer.setSize(width, height);
        document.getElementById('three-container').appendChild(renderer.domElement);
        
        // 光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        // 创建圆柱体
        const geometry = new THREE.CylinderGeometry(1, 1, 2, 32);
        const material = new THREE.MeshPhongMaterial({
            color: 0x9b59b6,
            transparent: true,
            opacity: 0.5
        });
        
        const cylinder = new THREE.Mesh(geometry, material);
        scene.add(cylinder);
        
        // 添加边框
        const edges = new THREE.EdgesGeometry(geometry);
        const lineMaterial = new THREE.LineBasicMaterial({ color: 0x000000 });
        const wireframe = new THREE.LineSegments(edges, lineMaterial);
        scene.add(wireframe);
        
        // 添加坐标轴
        const axesHelper = new THREE.AxesHelper(2);
        scene.add(axesHelper);
        
        // 动画
        function animate() {
            requestAnimationFrame(animate);
            cylinder.rotation.y += 0.01;
            wireframe.rotation.y += 0.01;
            renderer.render(scene, camera);
        }
        animate();
    }

    // 第18页：系
    function visualizeSpherical() {
        const container = document.getElementById('vis-spherical');
        container.innerHTML = '<div id="three-container"></div>';
        
        const width = container.clientWidth || container.getBoundingClientRect().width || 800;
        const height = container.clientHeight || container.getBoundingClientRect().height || 500;
        
        // Three.js场景
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf5f5f5);
        
        const camera = new THREE.PerspectiveCamera(45, width/height, 0.1, 1000);
        camera.position.set(3, 3, 3);
        camera.lookAt(0, 0, 0);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio || 1);
        renderer.setSize(width, height);
        document.getElementById('three-container').appendChild(renderer.domElement);
        
        // 光源
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
        directionalLight.position.set(5, 5, 5);
        scene.add(directionalLight);
        
        // 创建球体
        const geometry = new THREE.SphereGeometry(1, 32, 32);
        const material = new THREE.MeshPhongMaterial({
            color: 0xf39c12,
            transparent: true,
            opacity: 0.5,
            wireframe: false
        });
        
        const sphere = new THREE.Mesh(geometry, material);
        scene.add(sphere);
        
        // 添加经纬线
        const wireframeGeometry = new THREE.SphereGeometry(1.01, 16, 8);
        const wireframeMaterial = new THREE.MeshBasicMaterial({
            color: 0x333333,
            wireframe: true,
            transparent: true,
            opacity: 0.3
        });
        const wireframeSphere = new THREE.Mesh(wireframeGeometry, wireframeMaterial);
        scene.add(wireframeSphere);
        
        // 添加坐标轴
        const axesHelper = new THREE.AxesHelper(1.5);
        scene.add(axesHelper);
        
        // 动画
        function animate() {
            requestAnimationFrame(animate);
            sphere.rotation.y += 0.01;
            wireframeSphere.rotation.y += 0.01;
            renderer.render(scene, camera);
        }
        animate();
    }

    // 第19页：应用
    function visualizeTripleApplications() {
        const container = d3.select('#vis-triple-applications');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 创建三个应用示例
        const examples = [
            { x: width/4, y: height/2, title: '体积', formula: 'V = ∫∫∫ 1 dV', color: '#3498db' },
            { x: width/2, y: height/2, title: '质量', formula: 'M = ∫∫∫ ρ dV', color: '#2ecc71' },
            { x: width*3/4, y: height/2, title: '质心', formula: 'x̄ = (1/M)∫∫∫ xρ dV', color: '#e74c3c' }
        ];
        
        examples.forEach((ex, i) => {
            const g = svg.append('g')
                .attr('transform', `translate(${ex.x}, ${ex.y})`);
            
            // 绘制圆形背景
            g.append('circle')
                .attr('r', 0)
                .attr('fill', ex.color)
                .attr('opacity', 0.2)
                .transition()
                .delay(i * 300)
                .duration(500)
                .attr('r', 60);
            
            // 添加标题
            g.append('text')
                .attr('y', -20)
                .attr('text-anchor', 'middle')
                .style('font-size', '18px')
                .style('font-weight', 'bold')
                .style('opacity', 0)
                .text(ex.title)
                .transition()
                .delay(i * 300 + 200)
                .duration(500)
                .style('opacity', 1);
            
            // 添加公式
            g.append('text')
                .attr('y', 20)
                .attr('text-anchor', 'middle')
                .style('font-size', '14px')
                .style('opacity', 0)
                .text(ex.formula)
                .transition()
                .delay(i * 300 + 400)
                .duration(500)
                .style('opacity', 1);
        });
    }

    // 第20页：积分换序
    function visualizeChangeOrder() {
        const container = d3.select('#vis-change-order');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        // 创建两个坐标系
        const g1 = svg.append('g')
            .attr('transform', `translate(${width/4}, ${height/2})`);
        
        const g2 = svg.append('g')
            .attr('transform', `translate(${width*3/4}, ${height/2})`);
        
        const size = Math.min(width/4, height/2) - 60;
        
        // 左图：dxdy积分顺序
        g1.append('text')
            .attr('y', -size - 30)
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('先对y积分，再对x积分');
        
        // 绘制积分区域
        const region1 = [
            [-size/2, -size/2],
            [size/2, -size/2],
            [size/2, size/4],
            [0, size/2],
            [-size/2, size/4]
        ];
        
        const line = d3.line()
            .x(d => d[0])
            .y(d => d[1]);
        
        g1.append('path')
            .datum(region1)
            .attr('d', line)
            .attr('fill', 'rgba(52, 152, 219, 0.3)')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2);
        
        // 添加扫描线
        for(let i = 0; i < 10; i++) {
            const x = -size/2 + i * size / 10;
            g1.append('line')
                .attr('x1', x)
                .attr('y1', -size/2)
                .attr('x2', x)
                .attr('y2', size/2)
                .attr('stroke', '#e74c3c')
                .attr('stroke-width', 0.5)
                .attr('opacity', 0)
                .transition()
                .delay(i * 100)
                .duration(300)
                .attr('opacity', 0.5);
        }
        
        // 右图：dydx积分顺序
        g2.append('text')
            .attr('y', -size - 30)
            .attr('text-anchor', 'middle')
            .style('font-size', '16px')
            .text('先对x积分，再对y积分');
        
        g2.append('path')
            .datum(region1)
            .attr('d', line)
            .attr('fill', 'rgba(46, 204, 113, 0.3)')
            .attr('stroke', '#2ecc71')
            .attr('stroke-width', 2);
        
        // 添加水平扫描线
        for(let i = 0; i < 10; i++) {
            const y = -size/2 + i * size / 10;
            g2.append('line')
                .attr('x1', -size/2)
                .attr('y1', y)
                .attr('x2', size/2)
                .attr('y2', y)
                .attr('stroke', '#e74c3c')
                .attr('stroke-width', 0.5)
                .attr('opacity', 0)
                .transition()
                .delay(i * 100)
                .duration(300)
                .attr('opacity', 0.5);
        }
    }

    // 新增：换序计算例题（简易可视化）
    function visualizeChangeOrderExample() {
        const container = d3.select('#vis-change-order-example');
        if (container.empty()) return;
        container.selectAll("*").remove();
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        const margin = {top: 40, right: 40, bottom: 60, left: 60};
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;
        const svg = container.append('svg').attr('width', width).attr('height', height);
        const g = svg.append('g').attr('transform', `translate(${margin.left}, ${margin.top})`);
        const xScale = d3.scaleLinear().domain([0, 1]).range([0, innerWidth]);
        const yScale = d3.scaleLinear().domain([0, 1]).range([innerHeight, 0]);
        g.append('g').attr('transform', `translate(0, ${innerHeight})`).call(d3.axisBottom(xScale));
        g.append('g').call(d3.axisLeft(yScale));
        // 原描述区域 y ≤ 1 - x
        const triPath = d3.path();
        triPath.moveTo(xScale(0), yScale(0));
        triPath.lineTo(xScale(1), yScale(0));
        triPath.lineTo(xScale(0), yScale(1));
        triPath.closePath();
        g.append('path').attr('d', triPath.toString()).attr('fill', 'rgba(52,152,219,0.25)').attr('stroke', '#3498db');
        // 扫描线对比（两种换序）
        const scanX = g.append('line').attr('stroke', '#e74c3c').attr('stroke-width', 2).attr('opacity', 0.7);
        const scanY = g.append('line').attr('stroke', '#2ecc71').attr('stroke-width', 2).attr('opacity', 0.7);
        let t = 0; const timer = d3.interval(() => {
            t = (t + 0.02) % 1;
            const x = t; const y = t;
            scanX.attr('x1', xScale(x)).attr('y1', yScale(0)).attr('x2', xScale(x)).attr('y2', yScale(1 - x));
            scanY.attr('x1', xScale(0)).attr('y1', yScale(y)).attr('x2', xScale(1 - y)).attr('y2', yScale(y));
        }, 80);
    }

    // 新增：质量与重心案例（简易可视化）
    function visualizeMassCenterCase() {
        const container = d3.select('#vis-mass-center-case');
        if (container.empty()) return;
        container.selectAll('*').remove();
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        const svg = container.append('svg').attr('width', width).attr('height', height);
        const g = svg.append('g').attr('transform', `translate(${width/2}, ${height/2})`);
        const tri = [[0,0],[1,0],[1,1]].map(([x,y]) => [ (x-0.5)*240, (0.5-y)*240 ]);
        const p = d3.path(); p.moveTo(tri[0][0], tri[0][1]); p.lineTo(tri[1][0], tri[1][1]); p.lineTo(tri[2][0], tri[2][1]); p.closePath();
        g.append('path').attr('d', p.toString()).attr('fill', 'rgba(46,204,113,0.25)').attr('stroke', '#16a085');
        // 质心点（示意）
        const cx = (0.5+0.583-0.5)*240/2, cy = (0.5-0.208-0.5)*240/2; // 仅示意位置
        g.append('circle').attr('cx', 40).attr('cy', -50).attr('r', 6).attr('fill', '#e67e22');
        g.append('text').attr('x', 52).attr('y', -56).attr('fill', '#e67e22').attr('font-size', 12).text('质心');
    }

    // 第21页：常见错误
    function visualizeCommonMistakes() {
        const container = d3.select('#vis-common-mistakes');
        container.selectAll("*").remove();
        
        const width = container.node().clientWidth;
        const height = container.node().clientHeight;
        
        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);
        
        const g = svg.append('g')
            .attr('transform', `translate(${width/2}, ${height/2})`);
        
        // 创建错误示例
        const mistakes = [
            { 
                x: -width/3, 
                y: -height/4, 
                text: '积分限错误', 
                example: '∫₀¹∫₀ˣ → ∫₀¹∫ₓ¹', 
                color: '#e74c3c' 
            },
            { 
                x: 0, 
                y: -height/4, 
                text: '忘记雅可比', 
                example: '∬ f(r,θ) drdθ → ∬ f(r,θ) r drdθ', 
                color: '#f39c12' 
            },
            { 
                x: width/3, 
                y: -height/4, 
                text: '区域不完整', 
                example: '遗漏边界条件', 
                color: '#9b59b6' 
            }
        ];
        
        mistakes.forEach((mistake, i) => {
            const group = g.append('g')
                .attr('transform', `translate(${mistake.x}, ${mistake.y})`);
            
            // 错误标记
            group.append('text')
                .attr('y', -20)
                .attr('text-anchor', 'middle')
                .style('font-size', '24px')
                .style('fill', mistake.color)
                .style('opacity', 0)
                .text('❌')
                .transition()
                .delay(i * 500)
                .duration(500)
                .style('opacity', 1);
            
            // 错误描述
            group.append('text')
                .attr('y', 10)
                .attr('text-anchor', 'middle')
                .style('font-size', '16px')
                .style('font-weight', 'bold')
                .style('opacity', 0)
                .text(mistake.text)
                .transition()
                .delay(i * 500 + 200)
                .duration(500)
                .style('opacity', 1);
            
            // 示例
            group.append('text')
                .attr('y', 35)
                .attr('text-anchor', 'middle')
                .style('font-size', '12px')
                .style('opacity', 0)
                .text(mistake.example)
                .transition()
                .delay(i * 500 + 400)
                .duration(500)
                .style('opacity', 1);
        });
        
        // 正确做法提示
        g.append('text')
            .attr('y', height/3)
            .attr('text-anchor', 'middle')
            .style('font-size', '20px')
            .style('fill', '#2ecc71')
            .style('font-weight', 'bold')
            .style('opacity', 0)
            .text('✅ 解决方法：画图！检查！验证！')
            .transition()
            .delay(2000)
            .duration(1000)
            .style('opacity', 1);
    }
</script>

<!-- 悬浮控制按钮与二级菜单（统一样式） -->
<button class="floating-control-btn" id="floating-control-btn"><span class="btn-icon">+</span></button>
<div class="floating-menu-items" id="floating-menu-items">
    <div class="floating-menu-item" onclick="event.stopPropagation(); toggleLabSubmenu()">
        <span class="item-icon"><i class="fa-solid fa-flask"></i></span>
        <span class="item-text">实验室</span>
    </div>
    <div class="floating-menu-item" onclick="event.stopPropagation(); toggleChapterSubmenu()">
        <span class="item-icon"><i class="fa-solid fa-clipboard-list"></i></span>
        <span class="item-text">本章目录</span>
    </div>
</div>

<!-- 实验室弹层（第九章） -->
<div class="lab-submenu" id="lab-submenu" style="display: none;">
    <div class="submenu-content">
        <div class="submenu-title">第九章实验室</div>
        <div class="submenu-grid">
            <div class="submenu-item" onclick="window.open('../网页资源/index.html','_blank')"><span class="submenu-icon"><i class="fa-solid fa-list"></i></span><span class="submenu-text">资源总览</span></div>
            <div class="submenu-item" onclick="window.open('../网页资源/lab 9-1.html','_blank')"><span class="submenu-icon"><i class="fa-solid fa-vial"></i></span><span class="submenu-text">二重积分可视化实验室</span></div>
            <div class="submenu-item" onclick="window.open('../网页资源/lab 9-2.html','_blank')"><span class="submenu-icon"><i class="fa-solid fa-vial"></i></span><span class="submenu-text">极坐标与面积元素实验室</span></div>
            <!-- 移除相关实验室（高职不涉及） -->
        </div>
        <div class="submenu-close" onclick="toggleLabSubmenu()">×</div>
    </div>
</div>

<!-- 本章目录弹层（自动生成） -->
<div class="chapter-submenu" id="chapter-submenu" style="display:none;">
    <div class="submenu-content">
        <div class="submenu-title">第九章目录</div>
        <div class="submenu-grid" id="chapter-submenu-grid"></div>
        <div class="submenu-close" onclick="toggleChapterSubmenu()">×</div>
    </div>
</div>

<!-- 全部课件目录弹层 -->
<div class="course-submenu" id="course-submenu" style="display: none;">
    <div class="submenu-content">
        <div class="submenu-title">全部课件目录</div>
        <div class="submenu-grid">
            <div class="submenu-item" onclick="window.location.href='第1章代数.html';"><span class="submenu-icon"><i class="fa-solid fa-1"></i></span><span class="submenu-text">第1章 代数</span></div>
            <div class="submenu-item" onclick="window.location.href='第2章极限与连续.html';"><span class="submenu-icon"><i class="fa-solid fa-2"></i></span><span class="submenu-text">第2章 极限与连续</span></div>
            <div class="submenu-item" onclick="window.location.href='第3章导数与微分.html';"><span class="submenu-icon"><i class="fa-solid fa-3"></i></span><span class="submenu-text">第3章 导数与微分</span></div>
            <div class="submenu-item" onclick="window.location.href='第4章导数应用.html';"><span class="submenu-icon"><i class="fa-solid fa-4"></i></span><span class="submenu-text">第4章 导数应用</span></div>
            <div class="submenu-item" onclick="window.location.href='第5章不定积分.html';"><span class="submenu-icon"><i class="fa-solid fa-5"></i></span><span class="submenu-text">第5章 不定积分</span></div>
            <div class="submenu-item" onclick="window.location.href='第6章定积分.html';"><span class="submenu-icon"><i class="fa-solid fa-6"></i></span><span class="submenu-text">第6章 定积分</span></div>
            <div class="submenu-item" onclick="window.location.href='第7章常微分方程.html';"><span class="submenu-icon"><i class="fa-solid fa-7"></i></span><span class="submenu-text">第7章 常微分方程</span></div>
            <div class="submenu-item" onclick="window.location.href='第8章多元函数微分学.html';"><span class="submenu-icon"><i class="fa-solid fa-8"></i></span><span class="submenu-text">第8章 多元函数微分学</span></div>
            <div class="submenu-item" onclick="window.location.href='第9章多元函数积分学初步.html';"><span class="submenu-icon"><i class="fa-solid fa-9"></i></span><span class="submenu-text">第9章 多元函数积分学初步</span></div>
            <div class="submenu-item" onclick="window.location.href='第10章线性代数.html';"><span class="submenu-icon"><i class="fa-solid fa-folder"></i></span><span class="submenu-text">第10章 线性代数</span></div>
            <div class="submenu-item" onclick="window.location.href='第11章无穷级数.html';"><span class="submenu-icon"><i class="fa-solid fa-folder"></i></span><span class="submenu-text">第11章 无穷级数</span></div>
            <div class="submenu-item" onclick="window.location.href='第12章向量代数与空间解析几何.html';"><span class="submenu-icon"><i class="fa-solid fa-folder"></i></span><span class="submenu-text">第12章 向量代数与空间解析几何</span></div>
            <div class="submenu-item" onclick="window.location.href='第13章概率与统计.html';"><span class="submenu-icon"><i class="fa-solid fa-folder"></i></span><span class="submenu-text">第13章 概率与统计</span></div>
        </div>
        <div class="submenu-close" onclick="toggleCourseSubmenu()">×</div>
    </div>
</div>

<script>
// 统一导航API（兼容前面章节）
window.goToSlide = window.goToSlide || function(index) {
    try {
        if (typeof window.showSlide === 'function') { window.showSlide(index); }
        else if (typeof window.jumpToSlide === 'function') { window.jumpToSlide(index + 1); }
    } catch(e) {}
};

// 悬浮菜单互斥控制与切换
function closeAllSubmenus(exceptId) {
    ['lab-submenu','chapter-submenu','course-submenu'].forEach(id => {
        if (id !== exceptId) {
            const el = document.getElementById(id);
            if (el) el.style.display = 'none';
        }
    });
}
function toggleLabSubmenu() {
    const el = document.getElementById('lab-submenu');
    if (!el) return;
    const willOpen = el.style.display !== 'block';
    closeAllSubmenus('lab-submenu');
    el.style.display = willOpen ? 'block' : 'none';
}
function toggleChapterSubmenu() {
    const el = document.getElementById('chapter-submenu');
    if (!el) return;
    const willOpen = el.style.display !== 'block';
    closeAllSubmenus('chapter-submenu');
    if (willOpen) buildChapterMenuCh9();
    el.style.display = willOpen ? 'block' : 'none';
}
function toggleCourseSubmenu() {
    const el = document.getElementById('course-submenu');
    if (!el) return;
    const willOpen = el.style.display !== 'block';
    closeAllSubmenus('course-submenu');
    el.style.display = willOpen ? 'block' : 'none';
}
function initFloatingControl() {
    const floatingBtn = document.getElementById('floating-control-btn');
    const floatingMenu = document.getElementById('floating-menu-items');
    if (!floatingBtn || !floatingMenu) return;
    floatingBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        floatingBtn.classList.toggle('active');
        floatingMenu.classList.toggle('active');
    });
}

// 自动构建“第九章目录”
function buildChapterMenuCh9() {
    const grid = document.getElementById('chapter-submenu-grid');
    if (!grid) return;
    grid.innerHTML = '';
    const cover = document.createElement('div');
    cover.className = 'submenu-item';
    cover.innerHTML = '<span class="submenu-icon"><i class="fa-solid fa-house"></i></span><span class="submenu-text">封面</span>';
    cover.onclick = function() { try { goToSlide(0); } catch(_) {} toggleChapterSubmenu(); };
    grid.appendChild(cover);
    const toc = document.createElement('div');
    toc.className = 'submenu-item';
    toc.innerHTML = '<span class="submenu-icon"><i class="fa-solid fa-list-ul"></i></span><span class="submenu-text">目录页</span>';
    toc.onclick = function() { try { goToSlide(1); } catch(_) {} toggleChapterSubmenu(); };
    grid.appendChild(toc);
    const slides = document.querySelectorAll('#slidesContainer > .slide');
    slides.forEach((slide, idx) => {
        const h1 = slide.querySelector('.left-content h1');
        const h2 = slide.querySelector('.left-content h2');
        const title = (h1 && h1.textContent.trim()) || (h2 && h2.textContent.trim()) || '';
        if (!title) return;
        if (title.includes('目录')) return;
        const item = document.createElement('div');
        item.className = 'submenu-item';
        item.innerHTML = '<span class="submenu-icon"><i class="fa-solid fa-file-lines"></i></span><span class="submenu-text">' + title.replace(/\s+/g,' ') + '</span>';
        item.onclick = function() { try { goToSlide(idx); } catch(_) {} toggleChapterSubmenu(); };
        grid.appendChild(item);
    });
}

// 安装全局关闭与键盘Esc
document.addEventListener('DOMContentLoaded', function() {
    initFloatingControl();
    ['lab-submenu','chapter-submenu','course-submenu'].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        const content = el.querySelector('.submenu-content');
        if (content) content.addEventListener('click', ev => ev.stopPropagation());
    });
    document.addEventListener('click', () => {
        closeAllSubmenus();
        const floatingBtn = document.getElementById('floating-control-btn');
        const floatingMenu = document.getElementById('floating-menu-items');
        if (floatingBtn && floatingMenu) {
            floatingBtn.classList.remove('active');
            floatingMenu.classList.remove('active');
        }
    });
    document.addEventListener('keydown', (ev) => {
        if (ev.key === 'Escape') {
            closeAllSubmenus();
            const floatingBtn = document.getElementById('floating-control-btn');
            const floatingMenu = document.getElementById('floating-menu-items');
            if (floatingBtn && floatingMenu) {
                floatingBtn.classList.remove('active');
                floatingMenu.classList.remove('active');
            }
        }
    });
});
</script>

<script>
// 目录页（第2页）点击跳转绑定
document.addEventListener('DOMContentLoaded', function() {
    const slides = Array.from(document.querySelectorAll('#slidesContainer > .slide'));
    if (!slides.length) return;
    const dirSlide = slides[1];
    if (!dirSlide) return;
    const slideTitles = slides.map(slide => {
        const t1 = slide.querySelector('.left-content h1');
        const t2 = slide.querySelector('.left-content h2');
        const t3 = slide.querySelector('.left-content h3');
        return ((t1 && t1.textContent) || (t2 && t2.textContent) || (t3 && t3.textContent) || '').trim();
    });
    function findIndexByPatterns(patterns, from = 0) {
        if (!patterns || !patterns.length) return null;
        for (const p of patterns) {
            for (let i = from; i < slideTitles.length; i++) {
                const t = slideTitles[i] || '';
                if (p && t.includes(p)) return i;
            }
        }
        return null;
    }
    const sectionHeaders = dirSlide.querySelectorAll('h3');
    sectionHeaders.forEach(h3 => {
        const text = (h3.textContent || '').trim();
        let idx = null;
        if (/二重积分/.test(text)) {
            idx = findIndexByPatterns(['二重积分']);
        } else if (/应用/.test(text)) {
            idx = findIndexByPatterns(['应用：求体积','应用：求面积','应用：质量与重心','应用']);
        } else if (/方法|总结/.test(text)) {
            idx = findIndexByPatterns(['积分换序','常见错误','知识总结']);
        }
        if (idx != null) { h3.style.cursor = 'pointer'; h3.addEventListener('click', () => { try { goToSlide(idx); } catch(_) {} }); }
    });
    const map = new Map([
        ['二重积分概念与几何意义', ['二重积分']],
        ['二重积分性质', ['二重积分的性质']],
        ['直角坐标', ['直角坐标系计算','X型区域','Y型区域','直角坐标']],
        ['极坐标', ['极坐标系']],
        ['体积与面积', ['应用：求体积','应用：求面积','体积','面积']],
        ['质量与重心', ['应用：质量与重心','质量与重心']],
        ['对称性技巧', ['对称性']],
        ['积分换序', ['换序','积分换序']],
        ['常见错误与注意', ['常见错误','注意']],
        ['知识总结', ['知识总结','总结']]
    ]);
    const listItems = dirSlide.querySelectorAll('li');
    listItems.forEach(li => {
        const raw = (li.textContent || '').trim();
        let key = raw.replace(/[（(].*[）)]/g, '');
        let patterns = map.get(key);
        if (!patterns) {
            patterns = [];
            if (/二重积分/.test(raw)) patterns.push('二重积分');
            if (/极坐标/.test(raw)) patterns.push('极坐标');
            if (/直角/.test(raw)) patterns.push('直角');
            if (/体积|面积/.test(raw)) patterns.push('应用：求体积','应用：求面积');
            if (/质量|重心/.test(raw)) patterns.push('应用：质量与重心');
            if (/对称/.test(raw)) patterns.push('对称');
            if (/换序/.test(raw)) patterns.push('换序');
            if (/错误|注意/.test(raw)) patterns.push('常见错误');
            if (/总结/.test(raw)) patterns.push('知识总结','总结');
        }
        const idx = findIndexByPatterns(patterns || []);
        if (idx != null) { li.style.cursor = 'pointer'; li.addEventListener('click', () => { try { goToSlide(idx); } catch(_) {} }); }
    });
});
</script>

</body>
</html>
