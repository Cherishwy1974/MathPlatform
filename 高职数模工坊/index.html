<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数专融合交互实训平台</title>
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%230f172a'/%3E%3Cpath d='M16 44L26 20l6 12 6-12 10 24' stroke='%2338bdf8' stroke-width='6' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">

  <script src="../common-assets/js/tailwind.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'aviation-blue': '#0f172a',
            'aviation-accent': '#38bdf8',
            'warning': '#fbbf24',
            'danger': '#ef4444',
            'success': '#10b981',
            'industrial-gray': '#1e293b',
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
        }
      }
    }
  </script>


  <script src="../common-assets/js/react-18.production.min.js"></script>
  <script src="../common-assets/js/react-dom-18.production.min.js"></script>

  <script>
    window.require = function (name) {
      if (name === 'react') return window.React;
      if (name === 'react-dom') return window.ReactDOM;
      throw new Error('Unsupported module: ' + name);
    };
  </script>

  <script type="importmap">
    {
      "imports": {
        "react": "data:text/javascript,const R=window.React;export default R;export const useState=R.useState;export const useEffect=R.useEffect;export const useLayoutEffect=R.useLayoutEffect;export const useCallback=R.useCallback;export const useRef=R.useRef;export const createElement=R.createElement;export const cloneElement=R.cloneElement;export const Fragment=R.Fragment;export const Component=R.Component;export const PureComponent=R.PureComponent;export const memo=R.memo;export const forwardRef=R.forwardRef;export const useMemo=R.useMemo;export const useContext=R.useContext;export const useReducer=R.useReducer;export const useImperativeHandle=R.useImperativeHandle;export const useSyncExternalStore=R.useSyncExternalStore;export const useTransition=R.useTransition;export const useDeferredValue=R.useDeferredValue;export const useId=R.useId;export const useInsertionEffect=R.useInsertionEffect;export const useDebugValue=R.useDebugValue;export const Suspense=R.Suspense;export const StrictMode=R.StrictMode;export const startTransition=R.startTransition;export const lazy=R.lazy;export const isValidElement=R.isValidElement;export const createContext=R.createContext;export const createRef=R.createRef;export const Children=R.Children;export const version=R.version;",
        "react/jsx-runtime": "data:text/javascript,const R=window.React;export const jsx=R.createElement;export const jsxs=R.createElement;export const jsxDEV=R.createElement;export const Fragment=R.Fragment;",
        "react-dom": "data:text/javascript,const RD=window.ReactDOM;export default RD;export const createRoot=RD.createRoot;export const render=RD.render;export const hydrate=RD.hydrate;export const unmountComponentAtNode=RD.unmountComponentAtNode;export const findDOMNode=RD.findDOMNode;export const createPortal=RD.createPortal;export const flushSync=RD.flushSync;export const version=RD.version;",
        "react-dom/client": "data:text/javascript,export const createRoot=window.ReactDOM.createRoot;",
        "three": "../common-assets/js/three-0.160.0.module.js",
        "@react-three/fiber": "../common-assets/js/react-three-fiber.esm.js",
        "@react-three/drei": "../common-assets/js/react-three-drei.esm.js",
        "lucide-react": "../common-assets/js/lucide-react.esm.js"
      }
    }
    </script>

  <script src="../common-assets/js/babel.min.js"></script>

  <style>
    body {
      margin: 0;
      background-color: #fff;
      overflow: hidden;
    }

    #root {
      width: 100vw;
      height: 100vh;
    }

    .glass-panel {
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(56, 189, 248, 0.2);
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
  </style>
  <style>
    *,
    ::before,
    ::after {
      --tw-border-spacing-x: 0;
      --tw-border-spacing-y: 0;
      --tw-translate-x: 0;
      --tw-translate-y: 0;
      --tw-rotate: 0;
      --tw-skew-x: 0;
      --tw-skew-y: 0;
      --tw-scale-x: 1;
      --tw-scale-y: 1;
      --tw-pan-x: ;
      --tw-pan-y: ;
      --tw-pinch-zoom: ;
      --tw-scroll-snap-strictness: proximity;
      --tw-gradient-from-position: ;
      --tw-gradient-via-position: ;
      --tw-gradient-to-position: ;
      --tw-ordinal: ;
      --tw-slashed-zero: ;
      --tw-numeric-figure: ;
      --tw-numeric-spacing: ;
      --tw-numeric-fraction: ;
      --tw-ring-inset: ;
      --tw-ring-offset-width: 0px;
      --tw-ring-offset-color: #fff;
      --tw-ring-color: rgb(59 130 246 / 0.5);
      --tw-ring-offset-shadow: 0 0 #0000;
      --tw-ring-shadow: 0 0 #0000;
      --tw-shadow: 0 0 #0000;
      --tw-shadow-colored: 0 0 #0000;
      --tw-blur: ;
      --tw-brightness: ;
      --tw-contrast: ;
      --tw-grayscale: ;
      --tw-hue-rotate: ;
      --tw-invert: ;
      --tw-saturate: ;
      --tw-sepia: ;
      --tw-drop-shadow: ;
      --tw-backdrop-blur: ;
      --tw-backdrop-brightness: ;
      --tw-backdrop-contrast: ;
      --tw-backdrop-grayscale: ;
      --tw-backdrop-hue-rotate: ;
      --tw-backdrop-invert: ;
      --tw-backdrop-opacity: ;
      --tw-backdrop-saturate: ;
      --tw-backdrop-sepia: ;
      --tw-contain-size: ;
      --tw-contain-layout: ;
      --tw-contain-paint: ;
      --tw-contain-style:
    }

    ::backdrop {
      --tw-border-spacing-x: 0;
      --tw-border-spacing-y: 0;
      --tw-translate-x: 0;
      --tw-translate-y: 0;
      --tw-rotate: 0;
      --tw-skew-x: 0;
      --tw-skew-y: 0;
      --tw-scale-x: 1;
      --tw-scale-y: 1;
      --tw-pan-x: ;
      --tw-pan-y: ;
      --tw-pinch-zoom: ;
      --tw-scroll-snap-strictness: proximity;
      --tw-gradient-from-position: ;
      --tw-gradient-via-position: ;
      --tw-gradient-to-position: ;
      --tw-ordinal: ;
      --tw-slashed-zero: ;
      --tw-numeric-figure: ;
      --tw-numeric-spacing: ;
      --tw-numeric-fraction: ;
      --tw-ring-inset: ;
      --tw-ring-offset-width: 0px;
      --tw-ring-offset-color: #fff;
      --tw-ring-color: rgb(59 130 246 / 0.5);
      --tw-ring-offset-shadow: 0 0 #0000;
      --tw-ring-shadow: 0 0 #0000;
      --tw-shadow: 0 0 #0000;
      --tw-shadow-colored: 0 0 #0000;
      --tw-blur: ;
      --tw-brightness: ;
      --tw-contrast: ;
      --tw-grayscale: ;
      --tw-hue-rotate: ;
      --tw-invert: ;
      --tw-saturate: ;
      --tw-sepia: ;
      --tw-drop-shadow: ;
      --tw-backdrop-blur: ;
      --tw-backdrop-brightness: ;
      --tw-backdrop-contrast: ;
      --tw-backdrop-grayscale: ;
      --tw-backdrop-hue-rotate: ;
      --tw-backdrop-invert: ;
      --tw-backdrop-opacity: ;
      --tw-backdrop-saturate: ;
      --tw-backdrop-sepia: ;
      --tw-contain-size: ;
      --tw-contain-layout: ;
      --tw-contain-paint: ;
      --tw-contain-style:
    }

    *,
    ::after,
    ::before {
      box-sizing: border-box;
      border-width: 0;
      border-style: solid;
      border-color: #e5e7eb
    }

    ::after,
    ::before {
      --tw-content: ''
    }

    :host,
    html {
      line-height: 1.5;
      -webkit-text-size-adjust: 100%;
      -moz-tab-size: 4;
      tab-size: 4;
      font-family: Inter, sans-serif;
      font-feature-settings: normal;
      font-variation-settings: normal;
      -webkit-tap-highlight-color: transparent
    }

    body {
      margin: 0;
      line-height: inherit
    }

    hr {
      height: 0;
      color: inherit;
      border-top-width: 1px
    }

    abbr:where([title]) {
      -webkit-text-decoration: underline dotted;
      text-decoration: underline dotted
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      font-size: inherit;
      font-weight: inherit
    }

    a {
      color: inherit;
      text-decoration: inherit
    }

    b,
    strong {
      font-weight: bolder
    }

    code,
    kbd,
    pre,
    samp {
      font-family: JetBrains Mono, monospace;
      font-feature-settings: normal;
      font-variation-settings: normal;
      font-size: 1em
    }

    small {
      font-size: 80%
    }

    sub,
    sup {
      font-size: 75%;
      line-height: 0;
      position: relative;
      vertical-align: baseline
    }

    sub {
      bottom: -.25em
    }

    sup {
      top: -.5em
    }

    table {
      text-indent: 0;
      border-color: inherit;
      border-collapse: collapse
    }

    button,
    input,
    optgroup,
    select,
    textarea {
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: 100%;
      font-weight: inherit;
      line-height: inherit;
      letter-spacing: inherit;
      color: inherit;
      margin: 0;
      padding: 0
    }

    button,
    select {
      text-transform: none
    }

    button,
    input:where([type=button]),
    input:where([type=reset]),
    input:where([type=submit]) {
      -webkit-appearance: button;
      background-color: transparent;
      background-image: none
    }

    :-moz-focusring {
      outline: auto
    }

    :-moz-ui-invalid {
      box-shadow: none
    }

    progress {
      vertical-align: baseline
    }

    ::-webkit-inner-spin-button,
    ::-webkit-outer-spin-button {
      height: auto
    }

    [type=search] {
      -webkit-appearance: textfield;
      outline-offset: -2px
    }

    ::-webkit-search-decoration {
      -webkit-appearance: none
    }

    ::-webkit-file-upload-button {
      -webkit-appearance: button;
      font: inherit
    }

    summary {
      display: list-item
    }

    blockquote,
    dd,
    dl,
    figure,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    hr,
    p,
    pre {
      margin: 0
    }

    fieldset {
      margin: 0;
      padding: 0
    }

    legend {
      padding: 0
    }

    menu,
    ol,
    ul {
      list-style: none;
      margin: 0;
      padding: 0
    }

    dialog {
      padding: 0
    }

    textarea {
      resize: vertical
    }

    input::placeholder,
    textarea::placeholder {
      opacity: 1;
      color: #9ca3af
    }

    [role=button],
    button {
      cursor: pointer
    }

    :disabled {
      cursor: default
    }

    audio,
    canvas,
    embed,
    iframe,
    img,
    object,
    svg,
    video {
      display: block;
      vertical-align: middle
    }

    img,
    video {
      max-width: 100%;
      height: auto
    }

    [hidden]:where(:not([hidden=until-found])) {
      display: none
    }

    .pointer-events-none {
      pointer-events: none
    }

    .pointer-events-auto {
      pointer-events: auto
    }

    .absolute {
      position: absolute
    }

    .relative {
      position: relative
    }

    .inset-0 {
      inset: 0px
    }

    .right-0 {
      right: 0px
    }

    .top-0 {
      top: 0px
    }

    .-top-8 {
      top: -2rem
    }

    .bottom-6 {
      bottom: 1.5rem
    }

    .left-1\/2 {
      left: 50%
    }

    .left-6 {
      left: 1.5rem
    }

    .right-6 {
      right: 1.5rem
    }

    .top-6 {
      top: 1.5rem
    }

    .right-2 {
      right: 0.5rem
    }

    .top-1\/2 {
      top: 50%
    }

    .z-10 {
      z-index: 10
    }

    .z-20 {
      z-index: 20
    }

    .z-40 {
      z-index: 40
    }

    .z-50 {
      z-index: 50
    }

    .z-0 {
      z-index: 0
    }

    .mx-auto {
      margin-left: auto;
      margin-right: auto
    }

    .mb-12 {
      margin-bottom: 3rem
    }

    .mb-2 {
      margin-bottom: 0.5rem
    }

    .mb-4 {
      margin-bottom: 1rem
    }

    .mb-6 {
      margin-bottom: 1.5rem
    }

    .ml-1 {
      margin-left: 0.25rem
    }

    .mt-0\.5 {
      margin-top: 0.125rem
    }

    .mt-1 {
      margin-top: 0.25rem
    }

    .mt-2 {
      margin-top: 0.5rem
    }

    .mb-1 {
      margin-bottom: 0.25rem
    }

    .flex {
      display: flex
    }

    .inline-flex {
      display: inline-flex
    }

    .grid {
      display: grid
    }

    .h-12 {
      height: 3rem
    }

    .h-1\.5 {
      height: 0.375rem
    }

    .h-16 {
      height: 4rem
    }

    .h-3 {
      height: 0.75rem
    }

    .h-screen {
      height: 100vh
    }

    .h-8 {
      height: 2rem
    }

    .h-full {
      height: 100%
    }

    .max-h-32 {
      max-height: 8rem
    }

    .min-h-screen {
      min-height: 100vh
    }

    .w-full {
      width: 100%
    }

    .w-1\.5 {
      width: 0.375rem
    }

    .w-16 {
      width: 4rem
    }

    .w-3 {
      width: 0.75rem
    }

    .w-96 {
      width: 24rem
    }

    .w-8 {
      width: 2rem
    }

    .max-w-6xl {
      max-width: 72rem
    }

    .max-w-\[90vw\] {
      max-width: 90vw
    }

    .max-w-\[80\%\] {
      max-width: 80%
    }

    .flex-1 {
      flex: 1 1 0%
    }

    .shrink-0 {
      flex-shrink: 0
    }

    .-translate-x-1\/2 {
      --tw-translate-x: -50%;
      transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
    }

    .-translate-y-1\/2 {
      --tw-translate-y: -50%;
      transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
    }

    .scale-110 {
      --tw-scale-x: 1.1;
      --tw-scale-y: 1.1;
      transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
    }

    .transform {
      transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
    }

    @keyframes pulse {
      50% {
        opacity: .5
      }
    }

    .animate-pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .animate-spin {
      animation: spin 1s linear infinite
    }

    .cursor-pointer {
      cursor: pointer
    }

    .select-none {
      -webkit-user-select: none;
      user-select: none
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, minmax(0, 1fr))
    }

    .flex-col {
      flex-direction: column
    }

    .items-start {
      align-items: flex-start
    }

    .items-end {
      align-items: flex-end
    }

    .items-center {
      align-items: center
    }

    .justify-center {
      justify-content: center
    }

    .justify-between {
      justify-content: space-between
    }

    .gap-1\.5 {
      gap: 0.375rem
    }

    .gap-2 {
      gap: 0.5rem
    }

    .gap-6 {
      gap: 1.5rem
    }

    .gap-3 {
      gap: 0.75rem
    }

    .gap-4 {
      gap: 1rem
    }

    .space-y-1> :not([hidden])~ :not([hidden]) {
      --tw-space-y-reverse: 0;
      margin-top: calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));
      margin-bottom: calc(0.25rem * var(--tw-space-y-reverse))
    }

    .space-y-3> :not([hidden])~ :not([hidden]) {
      --tw-space-y-reverse: 0;
      margin-top: calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));
      margin-bottom: calc(0.75rem * var(--tw-space-y-reverse))
    }

    .space-y-6> :not([hidden])~ :not([hidden]) {
      --tw-space-y-reverse: 0;
      margin-top: calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));
      margin-bottom: calc(1.5rem * var(--tw-space-y-reverse))
    }

    .space-y-4> :not([hidden])~ :not([hidden]) {
      --tw-space-y-reverse: 0;
      margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse)));
      margin-bottom: calc(1rem * var(--tw-space-y-reverse))
    }

    .overflow-hidden {
      overflow: hidden
    }

    .overflow-x-auto {
      overflow-x: auto
    }

    .overflow-y-auto {
      overflow-y: auto
    }

    .whitespace-nowrap {
      white-space: nowrap
    }

    .rounded {
      border-radius: 0.25rem
    }

    .rounded-2xl {
      border-radius: 1rem
    }

    .rounded-full {
      border-radius: 9999px
    }

    .rounded-lg {
      border-radius: 0.5rem
    }

    .rounded-xl {
      border-radius: 0.75rem
    }

    .rounded-tl-none {
      border-top-left-radius: 0px
    }

    .border {
      border-width: 1px
    }

    .border-2 {
      border-width: 2px
    }

    .border-b {
      border-bottom-width: 1px
    }

    .border-t {
      border-top-width: 1px
    }

    .border-dashed {
      border-style: dashed
    }

    .border-slate-800 {
      --tw-border-opacity: 1;
      border-color: rgb(30 41 59 / var(--tw-border-opacity, 1))
    }

    .border-aviation-accent {
      --tw-border-opacity: 1;
      border-color: rgb(56 189 248 / var(--tw-border-opacity, 1))
    }

    .border-aviation-accent\/30 {
      border-color: rgb(56 189 248 / 0.3)
    }

    .border-slate-700 {
      --tw-border-opacity: 1;
      border-color: rgb(51 65 85 / var(--tw-border-opacity, 1))
    }

    .border-white\/10 {
      border-color: rgb(255 255 255 / 0.1)
    }

    .border-success {
      --tw-border-opacity: 1;
      border-color: rgb(16 185 129 / var(--tw-border-opacity, 1))
    }

    .bg-green-500\/10 {
      background-color: rgb(34 197 94 / 0.1)
    }

    .bg-red-500\/10 {
      background-color: rgb(239 68 68 / 0.1)
    }

    .bg-slate-900 {
      --tw-bg-opacity: 1;
      background-color: rgb(15 23 42 / var(--tw-bg-opacity, 1))
    }

    .bg-slate-950 {
      --tw-bg-opacity: 1;
      background-color: rgb(2 6 23 / var(--tw-bg-opacity, 1))
    }

    .bg-yellow-500\/10 {
      background-color: rgb(234 179 8 / 0.1)
    }

    .bg-aviation-accent {
      --tw-bg-opacity: 1;
      background-color: rgb(56 189 248 / var(--tw-bg-opacity, 1))
    }

    .bg-aviation-accent\/10 {
      background-color: rgb(56 189 248 / 0.1)
    }

    .bg-aviation-accent\/20 {
      background-color: rgb(56 189 248 / 0.2)
    }

    .bg-black {
      --tw-bg-opacity: 1;
      background-color: rgb(0 0 0 / var(--tw-bg-opacity, 1))
    }

    .bg-black\/80 {
      background-color: rgb(0 0 0 / 0.8)
    }

    .bg-slate-900\/80 {
      background-color: rgb(15 23 42 / 0.8)
    }

    .bg-success {
      --tw-bg-opacity: 1;
      background-color: rgb(16 185 129 / var(--tw-bg-opacity, 1))
    }

    .bg-transparent {
      background-color: transparent
    }

    .bg-slate-800\/50 {
      background-color: rgb(30 41 59 / 0.5)
    }

    .bg-slate-900\/50 {
      background-color: rgb(15 23 42 / 0.5)
    }

    .bg-success\/20 {
      background-color: rgb(16 185 129 / 0.2)
    }

    .bg-aviation-blue\/80 {
      background-color: rgb(15 23 42 / 0.8)
    }

    .bg-slate-800 {
      --tw-bg-opacity: 1;
      background-color: rgb(30 41 59 / var(--tw-bg-opacity, 1))
    }

    .bg-slate-800\/80 {
      background-color: rgb(30 41 59 / 0.8)
    }

    .bg-gradient-to-r {
      background-image: linear-gradient(to right, var(--tw-gradient-stops))
    }

    .bg-\[radial-gradient\(circle_at_center\2c transparent_0\%\2c rgba\(0\2c 0\2c 0\2c 0\.6\)_100\%\)\] {
      background-image: radial-gradient(circle at center, transparent 0%, rgba(0, 0, 0, 0.6) 100%)
    }

    .from-aviation-accent {
      --tw-gradient-from: #38bdf8 var(--tw-gradient-from-position);
      --tw-gradient-to: rgb(56 189 248 / 0) var(--tw-gradient-to-position);
      --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)
    }

    .to-purple-400 {
      --tw-gradient-to: #c084fc var(--tw-gradient-to-position)
    }

    .bg-clip-text {
      -webkit-background-clip: text;
      background-clip: text
    }

    .p-4 {
      padding: 1rem
    }

    .p-6 {
      padding: 1.5rem
    }

    .p-8 {
      padding: 2rem
    }

    .p-2 {
      padding: 0.5rem
    }

    .p-3 {
      padding: 0.75rem
    }

    .p-1 {
      padding: 0.25rem
    }

    .px-2 {
      padding-left: 0.5rem;
      padding-right: 0.5rem
    }

    .py-1 {
      padding-top: 0.25rem;
      padding-bottom: 0.25rem
    }

    .px-4 {
      padding-left: 1rem;
      padding-right: 1rem
    }

    .py-2 {
      padding-top: 0.5rem;
      padding-bottom: 0.5rem
    }

    .py-3 {
      padding-top: 0.75rem;
      padding-bottom: 0.75rem
    }

    .py-8 {
      padding-top: 2rem;
      padding-bottom: 2rem
    }

    .py-0\.5 {
      padding-top: 0.125rem;
      padding-bottom: 0.125rem
    }

    .px-1 {
      padding-left: 0.25rem;
      padding-right: 0.25rem
    }

    .py-2\.5 {
      padding-top: 0.625rem;
      padding-bottom: 0.625rem
    }

    .pb-6 {
      padding-bottom: 1.5rem
    }

    .pt-2 {
      padding-top: 0.5rem
    }

    .pl-4 {
      padding-left: 1rem
    }

    .pr-10 {
      padding-right: 2.5rem
    }

    .text-center {
      text-align: center
    }

    .font-mono {
      font-family: JetBrains Mono, monospace
    }

    .font-sans {
      font-family: Inter, sans-serif
    }

    .text-2xl {
      font-size: 1.5rem;
      line-height: 2rem
    }

    .text-4xl {
      font-size: 2.25rem;
      line-height: 2.5rem
    }

    .text-sm {
      font-size: 0.875rem;
      line-height: 1.25rem
    }

    .text-xs {
      font-size: 0.75rem;
      line-height: 1rem
    }

    .text-\[10px\] {
      font-size: 10px
    }

    .text-lg {
      font-size: 1.125rem;
      line-height: 1.75rem
    }

    .font-bold {
      font-weight: 700
    }

    .font-medium {
      font-weight: 500
    }

    .uppercase {
      text-transform: uppercase
    }

    .leading-relaxed {
      line-height: 1.625
    }

    .tracking-wider {
      letter-spacing: 0.05em
    }

    .tracking-widest {
      letter-spacing: 0.1em
    }

    .text-aviation-accent {
      --tw-text-opacity: 1;
      color: rgb(56 189 248 / var(--tw-text-opacity, 1))
    }

    .text-green-400 {
      --tw-text-opacity: 1;
      color: rgb(74 222 128 / var(--tw-text-opacity, 1))
    }

    .text-red-400 {
      --tw-text-opacity: 1;
      color: rgb(248 113 113 / var(--tw-text-opacity, 1))
    }

    .text-slate-400 {
      --tw-text-opacity: 1;
      color: rgb(148 163 184 / var(--tw-text-opacity, 1))
    }

    .text-slate-500 {
      --tw-text-opacity: 1;
      color: rgb(100 116 139 / var(--tw-text-opacity, 1))
    }

    .text-transparent {
      color: transparent
    }

    .text-white {
      --tw-text-opacity: 1;
      color: rgb(255 255 255 / var(--tw-text-opacity, 1))
    }

    .text-yellow-400 {
      --tw-text-opacity: 1;
      color: rgb(250 204 21 / var(--tw-text-opacity, 1))
    }

    .text-aviation-blue {
      --tw-text-opacity: 1;
      color: rgb(15 23 42 / var(--tw-text-opacity, 1))
    }

    .text-slate-300 {
      --tw-text-opacity: 1;
      color: rgb(203 213 225 / var(--tw-text-opacity, 1))
    }

    .text-slate-600 {
      --tw-text-opacity: 1;
      color: rgb(71 85 105 / var(--tw-text-opacity, 1))
    }

    .text-success {
      --tw-text-opacity: 1;
      color: rgb(16 185 129 / var(--tw-text-opacity, 1))
    }

    .text-slate-200 {
      --tw-text-opacity: 1;
      color: rgb(226 232 240 / var(--tw-text-opacity, 1))
    }

    .text-orange-400 {
      --tw-text-opacity: 1;
      color: rgb(251 146 60 / var(--tw-text-opacity, 1))
    }

    .text-danger {
      --tw-text-opacity: 1;
      color: rgb(239 68 68 / var(--tw-text-opacity, 1))
    }

    .placeholder-slate-500::placeholder {
      --tw-placeholder-opacity: 1;
      color: rgb(100 116 139 / var(--tw-placeholder-opacity, 1))
    }

    .opacity-10 {
      opacity: 0.1
    }

    .opacity-0 {
      opacity: 0
    }

    .opacity-40 {
      opacity: 0.4
    }

    .opacity-50 {
      opacity: 0.5
    }

    .opacity-60 {
      opacity: 0.6
    }

    .shadow-\[0_0_10px_\#38bdf8\] {
      --tw-shadow: 0 0 10px #38bdf8;
      --tw-shadow-colored: 0 0 10px var(--tw-shadow-color);
      box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
    }

    .shadow-\[0_0_15px_rgba\(56\2c 189\2c 248\2c 0\.5\)\] {
      --tw-shadow: 0 0 15px rgba(56, 189, 248, 0.5);
      --tw-shadow-colored: 0 0 15px var(--tw-shadow-color);
      box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
    }

    .shadow-\[0_0_15px_rgba\(16\2c 185\2c 129\2c 0\.4\)\] {
      --tw-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
      --tw-shadow-colored: 0 0 15px var(--tw-shadow-color);
      box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
    }

    .shadow-lg {
      --tw-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);
      box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
    }

    .backdrop-blur-md {
      --tw-backdrop-blur: blur(12px);
      -webkit-backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);
      backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)
    }

    .backdrop-blur-sm {
      --tw-backdrop-blur: blur(4px);
      -webkit-backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);
      backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)
    }

    .transition-all {
      transition-property: all;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 150ms
    }

    .transition-opacity {
      transition-property: opacity;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 150ms
    }

    .transition-transform {
      transition-property: transform;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 150ms
    }

    .transition-colors {
      transition-property: color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;
      transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
      transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;
      transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
      transition-duration: 150ms
    }

    .duration-200 {
      transition-duration: 200ms
    }

    .duration-300 {
      transition-duration: 300ms
    }

    .hover\:border-aviation-accent:hover {
      --tw-border-opacity: 1;
      border-color: rgb(56 189 248 / var(--tw-border-opacity, 1))
    }

    .hover\:border-slate-500:hover {
      --tw-border-opacity: 1;
      border-color: rgb(100 116 139 / var(--tw-border-opacity, 1))
    }

    .hover\:bg-slate-800:hover {
      --tw-bg-opacity: 1;
      background-color: rgb(30 41 59 / var(--tw-bg-opacity, 1))
    }

    .hover\:bg-white\/10:hover {
      background-color: rgb(255 255 255 / 0.1)
    }

    .hover\:text-white:hover {
      --tw-text-opacity: 1;
      color: rgb(255 255 255 / var(--tw-text-opacity, 1))
    }

    .hover\:text-aviation-accent:hover {
      --tw-text-opacity: 1;
      color: rgb(56 189 248 / var(--tw-text-opacity, 1))
    }

    .hover\:shadow-\[0_0_30px_rgba\(56\2c 189\2c 248\2c 0\.1\)\]:hover {
      --tw-shadow: 0 0 30px rgba(56, 189, 248, 0.1);
      --tw-shadow-colored: 0 0 30px var(--tw-shadow-color);
      box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)
    }

    .focus\:border-aviation-accent:focus {
      --tw-border-opacity: 1;
      border-color: rgb(56 189 248 / var(--tw-border-opacity, 1))
    }

    .focus\:outline-none:focus {
      outline: 2px solid transparent;
      outline-offset: 2px
    }

    .disabled\:opacity-50:disabled {
      opacity: 0.5
    }

    .group:hover .group-hover\:translate-x-1 {
      --tw-translate-x: 0.25rem;
      transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))
    }

    .group:hover .group-hover\:opacity-20 {
      opacity: 0.2
    }

    .group:hover .group-hover\:opacity-100 {
      opacity: 1
    }

    @media (min-width: 768px) {
      .md\:grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr))
      }
    }

    @media (min-width: 1024px) {
      .lg\:grid-cols-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr))
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>
  <script type="module">function asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }
    function _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, "next", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, "throw", n); } _next(void 0); }); }; }
    import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';
    import { createRoot } from 'react-dom/client';
    import * as THREE from 'three';
    import { Canvas, useFrame } from '@react-three/fiber';
    import { OrbitControls, Stars, ContactShadows, Html, useGLTF } from '@react-three/drei';
    import { Play, RotateCw, Maximize2, Minimize2, ArrowLeft, GraduationCap, Zap, Cpu, Plane, User, CheckCircle2, AlertTriangle, Circle, Bot, Send, Activity, ChevronRight, AlertOctagon, Settings2, Wrench, Scan, Flashlight, Hand, MousePointer2, PenTool, Cable, Ruler, Gauge, Droplet, BookOpen } from 'lucide-react';

    var ToolType = {
      NONE: 'none',
      GLOVES: 'gloves',
      WRENCH: 'wrench',
      SCANNER: 'scanner',
      FLASHLIGHT: 'flashlight',
      INSULATED_GLOVES: 'insulated_gloves',
      INSULATED_WRENCH: 'insulated_wrench',
      MULTIMETER: 'multimeter',
      ESD_STRAP: 'esd_strap',
      SCREWDRIVER: 'screwdriver',
      VERNIER_CALIPER: 'vernier_caliper',
      PRESSURE_GAUGE: 'pressure_gauge',
      OIL_CAN: 'oil_can'
    };

    var AVIATION_PARTS = [{
      id: 'fan_case',
      name: '整流罩与风扇机匣',
      description: '保护风扇叶片，引导气流。',
      position: [0, 0, 2.5],
      rotation: [0, 0, 0],
      scale: [3.2, 3.2, 4],
      color: '#94a3b8',
      type: 'casing',
      shape: 'hollow-cylinder',
      health: 95,
      status: 'ok',
      isInspected: false
    }, {
      id: 'fan_rotor',
      name: '低压风扇转子',
      description: '产生主要推力。',
      position: [0, 0, 2.2],
      rotation: [0, 0, 0],
      scale: [2.8, 2.8, 0.5],
      color: '#cbd5e1',
      type: 'fan',
      shape: 'cylinder',
      health: 88,
      status: 'worn',
      isInspected: false
    }, {
      id: 'compressor_hp',
      name: '高压压气机',
      description: '多级轴流压气机。',
      position: [0, 0, -0.5],
      rotation: [0, 0, 0],
      scale: [1.6, 1.6, 2.0],
      color: '#475569',
      type: 'compressor',
      shape: 'cylinder',
      health: 72,
      status: 'damaged',
      isInspected: false,
      notes: '叶片微裂纹'
    }, {
      id: 'combustor',
      name: '燃烧室',
      description: '环形燃烧室。',
      position: [0, 0, -2.0],
      rotation: [1.57, 0, 0],
      scale: [1.4, 1.4, 0.8],
      color: '#b45309',
      type: 'combustor',
      shape: 'torus',
      health: 90,
      status: 'ok',
      isInspected: false
    }, {
      id: 'turbine_hp',
      name: '高压涡轮',
      description: '单级高压涡轮。',
      position: [0, 0, -3.2],
      rotation: [0, 0, 0],
      scale: [1.5, 1.5, 0.8],
      color: '#713f12',
      type: 'turbine',
      shape: 'cylinder',
      health: 45,
      status: 'critical',
      isInspected: false,
      notes: '涂层脱落'
    }, {
      id: 'exhaust',
      name: '尾喷管',
      description: '排气锥。',
      position: [0, 0, -5],
      rotation: [1.57, 0, 0],
      scale: [1.2, 2.5, 1.2],
      color: '#334155',
      type: 'exhaust',
      shape: 'cone',
      health: 100,
      status: 'ok',
      isInspected: false
    }];
    var AVIATION_STEPS = [{
      id: 1,
      title: "安全检查",
      instruction: "穿戴防护手套。",
      targetPartId: "fan_case",
      requiredTool: ToolType.GLOVES
    }, {
      id: 2,
      title: "目视检查",
      instruction: "使用手电筒检查风扇异物损伤。",
      targetPartId: "fan_rotor",
      requiredTool: ToolType.FLASHLIGHT
    }, {
      id: 3,
      title: "机匣拆卸",
      instruction: "使用扳手移除机匣。",
      targetPartId: "fan_case",
      requiredTool: ToolType.WRENCH
    }, {
      id: 4,
      title: "核心诊断",
      instruction: "使用探伤仪检查压气机。",
      targetPartId: "compressor_hp",
      requiredTool: ToolType.SCANNER
    }, {
      id: 5,
      title: "涡轮探伤",
      instruction: "检查涡轮叶片。",
      targetPartId: "turbine_hp",
      requiredTool: ToolType.SCANNER
    }];

    var EV_PARTS = [{
      id: 'battery_pack_cover',
      name: '动力电池包上盖',
      description: '防护等级IP67铝合金外壳。',
      position: [0, 0.5, 0],
      rotation: [0, 0, 0],
      scale: [3, 0.1, 5],
      color: '#64748b',
      type: 'cover',
      shape: 'box',
      health: 98,
      status: 'ok',
      isInspected: false
    }, {
      id: 'msd_switch',
      name: '手动维护开关',
      description: '物理高压切断装置。',
      position: [0.8, 0.6, 1.5],
      rotation: [0, 0, 0],
      scale: [0.4, 0.2, 0.6],
      color: '#f97316',
      type: 'hv_switch',
      shape: 'box',
      health: 100,
      status: 'ok',
      isInspected: false,
      notes: '必须先拔出'
    }, {
      id: 'hv_cable_pos',
      name: '高压正极线束',
      description: '橙色高压电缆。',
      position: [0.5, 0.2, 0],
      rotation: [1.57, 0, 0],
      scale: [0.1, 4, 0.1],
      color: '#ea580c',
      type: 'cable',
      shape: 'cable',
      health: 95,
      status: 'ok',
      isInspected: false
    }, {
      id: 'battery_module_1',
      name: '电池模组 #1',
      description: '宁德时代标准模组。',
      position: [-0.8, 0, -1],
      rotation: [0, 0, 0],
      scale: [1, 0.4, 1.5],
      color: '#334155',
      type: 'module',
      shape: 'box',
      health: 92,
      status: 'ok',
      isInspected: false
    }, {
      id: 'bms_unit',
      name: '电池管理系统主控板',
      description: '电池管理系统PCB。',
      position: [0, 0.2, -1.8],
      rotation: [0, 0, 0],
      scale: [0.8, 0.1, 0.8],
      color: '#10b981',
      type: 'pcb',
      shape: 'plate',
      health: 60,
      status: 'damaged',
      isInspected: false,
      notes: '通讯芯片烧毁'
    }];
    var EV_STEPS = [{
      id: 1,
      title: "个人防护",
      instruction: "穿戴绝缘手套。",
      targetPartId: "battery_pack_cover",
      requiredTool: ToolType.INSULATED_GLOVES
    }, {
      id: 2,
      title: "断电操作",
      instruction: "拔出手动维护开关。",
      targetPartId: "msd_switch",
      requiredTool: ToolType.INSULATED_GLOVES
    }, {
      id: 3,
      title: "验电",
      instruction: "万用表测量手动维护开关插座无电压。",
      targetPartId: "msd_switch",
      requiredTool: ToolType.MULTIMETER
    }, {
      id: 4,
      title: "开盖",
      instruction: "使用绝缘扳手拆卸上盖。",
      targetPartId: "battery_pack_cover",
      requiredTool: ToolType.INSULATED_WRENCH
    }, {
      id: 5,
      title: "电池管理系统诊断",
      instruction: "连接诊断仪读取电池管理系统故障。",
      targetPartId: "bms_unit",
      requiredTool: ToolType.SCANNER
    }];

    var ELECTRONICS_PARTS = [{
      id: 'cabinet_door',
      name: 'PLC控制柜门',
      description: '防护等级IP54。',
      position: [0, 0, 0.5],
      rotation: [0, 0, 0],
      scale: [3, 4, 0.1],
      color: '#cbd5e1',
      type: 'door',
      shape: 'box',
      health: 100,
      status: 'ok',
      isInspected: false
    }, {
      id: 'plc_main',
      name: 'S7-1200可编程逻辑控制器中央处理器',
      description: '中央处理器。',
      position: [-0.5, 0.5, -0.2],
      rotation: [0, 0, 0],
      scale: [1, 0.8, 0.4],
      color: '#334155',
      type: 'plc',
      shape: 'box',
      health: 100,
      status: 'ok',
      isInspected: false
    }, {
      id: 'relay_k1',
      name: '继电器1号',
      description: '24伏直流中间继电器。',
      position: [0.5, 0, -0.1],
      rotation: [0, 0, 0],
      scale: [0.3, 0.4, 0.3],
      color: '#e2e8f0',
      type: 'relay',
      shape: 'small-box',
      health: 10,
      status: 'critical',
      isInspected: false,
      notes: '触点粘连'
    }, {
      id: 'terminal_block',
      name: '端子排',
      description: '接线端子。',
      position: [0, -1, -0.2],
      rotation: [0, 0, 0],
      scale: [2, 0.3, 0.3],
      color: '#94a3b8',
      type: 'terminal',
      shape: 'box',
      health: 90,
      status: 'ok',
      isInspected: false
    }];
    var ELECTRONICS_STEPS = [{
      id: 1,
      title: "静电防护",
      instruction: "佩戴防静电手环。",
      targetPartId: "cabinet_door",
      requiredTool: ToolType.ESD_STRAP
    }, {
      id: 2,
      title: "开启柜门",
      instruction: "打开控制柜。",
      targetPartId: "cabinet_door",
      requiredTool: ToolType.NONE
    }, {
      id: 3,
      title: "故障排查",
      instruction: "测量继电器1号线圈阻值。",
      targetPartId: "relay_k1",
      requiredTool: ToolType.MULTIMETER
    }, {
      id: 4,
      title: "拆除故障件",
      instruction: "拆卸损坏的继电器。",
      targetPartId: "relay_k1",
      requiredTool: ToolType.SCREWDRIVER
    }, {
      id: 5,
      title: "目视检查",
      instruction: "检查底座是否过热变色。",
      targetPartId: "terminal_block",
      requiredTool: ToolType.FLASHLIGHT
    }];

    var GEARBOX_PARTS = [{
      id: 'gearbox_housing',
      name: '减速机上箱体',
      description: '铸铁箱体，HT200材质。',
      position: [0, 1, 0],
      rotation: [0, 0, 0],
      scale: [3, 2, 3],
      color: '#475569',
      type: 'housing',
      shape: 'box',
      health: 100,
      status: 'ok',
      isInspected: false
    }, {
      id: 'input_gear',
      name: '高速级齿轮轴',
      description: '斜齿轮，20CrMnTi渗碳淬火。',
      position: [-0.5, 0, 0],
      rotation: [1.57, 0, 0],
      scale: [0.8, 0.8, 0.5],
      color: '#94a3b8',
      type: 'gear',
      shape: 'gear',
      health: 85,
      status: 'ok',
      isInspected: false
    }, {
      id: 'output_gear',
      name: '低速级大齿轮',
      description: '模数4，齿数45。',
      position: [0.8, 0, 0],
      rotation: [1.57, 0, 0],
      scale: [1.8, 1.8, 0.5],
      color: '#64748b',
      type: 'gear',
      shape: 'gear',
      health: 60,
      status: 'worn',
      isInspected: false,
      notes: '齿面点蚀磨损'
    }, {
      id: 'bearing_cover',
      name: '轴承端盖',
      description: '密封轴承座孔。',
      position: [0.8, 0, 1.5],
      rotation: [1.57, 0, 0],
      scale: [1.0, 1.0, 0.2],
      color: '#334155',
      type: 'cover',
      shape: 'cylinder',
      health: 90,
      status: 'ok',
      isInspected: false
    }];
    var GEARBOX_STEPS = [{
      id: 1,
      title: "作业准备",
      instruction: "佩戴防护手套。",
      targetPartId: "gearbox_housing",
      requiredTool: ToolType.GLOVES
    }, {
      id: 2,
      title: "开箱",
      instruction: "使用扳手拆卸上箱体螺栓。",
      targetPartId: "gearbox_housing",
      requiredTool: ToolType.WRENCH
    }, {
      id: 3,
      title: "磨损测量",
      instruction: "使用游标卡尺测量大齿轮齿厚。",
      targetPartId: "output_gear",
      requiredTool: ToolType.VERNIER_CALIPER
    }, {
      id: 4,
      title: "目视检查",
      instruction: "检查高速轴齿面状况。",
      targetPartId: "input_gear",
      requiredTool: ToolType.FLASHLIGHT
    }, {
      id: 5,
      title: "润滑保养",
      instruction: "对齿轮啮合面进行注油润滑。",
      targetPartId: "output_gear",
      requiredTool: ToolType.OIL_CAN
    }];

    var GLB_ENGINE_PARTS = [{
      id: 'engine_glb_model',
      name: '整机三维模型',
      description: 'GLB 格式的发动机整体模型，用于整体巡检与演示。',
      position: [0, -0.5, 0],
      rotation: [0, 0, 0],
      scale: [1.1, 1.1, 1.1],
      color: '#ffffff',
      type: 'model',
      shape: 'model',
      modelUrl: "./发动机.glb",
      health: 100,
      status: 'ok',
      isInspected: false
    }];
    var GLB_ENGINE_STEPS = [{
      id: 1,
      title: "安全准备",
      instruction: "佩戴防护手套，确认无明火和障碍物。",
      targetPartId: "engine_glb_model",
      requiredTool: ToolType.GLOVES
    }, {
      id: 2,
      title: "目视检查",
      instruction: "使用强光手电检查机匣、管路是否有裂纹或松动。",
      targetPartId: "engine_glb_model",
      requiredTool: ToolType.FLASHLIGHT
    }, {
      id: 3,
      title: "表面探伤",
      instruction: "使用探伤仪扫描关键区域，观察信号波形是否平滑。",
      targetPartId: "engine_glb_model",
      requiredTool: ToolType.SCANNER
    }];

    const MATH_TIPS = [
      {
        title: "函数与初等函数",
        tip: "函数的三要素：定义域、值域、对应法则。基本初等函数包括幂函数、指数函数、对数函数、三角函数和反三角函数。",
        chapter: "第1章",
        keywords: ["函数", "定义域", "值域", "初等函数"]
      },
      {
        title: "极限与连续",
        tip: "极限描述函数在某点的变化趋势。当自变量无限接近某值时，函数值会无限接近一个确定值，这个确定值就是极限。连续函数图像是一条不间断的曲线，在闭区间上必有最大值和最小值。",
        chapter: "第2章",
        keywords: ["极限", "连续", "变化趋势", "收敛"]
      },
      {
        title: "导数与微分",
        tip: "导数是切线斜率，也是瞬时变化率。微分是函数增量的近似值，当自变量变化很小时，可以用微分来近似函数值的变化。",
        chapter: "第3章",
        keywords: ["导数", "微分", "切线", "变化率"]
      },
      {
        title: "导数的应用",
        tip: "利用导数可以判断函数的单调性、求极值、判断凹凸性。导数为正函数递增，导数为负函数递减，导数为零的点可能是极值点。",
        chapter: "第4章",
        keywords: ["单调性", "极值", "凹凸性", "导数应用"]
      },
      {
        title: "不定积分",
        tip: "不定积分是求导的逆运算。基本积分公式和换元积分法、分部积分法是主要方法。",
        chapter: "第5章",
        keywords: ["不定积分", "换元法", "分部积分"]
      },
      {
        title: "定积分",
        tip: "定积分表示曲边梯形的面积。牛顿-莱布尼茨公式连接了定积分与不定积分。",
        chapter: "第6章",
        keywords: ["定积分", "面积", "牛顿-莱布尼茨公式"]
      },
      {
        title: "常微分方程",
        tip: "微分方程是含有未知函数及其导数的方程。一阶线性微分方程可以用积分因子法求解，二阶常系数齐次微分方程的解由特征方程决定。",
        chapter: "第7章",
        keywords: ["微分方程", "积分因子", "特征根"]
      },
      {
        title: "多元函数微分学",
        tip: "偏导数是固定其他变量对某一变量的导数。多元函数的偏导数反映了函数在各个方向上的变化率。梯度是各偏导数组成的向量，表示函数变化最快的方向。",
        chapter: "第8章",
        keywords: ["偏导数", "梯度", "多元函数", "变化率"]
      },
      {
        title: "多元函数积分学",
        tip: "二重积分表示曲顶柱体的体积。区域积分可化累次积分，选对积分次序或坐标系可显著简化计算。",
        chapter: "第9章",
        keywords: ["二重积分", "体积", "累次积分", "坐标系"]
      },
      {
        title: "线性代数",
        tip: "行列式可以用来判断矩阵是否可逆。矩阵可逆时，对应的线性方程组有唯一解。向量组的线性相关性反映了向量之间的依赖关系。",
        chapter: "第10章",
        keywords: ["行列式", "矩阵", "线性方程组", "向量组"]
      },
      {
        title: "无穷级数",
        tip: "级数是无穷多个数相加。级数可能收敛（和存在）或发散（和不存在）。正项级数可以用比较判别法、比值判别法判断收敛性。",
        chapter: "第11章",
        keywords: ["级数", "收敛性", "正项级数", "判别法"]
      },
      {
        title: "向量代数与空间解析几何",
        tip: "向量的数量积、向量积、混合积。空间直线和平面的方程表示。",
        chapter: "第12章",
        keywords: ["向量", "数量积", "向量积", "空间几何"]
      },
      {
        title: "概率与统计",
        tip: "概率的加法公式和乘法公式是概率计算的基础。随机变量是随机试验结果的数值表示。常见的概率分布有均匀分布、正态分布等。",
        chapter: "第13章",
        keywords: ["概率", "统计", "随机变量", "概率分布"]
      },
      {
        title: "数学应用",
        tip: "数学知识在实际问题中的应用。例如用函数描述变化规律，用导数分析变化趋势，用积分计算面积和体积等。",
        chapter: "应用",
        keywords: ["数学应用", "实际问题", "函数应用", "积分应用"]
      }
    ];

    const PART_MATH_MAPPING = {
      'vernier_caliper': ['函数与初等函数', '导数与微分'],
      'pressure_gauge': ['函数与初等函数', '导数的应用'],
      'multimeter': ['函数与初等函数', '导数的应用'],

      'fan_rotor': ['函数与初等函数', '向量代数与空间解析几何'],
      'compressor_hp': ['函数与初等函数', '向量代数与空间解析几何'],
      'turbine_hp': ['函数与初等函数', '向量代数与空间解析几何'],
      'input_gear': ['函数与初等函数', '向量代数与空间解析几何'],
      'output_gear': ['函数与初等函数', '向量代数与空间解析几何'],

      'main_strut': ['定积分', '常微分方程'],
      'brake_hyd': ['定积分', '常微分方程'],
      'dc_cap': ['定积分', '常微分方程'],

      'bms_unit': ['线性代数', '函数与初等函数'],
      'plc_main': ['线性代数', '函数与初等函数'],
      'igbt_mod': ['线性代数', '函数与初等函数'],
      'engine_glb_model': ['函数与初等函数', '极限与连续'],

      'default': ['函数与初等函数', '极限与连续']
    };

    const PART_MATH_DETAILS = {
      fan_rotor: '推力近似 p≈ρA·v^2，观察 Δp/Δt 变化率可发现叶片气动异常。',
      compressor_hp: '压比 π=p_out/p_in，压气机稳定时 π 曲线应平滑递增。',
      turbine_hp: '扭矩 M=F·r，留意转速梯度 dv/dt 以防过热。',
      input_gear: '啮合力可分解为法向与切向，关注齿厚变化 Δh/Δt。',
      output_gear: '齿轮磨损趋势可用线性回归 h≈k·t+b 判断是否超限。',
      main_strut: '减震支柱内压满足 p=F/A，读数偏离需及时卸压。',
      brake_hyd: '液压压力 p 与位移 s 的斜率 Δp/Δs 代表减震刚度。',
      dc_cap: '电容能量 E=½·C·U^2，放电后 U 应趋近 0。',
      bms_unit: '支路电压遵循 U=IR，矩阵记录各串联单体便于排查。',
      plc_main: '控制回路可抽象为线性系统，输入/输出成比例关系。',
      igbt_mod: '散热均匀时 ΔT 分布应平滑，突变说明接触不良。',
      engine_glb_model: '整体巡检关注光斑对称性和温升曲线平滑性，异常通常对应曲线突变。',
      default: '常用关系：一次函数 y=kx+b；导数 f\'(x)=lim(Δy/Δx) 表示瞬时变化率。'
    };

    var PV_PARTS = [{
      id: 'inv_door',
      name: '逆变器机柜门',
      description: '户外防护等级IP65。',
      position: [0, 0, 1],
      rotation: [0, 0, 0],
      scale: [2.5, 3.5, 0.1],
      color: '#e2e8f0',
      type: 'cover',
      shape: 'box',
      health: 100,
      status: 'ok',
      isInspected: false
    }, {
      id: 'dc_cap',
      name: '直流母线电容',
      description: '薄膜电容组，存储高压直流电。',
      position: [-0.6, 0.5, -0.5],
      rotation: [1.57, 0, 0],
      scale: [0.5, 0.5, 1.2],
      color: '#1e293b',
      type: 'capacitor',
      shape: 'cylinder',
      health: 95,
      status: 'ok',
      isInspected: false
    }, {
      id: 'igbt_mod',
      name: '绝缘栅双极型晶体管功率模块',
      description: '英飞凌绝缘栅双极型晶体管模块，核心逆变元件。',
      position: [0, -0.5, -0.8],
      rotation: [0, 0, 0],
      scale: [1.2, 0.2, 0.8],
      color: '#0f172a',
      type: 'igbt',
      shape: 'plate',
      health: 40,
      status: 'critical',
      isInspected: false,
      notes: '模块击穿短路'
    }, {
      id: 'heatsink',
      name: '散热器',
      description: '铝型材散热器。',
      position: [0, -0.5, -1.2],
      rotation: [0, 0, 0],
      scale: [1.5, 1.0, 0.2],
      color: '#94a3b8',
      type: 'heatsink',
      shape: 'box',
      health: 90,
      status: 'ok',
      isInspected: false
    }];
    var PV_STEPS = [{
      id: 1,
      title: "安全防护",
      instruction: "穿戴绝缘手套。",
      targetPartId: "inv_door",
      requiredTool: ToolType.INSULATED_GLOVES
    }, {
      id: 2,
      title: "开柜检查",
      instruction: "打开机柜门。",
      targetPartId: "inv_door",
      requiredTool: ToolType.NONE
    }, {
      id: 3,
      title: "验电放电",
      instruction: "使用万用表测量直流母线电压，确认放电完毕。",
      targetPartId: "dc_cap",
      requiredTool: ToolType.MULTIMETER
    }, {
      id: 4,
      title: "拆除模块",
      instruction: "拆卸损坏的绝缘栅双极型晶体管模块螺丝。",
      targetPartId: "igbt_mod",
      requiredTool: ToolType.SCREWDRIVER
    }, {
      id: 5,
      title: "检查散热",
      instruction: "检查散热器表面导热硅脂。",
      targetPartId: "heatsink",
      requiredTool: ToolType.FLASHLIGHT
    }];

    var LANDING_GEAR_PARTS = [{
      id: 'main_strut',
      name: '主减震支柱',
      description: '油气式减震支柱，承受着陆冲击。',
      position: [0, 2, 0],
      rotation: [0, 0, 0],
      scale: [0.6, 4, 0.6],
      color: '#cbd5e1',
      type: 'strut',
      shape: 'cylinder',
      health: 98,
      status: 'ok',
      isInspected: false
    }, {
      id: 'wheel_assy',
      name: '机轮组件',
      description: '含轮毂和刹车盘。',
      position: [0, -0.5, 0.8],
      rotation: [1.57, 0, 0],
      scale: [1.2, 0.5, 1.2],
      color: '#1e293b',
      type: 'wheel',
      shape: 'torus',
      health: 75,
      status: 'worn',
      isInspected: false
    }, {
      id: 'brake_hyd',
      name: '刹车液压管路',
      description: '3000磅每平方英寸高压液压管。',
      position: [0.4, 1, 0.4],
      rotation: [0, 0, 0],
      scale: [0.1, 2.5, 0.1],
      color: '#16a34a',
      type: 'tube',
      shape: 'cable',
      health: 80,
      status: 'ok',
      isInspected: false
    }, {
      id: 'torque_link',
      name: '防扭臂',
      description: '防止活塞杆相对外筒转动。',
      position: [0, 0.5, -0.5],
      rotation: [0.3, 0, 0],
      scale: [0.4, 1.5, 0.2],
      color: '#94a3b8',
      type: 'link',
      shape: 'box',
      health: 95,
      status: 'ok',
      isInspected: false
    }];
    var LANDING_GEAR_STEPS = [{
      id: 1,
      title: "起落架安全",
      instruction: "安装安全销（模拟操作），穿戴手套。",
      targetPartId: "main_strut",
      requiredTool: ToolType.GLOVES
    }, {
      id: 2,
      title: "压力检查",
      instruction: "使用压力表检查减震支柱充气压力。",
      targetPartId: "main_strut",
      requiredTool: ToolType.PRESSURE_GAUGE
    }, {
      id: 3,
      title: "外观检查",
      instruction: "检查液压管路是否有渗漏。",
      targetPartId: "brake_hyd",
      requiredTool: ToolType.FLASHLIGHT
    }, {
      id: 4,
      title: "刹车磨损",
      instruction: "使用深度尺(卡尺)测量刹车片磨损量。",
      targetPartId: "wheel_assy",
      requiredTool: ToolType.VERNIER_CALIPER
    }, {
      id: 5,
      title: "润滑",
      instruction: "对防扭臂关节注油润滑。",
      targetPartId: "torque_link",
      requiredTool: ToolType.OIL_CAN
    }];

    var CAR_ENGINE_PARTS = [{
      id: 'valve_cover',
      name: '气门室盖',
      description: '铝合金盖板，密封顶部。',
      position: [0, 2, 0],
      rotation: [0, 0, 0],
      scale: [3, 0.5, 1.5],
      color: '#475569',
      type: 'cover',
      shape: 'box',
      health: 100,
      status: 'ok',
      isInspected: false
    }, {
      id: 'piston_1',
      name: '1号活塞',
      description: '铝合金活塞，承受燃气压力。',
      position: [-1, 0.5, 0],
      rotation: [0, 0, 0],
      scale: [0.8, 0.6, 0.8],
      color: '#cbd5e1',
      type: 'piston',
      shape: 'cylinder',
      health: 85,
      status: 'ok',
      isInspected: false
    }, {
      id: 'con_rod_1',
      name: '连杆组件',
      description: '连接活塞与曲轴。',
      position: [-1, -0.5, 0],
      rotation: [0, 0, 0],
      scale: [0.3, 1.5, 0.3],
      color: '#64748b',
      type: 'rod',
      shape: 'box',
      health: 90,
      status: 'ok',
      isInspected: false
    }, {
      id: 'valve_spring',
      name: '气门弹簧',
      description: '保证气门及时关闭。',
      position: [-1, 1.5, 0],
      rotation: [0, 0, 0],
      scale: [0.3, 0.6, 0.3],
      color: '#ef4444',
      type: 'spring',
      shape: 'spring',
      health: 30,
      status: 'critical',
      isInspected: false,
      notes: '弹力衰减，疲劳断裂'
    }];
    var CAR_ENGINE_STEPS = [{
      id: 1,
      title: "准备工作",
      instruction: "穿戴防护手套，准备工具。",
      targetPartId: "valve_cover",
      requiredTool: ToolType.GLOVES
    }, {
      id: 2,
      title: "拆卸室盖",
      instruction: "使用扳手拆卸气门室盖。",
      targetPartId: "valve_cover",
      requiredTool: ToolType.WRENCH
    }, {
      id: 3,
      title: "检查弹簧",
      instruction: "目视检查气门弹簧是否断裂。",
      targetPartId: "valve_spring",
      requiredTool: ToolType.FLASHLIGHT
    }, {
      id: 4,
      title: "测量活塞",
      instruction: "使用游标卡尺测量活塞直径（模拟）。",
      targetPartId: "piston_1",
      requiredTool: ToolType.VERNIER_CALIPER
    }, {
      id: 5,
      title: "拆卸连杆",
      instruction: "使用扳手拆松连杆螺栓。",
      targetPartId: "con_rod_1",
      requiredTool: ToolType.WRENCH
    }];

    // ============================================
    // 发电机模块 - 岗位化任务三步建模教学
    // ============================================

    var GENERATOR_PARTS = [{
      id: 'gen_stator',
      name: '定子绕组',
      description: '三相交流定子绕组，产生旋转磁场。',
      position: [0, 0, 0],
      rotation: [0, 0, 0],
      scale: [2.5, 2.5, 1.5],
      color: '#475569',
      type: 'stator',
      shape: 'hollow-cylinder',
      health: 95,
      status: 'ok',
      isInspected: false
    }, {
      id: 'gen_rotor',
      name: '转子（励磁绕组）',
      description: '直流励磁转子，产生主磁场。转速直接影响输出频率。',
      position: [0, 0, 0],
      rotation: [0, 0, 0],
      scale: [1.8, 1.8, 1.2],
      color: '#cbd5e1',
      type: 'rotor',
      shape: 'cylinder',
      health: 88,
      status: 'ok',
      isInspected: false,
      notes: '关键变量：转速n'
    }, {
      id: 'gen_bearing_front',
      name: '前端轴承',
      description: '支撑转子的滚动轴承，减少摩擦损耗。',
      position: [0, 0, 1.2],
      rotation: [1.57, 0, 0],
      scale: [0.8, 0.8, 0.3],
      color: '#64748b',
      type: 'bearing',
      shape: 'torus',
      health: 92,
      status: 'ok',
      isInspected: false
    }, {
      id: 'gen_bearing_rear',
      name: '后端轴承',
      description: '支撑转子的滚动轴承。',
      position: [0, 0, -1.2],
      rotation: [1.57, 0, 0],
      scale: [0.8, 0.8, 0.3],
      color: '#64748b',
      type: 'bearing',
      shape: 'torus',
      health: 70,
      status: 'worn',
      isInspected: false,
      notes: '轴承温升异常'
    }, {
      id: 'gen_exciter',
      name: '励磁机',
      description: '为转子提供直流励磁电流，控制输出电压。',
      position: [0, 0, -2],
      rotation: [0, 0, 0],
      scale: [1.2, 1.2, 0.8],
      color: '#1e293b',
      type: 'exciter',
      shape: 'cylinder',
      health: 85,
      status: 'ok',
      isInspected: false,
      notes: '关键变量：励磁电流If'
    }, {
      id: 'gen_cooling_fan',
      name: '冷却风扇',
      description: '强制风冷散热系统。',
      position: [0, 0, 2],
      rotation: [0, 0, 0],
      scale: [2.2, 2.2, 0.3],
      color: '#94a3b8',
      type: 'fan',
      shape: 'fan',
      health: 98,
      status: 'ok',
      isInspected: false
    }, {
      id: 'gen_terminal_box',
      name: '接线盒',
      description: '三相输出端子与保护装置。',
      position: [1.5, 1, 0],
      rotation: [0, 0, 0],
      scale: [0.6, 0.6, 0.8],
      color: '#ef4444',
      type: 'terminal',
      shape: 'box',
      health: 100,
      status: 'ok',
      isInspected: false,
      notes: '输出：U、I、P'
    }, {
      id: 'gen_avr',
      name: '自动电压调节器(AVR)',
      description: '自动调节励磁电流，稳定输出电压。',
      position: [-1.5, 1, 0],
      rotation: [0, 0, 0],
      scale: [0.5, 0.3, 0.6],
      color: '#10b981',
      type: 'pcb',
      shape: 'plate',
      health: 60,
      status: 'damaged',
      isInspected: false,
      notes: '电压波动超限，需校准'
    }];

    var GENERATOR_STEPS = [{
      id: 1,
      title: "安全准备",
      instruction: "穿戴绝缘手套，确认发电机已停机并断开负载。",
      targetPartId: "gen_terminal_box",
      requiredTool: ToolType.INSULATED_GLOVES,
      mathContext: "安全函数 f(防护)∈{0,1}，f=1才可操作。输出功率P=0时开始检修。"
    }, {
      id: 2,
      title: "空载电压测量",
      instruction: "使用万用表测量空载输出电压，记录数据。",
      targetPartId: "gen_terminal_box",
      requiredTool: ToolType.MULTIMETER,
      mathContext: "空载电压 U₀=4.44fNΦ，其中f=np/60（转速与频率关系）。"
    }, {
      id: 3,
      title: "转速检测",
      instruction: "使用转速表检测转子转速，验证频率关系。",
      targetPartId: "gen_rotor",
      requiredTool: ToolType.SCANNER,
      mathContext: "同步转速 n=60f/p，检验f=50Hz时n=3000/p。"
    }, {
      id: 4,
      title: "轴承温度检测",
      instruction: "使用红外测温仪检查轴承温升。",
      targetPartId: "gen_bearing_rear",
      requiredTool: ToolType.SCANNER,
      mathContext: "温升ΔT应满足约束：ΔT≤65℃，否则效率η下降。"
    }, {
      id: 5,
      title: "AVR校准",
      instruction: "调节AVR参数，使输出电压稳定在额定值。",
      targetPartId: "gen_avr",
      requiredTool: ToolType.SCREWDRIVER,
      mathContext: "反馈控制：ΔU→ΔIf→ΔΦ→稳定输出。最优点：dU/dIf=0。"
    }];

    // ============================================
    // 岗位化任务数据结构 - 发电机建模任务
    // ============================================

    var GENERATOR_TASK_DATA = {
      taskQuestion: "这个发电机系统的「输出」是什么？影响输出的关键变量是什么？我们怎样把它写成一个可计算、可验证的模型？",

      // 第一步：拆变量
      variables: {
        input: [
          { symbol: 'n', name: '转速', unit: 'rpm', range: [1000, 3600], typical: 3000, description: '原动机带动转子的旋转速度' },
          { symbol: 'I_f', name: '励磁电流', unit: 'A', range: [0, 10], typical: 5, description: '励磁绕组的直流电流' },
          { symbol: 'P_load', name: '负载功率', unit: 'kW', range: [0, 100], typical: 50, description: '外部负载消耗的功率' },
          { symbol: 't', name: '运行时间', unit: 'h', range: [0, 24], typical: 8, description: '连续运行时间' }
        ],
        output: [
          { symbol: 'U', name: '输出电压', unit: 'V', range: [0, 480], typical: 400, description: '三相线电压有效值' },
          { symbol: 'I', name: '输出电流', unit: 'A', range: [0, 200], typical: 72, description: '负载电流有效值' },
          { symbol: 'P', name: '输出功率', unit: 'kW', range: [0, 100], typical: 50, description: 'P=√3·U·I·cosφ' },
          { symbol: 'η', name: '效率', unit: '%', range: [0, 100], typical: 92, description: 'η=P_out/P_in×100%' },
          { symbol: 'f', name: '频率', unit: 'Hz', range: [45, 55], typical: 50, description: 'f=np/60' }
        ],
        constraint: [
          { symbol: 'T_max', name: '最高温升', unit: '℃', limit: 65, description: '绕组温升不超过65℃' },
          { symbol: 'U_ripple', name: '电压波动', unit: '%', limit: 5, description: '电压波动率≤±5%' },
          { symbol: 'THD', name: '谐波畸变', unit: '%', limit: 8, description: '总谐波畸变率≤8%' },
          { symbol: 'P_loss', name: '损耗功率', unit: 'kW', limit: 10, description: '铜损+铁损+机械损耗' },
          { symbol: 'noise', name: '噪声', unit: 'dB', limit: 85, description: '运行噪声≤85dB' }
        ]
      },

      // 第二步：选模型
      models: [
        {
          id: 'voltage_speed',
          name: '电压-转速模型',
          type: '线性函数',
          formula: 'U = k₁ · n · I_f',
          description: '空载电压与转速、励磁电流成正比',
          parameters: [
            { symbol: 'k₁', name: '电压系数', value: 0.044, unit: 'V/(rpm·A)' }
          ],
          sampleData: [
            { n: 1500, I_f: 5, U: 330 },
            { n: 2000, I_f: 5, U: 350 },
            { n: 2500, I_f: 5, U: 380 },
            { n: 3000, I_f: 5, U: 400 },
            { n: 3000, I_f: 4, U: 352 },
            { n: 3000, I_f: 6, U: 432 }
          ]
        },
        {
          id: 'frequency_speed',
          name: '频率-转速模型',
          type: '线性函数',
          formula: 'f = n · p / 60',
          description: '输出频率由转速和极对数决定',
          parameters: [
            { symbol: 'p', name: '极对数', value: 1, unit: '对' }
          ],
          sampleData: [
            { n: 2400, f: 40 },
            { n: 2700, f: 45 },
            { n: 3000, f: 50 },
            { n: 3300, f: 55 },
            { n: 3600, f: 60 }
          ]
        },
        {
          id: 'power_efficiency',
          name: '功率-效率模型',
          type: '二次函数',
          formula: 'η = η_max - a(P - P_opt)²',
          description: '效率在最佳负载点达到最大值',
          parameters: [
            { symbol: 'η_max', name: '最高效率', value: 94, unit: '%' },
            { symbol: 'P_opt', name: '最佳负载', value: 75, unit: '%额定' },
            { symbol: 'a', name: '效率系数', value: 0.002, unit: '' }
          ],
          sampleData: [
            { P_percent: 25, eta: 85 },
            { P_percent: 50, eta: 91 },
            { P_percent: 75, eta: 94 },
            { P_percent: 100, eta: 92 },
            { P_percent: 110, eta: 89 }
          ]
        },
        {
          id: 'temp_time',
          name: '温升-时间模型',
          type: '指数函数',
          formula: 'ΔT(t) = ΔT_∞ · (1 - e^(-t/τ))',
          description: '温升随时间指数趋近稳态值',
          parameters: [
            { symbol: 'ΔT_∞', name: '稳态温升', value: 55, unit: '℃' },
            { symbol: 'τ', name: '热时间常数', value: 2, unit: 'h' }
          ],
          sampleData: [
            { t: 0.5, deltaT: 12 },
            { t: 1.0, deltaT: 22 },
            { t: 2.0, deltaT: 35 },
            { t: 4.0, deltaT: 48 },
            { t: 8.0, deltaT: 54 }
          ]
        }
      ],

      // 第三步：岗位问题
      jobQuestions: [
        {
          question: "如果我要让输出功率更稳定，我该优先控制哪个变量？为什么？",
          hint: "分析P=f(n, I_f, P_load)各变量的敏感度",
          answer: "优先控制转速n。因为P与n近似成正比，且励磁系统AVR可自动补偿电压波动，但转速波动会直接导致频率偏移，影响用电设备。使用调速器保持n恒定是最关键的。"
        },
        {
          question: "发电机长时间运行后效率下降，可能是哪个约束条件超限？如何验证？",
          hint: "观察温升-时间模型和效率-功率模型",
          answer: "最可能是温升T超限。验证方法：测量绕组温度，若ΔT>65℃，说明散热不足。温升导致绕组电阻增加（R∝T），铜损P_cu=I²R增大，效率η下降。"
        },
        {
          question: "如何找到发电机运行的最佳工况点？用什么数学方法？",
          hint: "效率η是负载率P%的函数",
          answer: "对效率函数求导并令dη/dP=0，找极值点。从实测数据用最小二乘法拟合抛物线η=a·P²+b·P+c，最佳点P_opt=-b/(2a)。实测表明75%额定负载时效率最高。"
        }
      ],

      // 学习证据模板
      evidenceTemplate: {
        variableTable: true,
        modelFormula: true,
        fittingChart: true,
        optimalPoint: true,
        jobExplanation: true
      }
    };

    // 部件-数学映射扩展
    PART_MATH_MAPPING['gen_rotor'] = ['函数与初等函数', '导数与微分', '极限与连续'];
    PART_MATH_MAPPING['gen_stator'] = ['向量代数与空间解析几何', '线性代数'];
    PART_MATH_MAPPING['gen_avr'] = ['导数的应用', '常微分方程', '函数与初等函数'];
    PART_MATH_MAPPING['gen_exciter'] = ['函数与初等函数', '线性代数'];
    PART_MATH_MAPPING['gen_bearing_front'] = ['定积分', '概率与统计'];
    PART_MATH_MAPPING['gen_bearing_rear'] = ['定积分', '概率与统计', '常微分方程'];
    PART_MATH_MAPPING['gen_cooling_fan'] = ['定积分', '多元函数微分学'];
    PART_MATH_MAPPING['gen_terminal_box'] = ['函数与初等函数', '线性代数'];

    // 部件-数学详情扩展
    PART_MATH_DETAILS['gen_rotor'] = '转子转速n决定输出频率f=np/60，电压U∝n·Φ，导数dn/dt反映加减速过程。';
    PART_MATH_DETAILS['gen_stator'] = '三相绑组产生旋转磁场，空间向量表示：Φ=Φ_A+Φ_B·e^(j2π/3)+Φ_C·e^(j4π/3)。';
    PART_MATH_DETAILS['gen_avr'] = '反馈控制使dU/dt→0，求解微分方程得稳态响应，最优励磁点使∂η/∂I_f=0。';
    PART_MATH_DETAILS['gen_exciter'] = '励磁电流I_f与磁通Φ近似线性Φ≈k·I_f（不饱和段），饱和后为对数关系。';
    PART_MATH_DETAILS['gen_bearing_front'] = '轴承寿命L=(C/P)^n小时，失效概率服从威布尔分布。';
    PART_MATH_DETAILS['gen_bearing_rear'] = '温升模型ΔT(t)=ΔT_∞(1-e^(-t/τ))是一阶微分方程的解。';
    PART_MATH_DETAILS['gen_cooling_fan'] = '散热功率Q=h·A·ΔT，风量-压力曲线的面积积分表示风机功率。';
    PART_MATH_DETAILS['gen_terminal_box'] = '三相功率P=√3·U·I·cosφ，功率因数cosφ影响效率。';

    // 步骤-数学语境扩展




    var MODULES_CONFIG = [{
      id: 'aviation_engine',
      title: '航空动力维修',
      category: 'Aviation',
      description: 'GE-90 涡扇发动机高压压气机叶片损伤检测与核心机拆装实训。',
      difficulty: 'Advanced',
      initialParts: AVIATION_PARTS,
      procedureSteps: AVIATION_STEPS,
      availableTools: [ToolType.NONE, ToolType.GLOVES, ToolType.WRENCH, ToolType.SCANNER, ToolType.FLASHLIGHT],
      cameraPosition: [5, 4, 6]
    }, {
      id: 'landing_gear',
      title: 'A320 起落架检修',
      category: 'Aviation',
      description: '主起落架减震支柱压力检测与刹车组件维护实训。',
      difficulty: 'Intermediate',
      initialParts: LANDING_GEAR_PARTS,
      procedureSteps: LANDING_GEAR_STEPS,
      availableTools: [ToolType.NONE, ToolType.GLOVES, ToolType.PRESSURE_GAUGE, ToolType.VERNIER_CALIPER, ToolType.FLASHLIGHT, ToolType.OIL_CAN],
      cameraPosition: [3, 2, 5]
    }, {
      id: 'ev_battery',
      title: '新能源汽车技术',
      category: 'Automotive',
      description: '纯电动汽车动力电池包高压断电锁定挂牌与电池管理系统故障诊断。',
      difficulty: 'Intermediate',
      initialParts: EV_PARTS,
      procedureSteps: EV_STEPS,
      availableTools: [ToolType.NONE, ToolType.INSULATED_GLOVES, ToolType.INSULATED_WRENCH, ToolType.MULTIMETER, ToolType.SCANNER],
      cameraPosition: [4, 6, 4]
    }, {
      id: 'car_engine',
      title: '汽车发动机大修',
      category: 'Automotive',
      description: '传统四缸发动机活塞连杆组拆解与精密测量。',
      difficulty: 'Advanced',
      initialParts: CAR_ENGINE_PARTS,
      procedureSteps: CAR_ENGINE_STEPS,
      availableTools: [ToolType.NONE, ToolType.GLOVES, ToolType.WRENCH, ToolType.VERNIER_CALIPER, ToolType.FLASHLIGHT],
      cameraPosition: [2, 3, 5]
    }, {
      id: 'industrial_plc',
      title: '工业电子技术',
      category: 'Electronics',
      description: '自动化生产线 PLC 控制柜电气元件排故与继电器更换实训。',
      difficulty: 'Beginner',
      initialParts: ELECTRONICS_PARTS,
      procedureSteps: ELECTRONICS_STEPS,
      availableTools: [ToolType.NONE, ToolType.ESD_STRAP, ToolType.SCREWDRIVER, ToolType.MULTIMETER, ToolType.FLASHLIGHT],
      cameraPosition: [0, 0, 6]
    }, {
      id: 'pv_inverter',
      title: '光伏逆变器维护',
      category: 'Electronics',
      description: '大功率光伏逆变器IGBT模块故障排查与更换。',
      difficulty: 'Advanced',
      initialParts: PV_PARTS,
      procedureSteps: PV_STEPS,
      availableTools: [ToolType.NONE, ToolType.INSULATED_GLOVES, ToolType.MULTIMETER, ToolType.SCREWDRIVER, ToolType.FLASHLIGHT],
      cameraPosition: [2, 1, 4]
    }, {
      id: 'gearbox',
      title: '机械装配技术',
      category: 'Mechanical',
      description: '工业减速机（齿轮箱）拆装、测量与润滑维护实训。',
      difficulty: 'Intermediate',
      initialParts: GEARBOX_PARTS,
      procedureSteps: GEARBOX_STEPS,
      availableTools: [ToolType.NONE, ToolType.GLOVES, ToolType.WRENCH, ToolType.VERNIER_CALIPER, ToolType.FLASHLIGHT, ToolType.OIL_CAN],
      cameraPosition: [3, 4, 3]
    }, {
      id: 'glb_engine',
      title: '发动机三维模型巡检',
      category: 'Aviation',
      description: '使用 GLB 发动机整机模型完成安全检查与目视巡检。',
      difficulty: 'Beginner',
      initialParts: GLB_ENGINE_PARTS,
      procedureSteps: GLB_ENGINE_STEPS,
      availableTools: [ToolType.NONE, ToolType.GLOVES, ToolType.FLASHLIGHT, ToolType.SCANNER],
      cameraPosition: [4, 3, 6]
    }, {
      id: 'single_cylinder_engine',
      title: '单缸机爆炸组装',
      category: 'Mechanical',
      description: '单缸发动机爆炸视图与组装动画演示。',
      difficulty: 'Beginner',
      initialParts: [],
      procedureSteps: [],
      availableTools: [ToolType.NONE],
      cameraPosition: [0, 0, 5],
      useSketchfab: true,
      sketchfabUrl: 'https://sketchfab.com/models/e1afedea76af43fdb92d8a6a8b936fb6/embed?autostart=1&ui_theme=dark'
    }, {
      id: 'generator',
      title: '发电机建模工坊',
      category: 'Electronics',
      description: '同步发电机原理建模：从工程语言到数学语言的三步教学法。包含变量表、模型拟合、最优点分析。',
      difficulty: 'Intermediate',
      initialParts: GENERATOR_PARTS,
      procedureSteps: GENERATOR_STEPS,
      availableTools: [ToolType.NONE, ToolType.INSULATED_GLOVES, ToolType.MULTIMETER, ToolType.SCANNER, ToolType.SCREWDRIVER, ToolType.FLASHLIGHT],
      cameraPosition: [4, 3, 5],
      hasModelingWorkshop: true,
      taskData: GENERATOR_TASK_DATA
    }];

    var STEP_MATH_CONTEXT = {
      aviation_engine: {
        1: '安全防护可抽象为函数 f(防护)=1/0，f=1 才允许操作；同时关注接触压力 p=F/A 是否超限。',
        2: '手电照射叶片时用三角函数判断入射角≈反射角，光斑对称说明转子角度正常。',
        3: '拆机匣需控制扭矩 M=F×r，关注导数 dM/dθ 平滑，避免瞬时峰值拉伤螺纹。',
        4: '探伤信号 I(t) 需连续且稳定，lim_{t→t0} I(t) 不应突变，保证结构无异常。',
        5: '转速与温度随时间的变化率 dv/dt、dT/dt 显示疲劳趋势，可提前预警高温区。'
      },
      landing_gear: {
        1: '支柱承载可用 p=F/A 描述，确认压力读数落在安全区间的定义域内。',
        2: '压力-位移曲线的斜率 Δp/Δs 表示压缩速率，应保持在设备允许范围。',
        3: '泄漏常表现为曲线不连续点或突增，目视检查辅助定位突变位置。',
        4: '刹车片磨耗近似一次函数 y=kx+b，可据 k、b 判断是否超过磨耗限值。',
        5: '润滑覆盖面积可用定积分近似 S=∫(油膜厚度×宽度)ds，确保均匀涂布。'
      },
      ev_battery: {
        1: '绝缘手套是安全函数 f(防护)=1/0 的前置条件，f=1 才能继续断电操作。',
        2: '维护开关是二值函数 {0,1}，必须先让状态降到 0，再解除高压连锁。',
        3: '验电读数 U(t) 应逐步趋近 0，极限 lim_{t→∞} U(t)=0 说明放电完成。',
        4: '拆盖需预估间隙，简单几何量测可判断是否满足最小安全距离。',
        5: 'BMS 采样可用线性方程 U=IR 分析支路压降，定位接触不良点。'
      },
      car_engine: {
        1: '工具与任务可视为映射表 f(序号)=工具，按序号执行保证流程可控。',
        2: '拆室盖扭矩曲线 M(θ) 需平滑，监控导数 dM/dθ 防止瞬时过扭。',
        3: '弹簧近似线性 F=kx，测量伸长判断是否超过设计弹性区。',
        4: '活塞直径测量需满足公差 |d-标准|≤Δd，属平面几何应用。',
        5: '拆连杆时注意力的分解，合力方向与大小遵循向量平衡。'
      },
      industrial_plc: {
        1: '静电量与风险等级可映射为 f(Q)=风险，佩戴手环使 Q≈0 保持安全。',
        2: '开启柜门前后保持电压状态连续，避免出现左右极限不一致的跳变。',
        3: '测阻值用欧姆定律 U=IR，判断线圈 R 是否偏离正常范围。',
        4: '拆继电器相当于简化线性系统，逐项断开耦合避免串扰。',
        5: '过热痕迹可用温度梯度 ∇T 指向散热方向，辅助定位发热点。'
      },
      pv_inverter: {
        1: '防护状态与电压等级可形成表格函数，只有“已绝缘”映射到安全输出。',
        2: '开柜前后需保证电压的左右极限一致，避免出现电压跳变。',
        3: '放电过程电压序列应收敛到 0，lim U_n=0 说明残压已清除。',
        4: '拆 IGBT 时记录位置矩阵，有助复原线路并校验接线一一对应。',
        5: '散热均匀性可用平均温升 ΔT=∫ΔT(x)dx/L 判断硅脂涂抹是否到位。'
      },
      gearbox: {
        1: '工具序列与操作步骤做映射 f(序号)=动作，按序执行避免遗漏。',
        2: '拆箱体监测扭矩曲线 M(θ)，保持 dM/dθ 平稳，防止螺栓受力突升。',
        3: '齿厚磨损可绘制 t–h 曲线，观察斜率 Δh/Δt 是否超出正常磨耗。',
        4: '齿面啮合方向可用向量表示，确保力的方向与设计啮合法线一致。',
        5: '润滑面积可估算 S=∫(齿宽×油膜厚度)ds，覆盖均匀能减少能量损耗。'
      },
      glb_engine: {
        1: '防护状态函数 f(手套)=1/0，f=1 才允许后续操作，注意接触压力 p=F/A 不可超限。',
        2: '手电光斑对称性可用三角函数判断入射角≈反射角，裂纹会打破对称。',
        3: '探伤信号 I(t) 应连续且平滑，lim_{t→t0} I(t) 不突变说明结构正常。'
      },
      generator: {
        1: '安全条件可表示为示性函数I(安全)∈{0,1}，只有I=1时才满足操作的定义域。',
        2: '空载电压U₀=4.44fNΦ，其中f=np/60是转速n的线性函数，N为绑组匝数。',
        3: '频率f与转速n的关系f=np/60是一次函数，斜率由极对数p决定。',
        4: '温升遵循指数模型ΔT(t)=ΔT_∞(1-e^(-t/τ))，τ是热时间常数，可从测量数据拟合。',
        5: 'AVR调节目标是使电压偏差ΔU→0，本质是求解使∂U/∂I_f=k的励磁电流值。'
      }
    };

    MODULES_CONFIG.forEach(function (module) {
      var contextMap = STEP_MATH_CONTEXT[module.id] || {};
      module.procedureSteps = module.procedureSteps.map(function (step) {
        var enriched = Object.assign({}, step);
        enriched.mathContext = contextMap[step.id] || step.mathContext || null;
        return enriched;
      });
    });

    var AI_CONFIG = {
      qwen: {
        name: '通义千问 (Qwen-Max)',
        url: "https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions",
        key: "sk-c2d1035ff7504269b2f91d5015940a7d",
        model: "qwen-max"
      },
      deepseek: {
        name: 'DeepSeek (V3)',
        url: "https://api.deepseek.com/chat/completions",
        key: "sk-eb1e9427a3624b48b706015c771d08b5",
        model: "deepseek-chat"
      },
      kimi: {
        name: 'Kimi (Moonshot)',
        url: "https://api.moonshot.cn/v1/chat/completions",
        key: "sk-SxAdShW4CUBvBNQxt4aJkqRsx7eTfgSimJbHcIX9c2PMa8wZ",
        model: "moonshot-v1-8k"
      }
    };
    var PROVIDER_LABEL = {
      qwen: '通义千问',
      deepseek: '深度求索',
      kimi: 'Kimi（月之暗面）'
    };
    function callAIAPI(_x, _x2) {
      return _callAIAPI.apply(this, arguments);
    }
    function _callAIAPI() {
      _callAIAPI = _asyncToGenerator(function* (provider, messages) {
        var temperature = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0.7;
        var config = AI_CONFIG[provider];
        try {
          var _data$choices;
          var response = yield fetch(config.url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': "Bearer ".concat(config.key)
            },
            body: JSON.stringify({
              model: config.model,
              messages: messages,
              temperature: temperature,
              stream: false
            })
          });
          if (!response.ok) {
            var errorData = yield response.json().catch(() => ({}));
            console.error("".concat(config.name, " API Error:"), response.status, errorData);
            if (response.status === 429) {
              throw new Error("QUOTA_EXCEEDED");
            }
            throw new Error("API_ERROR_".concat(response.status));
          }
          var data = yield response.json();
          return ((_data$choices = data.choices) === null || _data$choices === void 0 || (_data$choices = _data$choices[0]) === null || _data$choices === void 0 || (_data$choices = _data$choices.message) === null || _data$choices === void 0 ? void 0 : _data$choices.content) || "无回复内容。";
        } catch (error) {
          console.error("AI Service Error:", error);
          if (error.message === "QUOTA_EXCEEDED") {
            return "\u26A0\uFE0F \u7CFB\u7EDF\u63D0\u793A\uFF1A".concat(config.name, " \u670D\u52A1\u7E41\u5FD9\uFF08\u914D\u989D\u8D85\u9650\uFF09\u3002\u8BF7\u5C1D\u8BD5\u5207\u6362\u5176\u4ED6 AI \u6A21\u578B\u6216\u7A0D\u540E\u91CD\u8BD5\u3002");
          }
          return "\u26A0\uFE0F \u8FDE\u63A5\u5931\u8D25\uFF1A\u65E0\u6CD5\u8FDE\u63A5\u5230 ".concat(config.name, "\u3002\u8BF7\u68C0\u67E5\u7F51\u7EDC\u6216\u5207\u6362\u6A21\u578B\u3002");
        }
      });
      return _callAIAPI.apply(this, arguments);
    }
    var generatePartAnalysis = /*#__PURE__*/function () {
      var _ref = _asyncToGenerator(function* (part, tool) {
        var provider = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'qwen';
        var prompt = '';
        if (tool === ToolType.SCANNER) {
          prompt = "\n              \u89D2\u8272: \u9AD8\u7EA7\u7EF4\u4FEE\u5DE5\u7A0B\u5E08\u5BFC\u5E08\u3002\n              \u573A\u666F: \u5B66\u5458\u6B63\u5728\u4F7F\u7528\u65E0\u635F\u63A2\u4F24\u626B\u63CF\u4EEA\u68C0\u67E5\u8BBE\u5907\u90E8\u4EF6\u3002\n              \n              \u5F53\u524D\u90E8\u4EF6: ".concat(part.name, "\n              \u72B6\u6001: ").concat(part.status, " (\u5065\u5EB7\u5EA6: ").concat(part.health, "%)\n              \u5177\u4F53\u95EE\u9898: ").concat(part.notes || '无明显异常', "\n              \n              \u4EFB\u52A1:\n              1. \u751F\u6210\u4E00\u6BB5\u4E13\u4E1A\u7684\u626B\u63CF\u62A5\u544A\uFF08\u4E0D\u8D85\u8FC7100\u5B57\uFF09\u3002\n              2. \u5982\u679C\u72B6\u6001\u4E0D\u4F73\uFF0C\u7ED9\u51FA\u5177\u4F53\u7684\u7EF4\u4FEE\u5EFA\u8BAE\u3002\n              3. \u8BED\u6C14\u4E25\u8C28\u4E13\u4E1A\u3002\n            ");
        } else if (tool === ToolType.FLASHLIGHT) {
          prompt = "\n              \u89D2\u8272: \u9AD8\u7EA7\u7EF4\u4FEE\u5DE5\u7A0B\u5E08\u5BFC\u5E08\u3002\n              \u573A\u666F: \u5B66\u5458\u6B63\u5728\u4F7F\u7528\u5F3A\u5149\u624B\u7535\u7B52\u8FDB\u884C\u76EE\u89C6\u68C0\u67E5\u3002\n              \n              \u5F53\u524D\u90E8\u4EF6: ".concat(part.name, "\n              \n              \u4EFB\u52A1:\n              1. \u63CF\u8FF0\u5728\u6B64\u90E8\u4EF6\u4E0A\u76EE\u89C6\u68C0\u67E5\u5E94\u8BE5\u5173\u6CE8\u7684\u91CD\u70B9\uFF08\u5982\u88C2\u7EB9\u3001\u51F9\u5751\u3001FOD\u635F\u4F24\uFF09\u3002\n              2. \u7B80\u77ED\u6709\u529B\uFF0C\u4E0D\u8D85\u8FC780\u5B57\u3002\n            ");
        } else {
          prompt = "\n              \u89D2\u8272: \u9AD8\u7EA7\u7EF4\u4FEE\u5DE5\u7A0B\u5E08\u5BFC\u5E08\u3002\n              \u5F53\u524D\u90E8\u4EF6: ".concat(part.name, "\n              \n              \u4EFB\u52A1: \u7B80\u5355\u4ECB\u7ECD\u8BE5\u90E8\u4EF6\u7684\u529F\u80FD\u4F5C\u7528\u3002\u4E0D\u8D85\u8FC750\u5B57\u3002\n            ");
        }
        var mathLinks = PART_MATH_MAPPING[part.id] || PART_MATH_MAPPING.default;
        if (mathLinks && mathLinks.length) {
          prompt += "\n\u6570\u5B66\u5173\u8054\uFF1A".concat(mathLinks.join('\u3001'), "\n\u8BF7\u4ECE\u51FD\u6570\u3001\u5FAE\u79EF\u7B49\u6570\u5B66\u89D2\u5EA6\u4E0A\u4E0E\u6A21\u578B\u5B9E\u4F53\u5173\u8054\u7406\u89E3\u3002");
        }
        return yield callAIAPI(provider, [{
          role: 'user',
          content: prompt
        }]);
      });
      return function generatePartAnalysis(_x3, _x4) {
        return _ref.apply(this, arguments);
      };
    }();
    var chatWithInstructor = /*#__PURE__*/function () {
      var _ref2 = _asyncToGenerator(function* (history, message) {
        var provider = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'qwen';
        var currentPart = arguments.length > 3 ? arguments[3] : undefined;
        var context = currentPart ? "\u5F53\u524D\u5B66\u5458\u9009\u4E2D\u7684\u90E8\u4EF6\u662F: ".concat(currentPart.name, " (\u72B6\u6001: ").concat(currentPart.status, ")\u3002") : "当前未选中特定部件。";
        var messages = [{
          role: 'system',
          content: "\u4F60\u662F\u4E00\u540D\u7ECF\u9A8C\u4E30\u5BCC\u7684\u7EF4\u4FEE\u6559\u5458\u3002\u6B63\u5728\u6307\u5BFC\u5B66\u751F\u8FDB\u884C\u865A\u62DF\u7EF4\u4FEE\u5B9E\u8BAD\u3002\n              ".concat(context, "\n              \u89C4\u5219: \u7ED3\u5408 SOP\uFF0C\u5F3A\u8C03\u5B89\u5168\uFF0C\u56DE\u7B54\u7B80\u7EC3\u3002")
        }, ...history.map(text => ({
          role: 'user',
          content: text
        })),
        {
          role: 'user',
          content: message
        }];

        var formattedMessages = [{
          role: 'system',
          content: "\u4F60\u662F\u4E00\u540D\u7ECF\u9A8C\u4E30\u5BCC\u7684\u7EF4\u4FEE\u6559\u5458\u3002\u6B63\u5728\u6307\u5BFC\u5B66\u751F\u8FDB\u884C\u865A\u62DF\u7EF4\u4FEE\u5B9E\u8BAD\u3002\n              ".concat(context, "\n              \u89C4\u5219: \u7ED3\u5408 SOP\uFF0C\u5F3A\u8C03\u5B89\u5168\uFF0C\u56DE\u7B54\u7B80\u7EC3\u3002")
        }, ...history.map((text, i) => ({
          role: 'user',
          content: text
        })), {
          role: 'user',
          content: message
        }];
        return yield callAIAPI(provider, formattedMessages);
      });
      return function chatWithInstructor(_x5, _x6) {
        return _ref2.apply(this, arguments);
      };
    }();


    var ModelMesh = _ref3 => {
      var {
        url,
        scale,
        rotation
      } = _ref3;
      var {
        scene
      } = useGLTF(url);
      var clonedScene = useMemo(() => {
        var cloned = scene.clone(true);
        cloned.traverse(obj => {
          if (obj.isMesh || obj.isSkinnedMesh) {
            obj.castShadow = true;
            obj.receiveShadow = true;
          }
        });
        return cloned;
      }, [scene]);
      return /*#__PURE__*/React.createElement("primitive", {
        object: clonedScene,
        scale: scale || [1, 1, 1],
        rotation: rotation || [0, 0, 0]
      });
    };
    useGLTF.preload("./发动机.glb");
    var PartMesh = _ref4 => {
      var {
        part,
        onClick: _onClick,
        selected,
        exploded,
        running,
        index
      } = _ref4;
      var meshRef = useRef(null);
      var [hovered, setHovered] = useState(false);
      var isFlatStructure = part.shape === 'box' || part.shape === 'plate';
      var basePos = new THREE.Vector3(...part.position);
      var explodedOffset = exploded ? isFlatStructure ? new THREE.Vector3(0, index * 0.5, 0) : new THREE.Vector3(0, 0, (index - 3) * 1.5) : new THREE.Vector3(0, 0, 0);
      var targetPos = basePos.clone().add(explodedOffset);
      useFrame((state, delta) => {
        if (meshRef.current) {
          meshRef.current.position.lerp(targetPos, 0.1);
          if (running) {
            if (part.type === 'fan' || part.type === 'compressor' || part.type === 'turbine' || part.shape === 'gear') {
              var speed = part.type === 'fan' ? 2 : part.shape === 'gear' ? 1 : 5;
              var axis = part.shape === 'gear' ? 'x' : 'z';
              meshRef.current.rotation[axis] -= speed * delta;
            }
          }
        }
      });
      var materialColor = selected ? '#38bdf8' : hovered ? '#cbd5e1' : part.color;
      var renderGeometry = () => {
        switch (part.shape) {
          case 'hollow-cylinder':
            return /*#__PURE__*/React.createElement("mesh", {
              rotation: [Math.PI / 2, 0, 0]
            }, /*#__PURE__*/React.createElement("cylinderGeometry", {
              args: [part.scale[0], part.scale[1], part.scale[2], 32, 1, true]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              side: THREE.DoubleSide,
              transparent: true,
              opacity: 0.4,
              roughness: 0.2,
              metalness: 0.8
            }));
          case 'cylinder':
            if (part.type === 'fan') {
              return /*#__PURE__*/React.createElement("group", null, /*#__PURE__*/React.createElement("mesh", {
                rotation: [Math.PI / 2, 0, 0]
              }, /*#__PURE__*/React.createElement("cylinderGeometry", {
                args: [0.5, 0.8, 1, 16]
              }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
                color: "#333",
                roughness: 0.5
              })), Array.from({
                length: 12
              }).map((_, i) => /*#__PURE__*/React.createElement("mesh", {
                key: i,
                rotation: [0, 0, i / 12 * Math.PI * 2],
                position: [0, 0, 0]
              }, /*#__PURE__*/React.createElement("boxGeometry", {
                args: [0.1, part.scale[0] * 1.8, 0.4]
              }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
                color: materialColor,
                metalness: 0.8
              }))));
            }
            return /*#__PURE__*/React.createElement("mesh", {
              rotation: [Math.PI / 2, 0, 0]
            }, /*#__PURE__*/React.createElement("cylinderGeometry", {
              args: [part.scale[0], part.scale[0], part.scale[2] || 0.2, 32]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              metalness: 0.7,
              roughness: 0.3
            }));
          case 'torus':
            return /*#__PURE__*/React.createElement("mesh", null, /*#__PURE__*/React.createElement("torusGeometry", {
              args: [part.scale[0], part.scale[1] || 0.4, 16, 32]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: part.status === 'ok' ? part.type === 'wheel' ? '#1e293b' : '#ea580c' : '#ef4444',
              emissive: part.type === 'combustor' && running ? '#9a3412' : '#000',
              emissiveIntensity: part.type === 'combustor' && running ? 2 : 0,
              wireframe: selected
            }));
          case 'cone':
            return /*#__PURE__*/React.createElement("mesh", {
              rotation: [Math.PI / 2, 0, 0]
            }, /*#__PURE__*/React.createElement("cylinderGeometry", {
              args: [part.scale[0], part.scale[1], 2, 32, 1, true]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              side: THREE.DoubleSide,
              metalness: 0.6
            }));
          case 'box':
            return /*#__PURE__*/React.createElement("mesh", null, /*#__PURE__*/React.createElement("boxGeometry", {
              args: [part.scale[0], part.scale[1], part.scale[2]]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              metalness: 0.5,
              roughness: 0.4
            }));
          case 'plate':
            return /*#__PURE__*/React.createElement("group", null, /*#__PURE__*/React.createElement("mesh", null, /*#__PURE__*/React.createElement("boxGeometry", {
              args: [part.scale[0], part.scale[1], part.scale[2]]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              metalness: 0.2,
              roughness: 0.8
            })), /*#__PURE__*/React.createElement("mesh", {
              position: [0, part.scale[1] / 2 + 0.01, 0],
              rotation: [-Math.PI / 2, 0, 0]
            }, /*#__PURE__*/React.createElement("planeGeometry", {
              args: [part.scale[0] * 0.8, part.scale[2] * 0.8]
            }), /*#__PURE__*/React.createElement("meshBasicMaterial", {
              color: "#ffffff",
              wireframe: true,
              transparent: true,
              opacity: 0.2
            })));
          case 'cable':
            return /*#__PURE__*/React.createElement("mesh", {
              rotation: [0, 0, Math.PI / 2]
            }, /*#__PURE__*/React.createElement("cylinderGeometry", {
              args: [0.05, 0.05, part.scale[1], 8]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: part.color,
              emissive: part.color,
              emissiveIntensity: 0.2
            }));
          case 'small-box':
            return /*#__PURE__*/React.createElement("mesh", null, /*#__PURE__*/React.createElement("boxGeometry", {
              args: [part.scale[0], part.scale[1], part.scale[2]]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              transparent: true,
              opacity: 0.8
            }));
          case 'gear':
            return /*#__PURE__*/React.createElement("group", null, /*#__PURE__*/React.createElement("mesh", {
              rotation: [Math.PI / 2, 0, 0]
            }, /*#__PURE__*/React.createElement("cylinderGeometry", {
              args: [part.scale[0], part.scale[0], part.scale[2] || 0.2, 24]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              metalness: 0.8,
              roughness: 0.3
            })), Array.from({
              length: 12
            }).map((_, i) => /*#__PURE__*/React.createElement("mesh", {
              key: i,
              rotation: [i * (Math.PI / 6), 0, 0]
            }, /*#__PURE__*/React.createElement("boxGeometry", {
              args: [part.scale[0] * 2.1, 0.1, 0.1]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              metalness: 0.8
            }))));
          case 'spring':
            return /*#__PURE__*/React.createElement("group", null, Array.from({
              length: 8
            }).map((_, i) => /*#__PURE__*/React.createElement("mesh", {
              key: i,
              position: [0, i * 0.2 - 0.8, 0],
              rotation: [Math.PI / 2, 0, 0]
            }, /*#__PURE__*/React.createElement("torusGeometry", {
              args: [part.scale[0], 0.05, 8, 20]
            }), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: materialColor,
              metalness: 0.6
            }))));
          case 'model':
            return /*#__PURE__*/React.createElement(ModelMesh, {
              url: part.modelUrl || part.url,
              scale: part.scale,
              rotation: part.rotation
            });
          default:
            return /*#__PURE__*/React.createElement("mesh", null, /*#__PURE__*/React.createElement("boxGeometry", null), /*#__PURE__*/React.createElement("meshStandardMaterial", {
              color: "red"
            }));
        }
      };
      return /*#__PURE__*/React.createElement("group", {
        ref: meshRef,
        onClick: e => {
          e.stopPropagation();
          _onClick(part);
        },
        onPointerOver: () => setHovered(true),
        onPointerOut: () => setHovered(false)
      }, renderGeometry(), selected && /*#__PURE__*/React.createElement(Html, {
        position: [part.scale[0] / 2, part.scale[1] / 2, 0]
      }, /*#__PURE__*/React.createElement("div", {
        className: "bg-aviation-blue/80 text-white text-xs p-1 rounded border border-aviation-accent whitespace-nowrap backdrop-blur-sm shadow-lg pointer-events-none select-none z-0"
      }, part.name)));
    };
    var Engine3D = _ref5 => {
      var {
        parts,
        onPartClick,
        selectedPartId,
        explodedView,
        engineRunning
      } = _ref5;
      return /*#__PURE__*/React.createElement("group", null, parts.map((part, index) => /*#__PURE__*/React.createElement(PartMesh, {
        key: part.id,
        index: index,
        part: part,
        onClick: onPartClick,
        selected: selectedPartId === part.id,
        exploded: explodedView,
        running: engineRunning
      })), engineRunning && /*#__PURE__*/React.createElement("points", null, /*#__PURE__*/React.createElement("bufferGeometry", null, /*#__PURE__*/React.createElement("bufferAttribute", {
        attach: "attributes-position",
        count: 100,
        array: new Float32Array(300).map(() => (Math.random() - 0.5) * 10),
        itemSize: 3
      })), /*#__PURE__*/React.createElement("pointsMaterial", {
        size: 0.1,
        color: "cyan",
        transparent: true,
        opacity: 0.5
      })));
    };

    var TOOL_METADATA = {
      [ToolType.NONE]: {
        icon: /*#__PURE__*/React.createElement(MousePointer2, {
          size: 24
        }),
        label: '查看模式'
      },
      [ToolType.GLOVES]: {
        icon: /*#__PURE__*/React.createElement(Hand, {
          size: 24
        }),
        label: '防护手套'
      },
      [ToolType.WRENCH]: {
        icon: /*#__PURE__*/React.createElement(Wrench, {
          size: 24
        }),
        label: '力矩扳手'
      },
      [ToolType.SCANNER]: {
        icon: /*#__PURE__*/React.createElement(Scan, {
          size: 24
        }),
        label: '探伤仪'
      },
      [ToolType.FLASHLIGHT]: {
        icon: /*#__PURE__*/React.createElement(Flashlight, {
          size: 24
        }),
        label: '强光手电'
      },
      [ToolType.INSULATED_GLOVES]: {
        icon: /*#__PURE__*/React.createElement(Hand, {
          size: 24,
          className: "text-orange-400"
        }),
        label: '绝缘手套'
      },
      [ToolType.INSULATED_WRENCH]: {
        icon: /*#__PURE__*/React.createElement(Wrench, {
          size: 24,
          className: "text-orange-400"
        }),
        label: '绝缘扳手'
      },
      [ToolType.MULTIMETER]: {
        icon: /*#__PURE__*/React.createElement(Zap, {
          size: 24,
          className: "text-yellow-400"
        }),
        label: '万用表'
      },
      [ToolType.ESD_STRAP]: {
        icon: /*#__PURE__*/React.createElement(Cable, {
          size: 24,
          className: "text-blue-400"
        }),
        label: '防静电手环'
      },
      [ToolType.SCREWDRIVER]: {
        icon: /*#__PURE__*/React.createElement(PenTool, {
          size: 24
        }),
        label: '螺丝刀'
      },
      [ToolType.VERNIER_CALIPER]: {
        icon: /*#__PURE__*/React.createElement(Ruler, {
          size: 24,
          className: "text-cyan-400"
        }),
        label: '游标卡尺'
      },
      [ToolType.PRESSURE_GAUGE]: {
        icon: /*#__PURE__*/React.createElement(Gauge, {
          size: 24,
          className: "text-red-400"
        }),
        label: '压力表'
      },
      [ToolType.OIL_CAN]: {
        icon: /*#__PURE__*/React.createElement(Droplet, {
          size: 24,
          className: "text-amber-400"
        }),
        label: '润滑油壶'
      }
    };
    var ToolsPanel = _ref5 => {
      var {
        currentTool,
        onSelectTool,
        allowedTools
      } = _ref5;
      return /*#__PURE__*/React.createElement("div", {
        className: "absolute bottom-6 left-1/2 transform -translate-x-1/2 glass-panel rounded-2xl p-2 flex gap-4 z-50 overflow-x-auto max-w-[90vw] custom-scrollbar"
      }, allowedTools.map(toolType => {
        var meta = TOOL_METADATA[toolType];
        if (!meta) return null;
        return /*#__PURE__*/React.createElement("button", {
          key: toolType,
          onClick: () => onSelectTool(toolType),
          className: "\n                      relative group flex flex-col items-center justify-center w-16 h-16 rounded-xl transition-all duration-200 shrink-0\n                      ".concat(currentTool === toolType ? 'bg-aviation-accent text-aviation-blue shadow-[0_0_15px_rgba(56,189,248,0.5)] scale-110' : 'text-slate-400 hover:text-white hover:bg-white/10', "\n                    ")
        }, meta.icon, /*#__PURE__*/React.createElement("span", {
          className: "text-[10px] mt-1 font-medium opacity-0 group-hover:opacity-100 absolute -top-8 bg-black/80 px-2 py-1 rounded transition-opacity whitespace-nowrap text-white pointer-events-none"
        }, meta.label));
      }));
    };


    // ============================================
    // 建模工坊组件 - 三步岗位化教学
    // ============================================

    var ModelingWorkshop = _ref => {
      var { taskData, selectedPart, onExportEvidence } = _ref;
      var [currentPhase, setCurrentPhase] = useState(1);
      var [selectedModel, setSelectedModel] = useState(null);
      var [fittingResult, setFittingResult] = useState(null);
      var [userAnswers, setUserAnswers] = useState({});
      var [showChart, setShowChart] = useState(false);
      var [evidenceLog, setEvidenceLog] = useState([]);

      // 添加学习证据
      var addEvidence = (type, content) => {
        var newEvidence = {
          id: Date.now(),
          timestamp: new Date().toISOString(),
          type: type,
          content: content
        };
        setEvidenceLog(prev => [...prev, newEvidence]);
      };

      // 最小二乘线性拟合
      var linearFit = (data, xKey, yKey) => {
        var n = data.length;
        var sumX = data.reduce((acc, d) => acc + d[xKey], 0);
        var sumY = data.reduce((acc, d) => acc + d[yKey], 0);
        var sumXY = data.reduce((acc, d) => acc + d[xKey] * d[yKey], 0);
        var sumX2 = data.reduce((acc, d) => acc + d[xKey] * d[xKey], 0);

        var slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
        var intercept = (sumY - slope * sumX) / n;

        // R² 计算
        var yMean = sumY / n;
        var ssTotal = data.reduce((acc, d) => acc + Math.pow(d[yKey] - yMean, 2), 0);
        var ssResidual = data.reduce((acc, d) => acc + Math.pow(d[yKey] - (slope * d[xKey] + intercept), 2), 0);
        var r2 = 1 - ssResidual / ssTotal;

        return { slope: slope.toFixed(4), intercept: intercept.toFixed(2), r2: r2.toFixed(4) };
      };

      // 执行拟合
      var performFitting = (model) => {
        if (!model || !model.sampleData || model.sampleData.length < 2) return;

        var keys = Object.keys(model.sampleData[0]);
        var xKey = keys[0];
        var yKey = keys[1];

        var result = linearFit(model.sampleData, xKey, yKey);
        setFittingResult({
          model: model.name,
          equation: yKey + ' = ' + result.slope + '·' + xKey + ' + ' + result.intercept,
          r2: result.r2,
          slope: result.slope,
          intercept: result.intercept
        });

        addEvidence('fitting', {
          modelName: model.name,
          equation: yKey + ' = ' + result.slope + '·' + xKey + ' + ' + result.intercept,
          r2: result.r2
        });
      };

      // 导出学习证据
      var exportEvidence = () => {
        var evidence = {
          student: '学员01',
          module: '发电机建模',
          timestamp: new Date().toISOString(),
          variables: taskData.variables,
          selectedModels: selectedModel ? [selectedModel] : [],
          fittingResults: fittingResult ? [fittingResult] : [],
          answers: userAnswers,
          log: evidenceLog
        };

        console.log('导出学习证据:', evidence);
        if (onExportEvidence) onExportEvidence(evidence);

        // 简单的下载功能
        var dataStr = JSON.stringify(evidence, null, 2);
        var dataBlob = new Blob([dataStr], { type: 'application/json' });
        var url = URL.createObjectURL(dataBlob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'learning_evidence_' + Date.now() + '.json';
        a.click();
        URL.revokeObjectURL(url);
      };

      if (!taskData) {
        return /*#__PURE__*/React.createElement("div", {
          className: "text-center py-8 text-slate-500"
        }, "请选择发电机模块以开启建模工坊");
      }

      return /*#__PURE__*/React.createElement("div", {
        className: "space-y-4"
      },
    // 任务问题
    /*#__PURE__*/React.createElement("div", {
        className: "bg-gradient-to-r from-aviation-accent/20 to-purple-500/20 rounded-lg p-4 border border-aviation-accent/30"
      },
      /*#__PURE__*/React.createElement("div", {
        className: "flex items-center gap-2 text-aviation-accent mb-2"
      },
        /*#__PURE__*/React.createElement(BookOpen, { size: 16 }),
        /*#__PURE__*/React.createElement("span", { className: "font-bold text-sm" }, "岗位化任务")
      ),
      /*#__PURE__*/React.createElement("p", {
        className: "text-white text-sm leading-relaxed"
      }, taskData.taskQuestion)
      ),

    // 三步进度指示器
    /*#__PURE__*/React.createElement("div", {
        className: "flex items-center justify-between bg-slate-800/50 rounded-lg p-2"
      },
        [1, 2, 3].map(phase => /*#__PURE__*/React.createElement("button", {
          key: phase,
          onClick: () => setCurrentPhase(phase),
          className: "flex-1 flex items-center justify-center gap-2 py-2 rounded transition-all " +
            (currentPhase === phase
              ? 'bg-aviation-accent text-aviation-blue font-bold'
              : currentPhase > phase
                ? 'bg-success/20 text-success'
                : 'text-slate-400 hover:text-white')
        },
        /*#__PURE__*/React.createElement("span", {
          className: "w-6 h-6 rounded-full flex items-center justify-center text-xs " +
            (currentPhase === phase ? 'bg-aviation-blue' : currentPhase > phase ? 'bg-success' : 'bg-slate-700')
        }, phase),
        /*#__PURE__*/React.createElement("span", { className: "text-xs hidden sm:inline" },
          phase === 1 ? '拆变量' : phase === 2 ? '选模型' : '回岗位'
        )
        ))
      ),

        // 阶段内容
        currentPhase === 1 && /*#__PURE__*/React.createElement("div", {
          className: "space-y-3"
        },
      /*#__PURE__*/React.createElement("h4", {
          className: "text-sm font-bold text-aviation-accent flex items-center gap-2"
        },
        /*#__PURE__*/React.createElement("span", { className: "w-5 h-5 bg-aviation-accent text-aviation-blue rounded flex items-center justify-center text-xs" }, "1"),
          "第一步：拆变量（工程语言→数学语言）"
        ),

      // 输入变量
      /*#__PURE__*/React.createElement("div", {
          className: "bg-slate-900/50 rounded-lg p-3 border border-slate-700"
        },
        /*#__PURE__*/React.createElement("div", {
          className: "text-xs text-green-400 font-bold mb-2 flex items-center gap-1"
        },
          /*#__PURE__*/React.createElement("span", { className: "w-2 h-2 bg-green-400 rounded-full" }),
          "输入/工况变量"
        ),
        /*#__PURE__*/React.createElement("div", {
          className: "space-y-1"
        },
          taskData.variables.input.map(v => /*#__PURE__*/React.createElement("div", {
            key: v.symbol,
            className: "flex items-center justify-between text-xs py-1 border-b border-slate-800 last:border-0"
          },
            /*#__PURE__*/React.createElement("span", { className: "text-slate-300" },
              /*#__PURE__*/React.createElement("span", { className: "font-mono text-aviation-accent" }, v.symbol),
            " - ", v.name
          ),
            /*#__PURE__*/React.createElement("span", { className: "text-slate-500 font-mono" },
            v.range[0], "~", v.range[1], " ", v.unit
          )
          ))
        )
        ),

      // 输出变量
      /*#__PURE__*/React.createElement("div", {
          className: "bg-slate-900/50 rounded-lg p-3 border border-slate-700"
        },
        /*#__PURE__*/React.createElement("div", {
          className: "text-xs text-blue-400 font-bold mb-2 flex items-center gap-1"
        },
          /*#__PURE__*/React.createElement("span", { className: "w-2 h-2 bg-blue-400 rounded-full" }),
          "输出指标"
        ),
        /*#__PURE__*/React.createElement("div", {
          className: "space-y-1"
        },
          taskData.variables.output.map(v => /*#__PURE__*/React.createElement("div", {
            key: v.symbol,
            className: "flex items-center justify-between text-xs py-1 border-b border-slate-800 last:border-0"
          },
            /*#__PURE__*/React.createElement("span", { className: "text-slate-300" },
              /*#__PURE__*/React.createElement("span", { className: "font-mono text-blue-400" }, v.symbol),
            " - ", v.name
          ),
            /*#__PURE__*/React.createElement("span", { className: "text-slate-500" }, v.description)
          ))
        )
        ),

      // 约束条件
      /*#__PURE__*/React.createElement("div", {
          className: "bg-slate-900/50 rounded-lg p-3 border border-orange-500/30"
        },
        /*#__PURE__*/React.createElement("div", {
          className: "text-xs text-orange-400 font-bold mb-2 flex items-center gap-1"
        },
          /*#__PURE__*/React.createElement(AlertTriangle, { size: 12 }),
          "约束条件"
        ),
        /*#__PURE__*/React.createElement("div", {
          className: "grid grid-cols-2 gap-2"
        },
          taskData.variables.constraint.map(c => /*#__PURE__*/React.createElement("div", {
            key: c.symbol,
            className: "text-xs bg-slate-800 rounded p-2"
          },
            /*#__PURE__*/React.createElement("span", { className: "font-mono text-orange-400" }, c.symbol),
            /*#__PURE__*/React.createElement("span", { className: "text-slate-400" }, " ≤ ", c.limit, c.unit)
          ))
        )
        ),

      /*#__PURE__*/React.createElement("button", {
          onClick: () => {
            addEvidence('variables', taskData.variables);
            setCurrentPhase(2);
          },
          className: "w-full py-2 bg-aviation-accent text-aviation-blue rounded-lg font-bold text-sm hover:bg-aviation-accent/80 transition-colors"
        }, "变量梳理完成 → 进入建模")
        ),

        currentPhase === 2 && /*#__PURE__*/React.createElement("div", {
          className: "space-y-3"
        },
      /*#__PURE__*/React.createElement("h4", {
          className: "text-sm font-bold text-aviation-accent flex items-center gap-2"
        },
        /*#__PURE__*/React.createElement("span", { className: "w-5 h-5 bg-aviation-accent text-aviation-blue rounded flex items-center justify-center text-xs" }, "2"),
          "第二步：选模型（现象→关系）"
        ),

      // 模型列表
      /*#__PURE__*/React.createElement("div", {
          className: "space-y-2"
        },
          taskData.models.map(model => /*#__PURE__*/React.createElement("div", {
            key: model.id,
            onClick: () => {
              setSelectedModel(model);
              performFitting(model);
            },
            className: "bg-slate-900/50 rounded-lg p-3 border cursor-pointer transition-all " +
              (selectedModel && selectedModel.id === model.id
                ? 'border-aviation-accent bg-aviation-accent/10'
                : 'border-slate-700 hover:border-slate-500')
          },
          /*#__PURE__*/React.createElement("div", {
            className: "flex items-center justify-between mb-2"
          },
            /*#__PURE__*/React.createElement("span", { className: "text-white font-medium text-sm" }, model.name),
            /*#__PURE__*/React.createElement("span", {
            className: "text-xs px-2 py-0.5 rounded bg-slate-800 text-slate-400"
          }, model.type)
          ),
          /*#__PURE__*/React.createElement("div", {
            className: "font-mono text-aviation-accent text-sm bg-slate-800 rounded p-2 mb-2"
          }, model.formula),
          /*#__PURE__*/React.createElement("p", {
            className: "text-xs text-slate-400"
          }, model.description)
          ))
        ),

          // 拟合结果
          fittingResult && /*#__PURE__*/React.createElement("div", {
            className: "bg-success/10 border border-success/30 rounded-lg p-3"
          },
        /*#__PURE__*/React.createElement("div", {
            className: "text-xs text-success font-bold mb-2"
          }, "📈 最小二乘拟合结果"),
        /*#__PURE__*/React.createElement("div", {
            className: "font-mono text-white text-sm mb-1"
          }, fittingResult.equation),
        /*#__PURE__*/React.createElement("div", {
            className: "text-xs text-slate-400"
          }, "决定系数 R² = ", fittingResult.r2,
            parseFloat(fittingResult.r2) > 0.9
              ? /*#__PURE__*/React.createElement("span", { className: "text-success ml-2" }, "✓ 拟合优秀")
              : parseFloat(fittingResult.r2) > 0.7
                ? /*#__PURE__*/React.createElement("span", { className: "text-yellow-400 ml-2" }, "○ 拟合良好")
                : /*#__PURE__*/React.createElement("span", { className: "text-red-400 ml-2" }, "✗ 需改进")
          )
          ),

          // 数据可视化按钮
          selectedModel && /*#__PURE__*/React.createElement("button", {
            onClick: () => setShowChart(!showChart),
            className: "w-full py-2 bg-slate-800 text-white rounded-lg text-sm hover:bg-slate-700 transition-colors flex items-center justify-center gap-2"
          },
        /*#__PURE__*/React.createElement(Activity, { size: 14 }),
            showChart ? "隐藏数据图表" : "查看数据图表"
          ),

          // 简易数据表格
          showChart && selectedModel && /*#__PURE__*/React.createElement("div", {
            className: "bg-slate-900 rounded-lg p-3 overflow-x-auto"
          },
        /*#__PURE__*/React.createElement("table", {
            className: "w-full text-xs"
          },
          /*#__PURE__*/React.createElement("thead", null,
            /*#__PURE__*/React.createElement("tr", {
            className: "border-b border-slate-700"
          },
            Object.keys(selectedModel.sampleData[0]).map(key =>
                /*#__PURE__*/React.createElement("th", {
              key: key,
              className: "py-2 px-3 text-left text-aviation-accent font-mono"
            }, key)
            )
          )
          ),
          /*#__PURE__*/React.createElement("tbody", null,
            selectedModel.sampleData.map((row, i) =>
              /*#__PURE__*/React.createElement("tr", {
              key: i,
              className: "border-b border-slate-800"
            },
              Object.values(row).map((val, j) =>
                  /*#__PURE__*/React.createElement("td", {
                key: j,
                className: "py-2 px-3 text-slate-300 font-mono"
              }, val)
              )
            )
            )
          )
          ),
        // ASCII风格的简易图表
        /*#__PURE__*/React.createElement("div", {
            className: "mt-3 p-2 bg-slate-800 rounded font-mono text-[10px] text-slate-400"
          },
            "数据趋势: ",
            selectedModel.sampleData.map((d, i) => {
              var keys = Object.keys(d);
              var yVal = d[keys[1]];
              var maxY = Math.max(...selectedModel.sampleData.map(x => x[keys[1]]));
              var barLen = Math.round((yVal / maxY) * 20);
              return /*#__PURE__*/React.createElement("div", { key: i, className: "flex items-center gap-2" },
              /*#__PURE__*/React.createElement("span", { className: "w-12" }, d[keys[0]]),
              /*#__PURE__*/React.createElement("span", { className: "text-aviation-accent" }, "▓".repeat(barLen)),
              /*#__PURE__*/React.createElement("span", null, yVal)
              );
            })
          )
          ),

      /*#__PURE__*/React.createElement("button", {
            onClick: () => setCurrentPhase(3),
            disabled: !fittingResult,
            className: "w-full py-2 bg-aviation-accent text-aviation-blue rounded-lg font-bold text-sm hover:bg-aviation-accent/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          }, fittingResult ? "模型拟合完成 → 回到岗位" : "请先选择并拟合模型")
        ),

        currentPhase === 3 && /*#__PURE__*/React.createElement("div", {
          className: "space-y-3"
        },
      /*#__PURE__*/React.createElement("h4", {
          className: "text-sm font-bold text-aviation-accent flex items-center gap-2"
        },
        /*#__PURE__*/React.createElement("span", { className: "w-5 h-5 bg-aviation-accent text-aviation-blue rounded flex items-center justify-center text-xs" }, "3"),
          "第三步：回岗位解释（算对→说清）"
        ),

          // 岗位问题
          taskData.jobQuestions.map((q, i) => /*#__PURE__*/React.createElement("div", {
            key: i,
            className: "bg-slate-900/50 rounded-lg p-3 border border-slate-700"
          },
        /*#__PURE__*/React.createElement("div", {
            className: "text-white text-sm mb-2 font-medium"
          }, "Q", i + 1, ": ", q.question),
        /*#__PURE__*/React.createElement("div", {
            className: "text-xs text-slate-500 mb-2 flex items-center gap-1"
          },
          /*#__PURE__*/React.createElement("span", { className: "text-yellow-400" }, "💡"),
            "提示: ", q.hint
          ),
        /*#__PURE__*/React.createElement("textarea", {
            value: userAnswers[i] || '',
            onChange: e => setUserAnswers({ ...userAnswers, [i]: e.target.value }),
            placeholder: "请用一句话回答这个问题...",
            className: "w-full bg-slate-800 border border-slate-700 rounded p-2 text-white text-sm resize-none h-20 focus:outline-none focus:border-aviation-accent"
          }),
        /*#__PURE__*/React.createElement("details", {
            className: "mt-2"
          },
          /*#__PURE__*/React.createElement("summary", {
            className: "text-xs text-aviation-accent cursor-pointer hover:text-white"
          }, "查看参考答案"),
          /*#__PURE__*/React.createElement("div", {
            className: "mt-2 text-xs text-slate-400 bg-slate-800 rounded p-2 leading-relaxed"
          }, q.answer)
          )
          )),

      // 学习证据总结
      /*#__PURE__*/React.createElement("div", {
            className: "bg-gradient-to-r from-success/20 to-aviation-accent/20 rounded-lg p-4 border border-success/30"
          },
        /*#__PURE__*/React.createElement("div", {
            className: "text-sm font-bold text-success mb-3 flex items-center gap-2"
          },
          /*#__PURE__*/React.createElement(CheckCircle2, { size: 16 }),
            "学习证据清单"
          ),
        /*#__PURE__*/React.createElement("div", {
            className: "grid grid-cols-2 gap-2 text-xs"
          },
          /*#__PURE__*/React.createElement("div", {
            className: "flex items-center gap-2 text-slate-300"
          },
            /*#__PURE__*/React.createElement(CheckCircle2, { size: 12, className: "text-success" }),
            "变量表"
          ),
          /*#__PURE__*/React.createElement("div", {
            className: "flex items-center gap-2 text-slate-300"
          },
            fittingResult
              ? /*#__PURE__*/React.createElement(CheckCircle2, { size: 12, className: "text-success" })
              : /*#__PURE__*/React.createElement(Circle, { size: 12, className: "text-slate-600" }),
            "模型式"
          ),
          /*#__PURE__*/React.createElement("div", {
            className: "flex items-center gap-2 text-slate-300"
          },
            fittingResult
              ? /*#__PURE__*/React.createElement(CheckCircle2, { size: 12, className: "text-success" })
              : /*#__PURE__*/React.createElement(Circle, { size: 12, className: "text-slate-600" }),
            "拟合图"
          ),
          /*#__PURE__*/React.createElement("div", {
            className: "flex items-center gap-2 text-slate-300"
          },
            Object.keys(userAnswers).length > 0
              ? /*#__PURE__*/React.createElement(CheckCircle2, { size: 12, className: "text-success" })
              : /*#__PURE__*/React.createElement(Circle, { size: 12, className: "text-slate-600" }),
            "岗位解释"
          )
          )
          ),

      /*#__PURE__*/React.createElement("button", {
            onClick: exportEvidence,
            className: "w-full py-3 bg-success text-white rounded-lg font-bold text-sm hover:bg-success/80 transition-colors flex items-center justify-center gap-2"
          },
        /*#__PURE__*/React.createElement(CheckCircle2, { size: 16 }),
            "完成建模任务 - 导出学习证据"
          )
        )
      );
    };



    var Sidebar = _ref6 => {
      var {
        selectedPart,
        currentStep,
        steps,
        logs,
        onStepComplete,
        aiResponse,
        isProcessingAI,
        activeProvider,
        onProviderChange,
        taskData
      } = _ref6;
      var [chatInput, setChatInput] = useState('');
      var [chatHistory, setChatHistory] = useState([]);
      var chatEndRef = useRef(null);
      var [activeTab, setActiveTab] = useState('procedures');
      var [showModelMenu, setShowModelMenu] = useState(false);
      useEffect(() => {
        if (aiResponse) {
          setChatHistory(prev => [...prev, {
            role: 'ai',
            text: aiResponse
          }]);
          setActiveTab('chat');
        }
      }, [aiResponse]);
      var handleSendMessage = /*#__PURE__*/function () {
        var _ref7 = _asyncToGenerator(function* () {
          if (!chatInput.trim()) return;
          var msg = chatInput;
          setChatInput('');
          setChatHistory(prev => [...prev, {
            role: 'user',
            text: msg
          }]);

          var response = yield chatWithInstructor(chatHistory.map(h => h.text), msg, activeProvider, selectedPart || undefined);
          setChatHistory(prev => [...prev, {
            role: 'ai',
            text: response
          }]);
        });
        return function handleSendMessage() {
          return _ref7.apply(this, arguments);
        };
      }();
      useEffect(() => {
        var _chatEndRef$current;
        (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 || _chatEndRef$current.scrollIntoView({
          behavior: 'smooth'
        });
      }, [chatHistory, activeTab]);
      return /*#__PURE__*/React.createElement("div", {
        className: "absolute left-6 top-6 bottom-6 w-96 flex flex-col gap-4 z-40 pointer-events-none"
      }, /*#__PURE__*/React.createElement("div", {
        className: "glass-panel p-4 rounded-xl flex items-center justify-between pointer-events-auto"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex items-center gap-3"
      }, /*#__PURE__*/React.createElement("div", {
        className: "w-3 h-3 bg-aviation-accent rounded-full animate-pulse shadow-[0_0_10px_#38bdf8]"
      }), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
        className: "text-white font-bold text-lg tracking-wider font-mono"
      }, "数专融合交互实训平台")))), /*#__PURE__*/React.createElement("div", {
        className: "flex-1 glass-panel rounded-xl overflow-hidden flex flex-col pointer-events-auto"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex border-b border-white/10"
      }, /*#__PURE__*/React.createElement("button", {
        onClick: () => setActiveTab('procedures'),
        className: "flex-1 py-3 text-sm font-medium transition-colors ".concat(activeTab === 'procedures' ? 'bg-aviation-accent/20 text-aviation-accent' : 'text-slate-400 hover:text-white')
      }, "\u6807\u51C6\u4F5C\u4E1A\u7A0B\u5E8F"), /*#__PURE__*/React.createElement("button", {
        onClick: () => setActiveTab('modeling'),
        className: "flex-1 py-3 text-sm font-medium transition-colors ".concat(activeTab === 'modeling' ? 'bg-aviation-accent/20 text-aviation-accent' : 'text-slate-400 hover:text-white')
      }, "\u5EFA\u6A21\u5DE5\u574A"), /*#__PURE__*/React.createElement("button", {
        onClick: () => setActiveTab('chat'),
        className: "flex-1 py-3 text-sm font-medium transition-colors ".concat(activeTab === 'chat' ? 'bg-aviation-accent/20 text-aviation-accent' : 'text-slate-400 hover:text-white')
      }, "\u667A\u80FD\u5BFC\u5E08")), /*#__PURE__*/React.createElement("div", {
        className: "flex-1 overflow-y-auto p-4 custom-scrollbar"
      }, activeTab === 'procedures' && /*#__PURE__*/React.createElement("div", {
        className: "space-y-6"
      }, selectedPart ? /*#__PURE__*/React.createElement("div", {
        className: "bg-slate-900/50 rounded-lg p-3 border border-slate-700"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex items-center justify-between mb-2"
      }, /*#__PURE__*/React.createElement("span", {
        className: "text-xs text-slate-400 font-mono"
      }, "选中部件"), /*#__PURE__*/React.createElement("span", {
        className: "text-[10px] px-2 py-0.5 rounded ".concat(selectedPart.status === 'ok' ? 'bg-success/20 text-success' : 'bg-danger/20 text-danger')
      }, selectedPart.status === 'ok' ? '正常' : selectedPart.status === 'worn' ? '磨损' : '故障')), /*#__PURE__*/React.createElement("h3", {
        className: "text-white font-medium mb-1"
      }, selectedPart.name), /*#__PURE__*/React.createElement("div", {
        className: "flex items-center gap-2 text-xs text-slate-300 mb-2"
      }, /*#__PURE__*/React.createElement(Activity, {
        size: 12
      }), /*#__PURE__*/React.createElement("span", null, "健康度: ", selectedPart.health, "%")), /*#__PURE__*/React.createElement("p", {
        className: "text-xs text-slate-400 leading-relaxed border-t border-slate-700 pt-2 mt-2"
      }, selectedPart.description), /*#__PURE__*/React.createElement("div", {
        className: "mt-2 text-[11px] text-aviation-accent bg-slate-900/50 border border-aviation-accent/20 rounded p-2 leading-relaxed"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex items-center justify-between text-aviation-accent"
      }, /*#__PURE__*/React.createElement("span", null, "数学关联"), /*#__PURE__*/React.createElement("span", {
        className: "text-[10px] font-mono text-slate-400"
      }, "基础公式提示")), /*#__PURE__*/React.createElement("div", {
        className: "mt-1"
      }, (PART_MATH_MAPPING[selectedPart.id] || PART_MATH_MAPPING.default).join('、')), /*#__PURE__*/React.createElement("div", {
        className: "mt-1 font-mono text-aviation-accent/80"
      }, PART_MATH_DETAILS[selectedPart.id] || PART_MATH_DETAILS.default)), selectedPart.notes && /*#__PURE__*/React.createElement("div", {
        className: "mt-2 flex items-start gap-2 text-warning text-xs bg-warning/10 p-2 rounded"
      }, /*#__PURE__*/React.createElement(AlertTriangle, {
        size: 12,
        className: "mt-0.5 shrink-0"
      }), /*#__PURE__*/React.createElement("span", null, selectedPart.notes))) : /*#__PURE__*/React.createElement("div", {
        className: "text-center py-8 text-slate-500 text-sm border-2 border-dashed border-slate-800 rounded-lg"
      }, "\u70B9\u51FB 3D \u6A21\u578B\u9009\u62E9\u90E8\u4EF6", /*#__PURE__*/React.createElement("br", null), "\u67E5\u770B\u8BE6\u7EC6\u4FE1\u606F"), /*#__PURE__*/React.createElement("div", {
        className: "space-y-3"
      }, /*#__PURE__*/React.createElement("h3", {
        className: "text-xs font-bold text-slate-500 uppercase tracking-wider"
      }, "维护检查清单"), steps.map((step, index) => {
        var isActive = step.id === currentStep;
        var isCompleted = step.id < currentStep;
        return /*#__PURE__*/React.createElement("div", {
          key: step.id,
          className: "\n                                relative p-3 rounded-lg border transition-all duration-300\n                                ".concat(isActive ? 'bg-aviation-accent/10 border-aviation-accent' : isCompleted ? 'bg-slate-800/50 border-slate-700 opacity-60' : 'bg-transparent border-slate-800 opacity-40', "\n                              ")
        }, /*#__PURE__*/React.createElement("div", {
          className: "flex items-start gap-3"
        }, /*#__PURE__*/React.createElement("div", {
          className: "mt-0.5 ".concat(isActive ? 'text-aviation-accent' : isCompleted ? 'text-success' : 'text-slate-600')
        }, isCompleted ? /*#__PURE__*/React.createElement(CheckCircle2, {
          size: 18
        }) : isActive ? /*#__PURE__*/React.createElement(ChevronRight, {
          size: 18
        }) : /*#__PURE__*/React.createElement(Circle, {
          size: 18
        })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h4", {
          className: "text-sm font-medium ".concat(isActive ? 'text-white' : 'text-slate-300')
        }, step.title), /*#__PURE__*/React.createElement("p", {
          className: "text-xs text-slate-400 mt-1"
        }, step.instruction), step.mathContext && /*#__PURE__*/React.createElement("p", {
          className: "text-[11px] text-aviation-accent mt-1 leading-relaxed"
        }, "\u6570\u5B66\u63A8\u5BFC\uFF1A", step.mathContext), isActive && /*#__PURE__*/React.createElement("div", {
          className: "mt-2 inline-flex items-center gap-1.5 px-2 py-1 rounded bg-slate-900 text-[10px] text-aviation-accent border border-aviation-accent/30"
        }, /*#__PURE__*/React.createElement(AlertOctagon, {
          size: 10
        }), "所需工具: ", step.requiredTool))));
      }))), activeTab === 'modeling' && /*#__PURE__*/React.createElement(ModelingWorkshop, {
        taskData: typeof GENERATOR_TASK_DATA !== 'undefined' ? GENERATOR_TASK_DATA : null,
        selectedPart: selectedPart,
        onExportEvidence: (evidence) => console.log('学习证据:', evidence)
      }), activeTab === 'chat' && /*#__PURE__*/React.createElement("div", {
        className: "flex flex-col h-full"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex justify-between items-center mb-4 px-1"
      }, /*#__PURE__*/React.createElement("span", {
        className: "text-xs text-slate-500 uppercase tracking-wider font-bold"
      }, "\u6A21\u578B\u9009\u62E9"), /*#__PURE__*/React.createElement("div", {
        className: "relative"
      }, /*#__PURE__*/React.createElement("button", {
        onClick: () => setShowModelMenu(!showModelMenu),
        className: "flex items-center gap-1.5 text-xs text-aviation-accent hover:text-white transition-colors bg-slate-800/80 px-2 py-1 rounded border border-slate-700"
      }, /*#__PURE__*/React.createElement(Settings2, {
        size: 12
      }), PROVIDER_LABEL[activeProvider] || '智能模型'), showModelMenu && /*#__PURE__*/React.createElement("div", {
        className: "absolute right-0 top-full mt-2 w-40 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden z-50"
      }, [{
        id: 'qwen',
        label: '通义千问'
      }, {
        id: 'deepseek',
        label: '深度求索'
      }, {
        id: 'kimi',
        label: 'Kimi（月之暗面）'
      }].map(model => /*#__PURE__*/React.createElement("button", {
        key: model.id,
        onClick: () => {
          onProviderChange(model.id);
          setShowModelMenu(false);
        },
        className: "w-full text-left px-3 py-2 text-xs transition-colors hover:bg-slate-800 ".concat(activeProvider === model.id ? 'text-aviation-accent font-bold bg-aviation-accent/10' : 'text-slate-300')
      }, model.label))))), /*#__PURE__*/React.createElement("div", {
        className: "flex-1 space-y-4 mb-4"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex gap-3"
      }, /*#__PURE__*/React.createElement("div", {
        className: "w-8 h-8 rounded-full bg-aviation-accent/20 flex items-center justify-center shrink-0"
      }, /*#__PURE__*/React.createElement(Bot, {
        size: 16,
        className: "text-aviation-accent"
      })), /*#__PURE__*/React.createElement("div", {
        className: "bg-slate-800 rounded-2xl rounded-tl-none p-3 text-sm text-slate-200"
      }, "\u6211\u662F\u4F60\u7684\u865A\u62DF\u5B9E\u8BAD\u5BFC\u5E08\u3002\u5F53\u524D\u4F7F\u7528\u6A21\u578B\uFF1A", /*#__PURE__*/React.createElement("span", {
        className: "text-aviation-accent font-bold"
      }, PROVIDER_LABEL[activeProvider] || '智能模型'), "\u3002 \u4F60\u53EF\u4EE5\u968F\u65F6\u5411\u6211\u63D0\u95EE\u5173\u4E8E\u7EF4\u4FEE\u6D41\u7A0B\u6216\u6545\u969C\u8BCA\u65AD\u7684\u95EE\u9898\u3002")), chatHistory.map((msg, idx) => /*#__PURE__*/React.createElement("div", {
        key: idx,
        className: "flex gap-3 ".concat(msg.role === 'user' ? 'flex-row-reverse' : '')
      }, /*#__PURE__*/React.createElement("div", {
        className: "w-8 h-8 rounded-full flex items-center justify-center shrink-0 ".concat(msg.role === 'user' ? 'bg-indigo-500/20' : 'bg-aviation-accent/20')
      }, msg.role === 'user' ? /*#__PURE__*/React.createElement("div", {
        className: "w-2 h-2 bg-indigo-400 rounded-full"
      }) : /*#__PURE__*/React.createElement(Bot, {
        size: 16,
        className: "text-aviation-accent"
      })), /*#__PURE__*/React.createElement("div", {
        className: "\n                                max-w-[80%] rounded-2xl p-3 text-sm leading-relaxed\n                                ".concat(msg.role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-slate-800 text-slate-200 rounded-tl-none border border-slate-700', "\n                              ")
      }, msg.text))), isProcessingAI && /*#__PURE__*/React.createElement("div", {
        className: "flex gap-3"
      }, /*#__PURE__*/React.createElement("div", {
        className: "w-8 h-8 rounded-full bg-aviation-accent/20 flex items-center justify-center shrink-0"
      }, /*#__PURE__*/React.createElement(Bot, {
        size: 16,
        className: "text-aviation-accent"
      })), /*#__PURE__*/React.createElement("div", {
        className: "bg-slate-800 rounded-2xl rounded-tl-none p-3 flex gap-1 items-center"
      }, /*#__PURE__*/React.createElement("div", {
        className: "w-1.5 h-1.5 bg-aviation-accent rounded-full animate-bounce",
        style: {
          animationDelay: '0ms'
        }
      }), /*#__PURE__*/React.createElement("div", {
        className: "w-1.5 h-1.5 bg-aviation-accent rounded-full animate-bounce",
        style: {
          animationDelay: '150ms'
        }
      }), /*#__PURE__*/React.createElement("div", {
        className: "w-1.5 h-1.5 bg-aviation-accent rounded-full animate-bounce",
        style: {
          animationDelay: '300ms'
        }
      }))), /*#__PURE__*/React.createElement("div", {
        ref: chatEndRef
      })))), activeTab === 'chat' && /*#__PURE__*/React.createElement("div", {
        className: "p-3 bg-slate-900 border-t border-white/10"
      }, /*#__PURE__*/React.createElement("div", {
        className: "relative"
      }, /*#__PURE__*/React.createElement("input", {
        type: "text",
        value: chatInput,
        onChange: e => setChatInput(e.target.value),
        onKeyDown: e => e.key === 'Enter' && handleSendMessage(),
        placeholder: "\u5411\u5BFC\u5E08\u63D0\u95EE...",
        className: "w-full bg-slate-800 border border-slate-700 text-white rounded-lg pl-4 pr-10 py-2.5 text-sm focus:outline-none focus:border-aviation-accent placeholder-slate-500"
      }), /*#__PURE__*/React.createElement("button", {
        onClick: handleSendMessage,
        disabled: !chatInput.trim() || isProcessingAI,
        className: "absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-aviation-accent disabled:opacity-50 transition-colors"
      }, /*#__PURE__*/React.createElement(Send, {
        size: 16
      }))))), /*#__PURE__*/React.createElement("div", {
        className: "glass-panel p-3 rounded-xl pointer-events-auto max-h-32 overflow-hidden flex flex-col"
      }, /*#__PURE__*/React.createElement("div", {
        className: "text-[10px] font-bold text-slate-500 uppercase mb-2 tracking-wider flex items-center gap-2"
      }, /*#__PURE__*/React.createElement("div", {
        className: "w-1.5 h-1.5 rounded-full bg-success animate-pulse"
      }), "系统日志"), /*#__PURE__*/React.createElement("div", {
        className: "space-y-1 overflow-y-auto custom-scrollbar font-mono text-[10px]"
      }, logs.slice().reverse().map(log => /*#__PURE__*/React.createElement("div", {
        key: log.id,
        className: "\n                      ".concat(log.type === 'error' ? 'text-danger' : log.type === 'success' ? 'text-success' : 'text-slate-400', "\n                    ")
      }, /*#__PURE__*/React.createElement("span", {
        className: "opacity-50"
      }, "[", log.timestamp.toLocaleTimeString(), "]"), " ", log.message)))));
    };

    var App = () => {
      var [activeModuleId, setActiveModuleId] = useState(null);
      var activeModule = MODULES_CONFIG.find(m => m.id === activeModuleId);

      var [parts, setParts] = useState([]);
      var [selectedPartId, setSelectedPartId] = useState(null);
      var [currentTool, setCurrentTool] = useState(ToolType.NONE);
      var [explodedView, setExplodedView] = useState(false);
      var [engineRunning, setEngineRunning] = useState(false);

      var [currentStepId, setCurrentStepId] = useState(1);
      var [logs, setLogs] = useState([]);

      var [aiResponse, setAiResponse] = useState(null);
      var [isProcessingAI, setIsProcessingAI] = useState(false);
      var [activeAIProvider, setActiveAIProvider] = useState('qwen');
      var [sidebarVisible, setSidebarVisible] = useState(true);
      var [toolsVisible, setToolsVisible] = useState(true);

      useEffect(() => {
        if (activeModule) {
          setParts(activeModule.initialParts);
          setCurrentStepId(1);
          setLogs([]);
          setAiResponse(null);
          setCurrentTool(ToolType.NONE);
          addLog("\u5B9E\u8BAD\u5F00\u59CB: ".concat(activeModule.title), 'info');
          addLog("\u573A\u666F: ".concat(activeModule.description), 'info');
        }
      }, [activeModuleId]);

      var addLog = function addLog(message) {
        var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'info';
        var newLog = {
          id: Math.random().toString(36).substr(2, 9),
          timestamp: new Date(),
          message,
          type
        };
        setLogs(prev => [...prev, newLog]);
      };
      var getSelectedPart = () => parts.find(p => p.id === selectedPartId) || null;

      var handlePartClick = /*#__PURE__*/function () {
        var _ref8 = _asyncToGenerator(function* (part) {
          if (!activeModule) return;
          setSelectedPartId(part.id);
          addLog("\u9009\u4E2D\u90E8\u4EF6: ".concat(part.name));

          var currentTask = activeModule.procedureSteps.find(s => s.id === currentStepId);

          if (currentStepId === 1 && currentTool === ToolType.NONE) {
            if (currentTask && currentTask.requiredTool !== ToolType.NONE) {
              addLog("SOP\u8B66\u544A\uFF1A\u64CD\u4F5C\u524D\u8BF7\u5148\u7A7F\u6234/\u4F7F\u7528\uFF1A".concat(currentTask.requiredTool), 'error');
              return;
            }
          }

          var isInspectionTool = currentTool === ToolType.SCANNER || currentTool === ToolType.MULTIMETER || currentTool === ToolType.FLASHLIGHT || currentTool === ToolType.VERNIER_CALIPER || currentTool === ToolType.PRESSURE_GAUGE;
          var isDisassemblyTool = currentTool === ToolType.WRENCH || currentTool === ToolType.INSULATED_WRENCH || currentTool === ToolType.SCREWDRIVER;
          if (isInspectionTool) {
            addLog("\u6B63\u5728\u4F7F\u7528 ".concat(currentTool, " \u64CD\u4F5C ").concat(part.name, "..."), 'info');

            setIsProcessingAI(true);
            var analysis = yield generatePartAnalysis(part, currentTool, activeAIProvider);
            setAiResponse(analysis);
            setIsProcessingAI(false);

            if (currentTask) {
              var isCorrectPart = currentTask.targetPartId === part.id;
              var isCorrectTool = currentTask.requiredTool === currentTool;
              if (isCorrectPart && isCorrectTool) {
                completeStep(currentStepId);
              } else if (isCorrectTool && !isCorrectPart) {
                var _parts$find;
                addLog("\u64CD\u4F5C\u5BF9\u8C61\u9519\u8BEF\u3002\u5F53\u524D\u9700\u64CD\u4F5C\uFF1A".concat((_parts$find = parts.find(p => p.id === currentTask.targetPartId)) === null || _parts$find === void 0 ? void 0 : _parts$find.name), 'warning');
              } else if (isCorrectPart && !isCorrectTool) {
                addLog("\u5DE5\u5177\u9519\u8BEF\u3002\u8BF7\u4F7F\u7528\uFF1A".concat(currentTask.requiredTool), 'warning');
              }
            }
          } else if (isDisassemblyTool) {
            if (currentTask && currentTask.targetPartId === part.id && currentTask.requiredTool === currentTool) {
              completeStep(currentStepId);
              addLog("".concat(part.name, " \u62C6\u5378\u6210\u529F"), 'success');
            } else if (currentTask) {
              var _isCorrectPart = currentTask.targetPartId === part.id;
              var _isCorrectTool = currentTask.requiredTool === currentTool;
              if (_isCorrectTool && !_isCorrectPart) {
                var _parts$find2;
                addLog("\u64CD\u4F5C\u5BF9\u8C61\u9519\u8BEF\u3002\u5F53\u524D\u9700\u64CD\u4F5C\uFF1A".concat((_parts$find2 = parts.find(p => p.id === currentTask.targetPartId)) === null || _parts$find2 === void 0 ? void 0 : _parts$find2.name), 'warning');
              } else if (_isCorrectPart && !_isCorrectTool) {
                addLog("\u5DE5\u5177\u9519\u8BEF\u3002\u8BF7\u4F7F\u7528\uFF1A".concat(currentTask.requiredTool), 'warning');
              } else {
                addLog("\u6B63\u5728\u4F7F\u7528 ".concat(currentTool, " \u62C6\u5378 ").concat(part.name, "..."), 'info');
              }
            } else {
              addLog("\u6B63\u5728\u4F7F\u7528 ".concat(currentTool, " \u62C6\u5378 ").concat(part.name, "..."), 'info');
            }
          } else if (currentTool === ToolType.OIL_CAN) {
            addLog("\u6B63\u5728\u5BF9 ".concat(part.name, " \u8FDB\u884C\u6DA6\u6ED1\u4FDD\u517B..."), 'success');
            if (currentTask && currentTask.targetPartId === part.id && currentTask.requiredTool === ToolType.OIL_CAN) {
              completeStep(currentStepId);
            }
          }
        });
        return function handlePartClick(_x7) {
          return _ref8.apply(this, arguments);
        };
      }();
      var completeStep = stepId => {
        if (stepId === currentStepId && activeModule) {
          var step = activeModule.procedureSteps.find(s => s.id === stepId);
          addLog("\u6B65\u9AA4\u5B8C\u6210: ".concat(step === null || step === void 0 ? void 0 : step.title), 'success');
          setTimeout(() => {
            if (currentStepId < activeModule.procedureSteps.length) {
              setCurrentStepId(prev => prev + 1);
            } else {
              addLog("🎉 实训考核通过！", 'success');
            }
          }, 800);
        }
      };
      var handleToolSelect = tool => {
        setCurrentTool(tool);
        addLog("\u5207\u6362\u5DE5\u5177: ".concat(tool), 'info');

        if (activeModule) {
          var currentTask = activeModule.procedureSteps.find(s => s.id === currentStepId);
          if (currentTask && currentTask.requiredTool === tool) {
            if ([ToolType.GLOVES, ToolType.INSULATED_GLOVES, ToolType.ESD_STRAP].includes(tool)) {
              addLog("".concat(tool, " \u4F69\u6234\u6B63\u786E\uFF0C\u5B89\u5168\u68C0\u67E5\u901A\u8FC7\u3002"), 'success');
              completeStep(currentStepId);
            }
          }
        }
      };

      if (!activeModule) {
        return /*#__PURE__*/React.createElement(
          "div",
          { className: "w-full h-screen bg-slate-950 text-white font-sans p-8 overflow-y-auto custom-scrollbar" },
      /*#__PURE__*/React.createElement(
            "div",
            { className: "max-w-6xl mx-auto" },
        /*#__PURE__*/React.createElement(
              "header",
              { className: "mb-12 border-b border-slate-800 pb-6 flex items-end justify-between" },
          /*#__PURE__*/React.createElement(
                "div",
                null,
            /*#__PURE__*/React.createElement(
                  "h1",
                  { className: "text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-aviation-accent to-purple-400 mb-2 font-mono" },
                  "数专融合交互实训平台"
                )
              ),
          /*#__PURE__*/React.createElement(
                "div",
                { className: "flex items-center gap-2 text-sm text-slate-500" },
            /*#__PURE__*/React.createElement(User, { size: 16 }),
            /*#__PURE__*/React.createElement("span", null, "学员: 学员01")
              )
            ),
        /*#__PURE__*/React.createElement(
              "div",
              { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" },
              MODULES_CONFIG.map(module =>
            /*#__PURE__*/React.createElement(
                "div",
                {
                  key: module.id,
                  onClick: () => setActiveModuleId(module.id),
                  className: "group relative bg-slate-900 border border-slate-800 rounded-2xl p-6 hover:border-aviation-accent hover:shadow-[0_0_30px_rgba(56,189,248,0.1)] transition-all cursor-pointer overflow-hidden"
                },
              /*#__PURE__*/React.createElement(
                  "div",
                  { className: "absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity" },
                  module.category === 'Aviation' && /*#__PURE__*/React.createElement(Plane, { size: 120 }),
                  module.category === 'Automotive' && /*#__PURE__*/React.createElement(Zap, { size: 120 }),
                  module.category === 'Electronics' && /*#__PURE__*/React.createElement(Cpu, { size: 120 })
                ),
              /*#__PURE__*/React.createElement(
                  "div",
                  { className: "relative z-10" },
                /*#__PURE__*/React.createElement(
                    "div",
                    {
                      className: "\n                             inline-flex items-center gap-1.5 px-2 py-1 rounded text-xs font-bold mb-4\n                             ".concat(
                        module.difficulty === 'Advanced'
                          ? 'bg-red-500/10 text-red-400'
                          : module.difficulty === 'Intermediate'
                            ? 'bg-yellow-500/10 text-yellow-400'
                            : 'bg-green-500/10 text-green-400',
                        "\n                           "
                      )
                    },
                  /*#__PURE__*/React.createElement(GraduationCap, { size: 14 }),
                    module.difficulty === 'Advanced' ? '高级' : module.difficulty === 'Intermediate' ? '中级' : '初级'
                  ),
                /*#__PURE__*/React.createElement("h2", { className: "text-2xl font-bold mb-2" }, module.title),
                /*#__PURE__*/React.createElement(
                    "p",
                    { className: "text-slate-400 text-sm leading-relaxed mb-6 h-12" },
                    module.description
                  ),
                /*#__PURE__*/React.createElement(
                    "div",
                    { className: "flex items-center text-sm font-medium text-aviation-accent group-hover:translate-x-1 transition-transform" },
                    "开始实训 ",
                  /*#__PURE__*/React.createElement("span", { className: "ml-1" }, "→")
                  )
                )
              )
              )
            )
          )
        );
      }


      var renderScene = activeModule.useSketchfab ? /*#__PURE__*/React.createElement("div", {
        className: "absolute inset-0 z-10 bg-slate-900"
      }, /*#__PURE__*/React.createElement("iframe", {
        src: activeModule.sketchfabUrl,
        title: activeModule.title,
        className: "w-full h-full",
        frameBorder: "0",
        allow: "autoplay; fullscreen; xr-spatial-tracking",
        allowFullScreen: true
      })) : /*#__PURE__*/React.createElement("div", {
        className: "absolute inset-0 z-10"
      }, /*#__PURE__*/React.createElement(Canvas, {
        shadows: true,
        camera: {
          position: activeModule.cameraPosition,
          fov: 45
        }
      }, /*#__PURE__*/React.createElement("color", {
        attach: "background",
        args: ['#ffffff']
      }), /*#__PURE__*/React.createElement(Stars, {
        radius: 100,
        depth: 50,
        count: 5000,
        factor: 4,
        saturation: 0,
        fade: true,
        speed: 1
      }), /*#__PURE__*/React.createElement("ambientLight", {
        intensity: 0.5
      }), /*#__PURE__*/React.createElement("spotLight", {
        position: [10, 10, 10],
        angle: 0.15,
        penumbra: 1,
        intensity: 1,
        castShadow: true
      }), /*#__PURE__*/React.createElement("pointLight", {
        position: [-10, -10, -10],
        intensity: 0.5,
        color: "#38bdf8"
      }), /*#__PURE__*/React.createElement("group", {
        position: [0, -0.5, 0]
      }, /*#__PURE__*/React.createElement(Engine3D, {
        parts: parts,
        onPartClick: handlePartClick,
        selectedPartId: selectedPartId,
        explodedView: explodedView,
        engineRunning: engineRunning
      }), /*#__PURE__*/React.createElement(ContactShadows, {
        position: [0, -2, 0],
        opacity: 0.4,
        scale: 20,
        blur: 2.5,
        far: 4
      })), /*#__PURE__*/React.createElement(OrbitControls, {
        makeDefault: true,
        minPolarAngle: 0,
        maxPolarAngle: Math.PI / 1.5,
        enablePan: true,
        enableZoom: true
      }), /*#__PURE__*/React.createElement("hemisphereLight", {
        intensity: 0.6,
        groundColor: "#1e293b"
      })));

      return /*#__PURE__*/React.createElement("div", {
        className: "relative w-full h-screen bg-black overflow-hidden font-sans"
      }, renderScene, /*#__PURE__*/React.createElement("div", {
        className: "absolute top-6 right-6 z-50 flex gap-4"
      }, activeModule.category === 'Aviation' && /*#__PURE__*/React.createElement("button", {
        onClick: () => setEngineRunning(!engineRunning),
        className: "\n                        flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-md border transition-all\n                        ".concat(engineRunning ? 'bg-success text-white border-success shadow-[0_0_15px_rgba(16,185,129,0.4)]' : 'bg-slate-900/80 text-white border-slate-700 hover:border-slate-500', "\n                      ")
      }, engineRunning ? /*#__PURE__*/React.createElement(RotateCw, {
        size: 18,
        className: "animate-spin"
      }) : /*#__PURE__*/React.createElement(Play, {
        size: 18
      }), /*#__PURE__*/React.createElement("span", {
        className: "text-sm font-medium"
      }, engineRunning ? '运行中' : '试车')), /*#__PURE__*/React.createElement("button", {
        onClick: () => setExplodedView(!explodedView),
        className: "\n                    flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-md border transition-all\n                    ".concat(explodedView ? 'bg-aviation-accent text-aviation-blue border-aviation-accent' : 'bg-slate-900/80 text-white border-slate-700 hover:border-slate-500', "\n                  ")
      }, explodedView ? /*#__PURE__*/React.createElement(Minimize2, {
        size: 18
      }) : /*#__PURE__*/React.createElement(Maximize2, {
        size: 18
      }), /*#__PURE__*/React.createElement("span", {
        className: "text-sm font-medium"
      }, "\u62C6\u89E3\u89C6\u56FE")), /*#__PURE__*/React.createElement("button", {
        onClick: () => setActiveModuleId(null),
        className: "flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-md border bg-slate-900/80 text-white border-slate-700 hover:bg-slate-800"
      }, /*#__PURE__*/React.createElement(ArrowLeft, {
        size: 18
      }), /*#__PURE__*/React.createElement("span", {
        className: "text-sm font-medium"
      }, "\u8FD4\u56DE\u5927\u5385")), /*#__PURE__*/React.createElement("button", {
        onClick: () => setSidebarVisible(!sidebarVisible),
        className: "flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-md border bg-slate-900/80 text-white border-slate-700 hover:bg-slate-800"
      }, /*#__PURE__*/React.createElement(MousePointer2, {
        size: 18
      }), /*#__PURE__*/React.createElement("span", {
        className: "text-sm font-medium"
      }, sidebarVisible ? '隐藏左侧面板' : '显示左侧面板')), /*#__PURE__*/React.createElement("button", {
        onClick: () => setToolsVisible(!toolsVisible),
        className: "flex items-center gap-2 px-4 py-2 rounded-lg backdrop-blur-md border bg-slate-900/80 text-white border-slate-700 hover:bg-slate-800"
      }, /*#__PURE__*/React.createElement(Wrench, {
        size: 18
      }), /*#__PURE__*/React.createElement("span", {
        className: "text-sm font-medium"
      }, toolsVisible ? '隐藏工具栏' : '显示工具栏'))), sidebarVisible ? /*#__PURE__*/React.createElement(Sidebar, {
        selectedPart: getSelectedPart(),
        currentStep: currentStepId,
        steps: activeModule.procedureSteps,
        logs: logs,
        onStepComplete: completeStep,
        aiResponse: aiResponse,
        isProcessingAI: isProcessingAI,
        activeProvider: activeAIProvider,
        onProviderChange: setActiveAIProvider,
        taskData: activeModule && activeModule.hasModelingWorkshop ? activeModule.taskData : null
      }) : /*#__PURE__*/React.createElement("button", {
        className: "absolute left-6 top-6 z-40 px-3 py-2 rounded-lg bg-slate-900/80 text-white border border-slate-700 hover:border-aviation-accent pointer-events-auto",
        onClick: () => setSidebarVisible(true)
      }, "\u663E\u793A\u5DE6\u4FA7\u9762\u677F"), toolsVisible && /*#__PURE__*/React.createElement(ToolsPanel, {
        currentTool: currentTool,
        onSelectTool: handleToolSelect,
        allowedTools: activeModule.availableTools
      }), /*#__PURE__*/React.createElement("div", {
        className: "absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.6)_100%)] z-20"
      }));
    };
    var root = createRoot(document.getElementById('root'));
    root.render(/*#__PURE__*/React.createElement(App, null));
  </script>
</body>

</html>